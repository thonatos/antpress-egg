<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.png"><style class="_styletron_hydrate_"></style><title>Loader</title><meta name="description" content="Born to build better enterprise frameworks and apps"><link href="/static/css/post.d62265dc.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="ant-layout" data-reactroot=""><div class="header-module__header___3ADJ9 ant-layout-header"><div class="ant-row-flex"><div class="ant-col-xs-12 ant-col-md-20 ant-col-lg-2"><div class="header-module__logo___3yTXp"><a href="/"><img src="/logo.svg" alt="logo"/></a></div></div><div class="ant-col-xs-0 ant-col-md-0 ant-col-lg-20"><ul class="ant-menu header-module__menu___3yEtW ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/intro/">指南</a></li><li class="ant-menu-item" role="menuitem"><a href="/api/">API</a></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/tutorials/index.html">教程</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/search?q=topic%3Aegg-plugin&amp;type=Repositories">插件</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/eggjs/egg/releases">发布日志</a></li></ul></div><div style="text-align:right" class="ant-col-xs-12 ant-col-md-4 ant-col-lg-2"><button type="button" class="ant-btn"><span>Languages</span></button></div></div></div><div class="ant-layout-content"><div class="basic_layout-module__content___3flpY ant-layout"><div class="sider-module__side___1Cadj ant-layout-sider ant-layout-sider-light" style="flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"><ul class="ant-menu sider-module__menu___2GqPr ant-menu-light ant-menu-root ant-menu-inline" role="menu"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="0$Menu" aria-haspopup="true"><span>新手指南</span><i class="ant-menu-submenu-arrow"></i></div><ul id="0$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/index.html">Egg.js 是什么?</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/egg-and-koa.html">Egg.js 和 Koa</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/quickstart.html">快速入门</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/progressive.html">渐进式开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/migration.html">2.x 升级指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="1$Menu" aria-haspopup="true"><span>基础功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="1$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/structure.html">目录结构</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/objects.html">内置对象</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/env.html">运行环境</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/config.html">配置</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/middleware.html">中间件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/router.html">Router</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/controller.html">Controller</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/service.html">Service</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/plugin.html">插件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/schedule.html">定时任务</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/extend.html">框架扩展</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/app-start.html">启动自定义</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="2$Menu" aria-haspopup="true"><span>核心功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="2$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/development.html">本地开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/unittest.html">单元测试</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/deployment.html">应用部署</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/logger.html">日志</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/httpclient.html">HttpClient</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cookie-and-session.html">Cookie and Session</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cluster-and-ipc.html">多进程模型和进程间通讯</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/view.html">模板渲染</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/error-handling.html">异常处理</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/security.html">安全</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/i18n.html">国际化</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="3$Menu" aria-haspopup="true"><span>教程</span><i class="ant-menu-submenu-arrow"></i></div><ul id="3$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/mysql.html">MySQL</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/restful.html">RESTful API</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/passport.html">Passport 鉴权</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/socketio.html">Socket.IO</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/assets.html">静态资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/typescript.html">TypeScript</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="4$Menu" aria-haspopup="true"><span>进阶</span><i class="ant-menu-submenu-arrow"></i></div><ul id="4$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/loader.html">Loader</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/plugin.html">插件开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/framework.html">框架开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/cluster-client.html">多进程研发模式增强</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/view-plugin.html">模板插件开发规范</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/style-guide.html">代码风格指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="5$Menu" aria-haspopup="true"><span>社区</span><i class="ant-menu-submenu-arrow"></i></div><ul id="5$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/plugins/">内置插件列表</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/contributing.html">如何贡献</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/resource.html">资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/faq.html">常见问题</a></li></ul></li></ul></div></div><div class="basic_layout-module__post___2Z7KK ant-layout-content"><div class="ant-row" style="margin-left:-8px;margin-right:-8px"><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-24 ant-col-md-18"><div class="markdown-body" style="font-size:14px"><div><p>Egg 在 Koa 的基础上进行增强最重要的就是基于一定的约定，根据功能差异将代码放到不同的目录下管理，对整体团队的开发成本提升有着明显的效果。Loader 实现了这套约定，并抽象了很多底层 API 可以进一步扩展。</p><h2 id="应用-框架和插件">应用、框架和插件</h2><p>Egg 是一个底层框架，应用可以直接使用，但 Egg 本身的插件比较少，应用需要自己配置插件增加各种特性，比如 MySQL。</p><pre><code class="language-js">// 应用配置
// package.json
{
  &quot;dependencies&quot;: {
    &quot;egg&quot;: &quot;^2.0.0&quot;,
    &quot;egg-mysql&quot;: &quot;^3.0.0&quot;
  }
}

// config/plugin.js
module.exports = {
  mysql: {
    enable: true,
    package: &#x27;egg-mysql&#x27;,
  },
}</code></pre><p>当应用达到一定数量，我们会发现大部分应用的配置都是类似的，这时可以基于 Egg 扩展出一个框架，应用的配置就会简化很多。</p><pre><code class="language-js">// 框架配置
// package.json
{
  &quot;name&quot;: &quot;framework1&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;dependencies&quot;: {
    &quot;egg-mysql&quot;: &quot;^3.0.0&quot;,
    &quot;egg-view-nunjucks&quot;: &quot;^2.0.0&quot;
  }
}

// config/plugin.js
module.exports = {
  mysql: {
    enable: false,
    package: &#x27;egg-mysql&#x27;,
  },
  view: {
    enable: false,
    package: &#x27;egg-view-nunjucks&#x27;,
  }
}

// 应用配置
// package.json
{
  &quot;dependencies&quot;: {
    &quot;framework1&quot;: &quot;^1.0.0&quot;,
  }
}

// config/plugin.js
module.exports = {
  // 开启插件
  mysql: true,
  view: true,
}</code></pre><p>从上面的使用场景可以看到应用、插件和框架三者之间的关系。</p><ul><li>我们在应用中完成业务，需要指定一个框架才能运行起来，当需要某个特性场景的功能时可以配置插件（比如 MySQL）。</li><li>插件只完成特定功能，当两个独立的功能有互相依赖时，还是分开两个插件，但需要配置依赖。</li><li>框架是一个启动器（默认就是 Egg），必须有它才能运行起来。框架还是一个封装器，将插件的功能聚合起来统一提供，框架也可以配置插件。</li><li>在框架的基础上还可以扩展出新的框架，也就是说<strong>框架是可以无限级继承的</strong>，有点像类的继承。</li></ul><pre><code>+-----------------------------------+--------+
|      app1, app2, app3, app4       |        |
+-----+--------------+--------------+        |
|     |              |  framework3  |        |
+     |  framework1  +--------------+ plugin |
|     |              |  framework2  |        |
+     +--------------+--------------+        |
|                   Egg             |        |
+-----------------------------------+--------|
|                   Koa                      |
+-----------------------------------+--------+</code></pre><h2 id="loadunit">loadUnit</h2><p>Egg 将应用、框架和插件都称为加载单元（loadUnit），因为在代码结构上几乎没有什么差异，下面是目录结构</p><pre><code>loadUnit
├── package.json
├── app.js
├── agent.js
├── app
│   ├── extend
│   |   ├── helper.js
│   |   ├── request.js
│   |   ├── response.js
│   |   ├── context.js
│   |   ├── application.js
│   |   └── agent.js
│   ├── service
│   ├── middleware
│   └── router.js
└── config
    ├── config.default.js
    ├── config.prod.js
    ├── config.test.js
    ├── config.local.js
    └── config.unittest.js</code></pre><p>不过还存在着一些差异</p><table><thead><tr><th>文件</th><th>应用</th><th>框架</th><th>插件</th></tr></thead><tbody><tr><td>package.json</td><td>✔︎</td><td>✔︎</td><td>✔︎</td></tr><tr><td>config/plugin.{env}.js</td><td>✔︎</td><td>✔︎</td><td></td></tr><tr><td>config/config.{env}.js</td><td>✔︎</td><td>✔︎</td><td>✔︎</td></tr><tr><td>app/extend/application.js</td><td>✔︎</td><td>✔︎</td><td>✔︎</td></tr><tr><td>app/extend/request.js</td><td>✔︎</td><td>✔︎</td><td>✔︎</td></tr><tr><td>app/extend/response.js</td><td>✔︎</td><td>✔︎</td><td>✔︎</td></tr><tr><td>app/extend/context.js</td><td>✔︎</td><td>✔︎</td><td>✔︎</td></tr><tr><td>app/extend/helper.js</td><td>✔︎</td><td>✔︎</td><td>✔︎</td></tr><tr><td>agent.js</td><td>✔︎</td><td>✔︎</td><td>✔︎</td></tr><tr><td>app.js</td><td>✔︎</td><td>✔︎</td><td>✔︎</td></tr><tr><td>app/service</td><td>✔︎</td><td>✔︎</td><td>✔︎</td></tr><tr><td>app/middleware</td><td>✔︎</td><td>✔︎</td><td>✔︎</td></tr><tr><td>app/controller</td><td>✔︎</td><td></td><td></td></tr><tr><td>app/router.js</td><td>✔︎</td><td></td><td></td></tr></tbody></table><p>文件按表格内的顺序自上而下加载</p><p>在加载过程中，Egg 会遍历所有的 loadUnit 加载上述的文件（应用、框架、插件各有不同），加载时有一定的优先级</p><ul><li>按插件 =&gt; 框架 =&gt; 应用依次加载</li><li>插件之间的顺序由依赖关系决定，被依赖方先加载，无依赖按 object key 配置顺序加载，具体可以查看<a href="./plugin.md">插件章节</a></li><li>框架按继承顺序加载，越底层越先加载。</li></ul><p>比如有这样一个应用配置了如下依赖</p><pre><code>app
| ├── plugin2 (依赖 plugin3)
| └── plugin3
└── framework1
    | └── plugin1
    └── egg</code></pre><p>最终的加载顺序为</p><pre><code>=&gt; plugin1
=&gt; plugin3
=&gt; plugin2
=&gt; egg
=&gt; framework1
=&gt; app</code></pre><p>plugin1 为 framework1 依赖的插件，配置合并后 object key 的顺序会优先于 plugin2/plugin3。因为 plugin2 和 plugin3 的依赖关系，所以交换了位置。framework1 继承了 egg，顺序会晚于 egg。应用最后加载。</p><p>请查看 <a href="https://github.com/eggjs/egg-core/blob/65ea778a4f2156a9cebd3951dac12c4f9455e636/lib/loader/egg_loader.js#L233">Loader.getLoadUnits</a> 方法</p><h3 id="文件顺序">文件顺序</h3><p>上面已经列出了默认会加载的文件，Egg 会按如下文件顺序加载，每个文件或目录再根据 loadUnit 的顺序去加载（应用、框架、插件各有不同）。</p><ul><li>加载 <a href="./plugin.md">plugin</a>，找到应用和框架，加载 <code>config/plugin.js</code></li><li>加载 <a href="../basics/config.md">config</a>，遍历 loadUnit 加载 <code>config/config.{env}.js</code></li><li>加载 <a href="../basics/extend.md">extend</a>，遍历 loadUnit 加载 <code>app/extend/xx.js</code></li><li><a href="../basics/app-start.md">自定义初始化</a>，遍历 loadUnit 加载 <code>app.js</code> 和 <code>agent.js</code></li><li>加载 <a href="../basics/service.md">service</a>，遍历 loadUnit 加载 <code>app/service</code> 目录</li><li>加载 <a href="../basics/middleware.md">middleware</a>，遍历 loadUnit 加载 <code>app/middleware</code> 目录</li><li>加载 <a href="../basics/controller.md">controller</a>，加载应用的 <code>app/controller</code> 目录</li><li>加载 <a href="../basics/router.md">router</a>，加载应用的 <code>app/router.js</code></li></ul><p>注意</p><ul><li>加载时如果遇到同名的会覆盖，比如想要覆盖 <code>ctx.ip</code> 可以直接在应用的 <code>app/extend/context.js</code> 定义 ip 就可以了。</li><li>应用完整启动顺序查看<a href="./framework.md">框架开发</a></li></ul><h3 id="生命周期">生命周期</h3><p>Egg提供了应用启动(<code>beforeStart</code>), 启动完成(<code>ready</code>), 关闭(<code>beforeClose</code>)这三个生命周期方法。</p><pre><code>   init master process
           ⬇
init agent worker process
           ⬇
loader.load | beforeStart
           ⬇
 await agent worker ready
           ⬇
   call ready callback
           ⬇
init app worker processes
           ⬇
loader.load | beforeStart
           ⬇
 await app workers ready
           ⬇
   call ready callback
           ⬇
send egg-ready to master,
    agent,app workers</code></pre><h2 id="beforestart">beforeStart</h2><p><code>beforeStart</code> 方法在 loading 过程中调用, 所有的方法并行执行。 一般用来执行一些异步方法, 例如检查连接状态等, 比如 <a href="https://github.com/eggjs/egg-mysql/blob/master/lib/mysql.js"><code>egg-mysql</code></a> 就用 <code>beforeStart</code> 来检查与 mysql 的连接状态。所有的 <code>beforeStart</code> 任务结束后, 状态将会进入 <code>ready</code> 。不建议执行一些耗时较长的方法, 可能会导致应用启动超时。</p><h2 id="ready">ready</h2><p><code>ready</code> 方法注册的任务在 load 结束并且所有的 <code>beforeStart</code> 方法执行结束后顺序执行, HTTP server 监听也是在这个时候开始, 此时代表所有的插件已经加载完毕并且准备工作已经完成, 一般用来执行一些启动的后置任务。</p><h2 id="beforeclose">beforeClose</h2><p><code>beforeClose</code> 注册方法在 app/agent 实例的 <code>close</code> 方法被调用后, 按注册的逆序执行。一般用于资源的释放操作, 例如 <a href="https://github.com/eggjs/egg/blob/master/lib/egg.js"><code>egg</code></a> 用来关闭 logger , 删除监听方法等。</p><p><strong>这个方法不建议在生产环境使用, 可能遇到未执行完就结束进程的问题。</strong></p><p>e.g.:</p><pre><code class="language-js">// app.js
console.time(&#x27;app before start 200ms&#x27;);
console.time(&#x27;app before start 100ms&#x27;);

app.beforeStart(async () =&gt; {
  await sleep(200);
  console.timeEnd(&#x27;app before start 200ms&#x27;);
});

app.beforeStart(async () =&gt; {
  await sleep(100);
  console.timeEnd(&#x27;app before start 100ms&#x27;);
});

app.on(&#x27;server&#x27;, () =&gt; {
  console.log(&#x27;server is ready&#x27;);
});

app.ready(() =&gt; {
  console.log(&#x27;app ready&#x27;);
  cp.execSync(`kill ${process.ppid}`);
  console.time(&#x27;app before close 100ms&#x27;);
  console.time(&#x27;app before close 200ms&#x27;);
});

app.beforeClose(async () =&gt; {
  await sleep(200);
  console.timeEnd(&#x27;app before close 200ms&#x27;);
});

app.beforeClose(async () =&gt; {
  await sleep(100);
  console.timeEnd(&#x27;app before close 100ms&#x27;);
});

// agent.js
console.time(&#x27;agent before start 200ms&#x27;);
console.time(&#x27;agent before start 100ms&#x27;);

agent.beforeStart(async () =&gt; {
  await sleep(200);
  console.timeEnd(&#x27;agent before start 200ms&#x27;);
});

agent.beforeStart(async () =&gt; {
  await sleep(100);
  console.timeEnd(&#x27;agent before start 100ms&#x27;);
});

agent.ready(() =&gt; {
  console.log(&#x27;agent ready&#x27;);
  console.time(&#x27;agent before close 200ms&#x27;);
  console.time(&#x27;agent before close 100ms&#x27;);
});

agent.beforeClose(async () =&gt; {
  await sleep(200);
  console.timeEnd(&#x27;agent before close 200ms&#x27;);
});

agent.beforeClose(async () =&gt; {
  await sleep(100);
  console.timeEnd(&#x27;agent before close 100ms&#x27;);
});</code></pre><p>print:</p><pre><code>agent before start 100ms: 131.096ms
agent before start 200ms: 224.396ms // 并行执行

agent ready

app before start 100ms: 147.546ms
app before start 200ms: 245.405ms // 并行执行

app ready

// 开流量
server is ready

agent before close 100ms: 866.218ms
app before close 100ms: 108.007ms // LIFO, 后注册先执行
app before close 200ms: 310.549ms // 串行执行
agent before close 200ms: 1070.865ms</code></pre><p>可以使用 <a href="https://github.com/eggjs/egg-development#loader-trace"><code>egg-development</code></a> 来查看加载过程。</p><h3 id="文件加载规则">文件加载规则</h3><p>框架在加载文件时会进行转换，因为文件命名风格和 API 风格存在差异。我们推荐文件使用下划线，而 API 使用驼峰。比如 <code>app/service/user_info.js</code> 会转换成 <code>app.service.userInfo</code>。</p><p>框架也支持连字符和驼峰的方式</p><ul><li><code>app/service/user-info.js</code> =&gt; <code>app.service.userInfo</code></li><li><code>app/service/userInfo.js</code> =&gt; <code>app.service.userInfo</code></li></ul><p>Loader 还提供了 <a href="#caseStyle-string">caseStyle</a> 强制指定首字母大小写，比如加载 model 时 API 首字母大写，<code>app/model/user.js</code> =&gt; <code>app.model.User</code>，就可以指定 <code>caseStyle: &#x27;upper&#x27;</code>。</p><h2 id="扩展-loader">扩展 Loader</h2><p><a href="https://github.com/eggjs/egg-core/blob/master/lib/loader/egg_loader.js">Loader</a> 是一个基类，并根据文件加载的规则提供了一些内置的方法，但基本本身并不会去调用，而是由继承类调用。</p><ul><li>loadPlugin()</li><li>loadConfig()</li><li>loadAgentExtend()</li><li>loadApplicationExtend()</li><li>loadRequestExtend()</li><li>loadResponseExtend()</li><li>loadContextExtend()</li><li>loadHelperExtend()</li><li>loadCustomAgent()</li><li>loadCustomApp()</li><li>loadService()</li><li>loadMiddleware()</li><li>loadController()</li><li>loadRouter()</li></ul><p>Egg 基于 Loader 实现了 <a href="https://github.com/eggjs/egg/blob/master/lib/loader/app_worker_loader.js">AppWorkerLoader</a> 和 <a href="https://github.com/eggjs/egg/blob/master/lib/loader/agent_worker_loader.js">AgentWorkerLoader</a>，上层框架基于这两个类来扩展，<strong>Loader 的扩展只能在框架进行</strong>。</p><pre><code class="language-js">// 自定义 AppWorkerLoader
// lib/framework.js
const path = require(&#x27;path&#x27;);
const egg = require(&#x27;egg&#x27;);
const EGG_PATH = Symbol.for(&#x27;egg#eggPath&#x27;);

class YadanAppWorkerLoader extends egg.AppWorkerLoader {
  constructor(opt) {
    super(opt);
    // 自定义初始化
  }

  loadConfig() {
    super.loadConfig();
    // 对 config 进行处理
  }

  load() {
    super.load();
    // 自定义加载其他目录
    // 或对已加载的文件进行处理
  }
}

class Application extends egg.Application {
  get [EGG_PATH]() {
    return path.dirname(__dirname);
  }
  // 覆盖 Egg 的 Loader，启动时使用这个 Loader
  get [EGG_LOADER]() {
    return YadanAppWorkerLoader;
  }
}

module.exports = Object.assign(egg, {
  Application,
  // 自定义的 Loader 也需要 export，上层框架需要基于这个扩展
  AppWorkerLoader: YadanAppWorkerLoader,
});</code></pre><p>通过 Loader 提供的这些 API，可以很方便的定制团队的自定义加载，如 <code>this.model.xx</code>， <code>app/extend/filter.js</code> 等等。</p><p>以上只是说明 Loader 的写法，具体可以查看<a href="./framework.md">框架开发</a>。</p><h2 id="loader-api">Loader API</h2><p>Loader 还提供一些底层的 API，在扩展时可以简化代码，全部 API 请<a href="https://github.com/eggjs/egg-core#eggloader">查看</a></p><h3 id="loadfile">loadFile</h3><p>用于加载一个文件，比如加载 <code>app.js</code> 就是使用这个方法。</p><pre><code class="language-js">// app/xx.js
module.exports = app =&gt; {
  console.log(app.config);
};

// app.js
// 以 app/xx.js 为例，我们可以在 app.js 加载这个文件
const path = require(&#x27;path&#x27;);
module.exports = app =&gt; {
  app.loader.loadFile(path.join(app.config.baseDir, &#x27;app/xx.js&#x27;));
};</code></pre><p>如果文件 export 一个函数会被调用，并将 app 作为参数，否则直接使用这个值。</p><h3 id="loadtoapp">loadToApp</h3><p>用于加载一个目录下的文件到 app，比如 <code>app/controller/home.js</code> 会加载到 <code>app.controller.home</code>。</p><pre><code class="language-js">// app.js
// 以下只是示例，加载 controller 请用 loadController
module.exports = app =&gt; {
  const directory = path.join(app.config.baseDir, &#x27;app/controller&#x27;);
  app.loader.loadToApp(directory, &#x27;controller&#x27;);
};</code></pre><p>一共有三个参数 <code>loadToApp(directory, property, LoaderOptions)</code></p><ol><li>directory 可以为 String 或 Array，Loader 会从这些目录加载文件</li><li>property 为 app 的属性</li><li><a href="#LoaderOptions">LoaderOptions</a> 为一些配置</li></ol><h3 id="loadtocontext">loadToContext</h3><p>与 loadToApp 有一点差异，loadToContext 是加载到 ctx 上而非 app，而且是懒加载。加载时会将文件都放到一个临时对象上，在调用 ctx API 时才实例化对象。</p><p>比如 service 的加载就是使用这种模式</p><pre><code class="language-js">// 以下为示例，请使用 loadService
// app/service/user.js
const Service = require(&#x27;egg&#x27;).Service;
class UserService extends Service {

}
module.exports = UserService;

// app.js
// 获取所有的 loadUnit
const servicePaths = app.loader.getLoadUnits().map(unit =&gt; path.join(unit.path, &#x27;app/service&#x27;));

app.loader.loadToContext(servicePaths, &#x27;service&#x27;, {
  // service 需要继承 app.Service，所以要拿到 app 参数
  // 设置 call 在加载时会调用函数返回 UserService
  call: true,
  // 将文件加载到 app.serviceClasses
  fieldClass: &#x27;serviceClasses&#x27;,
});</code></pre><p>文件加载后 <code>app.serviceClasses.user</code> 就是 UserService，当调用 <code>ctx.service.user</code> 时会实例化 UserService，
所以这个类只有每次请求中首次访问时才会实例化，实例化后会被缓存，同一个请求多次调用也只会实例化一次。</p><h3 id="loaderoptions">LoaderOptions</h3><h4 id="ignore-string">ignore <a href="">String</a></h4><p>ignore 可以忽略一些文件，支持 glob，默认为空</p><pre><code class="language-js">app.loader.loadToApp(directory, &#x27;controller&#x27;, {
  // 忽略 app/controller/util 下的文件
  ignore: &#x27;util/**&#x27;,
});</code></pre><h4 id="initializer-function">initializer <a href="">Function</a></h4><p>对每个文件 export 出来的值进行处理，默认为空</p><pre><code class="language-js">// app/model/user.js
module.exports = class User {
  constructor(app, path) {}
}

// 从 app/model 目录加载，加载时可做一些初始化处理
const directory = path.join(app.config.baseDir, &#x27;app/model&#x27;);
app.loader.loadToApp(directory, &#x27;model&#x27;, {
  initializer(model, opt) {
    // 第一个参数为 export 的对象
    // 第二个参数为一个对象，只包含当前文件的路径
    return new model(app, opt.path);
  },
});</code></pre><h4 id="casestyle-string">caseStyle <a href="">String</a></h4><p>文件的转换规则，可选为 <code>camel</code>，<code>upper</code>，<code>lower</code>，默认为 <code>camel</code>。</p><p>三者都会将文件名转换成驼峰，但是对于首字母的处理有所不同。</p><ul><li><code>camel</code>：首字母不变。</li><li><code>upper</code>：首字母大写。</li><li><code>lower</code>：首字母小写。</li></ul><p>在加载不同文件时配置不同</p><table><thead><tr><th>文件</th><th>配置</th></tr></thead><tbody><tr><td>app/controller</td><td>lower</td></tr><tr><td>app/middleware</td><td>lower</td></tr><tr><td>app/service</td><td>lower</td></tr></tbody></table><h4 id="override-boolean">override <a href="">Boolean</a></h4><p>遇到已经存在的文件时是直接覆盖还是抛出异常，默认为 false</p><p>比如同时加载应用和插件的 <code>app/service/user.js</code> 文件，如果为 true 应用会覆盖插件的，否则加载应用的文件时会报错。</p><p>在加载不同文件时配置不同</p><table><thead><tr><th>文件</th><th>配置</th></tr></thead><tbody><tr><td>app/controller</td><td>true</td></tr><tr><td>app/middleware</td><td>false</td></tr><tr><td>app/service</td><td>false</td></tr></tbody></table><h4 id="call-boolean">call <a href="">Boolean</a></h4><p>当 export 的对象为函数时则调用，并获取返回值，默认为 true</p><p>在加载不同文件时配置不同</p><table><thead><tr><th>文件</th><th>配置</th></tr></thead><tbody><tr><td>app/controller</td><td>true</td></tr><tr><td>app/middleware</td><td>false</td></tr><tr><td>app/service</td><td>true</td></tr></tbody></table></div></div></div><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-0 ant-col-md-6"><div class="markdown-body" style="font-size:14px"><div><ul><li><a href="#%E5%BA%94%E7%94%A8-%E6%A1%86%E6%9E%B6%E5%92%8C%E6%8F%92%E4%BB%B6">应用、框架和插件</a></li><li><a href="#loadunit">loadUnit</a><ul><li><a href="#%E6%96%87%E4%BB%B6%E9%A1%BA%E5%BA%8F">文件顺序</a></li><li><a href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">生命周期</a></li></ul></li><li><a href="#beforestart">beforeStart</a></li><li><a href="#ready">ready</a></li><li><a href="#beforeclose">beforeClose</a><ul><li><a href="#%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E8%A7%84%E5%88%99">文件加载规则</a></li></ul></li><li><a href="#%E6%89%A9%E5%B1%95-loader">扩展 Loader</a></li><li><a href="#loader-api">Loader API</a><ul><li><a href="#loadfile">loadFile</a></li><li><a href="#loadtoapp">loadToApp</a></li><li><a href="#loadtocontext">loadToContext</a></li><li><a href="#loaderoptions">LoaderOptions</a><ul><li><a href="#ignore-string">ignore [String]</a></li><li><a href="#initializer-function">initializer [Function]</a></li><li><a href="#casestyle-string">caseStyle [String]</a></li><li><a href="#override-boolean">override [Boolean]</a></li><li><a href="#call-boolean">call [Boolean]</a></li></ul></li></ul></li></ul></div></div></div></div></div></div></div></div></div><script type="text/javascript">window.__INIT_STATE__={"lang":"zh","props":{"toc":"-%20%5B%E5%BA%94%E7%94%A8%E3%80%81%E6%A1%86%E6%9E%B6%E5%92%8C%E6%8F%92%E4%BB%B6%5D(%23%25E5%25BA%2594%25E7%2594%25A8-%25E6%25A1%2586%25E6%259E%25B6%25E5%2592%258C%25E6%258F%2592%25E4%25BB%25B6)%0A-%20%5BloadUnit%5D(%23loadunit)%0A%20%20*%20%5B%E6%96%87%E4%BB%B6%E9%A1%BA%E5%BA%8F%5D(%23%25E6%2596%2587%25E4%25BB%25B6%25E9%25A1%25BA%25E5%25BA%258F)%0A%20%20*%20%5B%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%5D(%23%25E7%2594%259F%25E5%2591%25BD%25E5%2591%25A8%25E6%259C%259F)%0A-%20%5BbeforeStart%5D(%23beforestart)%0A-%20%5Bready%5D(%23ready)%0A-%20%5BbeforeClose%5D(%23beforeclose)%0A%20%20*%20%5B%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E8%A7%84%E5%88%99%5D(%23%25E6%2596%2587%25E4%25BB%25B6%25E5%258A%25A0%25E8%25BD%25BD%25E8%25A7%2584%25E5%2588%2599)%0A-%20%5B%E6%89%A9%E5%B1%95%20Loader%5D(%23%25E6%2589%25A9%25E5%25B1%2595-loader)%0A-%20%5BLoader%20API%5D(%23loader-api)%0A%20%20*%20%5BloadFile%5D(%23loadfile)%0A%20%20*%20%5BloadToApp%5D(%23loadtoapp)%0A%20%20*%20%5BloadToContext%5D(%23loadtocontext)%0A%20%20*%20%5BLoaderOptions%5D(%23loaderoptions)%0A%20%20%20%20%2B%20%5Bignore%20%5BString%5D%5D(%23ignore-string)%0A%20%20%20%20%2B%20%5Binitializer%20%5BFunction%5D%5D(%23initializer-function)%0A%20%20%20%20%2B%20%5BcaseStyle%20%5BString%5D%5D(%23casestyle-string)%0A%20%20%20%20%2B%20%5Boverride%20%5BBoolean%5D%5D(%23override-boolean)%0A%20%20%20%20%2B%20%5Bcall%20%5BBoolean%5D%5D(%23call-boolean)","meta":{"info":{"title":"Loader"}},"content":"%0A%0A%0AEgg%20%E5%9C%A8%20Koa%20%E7%9A%84%E5%9F%BA%E7%A1%80%E4%B8%8A%E8%BF%9B%E8%A1%8C%E5%A2%9E%E5%BC%BA%E6%9C%80%E9%87%8D%E8%A6%81%E7%9A%84%E5%B0%B1%E6%98%AF%E5%9F%BA%E4%BA%8E%E4%B8%80%E5%AE%9A%E7%9A%84%E7%BA%A6%E5%AE%9A%EF%BC%8C%E6%A0%B9%E6%8D%AE%E5%8A%9F%E8%83%BD%E5%B7%AE%E5%BC%82%E5%B0%86%E4%BB%A3%E7%A0%81%E6%94%BE%E5%88%B0%E4%B8%8D%E5%90%8C%E7%9A%84%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%AE%A1%E7%90%86%EF%BC%8C%E5%AF%B9%E6%95%B4%E4%BD%93%E5%9B%A2%E9%98%9F%E7%9A%84%E5%BC%80%E5%8F%91%E6%88%90%E6%9C%AC%E6%8F%90%E5%8D%87%E6%9C%89%E7%9D%80%E6%98%8E%E6%98%BE%E7%9A%84%E6%95%88%E6%9E%9C%E3%80%82Loader%20%E5%AE%9E%E7%8E%B0%E4%BA%86%E8%BF%99%E5%A5%97%E7%BA%A6%E5%AE%9A%EF%BC%8C%E5%B9%B6%E6%8A%BD%E8%B1%A1%E4%BA%86%E5%BE%88%E5%A4%9A%E5%BA%95%E5%B1%82%20API%20%E5%8F%AF%E4%BB%A5%E8%BF%9B%E4%B8%80%E6%AD%A5%E6%89%A9%E5%B1%95%E3%80%82%0A%0A%23%23%20%E5%BA%94%E7%94%A8%E3%80%81%E6%A1%86%E6%9E%B6%E5%92%8C%E6%8F%92%E4%BB%B6%0A%0AEgg%20%E6%98%AF%E4%B8%80%E4%B8%AA%E5%BA%95%E5%B1%82%E6%A1%86%E6%9E%B6%EF%BC%8C%E5%BA%94%E7%94%A8%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8%EF%BC%8C%E4%BD%86%20Egg%20%E6%9C%AC%E8%BA%AB%E7%9A%84%E6%8F%92%E4%BB%B6%E6%AF%94%E8%BE%83%E5%B0%91%EF%BC%8C%E5%BA%94%E7%94%A8%E9%9C%80%E8%A6%81%E8%87%AA%E5%B7%B1%E9%85%8D%E7%BD%AE%E6%8F%92%E4%BB%B6%E5%A2%9E%E5%8A%A0%E5%90%84%E7%A7%8D%E7%89%B9%E6%80%A7%EF%BC%8C%E6%AF%94%E5%A6%82%20MySQL%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE%0A%2F%2F%20package.json%0A%7B%0A%20%20%22dependencies%22%3A%20%7B%0A%20%20%20%20%22egg%22%3A%20%22%5E2.0.0%22%2C%0A%20%20%20%20%22egg-mysql%22%3A%20%22%5E3.0.0%22%0A%20%20%7D%0A%7D%0A%0A%2F%2F%20config%2Fplugin.js%0Amodule.exports%20%3D%20%7B%0A%20%20mysql%3A%20%7B%0A%20%20%20%20enable%3A%20true%2C%0A%20%20%20%20package%3A%20'egg-mysql'%2C%0A%20%20%7D%2C%0A%7D%0A%60%60%60%0A%0A%E5%BD%93%E5%BA%94%E7%94%A8%E8%BE%BE%E5%88%B0%E4%B8%80%E5%AE%9A%E6%95%B0%E9%87%8F%EF%BC%8C%E6%88%91%E4%BB%AC%E4%BC%9A%E5%8F%91%E7%8E%B0%E5%A4%A7%E9%83%A8%E5%88%86%E5%BA%94%E7%94%A8%E7%9A%84%E9%85%8D%E7%BD%AE%E9%83%BD%E6%98%AF%E7%B1%BB%E4%BC%BC%E7%9A%84%EF%BC%8C%E8%BF%99%E6%97%B6%E5%8F%AF%E4%BB%A5%E5%9F%BA%E4%BA%8E%20Egg%20%E6%89%A9%E5%B1%95%E5%87%BA%E4%B8%80%E4%B8%AA%E6%A1%86%E6%9E%B6%EF%BC%8C%E5%BA%94%E7%94%A8%E7%9A%84%E9%85%8D%E7%BD%AE%E5%B0%B1%E4%BC%9A%E7%AE%80%E5%8C%96%E5%BE%88%E5%A4%9A%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20%E6%A1%86%E6%9E%B6%E9%85%8D%E7%BD%AE%0A%2F%2F%20package.json%0A%7B%0A%20%20%22name%22%3A%20%22framework1%22%2C%0A%20%20%22version%22%3A%20%221.0.0%22%2C%0A%20%20%22dependencies%22%3A%20%7B%0A%20%20%20%20%22egg-mysql%22%3A%20%22%5E3.0.0%22%2C%0A%20%20%20%20%22egg-view-nunjucks%22%3A%20%22%5E2.0.0%22%0A%20%20%7D%0A%7D%0A%0A%2F%2F%20config%2Fplugin.js%0Amodule.exports%20%3D%20%7B%0A%20%20mysql%3A%20%7B%0A%20%20%20%20enable%3A%20false%2C%0A%20%20%20%20package%3A%20'egg-mysql'%2C%0A%20%20%7D%2C%0A%20%20view%3A%20%7B%0A%20%20%20%20enable%3A%20false%2C%0A%20%20%20%20package%3A%20'egg-view-nunjucks'%2C%0A%20%20%7D%0A%7D%0A%0A%2F%2F%20%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE%0A%2F%2F%20package.json%0A%7B%0A%20%20%22dependencies%22%3A%20%7B%0A%20%20%20%20%22framework1%22%3A%20%22%5E1.0.0%22%2C%0A%20%20%7D%0A%7D%0A%0A%2F%2F%20config%2Fplugin.js%0Amodule.exports%20%3D%20%7B%0A%20%20%2F%2F%20%E5%BC%80%E5%90%AF%E6%8F%92%E4%BB%B6%0A%20%20mysql%3A%20true%2C%0A%20%20view%3A%20true%2C%0A%7D%0A%60%60%60%0A%0A%E4%BB%8E%E4%B8%8A%E9%9D%A2%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E5%BA%94%E7%94%A8%E3%80%81%E6%8F%92%E4%BB%B6%E5%92%8C%E6%A1%86%E6%9E%B6%E4%B8%89%E8%80%85%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB%E3%80%82%0A%0A-%20%E6%88%91%E4%BB%AC%E5%9C%A8%E5%BA%94%E7%94%A8%E4%B8%AD%E5%AE%8C%E6%88%90%E4%B8%9A%E5%8A%A1%EF%BC%8C%E9%9C%80%E8%A6%81%E6%8C%87%E5%AE%9A%E4%B8%80%E4%B8%AA%E6%A1%86%E6%9E%B6%E6%89%8D%E8%83%BD%E8%BF%90%E8%A1%8C%E8%B5%B7%E6%9D%A5%EF%BC%8C%E5%BD%93%E9%9C%80%E8%A6%81%E6%9F%90%E4%B8%AA%E7%89%B9%E6%80%A7%E5%9C%BA%E6%99%AF%E7%9A%84%E5%8A%9F%E8%83%BD%E6%97%B6%E5%8F%AF%E4%BB%A5%E9%85%8D%E7%BD%AE%E6%8F%92%E4%BB%B6%EF%BC%88%E6%AF%94%E5%A6%82%20MySQL%EF%BC%89%E3%80%82%0A-%20%E6%8F%92%E4%BB%B6%E5%8F%AA%E5%AE%8C%E6%88%90%E7%89%B9%E5%AE%9A%E5%8A%9F%E8%83%BD%EF%BC%8C%E5%BD%93%E4%B8%A4%E4%B8%AA%E7%8B%AC%E7%AB%8B%E7%9A%84%E5%8A%9F%E8%83%BD%E6%9C%89%E4%BA%92%E7%9B%B8%E4%BE%9D%E8%B5%96%E6%97%B6%EF%BC%8C%E8%BF%98%E6%98%AF%E5%88%86%E5%BC%80%E4%B8%A4%E4%B8%AA%E6%8F%92%E4%BB%B6%EF%BC%8C%E4%BD%86%E9%9C%80%E8%A6%81%E9%85%8D%E7%BD%AE%E4%BE%9D%E8%B5%96%E3%80%82%0A-%20%E6%A1%86%E6%9E%B6%E6%98%AF%E4%B8%80%E4%B8%AA%E5%90%AF%E5%8A%A8%E5%99%A8%EF%BC%88%E9%BB%98%E8%AE%A4%E5%B0%B1%E6%98%AF%20Egg%EF%BC%89%EF%BC%8C%E5%BF%85%E9%A1%BB%E6%9C%89%E5%AE%83%E6%89%8D%E8%83%BD%E8%BF%90%E8%A1%8C%E8%B5%B7%E6%9D%A5%E3%80%82%E6%A1%86%E6%9E%B6%E8%BF%98%E6%98%AF%E4%B8%80%E4%B8%AA%E5%B0%81%E8%A3%85%E5%99%A8%EF%BC%8C%E5%B0%86%E6%8F%92%E4%BB%B6%E7%9A%84%E5%8A%9F%E8%83%BD%E8%81%9A%E5%90%88%E8%B5%B7%E6%9D%A5%E7%BB%9F%E4%B8%80%E6%8F%90%E4%BE%9B%EF%BC%8C%E6%A1%86%E6%9E%B6%E4%B9%9F%E5%8F%AF%E4%BB%A5%E9%85%8D%E7%BD%AE%E6%8F%92%E4%BB%B6%E3%80%82%0A-%20%E5%9C%A8%E6%A1%86%E6%9E%B6%E7%9A%84%E5%9F%BA%E7%A1%80%E4%B8%8A%E8%BF%98%E5%8F%AF%E4%BB%A5%E6%89%A9%E5%B1%95%E5%87%BA%E6%96%B0%E7%9A%84%E6%A1%86%E6%9E%B6%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E8%AF%B4**%E6%A1%86%E6%9E%B6%E6%98%AF%E5%8F%AF%E4%BB%A5%E6%97%A0%E9%99%90%E7%BA%A7%E7%BB%A7%E6%89%BF%E7%9A%84**%EF%BC%8C%E6%9C%89%E7%82%B9%E5%83%8F%E7%B1%BB%E7%9A%84%E7%BB%A7%E6%89%BF%E3%80%82%0A%0A%60%60%60%0A%2B-----------------------------------%2B--------%2B%0A%7C%20%20%20%20%20%20app1%2C%20app2%2C%20app3%2C%20app4%20%20%20%20%20%20%20%7C%20%20%20%20%20%20%20%20%7C%0A%2B-----%2B--------------%2B--------------%2B%20%20%20%20%20%20%20%20%7C%0A%7C%20%20%20%20%20%7C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20%20framework3%20%20%7C%20%20%20%20%20%20%20%20%7C%0A%2B%20%20%20%20%20%7C%20%20framework1%20%20%2B--------------%2B%20plugin%20%7C%0A%7C%20%20%20%20%20%7C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20%20framework2%20%20%7C%20%20%20%20%20%20%20%20%7C%0A%2B%20%20%20%20%20%2B--------------%2B--------------%2B%20%20%20%20%20%20%20%20%7C%0A%7C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Egg%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20%20%20%20%20%20%20%20%7C%0A%2B-----------------------------------%2B--------%7C%0A%7C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Koa%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%2B-----------------------------------%2B--------%2B%0A%60%60%60%0A%0A%23%23%20loadUnit%0A%0AEgg%20%E5%B0%86%E5%BA%94%E7%94%A8%E3%80%81%E6%A1%86%E6%9E%B6%E5%92%8C%E6%8F%92%E4%BB%B6%E9%83%BD%E7%A7%B0%E4%B8%BA%E5%8A%A0%E8%BD%BD%E5%8D%95%E5%85%83%EF%BC%88loadUnit%EF%BC%89%EF%BC%8C%E5%9B%A0%E4%B8%BA%E5%9C%A8%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84%E4%B8%8A%E5%87%A0%E4%B9%8E%E6%B2%A1%E6%9C%89%E4%BB%80%E4%B9%88%E5%B7%AE%E5%BC%82%EF%BC%8C%E4%B8%8B%E9%9D%A2%E6%98%AF%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%0A%0A%60%60%60%0AloadUnit%0A%E2%94%9C%E2%94%80%E2%94%80%20package.json%0A%E2%94%9C%E2%94%80%E2%94%80%20app.js%0A%E2%94%9C%E2%94%80%E2%94%80%20agent.js%0A%E2%94%9C%E2%94%80%E2%94%80%20app%0A%E2%94%82%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20extend%0A%E2%94%82%20%20%20%7C%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20helper.js%0A%E2%94%82%20%20%20%7C%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20request.js%0A%E2%94%82%20%20%20%7C%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20response.js%0A%E2%94%82%20%20%20%7C%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20context.js%0A%E2%94%82%20%20%20%7C%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20application.js%0A%E2%94%82%20%20%20%7C%20%20%20%E2%94%94%E2%94%80%E2%94%80%20agent.js%0A%E2%94%82%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20service%0A%E2%94%82%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20middleware%0A%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20router.js%0A%E2%94%94%E2%94%80%E2%94%80%20config%0A%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20config.default.js%0A%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20config.prod.js%0A%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20config.test.js%0A%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20config.local.js%0A%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%20config.unittest.js%0A%60%60%60%0A%0A%E4%B8%8D%E8%BF%87%E8%BF%98%E5%AD%98%E5%9C%A8%E7%9D%80%E4%B8%80%E4%BA%9B%E5%B7%AE%E5%BC%82%0A%0A%E6%96%87%E4%BB%B6%20%7C%20%E5%BA%94%E7%94%A8%20%7C%20%E6%A1%86%E6%9E%B6%20%7C%20%E6%8F%92%E4%BB%B6%0A---%20%7C%20---%20%7C%20---%20%7C%20---%0Apackage.json%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%0Aconfig%2Fplugin.%7Benv%7D.js%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%7C%0Aconfig%2Fconfig.%7Benv%7D.js%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%0Aapp%2Fextend%2Fapplication.js%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%0Aapp%2Fextend%2Frequest.js%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%0Aapp%2Fextend%2Fresponse.js%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%0Aapp%2Fextend%2Fcontext.js%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%0Aapp%2Fextend%2Fhelper.js%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%0Aagent.js%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%0Aapp.js%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%0Aapp%2Fservice%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%0Aapp%2Fmiddleware%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%0Aapp%2Fcontroller%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%7C%20%7C%0Aapp%2Frouter.js%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%7C%20%7C%0A%0A%E6%96%87%E4%BB%B6%E6%8C%89%E8%A1%A8%E6%A0%BC%E5%86%85%E7%9A%84%E9%A1%BA%E5%BA%8F%E8%87%AA%E4%B8%8A%E8%80%8C%E4%B8%8B%E5%8A%A0%E8%BD%BD%0A%0A%E5%9C%A8%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B%E4%B8%AD%EF%BC%8CEgg%20%E4%BC%9A%E9%81%8D%E5%8E%86%E6%89%80%E6%9C%89%E7%9A%84%20loadUnit%20%E5%8A%A0%E8%BD%BD%E4%B8%8A%E8%BF%B0%E7%9A%84%E6%96%87%E4%BB%B6%EF%BC%88%E5%BA%94%E7%94%A8%E3%80%81%E6%A1%86%E6%9E%B6%E3%80%81%E6%8F%92%E4%BB%B6%E5%90%84%E6%9C%89%E4%B8%8D%E5%90%8C%EF%BC%89%EF%BC%8C%E5%8A%A0%E8%BD%BD%E6%97%B6%E6%9C%89%E4%B8%80%E5%AE%9A%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%0A%0A-%20%E6%8C%89%E6%8F%92%E4%BB%B6%20%3D%3E%20%E6%A1%86%E6%9E%B6%20%3D%3E%20%E5%BA%94%E7%94%A8%E4%BE%9D%E6%AC%A1%E5%8A%A0%E8%BD%BD%0A-%20%E6%8F%92%E4%BB%B6%E4%B9%8B%E9%97%B4%E7%9A%84%E9%A1%BA%E5%BA%8F%E7%94%B1%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%E5%86%B3%E5%AE%9A%EF%BC%8C%E8%A2%AB%E4%BE%9D%E8%B5%96%E6%96%B9%E5%85%88%E5%8A%A0%E8%BD%BD%EF%BC%8C%E6%97%A0%E4%BE%9D%E8%B5%96%E6%8C%89%20object%20key%20%E9%85%8D%E7%BD%AE%E9%A1%BA%E5%BA%8F%E5%8A%A0%E8%BD%BD%EF%BC%8C%E5%85%B7%E4%BD%93%E5%8F%AF%E4%BB%A5%E6%9F%A5%E7%9C%8B%5B%E6%8F%92%E4%BB%B6%E7%AB%A0%E8%8A%82%5D(.%2Fplugin.md)%0A-%20%E6%A1%86%E6%9E%B6%E6%8C%89%E7%BB%A7%E6%89%BF%E9%A1%BA%E5%BA%8F%E5%8A%A0%E8%BD%BD%EF%BC%8C%E8%B6%8A%E5%BA%95%E5%B1%82%E8%B6%8A%E5%85%88%E5%8A%A0%E8%BD%BD%E3%80%82%0A%0A%E6%AF%94%E5%A6%82%E6%9C%89%E8%BF%99%E6%A0%B7%E4%B8%80%E4%B8%AA%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE%E4%BA%86%E5%A6%82%E4%B8%8B%E4%BE%9D%E8%B5%96%0A%0A%60%60%60%0Aapp%0A%7C%20%E2%94%9C%E2%94%80%E2%94%80%20plugin2%20(%E4%BE%9D%E8%B5%96%20plugin3)%0A%7C%20%E2%94%94%E2%94%80%E2%94%80%20plugin3%0A%E2%94%94%E2%94%80%E2%94%80%20framework1%0A%20%20%20%20%7C%20%E2%94%94%E2%94%80%E2%94%80%20plugin1%0A%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%20egg%0A%60%60%60%0A%0A%E6%9C%80%E7%BB%88%E7%9A%84%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F%E4%B8%BA%0A%0A%60%60%60%0A%3D%3E%20plugin1%0A%3D%3E%20plugin3%0A%3D%3E%20plugin2%0A%3D%3E%20egg%0A%3D%3E%20framework1%0A%3D%3E%20app%0A%60%60%60%0A%0Aplugin1%20%E4%B8%BA%20framework1%20%E4%BE%9D%E8%B5%96%E7%9A%84%E6%8F%92%E4%BB%B6%EF%BC%8C%E9%85%8D%E7%BD%AE%E5%90%88%E5%B9%B6%E5%90%8E%20object%20key%20%E7%9A%84%E9%A1%BA%E5%BA%8F%E4%BC%9A%E4%BC%98%E5%85%88%E4%BA%8E%20plugin2%2Fplugin3%E3%80%82%E5%9B%A0%E4%B8%BA%20plugin2%20%E5%92%8C%20plugin3%20%E7%9A%84%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%EF%BC%8C%E6%89%80%E4%BB%A5%E4%BA%A4%E6%8D%A2%E4%BA%86%E4%BD%8D%E7%BD%AE%E3%80%82framework1%20%E7%BB%A7%E6%89%BF%E4%BA%86%20egg%EF%BC%8C%E9%A1%BA%E5%BA%8F%E4%BC%9A%E6%99%9A%E4%BA%8E%20egg%E3%80%82%E5%BA%94%E7%94%A8%E6%9C%80%E5%90%8E%E5%8A%A0%E8%BD%BD%E3%80%82%0A%0A%E8%AF%B7%E6%9F%A5%E7%9C%8B%20%5BLoader.getLoadUnits%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-core%2Fblob%2F65ea778a4f2156a9cebd3951dac12c4f9455e636%2Flib%2Floader%2Fegg_loader.js%23L233)%20%E6%96%B9%E6%B3%95%0A%0A%23%23%23%20%E6%96%87%E4%BB%B6%E9%A1%BA%E5%BA%8F%0A%0A%E4%B8%8A%E9%9D%A2%E5%B7%B2%E7%BB%8F%E5%88%97%E5%87%BA%E4%BA%86%E9%BB%98%E8%AE%A4%E4%BC%9A%E5%8A%A0%E8%BD%BD%E7%9A%84%E6%96%87%E4%BB%B6%EF%BC%8CEgg%20%E4%BC%9A%E6%8C%89%E5%A6%82%E4%B8%8B%E6%96%87%E4%BB%B6%E9%A1%BA%E5%BA%8F%E5%8A%A0%E8%BD%BD%EF%BC%8C%E6%AF%8F%E4%B8%AA%E6%96%87%E4%BB%B6%E6%88%96%E7%9B%AE%E5%BD%95%E5%86%8D%E6%A0%B9%E6%8D%AE%20loadUnit%20%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%8E%BB%E5%8A%A0%E8%BD%BD%EF%BC%88%E5%BA%94%E7%94%A8%E3%80%81%E6%A1%86%E6%9E%B6%E3%80%81%E6%8F%92%E4%BB%B6%E5%90%84%E6%9C%89%E4%B8%8D%E5%90%8C%EF%BC%89%E3%80%82%0A%0A-%20%E5%8A%A0%E8%BD%BD%20%5Bplugin%5D(.%2Fplugin.md)%EF%BC%8C%E6%89%BE%E5%88%B0%E5%BA%94%E7%94%A8%E5%92%8C%E6%A1%86%E6%9E%B6%EF%BC%8C%E5%8A%A0%E8%BD%BD%20%60config%2Fplugin.js%60%0A-%20%E5%8A%A0%E8%BD%BD%20%5Bconfig%5D(..%2Fbasics%2Fconfig.md)%EF%BC%8C%E9%81%8D%E5%8E%86%20loadUnit%20%E5%8A%A0%E8%BD%BD%20%60config%2Fconfig.%7Benv%7D.js%60%0A-%20%E5%8A%A0%E8%BD%BD%20%5Bextend%5D(..%2Fbasics%2Fextend.md)%EF%BC%8C%E9%81%8D%E5%8E%86%20loadUnit%20%E5%8A%A0%E8%BD%BD%20%60app%2Fextend%2Fxx.js%60%0A-%20%5B%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%9D%E5%A7%8B%E5%8C%96%5D(..%2Fbasics%2Fapp-start.md)%EF%BC%8C%E9%81%8D%E5%8E%86%20loadUnit%20%E5%8A%A0%E8%BD%BD%20%60app.js%60%20%E5%92%8C%20%60agent.js%60%0A-%20%E5%8A%A0%E8%BD%BD%20%5Bservice%5D(..%2Fbasics%2Fservice.md)%EF%BC%8C%E9%81%8D%E5%8E%86%20loadUnit%20%E5%8A%A0%E8%BD%BD%20%60app%2Fservice%60%20%E7%9B%AE%E5%BD%95%0A-%20%E5%8A%A0%E8%BD%BD%20%5Bmiddleware%5D(..%2Fbasics%2Fmiddleware.md)%EF%BC%8C%E9%81%8D%E5%8E%86%20loadUnit%20%E5%8A%A0%E8%BD%BD%20%60app%2Fmiddleware%60%20%E7%9B%AE%E5%BD%95%0A-%20%E5%8A%A0%E8%BD%BD%20%5Bcontroller%5D(..%2Fbasics%2Fcontroller.md)%EF%BC%8C%E5%8A%A0%E8%BD%BD%E5%BA%94%E7%94%A8%E7%9A%84%20%60app%2Fcontroller%60%20%E7%9B%AE%E5%BD%95%0A-%20%E5%8A%A0%E8%BD%BD%20%5Brouter%5D(..%2Fbasics%2Frouter.md)%EF%BC%8C%E5%8A%A0%E8%BD%BD%E5%BA%94%E7%94%A8%E7%9A%84%20%60app%2Frouter.js%60%0A%0A%E6%B3%A8%E6%84%8F%0A%0A-%20%E5%8A%A0%E8%BD%BD%E6%97%B6%E5%A6%82%E6%9E%9C%E9%81%87%E5%88%B0%E5%90%8C%E5%90%8D%E7%9A%84%E4%BC%9A%E8%A6%86%E7%9B%96%EF%BC%8C%E6%AF%94%E5%A6%82%E6%83%B3%E8%A6%81%E8%A6%86%E7%9B%96%20%60ctx.ip%60%20%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E5%9C%A8%E5%BA%94%E7%94%A8%E7%9A%84%20%60app%2Fextend%2Fcontext.js%60%20%E5%AE%9A%E4%B9%89%20ip%20%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BA%86%E3%80%82%0A-%20%E5%BA%94%E7%94%A8%E5%AE%8C%E6%95%B4%E5%90%AF%E5%8A%A8%E9%A1%BA%E5%BA%8F%E6%9F%A5%E7%9C%8B%5B%E6%A1%86%E6%9E%B6%E5%BC%80%E5%8F%91%5D(.%2Fframework.md)%0A%0A%23%23%23%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%0A%0AEgg%E6%8F%90%E4%BE%9B%E4%BA%86%E5%BA%94%E7%94%A8%E5%90%AF%E5%8A%A8(%60beforeStart%60)%2C%20%E5%90%AF%E5%8A%A8%E5%AE%8C%E6%88%90(%60ready%60)%2C%20%E5%85%B3%E9%97%AD(%60beforeClose%60)%E8%BF%99%E4%B8%89%E4%B8%AA%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%96%B9%E6%B3%95%E3%80%82%0A%60%60%60%0A%20%20%20init%20master%20process%0A%20%20%20%20%20%20%20%20%20%20%20%E2%AC%87%0Ainit%20agent%20worker%20process%0A%20%20%20%20%20%20%20%20%20%20%20%E2%AC%87%0Aloader.load%20%7C%20beforeStart%0A%20%20%20%20%20%20%20%20%20%20%20%E2%AC%87%0A%20await%20agent%20worker%20ready%0A%20%20%20%20%20%20%20%20%20%20%20%E2%AC%87%0A%20%20%20call%20ready%20callback%0A%20%20%20%20%20%20%20%20%20%20%20%E2%AC%87%0Ainit%20app%20worker%20processes%0A%20%20%20%20%20%20%20%20%20%20%20%E2%AC%87%0Aloader.load%20%7C%20beforeStart%0A%20%20%20%20%20%20%20%20%20%20%20%E2%AC%87%0A%20await%20app%20workers%20ready%0A%20%20%20%20%20%20%20%20%20%20%20%E2%AC%87%0A%20%20%20call%20ready%20callback%0A%20%20%20%20%20%20%20%20%20%20%20%E2%AC%87%0Asend%20egg-ready%20to%20master%2C%0A%20%20%20%20agent%2Capp%20workers%0A%60%60%60%0A%23%23%20beforeStart%0A%60beforeStart%60%20%E6%96%B9%E6%B3%95%E5%9C%A8%20loading%20%E8%BF%87%E7%A8%8B%E4%B8%AD%E8%B0%83%E7%94%A8%2C%20%E6%89%80%E6%9C%89%E7%9A%84%E6%96%B9%E6%B3%95%E5%B9%B6%E8%A1%8C%E6%89%A7%E8%A1%8C%E3%80%82%20%E4%B8%80%E8%88%AC%E7%94%A8%E6%9D%A5%E6%89%A7%E8%A1%8C%E4%B8%80%E4%BA%9B%E5%BC%82%E6%AD%A5%E6%96%B9%E6%B3%95%2C%20%E4%BE%8B%E5%A6%82%E6%A3%80%E6%9F%A5%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81%E7%AD%89%2C%20%E6%AF%94%E5%A6%82%20%5B%60egg-mysql%60%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-mysql%2Fblob%2Fmaster%2Flib%2Fmysql.js)%20%E5%B0%B1%E7%94%A8%20%60beforeStart%60%20%E6%9D%A5%E6%A3%80%E6%9F%A5%E4%B8%8E%20mysql%20%E7%9A%84%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81%E3%80%82%E6%89%80%E6%9C%89%E7%9A%84%20%60beforeStart%60%20%E4%BB%BB%E5%8A%A1%E7%BB%93%E6%9D%9F%E5%90%8E%2C%20%E7%8A%B6%E6%80%81%E5%B0%86%E4%BC%9A%E8%BF%9B%E5%85%A5%20%60ready%60%20%E3%80%82%E4%B8%8D%E5%BB%BA%E8%AE%AE%E6%89%A7%E8%A1%8C%E4%B8%80%E4%BA%9B%E8%80%97%E6%97%B6%E8%BE%83%E9%95%BF%E7%9A%84%E6%96%B9%E6%B3%95%2C%20%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%AF%BC%E8%87%B4%E5%BA%94%E7%94%A8%E5%90%AF%E5%8A%A8%E8%B6%85%E6%97%B6%E3%80%82%0A%23%23%20ready%0A%60ready%60%20%E6%96%B9%E6%B3%95%E6%B3%A8%E5%86%8C%E7%9A%84%E4%BB%BB%E5%8A%A1%E5%9C%A8%20load%20%E7%BB%93%E6%9D%9F%E5%B9%B6%E4%B8%94%E6%89%80%E6%9C%89%E7%9A%84%20%60beforeStart%60%20%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9D%9F%E5%90%8E%E9%A1%BA%E5%BA%8F%E6%89%A7%E8%A1%8C%2C%20HTTP%20server%20%E7%9B%91%E5%90%AC%E4%B9%9F%E6%98%AF%E5%9C%A8%E8%BF%99%E4%B8%AA%E6%97%B6%E5%80%99%E5%BC%80%E5%A7%8B%2C%20%E6%AD%A4%E6%97%B6%E4%BB%A3%E8%A1%A8%E6%89%80%E6%9C%89%E7%9A%84%E6%8F%92%E4%BB%B6%E5%B7%B2%E7%BB%8F%E5%8A%A0%E8%BD%BD%E5%AE%8C%E6%AF%95%E5%B9%B6%E4%B8%94%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C%E5%B7%B2%E7%BB%8F%E5%AE%8C%E6%88%90%2C%20%E4%B8%80%E8%88%AC%E7%94%A8%E6%9D%A5%E6%89%A7%E8%A1%8C%E4%B8%80%E4%BA%9B%E5%90%AF%E5%8A%A8%E7%9A%84%E5%90%8E%E7%BD%AE%E4%BB%BB%E5%8A%A1%E3%80%82%0A%23%23%20beforeClose%0A%60beforeClose%60%20%E6%B3%A8%E5%86%8C%E6%96%B9%E6%B3%95%E5%9C%A8%20app%2Fagent%20%E5%AE%9E%E4%BE%8B%E7%9A%84%20%60close%60%20%E6%96%B9%E6%B3%95%E8%A2%AB%E8%B0%83%E7%94%A8%E5%90%8E%2C%20%E6%8C%89%E6%B3%A8%E5%86%8C%E7%9A%84%E9%80%86%E5%BA%8F%E6%89%A7%E8%A1%8C%E3%80%82%E4%B8%80%E8%88%AC%E7%94%A8%E4%BA%8E%E8%B5%84%E6%BA%90%E7%9A%84%E9%87%8A%E6%94%BE%E6%93%8D%E4%BD%9C%2C%20%E4%BE%8B%E5%A6%82%20%5B%60egg%60%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg%2Fblob%2Fmaster%2Flib%2Fegg.js)%20%E7%94%A8%E6%9D%A5%E5%85%B3%E9%97%AD%20logger%20%2C%20%E5%88%A0%E9%99%A4%E7%9B%91%E5%90%AC%E6%96%B9%E6%B3%95%E7%AD%89%E3%80%82%0A%0A__%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%E4%B8%8D%E5%BB%BA%E8%AE%AE%E5%9C%A8%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%BD%BF%E7%94%A8%2C%20%E5%8F%AF%E8%83%BD%E9%81%87%E5%88%B0%E6%9C%AA%E6%89%A7%E8%A1%8C%E5%AE%8C%E5%B0%B1%E7%BB%93%E6%9D%9F%E8%BF%9B%E7%A8%8B%E7%9A%84%E9%97%AE%E9%A2%98%E3%80%82__%0A%0Ae.g.%3A%0A%60%60%60js%0A%2F%2F%20app.js%0Aconsole.time('app%20before%20start%20200ms')%3B%0Aconsole.time('app%20before%20start%20100ms')%3B%0A%0Aapp.beforeStart(async%20()%20%3D%3E%20%7B%0A%20%20await%20sleep(200)%3B%0A%20%20console.timeEnd('app%20before%20start%20200ms')%3B%0A%7D)%3B%0A%0Aapp.beforeStart(async%20()%20%3D%3E%20%7B%0A%20%20await%20sleep(100)%3B%0A%20%20console.timeEnd('app%20before%20start%20100ms')%3B%0A%7D)%3B%0A%0Aapp.on('server'%2C%20()%20%3D%3E%20%7B%0A%20%20console.log('server%20is%20ready')%3B%0A%7D)%3B%0A%0Aapp.ready(()%20%3D%3E%20%7B%0A%20%20console.log('app%20ready')%3B%0A%20%20cp.execSync(%60kill%20%24%7Bprocess.ppid%7D%60)%3B%0A%20%20console.time('app%20before%20close%20100ms')%3B%0A%20%20console.time('app%20before%20close%20200ms')%3B%0A%7D)%3B%0A%0Aapp.beforeClose(async%20()%20%3D%3E%20%7B%0A%20%20await%20sleep(200)%3B%0A%20%20console.timeEnd('app%20before%20close%20200ms')%3B%0A%7D)%3B%0A%0Aapp.beforeClose(async%20()%20%3D%3E%20%7B%0A%20%20await%20sleep(100)%3B%0A%20%20console.timeEnd('app%20before%20close%20100ms')%3B%0A%7D)%3B%0A%0A%2F%2F%20agent.js%0Aconsole.time('agent%20before%20start%20200ms')%3B%0Aconsole.time('agent%20before%20start%20100ms')%3B%0A%0Aagent.beforeStart(async%20()%20%3D%3E%20%7B%0A%20%20await%20sleep(200)%3B%0A%20%20console.timeEnd('agent%20before%20start%20200ms')%3B%0A%7D)%3B%0A%0Aagent.beforeStart(async%20()%20%3D%3E%20%7B%0A%20%20await%20sleep(100)%3B%0A%20%20console.timeEnd('agent%20before%20start%20100ms')%3B%0A%7D)%3B%0A%0Aagent.ready(()%20%3D%3E%20%7B%0A%20%20console.log('agent%20ready')%3B%0A%20%20console.time('agent%20before%20close%20200ms')%3B%0A%20%20console.time('agent%20before%20close%20100ms')%3B%0A%7D)%3B%0A%0Aagent.beforeClose(async%20()%20%3D%3E%20%7B%0A%20%20await%20sleep(200)%3B%0A%20%20console.timeEnd('agent%20before%20close%20200ms')%3B%0A%7D)%3B%0A%0Aagent.beforeClose(async%20()%20%3D%3E%20%7B%0A%20%20await%20sleep(100)%3B%0A%20%20console.timeEnd('agent%20before%20close%20100ms')%3B%0A%7D)%3B%0A%60%60%60%0A%0Aprint%3A%0A%60%60%60%0Aagent%20before%20start%20100ms%3A%20131.096ms%0Aagent%20before%20start%20200ms%3A%20224.396ms%20%2F%2F%20%E5%B9%B6%E8%A1%8C%E6%89%A7%E8%A1%8C%0A%0Aagent%20ready%0A%0Aapp%20before%20start%20100ms%3A%20147.546ms%0Aapp%20before%20start%20200ms%3A%20245.405ms%20%2F%2F%20%E5%B9%B6%E8%A1%8C%E6%89%A7%E8%A1%8C%0A%0Aapp%20ready%0A%0A%2F%2F%20%E5%BC%80%E6%B5%81%E9%87%8F%0Aserver%20is%20ready%0A%0Aagent%20before%20close%20100ms%3A%20866.218ms%0Aapp%20before%20close%20100ms%3A%20108.007ms%20%2F%2F%20LIFO%2C%20%E5%90%8E%E6%B3%A8%E5%86%8C%E5%85%88%E6%89%A7%E8%A1%8C%0Aapp%20before%20close%20200ms%3A%20310.549ms%20%2F%2F%20%E4%B8%B2%E8%A1%8C%E6%89%A7%E8%A1%8C%0Aagent%20before%20close%20200ms%3A%201070.865ms%0A%60%60%60%0A%0A%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%20%5B%60egg-development%60%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-development%23loader-trace)%20%E6%9D%A5%E6%9F%A5%E7%9C%8B%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B%E3%80%82%0A%0A%23%23%23%20%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E8%A7%84%E5%88%99%0A%0A%E6%A1%86%E6%9E%B6%E5%9C%A8%E5%8A%A0%E8%BD%BD%E6%96%87%E4%BB%B6%E6%97%B6%E4%BC%9A%E8%BF%9B%E8%A1%8C%E8%BD%AC%E6%8D%A2%EF%BC%8C%E5%9B%A0%E4%B8%BA%E6%96%87%E4%BB%B6%E5%91%BD%E5%90%8D%E9%A3%8E%E6%A0%BC%E5%92%8C%20API%20%E9%A3%8E%E6%A0%BC%E5%AD%98%E5%9C%A8%E5%B7%AE%E5%BC%82%E3%80%82%E6%88%91%E4%BB%AC%E6%8E%A8%E8%8D%90%E6%96%87%E4%BB%B6%E4%BD%BF%E7%94%A8%E4%B8%8B%E5%88%92%E7%BA%BF%EF%BC%8C%E8%80%8C%20API%20%E4%BD%BF%E7%94%A8%E9%A9%BC%E5%B3%B0%E3%80%82%E6%AF%94%E5%A6%82%20%60app%2Fservice%2Fuser_info.js%60%20%E4%BC%9A%E8%BD%AC%E6%8D%A2%E6%88%90%20%60app.service.userInfo%60%E3%80%82%0A%0A%E6%A1%86%E6%9E%B6%E4%B9%9F%E6%94%AF%E6%8C%81%E8%BF%9E%E5%AD%97%E7%AC%A6%E5%92%8C%E9%A9%BC%E5%B3%B0%E7%9A%84%E6%96%B9%E5%BC%8F%0A%0A-%20%60app%2Fservice%2Fuser-info.js%60%20%3D%3E%20%60app.service.userInfo%60%0A-%20%60app%2Fservice%2FuserInfo.js%60%20%3D%3E%20%60app.service.userInfo%60%0A%0ALoader%20%E8%BF%98%E6%8F%90%E4%BE%9B%E4%BA%86%20%5BcaseStyle%5D(%23caseStyle-string)%20%E5%BC%BA%E5%88%B6%E6%8C%87%E5%AE%9A%E9%A6%96%E5%AD%97%E6%AF%8D%E5%A4%A7%E5%B0%8F%E5%86%99%EF%BC%8C%E6%AF%94%E5%A6%82%E5%8A%A0%E8%BD%BD%20model%20%E6%97%B6%20API%20%E9%A6%96%E5%AD%97%E6%AF%8D%E5%A4%A7%E5%86%99%EF%BC%8C%60app%2Fmodel%2Fuser.js%60%20%3D%3E%20%60app.model.User%60%EF%BC%8C%E5%B0%B1%E5%8F%AF%E4%BB%A5%E6%8C%87%E5%AE%9A%20%60caseStyle%3A%20'upper'%60%E3%80%82%0A%0A%23%23%20%E6%89%A9%E5%B1%95%20Loader%0A%0A%5BLoader%5D%20%E6%98%AF%E4%B8%80%E4%B8%AA%E5%9F%BA%E7%B1%BB%EF%BC%8C%E5%B9%B6%E6%A0%B9%E6%8D%AE%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E7%9A%84%E8%A7%84%E5%88%99%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E4%BA%9B%E5%86%85%E7%BD%AE%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%8C%E4%BD%86%E5%9F%BA%E6%9C%AC%E6%9C%AC%E8%BA%AB%E5%B9%B6%E4%B8%8D%E4%BC%9A%E5%8E%BB%E8%B0%83%E7%94%A8%EF%BC%8C%E8%80%8C%E6%98%AF%E7%94%B1%E7%BB%A7%E6%89%BF%E7%B1%BB%E8%B0%83%E7%94%A8%E3%80%82%0A%0A-%20loadPlugin()%0A-%20loadConfig()%0A-%20loadAgentExtend()%0A-%20loadApplicationExtend()%0A-%20loadRequestExtend()%0A-%20loadResponseExtend()%0A-%20loadContextExtend()%0A-%20loadHelperExtend()%0A-%20loadCustomAgent()%0A-%20loadCustomApp()%0A-%20loadService()%0A-%20loadMiddleware()%0A-%20loadController()%0A-%20loadRouter()%0A%0AEgg%20%E5%9F%BA%E4%BA%8E%20Loader%20%E5%AE%9E%E7%8E%B0%E4%BA%86%20%5BAppWorkerLoader%5D%20%E5%92%8C%20%5BAgentWorkerLoader%5D%EF%BC%8C%E4%B8%8A%E5%B1%82%E6%A1%86%E6%9E%B6%E5%9F%BA%E4%BA%8E%E8%BF%99%E4%B8%A4%E4%B8%AA%E7%B1%BB%E6%9D%A5%E6%89%A9%E5%B1%95%EF%BC%8C**Loader%20%E7%9A%84%E6%89%A9%E5%B1%95%E5%8F%AA%E8%83%BD%E5%9C%A8%E6%A1%86%E6%9E%B6%E8%BF%9B%E8%A1%8C**%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20%E8%87%AA%E5%AE%9A%E4%B9%89%20AppWorkerLoader%0A%2F%2F%20lib%2Fframework.js%0Aconst%20path%20%3D%20require('path')%3B%0Aconst%20egg%20%3D%20require('egg')%3B%0Aconst%20EGG_PATH%20%3D%20Symbol.for('egg%23eggPath')%3B%0A%0Aclass%20YadanAppWorkerLoader%20extends%20egg.AppWorkerLoader%20%7B%0A%20%20constructor(opt)%20%7B%0A%20%20%20%20super(opt)%3B%0A%20%20%20%20%2F%2F%20%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%9D%E5%A7%8B%E5%8C%96%0A%20%20%7D%0A%0A%20%20loadConfig()%20%7B%0A%20%20%20%20super.loadConfig()%3B%0A%20%20%20%20%2F%2F%20%E5%AF%B9%20config%20%E8%BF%9B%E8%A1%8C%E5%A4%84%E7%90%86%0A%20%20%7D%0A%0A%20%20load()%20%7B%0A%20%20%20%20super.load()%3B%0A%20%20%20%20%2F%2F%20%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8A%A0%E8%BD%BD%E5%85%B6%E4%BB%96%E7%9B%AE%E5%BD%95%0A%20%20%20%20%2F%2F%20%E6%88%96%E5%AF%B9%E5%B7%B2%E5%8A%A0%E8%BD%BD%E7%9A%84%E6%96%87%E4%BB%B6%E8%BF%9B%E8%A1%8C%E5%A4%84%E7%90%86%0A%20%20%7D%0A%7D%0A%0Aclass%20Application%20extends%20egg.Application%20%7B%0A%20%20get%20%5BEGG_PATH%5D()%20%7B%0A%20%20%20%20return%20path.dirname(__dirname)%3B%0A%20%20%7D%0A%20%20%2F%2F%20%E8%A6%86%E7%9B%96%20Egg%20%E7%9A%84%20Loader%EF%BC%8C%E5%90%AF%E5%8A%A8%E6%97%B6%E4%BD%BF%E7%94%A8%E8%BF%99%E4%B8%AA%20Loader%0A%20%20get%20%5BEGG_LOADER%5D()%20%7B%0A%20%20%20%20return%20YadanAppWorkerLoader%3B%0A%20%20%7D%0A%7D%0A%0Amodule.exports%20%3D%20Object.assign(egg%2C%20%7B%0A%20%20Application%2C%0A%20%20%2F%2F%20%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%20Loader%20%E4%B9%9F%E9%9C%80%E8%A6%81%20export%EF%BC%8C%E4%B8%8A%E5%B1%82%E6%A1%86%E6%9E%B6%E9%9C%80%E8%A6%81%E5%9F%BA%E4%BA%8E%E8%BF%99%E4%B8%AA%E6%89%A9%E5%B1%95%0A%20%20AppWorkerLoader%3A%20YadanAppWorkerLoader%2C%0A%7D)%3B%0A%60%60%60%0A%0A%E9%80%9A%E8%BF%87%20Loader%20%E6%8F%90%E4%BE%9B%E7%9A%84%E8%BF%99%E4%BA%9B%20API%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%BE%88%E6%96%B9%E4%BE%BF%E7%9A%84%E5%AE%9A%E5%88%B6%E5%9B%A2%E9%98%9F%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8A%A0%E8%BD%BD%EF%BC%8C%E5%A6%82%20%60this.model.xx%60%EF%BC%8C%20%60app%2Fextend%2Ffilter.js%60%20%E7%AD%89%E7%AD%89%E3%80%82%0A%0A%E4%BB%A5%E4%B8%8A%E5%8F%AA%E6%98%AF%E8%AF%B4%E6%98%8E%20Loader%20%E7%9A%84%E5%86%99%E6%B3%95%EF%BC%8C%E5%85%B7%E4%BD%93%E5%8F%AF%E4%BB%A5%E6%9F%A5%E7%9C%8B%5B%E6%A1%86%E6%9E%B6%E5%BC%80%E5%8F%91%5D(.%2Fframework.md)%E3%80%82%0A%0A%23%23%20Loader%20API%0A%0ALoader%20%E8%BF%98%E6%8F%90%E4%BE%9B%E4%B8%80%E4%BA%9B%E5%BA%95%E5%B1%82%E7%9A%84%20API%EF%BC%8C%E5%9C%A8%E6%89%A9%E5%B1%95%E6%97%B6%E5%8F%AF%E4%BB%A5%E7%AE%80%E5%8C%96%E4%BB%A3%E7%A0%81%EF%BC%8C%E5%85%A8%E9%83%A8%20API%20%E8%AF%B7%5B%E6%9F%A5%E7%9C%8B%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-core%23eggloader)%0A%0A%23%23%23%20loadFile%0A%0A%E7%94%A8%E4%BA%8E%E5%8A%A0%E8%BD%BD%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%EF%BC%8C%E6%AF%94%E5%A6%82%E5%8A%A0%E8%BD%BD%20%60app.js%60%20%E5%B0%B1%E6%98%AF%E4%BD%BF%E7%94%A8%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20app%2Fxx.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20console.log(app.config)%3B%0A%7D%3B%0A%0A%2F%2F%20app.js%0A%2F%2F%20%E4%BB%A5%20app%2Fxx.js%20%E4%B8%BA%E4%BE%8B%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%9C%A8%20app.js%20%E5%8A%A0%E8%BD%BD%E8%BF%99%E4%B8%AA%E6%96%87%E4%BB%B6%0Aconst%20path%20%3D%20require('path')%3B%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20app.loader.loadFile(path.join(app.config.baseDir%2C%20'app%2Fxx.js'))%3B%0A%7D%3B%0A%60%60%60%0A%0A%E5%A6%82%E6%9E%9C%E6%96%87%E4%BB%B6%20export%20%E4%B8%80%E4%B8%AA%E5%87%BD%E6%95%B0%E4%BC%9A%E8%A2%AB%E8%B0%83%E7%94%A8%EF%BC%8C%E5%B9%B6%E5%B0%86%20app%20%E4%BD%9C%E4%B8%BA%E5%8F%82%E6%95%B0%EF%BC%8C%E5%90%A6%E5%88%99%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8%E8%BF%99%E4%B8%AA%E5%80%BC%E3%80%82%0A%0A%23%23%23%20loadToApp%0A%0A%E7%94%A8%E4%BA%8E%E5%8A%A0%E8%BD%BD%E4%B8%80%E4%B8%AA%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84%E6%96%87%E4%BB%B6%E5%88%B0%20app%EF%BC%8C%E6%AF%94%E5%A6%82%20%60app%2Fcontroller%2Fhome.js%60%20%E4%BC%9A%E5%8A%A0%E8%BD%BD%E5%88%B0%20%60app.controller.home%60%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20app.js%0A%2F%2F%20%E4%BB%A5%E4%B8%8B%E5%8F%AA%E6%98%AF%E7%A4%BA%E4%BE%8B%EF%BC%8C%E5%8A%A0%E8%BD%BD%20controller%20%E8%AF%B7%E7%94%A8%20loadController%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20const%20directory%20%3D%20path.join(app.config.baseDir%2C%20'app%2Fcontroller')%3B%0A%20%20app.loader.loadToApp(directory%2C%20'controller')%3B%0A%7D%3B%0A%60%60%60%0A%0A%E4%B8%80%E5%85%B1%E6%9C%89%E4%B8%89%E4%B8%AA%E5%8F%82%E6%95%B0%20%60loadToApp(directory%2C%20property%2C%20LoaderOptions)%60%0A%0A1.%20directory%20%E5%8F%AF%E4%BB%A5%E4%B8%BA%20String%20%E6%88%96%20Array%EF%BC%8CLoader%20%E4%BC%9A%E4%BB%8E%E8%BF%99%E4%BA%9B%E7%9B%AE%E5%BD%95%E5%8A%A0%E8%BD%BD%E6%96%87%E4%BB%B6%0A1.%20property%20%E4%B8%BA%20app%20%E7%9A%84%E5%B1%9E%E6%80%A7%0A1.%20%5BLoaderOptions%5D(%23LoaderOptions)%20%E4%B8%BA%E4%B8%80%E4%BA%9B%E9%85%8D%E7%BD%AE%0A%0A%23%23%23%20loadToContext%0A%0A%E4%B8%8E%20loadToApp%20%E6%9C%89%E4%B8%80%E7%82%B9%E5%B7%AE%E5%BC%82%EF%BC%8CloadToContext%20%E6%98%AF%E5%8A%A0%E8%BD%BD%E5%88%B0%20ctx%20%E4%B8%8A%E8%80%8C%E9%9D%9E%20app%EF%BC%8C%E8%80%8C%E4%B8%94%E6%98%AF%E6%87%92%E5%8A%A0%E8%BD%BD%E3%80%82%E5%8A%A0%E8%BD%BD%E6%97%B6%E4%BC%9A%E5%B0%86%E6%96%87%E4%BB%B6%E9%83%BD%E6%94%BE%E5%88%B0%E4%B8%80%E4%B8%AA%E4%B8%B4%E6%97%B6%E5%AF%B9%E8%B1%A1%E4%B8%8A%EF%BC%8C%E5%9C%A8%E8%B0%83%E7%94%A8%20ctx%20API%20%E6%97%B6%E6%89%8D%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%AF%B9%E8%B1%A1%E3%80%82%0A%0A%E6%AF%94%E5%A6%82%20service%20%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%B0%B1%E6%98%AF%E4%BD%BF%E7%94%A8%E8%BF%99%E7%A7%8D%E6%A8%A1%E5%BC%8F%0A%0A%60%60%60js%0A%2F%2F%20%E4%BB%A5%E4%B8%8B%E4%B8%BA%E7%A4%BA%E4%BE%8B%EF%BC%8C%E8%AF%B7%E4%BD%BF%E7%94%A8%20loadService%0A%2F%2F%20app%2Fservice%2Fuser.js%0Aconst%20Service%20%3D%20require('egg').Service%3B%0Aclass%20UserService%20extends%20Service%20%7B%0A%0A%7D%0Amodule.exports%20%3D%20UserService%3B%0A%0A%2F%2F%20app.js%0A%2F%2F%20%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E7%9A%84%20loadUnit%0Aconst%20servicePaths%20%3D%20app.loader.getLoadUnits().map(unit%20%3D%3E%20path.join(unit.path%2C%20'app%2Fservice'))%3B%0A%0Aapp.loader.loadToContext(servicePaths%2C%20'service'%2C%20%7B%0A%20%20%2F%2F%20service%20%E9%9C%80%E8%A6%81%E7%BB%A7%E6%89%BF%20app.Service%EF%BC%8C%E6%89%80%E4%BB%A5%E8%A6%81%E6%8B%BF%E5%88%B0%20app%20%E5%8F%82%E6%95%B0%0A%20%20%2F%2F%20%E8%AE%BE%E7%BD%AE%20call%20%E5%9C%A8%E5%8A%A0%E8%BD%BD%E6%97%B6%E4%BC%9A%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%20UserService%0A%20%20call%3A%20true%2C%0A%20%20%2F%2F%20%E5%B0%86%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E5%88%B0%20app.serviceClasses%0A%20%20fieldClass%3A%20'serviceClasses'%2C%0A%7D)%3B%0A%60%60%60%0A%0A%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E5%90%8E%20%60app.serviceClasses.user%60%20%E5%B0%B1%E6%98%AF%20UserService%EF%BC%8C%E5%BD%93%E8%B0%83%E7%94%A8%20%60ctx.service.user%60%20%E6%97%B6%E4%BC%9A%E5%AE%9E%E4%BE%8B%E5%8C%96%20UserService%EF%BC%8C%0A%E6%89%80%E4%BB%A5%E8%BF%99%E4%B8%AA%E7%B1%BB%E5%8F%AA%E6%9C%89%E6%AF%8F%E6%AC%A1%E8%AF%B7%E6%B1%82%E4%B8%AD%E9%A6%96%E6%AC%A1%E8%AE%BF%E9%97%AE%E6%97%B6%E6%89%8D%E4%BC%9A%E5%AE%9E%E4%BE%8B%E5%8C%96%EF%BC%8C%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%90%8E%E4%BC%9A%E8%A2%AB%E7%BC%93%E5%AD%98%EF%BC%8C%E5%90%8C%E4%B8%80%E4%B8%AA%E8%AF%B7%E6%B1%82%E5%A4%9A%E6%AC%A1%E8%B0%83%E7%94%A8%E4%B9%9F%E5%8F%AA%E4%BC%9A%E5%AE%9E%E4%BE%8B%E5%8C%96%E4%B8%80%E6%AC%A1%E3%80%82%0A%0A%23%23%23%20LoaderOptions%0A%0A%23%23%23%23%20ignore%20%5BString%5D%0A%0Aignore%20%E5%8F%AF%E4%BB%A5%E5%BF%BD%E7%95%A5%E4%B8%80%E4%BA%9B%E6%96%87%E4%BB%B6%EF%BC%8C%E6%94%AF%E6%8C%81%20glob%EF%BC%8C%E9%BB%98%E8%AE%A4%E4%B8%BA%E7%A9%BA%0A%0A%60%60%60js%0Aapp.loader.loadToApp(directory%2C%20'controller'%2C%20%7B%0A%20%20%2F%2F%20%E5%BF%BD%E7%95%A5%20app%2Fcontroller%2Futil%20%E4%B8%8B%E7%9A%84%E6%96%87%E4%BB%B6%0A%20%20ignore%3A%20'util%2F**'%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%23%20initializer%20%5BFunction%5D%0A%0A%E5%AF%B9%E6%AF%8F%E4%B8%AA%E6%96%87%E4%BB%B6%20export%20%E5%87%BA%E6%9D%A5%E7%9A%84%E5%80%BC%E8%BF%9B%E8%A1%8C%E5%A4%84%E7%90%86%EF%BC%8C%E9%BB%98%E8%AE%A4%E4%B8%BA%E7%A9%BA%0A%0A%60%60%60js%0A%2F%2F%20app%2Fmodel%2Fuser.js%0Amodule.exports%20%3D%20class%20User%20%7B%0A%20%20constructor(app%2C%20path)%20%7B%7D%0A%7D%0A%0A%2F%2F%20%E4%BB%8E%20app%2Fmodel%20%E7%9B%AE%E5%BD%95%E5%8A%A0%E8%BD%BD%EF%BC%8C%E5%8A%A0%E8%BD%BD%E6%97%B6%E5%8F%AF%E5%81%9A%E4%B8%80%E4%BA%9B%E5%88%9D%E5%A7%8B%E5%8C%96%E5%A4%84%E7%90%86%0Aconst%20directory%20%3D%20path.join(app.config.baseDir%2C%20'app%2Fmodel')%3B%0Aapp.loader.loadToApp(directory%2C%20'model'%2C%20%7B%0A%20%20initializer(model%2C%20opt)%20%7B%0A%20%20%20%20%2F%2F%20%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E4%B8%BA%20export%20%E7%9A%84%E5%AF%B9%E8%B1%A1%0A%20%20%20%20%2F%2F%20%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%8F%82%E6%95%B0%E4%B8%BA%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%8F%AA%E5%8C%85%E5%90%AB%E5%BD%93%E5%89%8D%E6%96%87%E4%BB%B6%E7%9A%84%E8%B7%AF%E5%BE%84%0A%20%20%20%20return%20new%20model(app%2C%20opt.path)%3B%0A%20%20%7D%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%23%20caseStyle%20%5BString%5D%0A%0A%E6%96%87%E4%BB%B6%E7%9A%84%E8%BD%AC%E6%8D%A2%E8%A7%84%E5%88%99%EF%BC%8C%E5%8F%AF%E9%80%89%E4%B8%BA%20%60camel%60%EF%BC%8C%60upper%60%EF%BC%8C%60lower%60%EF%BC%8C%E9%BB%98%E8%AE%A4%E4%B8%BA%20%60camel%60%E3%80%82%0A%0A%E4%B8%89%E8%80%85%E9%83%BD%E4%BC%9A%E5%B0%86%E6%96%87%E4%BB%B6%E5%90%8D%E8%BD%AC%E6%8D%A2%E6%88%90%E9%A9%BC%E5%B3%B0%EF%BC%8C%E4%BD%86%E6%98%AF%E5%AF%B9%E4%BA%8E%E9%A6%96%E5%AD%97%E6%AF%8D%E7%9A%84%E5%A4%84%E7%90%86%E6%9C%89%E6%89%80%E4%B8%8D%E5%90%8C%E3%80%82%0A%0A-%20%60camel%60%EF%BC%9A%E9%A6%96%E5%AD%97%E6%AF%8D%E4%B8%8D%E5%8F%98%E3%80%82%0A-%20%60upper%60%EF%BC%9A%E9%A6%96%E5%AD%97%E6%AF%8D%E5%A4%A7%E5%86%99%E3%80%82%0A-%20%60lower%60%EF%BC%9A%E9%A6%96%E5%AD%97%E6%AF%8D%E5%B0%8F%E5%86%99%E3%80%82%0A%0A%E5%9C%A8%E5%8A%A0%E8%BD%BD%E4%B8%8D%E5%90%8C%E6%96%87%E4%BB%B6%E6%97%B6%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%0A%0A%E6%96%87%E4%BB%B6%20%7C%20%E9%85%8D%E7%BD%AE%0A---%20%7C%20---%0Aapp%2Fcontroller%20%7C%20lower%0Aapp%2Fmiddleware%20%7C%20lower%0Aapp%2Fservice%20%7C%20lower%0A%0A%23%23%23%23%20override%20%5BBoolean%5D%0A%0A%E9%81%87%E5%88%B0%E5%B7%B2%E7%BB%8F%E5%AD%98%E5%9C%A8%E7%9A%84%E6%96%87%E4%BB%B6%E6%97%B6%E6%98%AF%E7%9B%B4%E6%8E%A5%E8%A6%86%E7%9B%96%E8%BF%98%E6%98%AF%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%EF%BC%8C%E9%BB%98%E8%AE%A4%E4%B8%BA%20false%0A%0A%E6%AF%94%E5%A6%82%E5%90%8C%E6%97%B6%E5%8A%A0%E8%BD%BD%E5%BA%94%E7%94%A8%E5%92%8C%E6%8F%92%E4%BB%B6%E7%9A%84%20%60app%2Fservice%2Fuser.js%60%20%E6%96%87%E4%BB%B6%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%B8%BA%20true%20%E5%BA%94%E7%94%A8%E4%BC%9A%E8%A6%86%E7%9B%96%E6%8F%92%E4%BB%B6%E7%9A%84%EF%BC%8C%E5%90%A6%E5%88%99%E5%8A%A0%E8%BD%BD%E5%BA%94%E7%94%A8%E7%9A%84%E6%96%87%E4%BB%B6%E6%97%B6%E4%BC%9A%E6%8A%A5%E9%94%99%E3%80%82%0A%0A%E5%9C%A8%E5%8A%A0%E8%BD%BD%E4%B8%8D%E5%90%8C%E6%96%87%E4%BB%B6%E6%97%B6%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%0A%0A%E6%96%87%E4%BB%B6%20%7C%20%E9%85%8D%E7%BD%AE%0A---%20%7C%20---%0Aapp%2Fcontroller%20%7C%20true%0Aapp%2Fmiddleware%20%7C%20false%0Aapp%2Fservice%20%7C%20false%0A%0A%23%23%23%23%20call%20%5BBoolean%5D%0A%0A%E5%BD%93%20export%20%E7%9A%84%E5%AF%B9%E8%B1%A1%E4%B8%BA%E5%87%BD%E6%95%B0%E6%97%B6%E5%88%99%E8%B0%83%E7%94%A8%EF%BC%8C%E5%B9%B6%E8%8E%B7%E5%8F%96%E8%BF%94%E5%9B%9E%E5%80%BC%EF%BC%8C%E9%BB%98%E8%AE%A4%E4%B8%BA%20true%0A%0A%E5%9C%A8%E5%8A%A0%E8%BD%BD%E4%B8%8D%E5%90%8C%E6%96%87%E4%BB%B6%E6%97%B6%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%0A%0A%E6%96%87%E4%BB%B6%20%7C%20%E9%85%8D%E7%BD%AE%0A---%20%7C%20---%0Aapp%2Fcontroller%20%7C%20true%0Aapp%2Fmiddleware%20%7C%20false%0Aapp%2Fservice%20%7C%20true%0A%0A%5BLoader%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-core%2Fblob%2Fmaster%2Flib%2Floader%2Fegg_loader.js%0A%5BAppWorkerLoader%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg%2Fblob%2Fmaster%2Flib%2Floader%2Fapp_worker_loader.js%0A%5BAgentWorkerLoader%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg%2Fblob%2Fmaster%2Flib%2Floader%2Fagent_worker_loader.js%0A"}}</script><script type="text/javascript" src="/static/js/post.b9faab88.js"></script></body></html>