<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.png"><style class="_styletron_hydrate_"></style><title>TypeScript</title><meta name="description" content="Born to build better enterprise frameworks and apps"><link href="/static/css/post.d62265dc.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="ant-layout" data-reactroot=""><div class="header-module__header___3ADJ9 ant-layout-header"><div class="ant-row-flex"><div class="ant-col-xs-12 ant-col-md-20 ant-col-lg-2"><div class="header-module__logo___3yTXp"><a href="/"><img src="/logo.svg" alt="logo"/></a></div></div><div class="ant-col-xs-0 ant-col-md-0 ant-col-lg-20"><ul class="ant-menu header-module__menu___3yEtW ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/intro/">指南</a></li><li class="ant-menu-item" role="menuitem"><a href="/api/">API</a></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/tutorials/index.html">教程</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/search?q=topic%3Aegg-plugin&amp;type=Repositories">插件</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/eggjs/egg/releases">发布日志</a></li></ul></div><div style="text-align:right" class="ant-col-xs-12 ant-col-md-4 ant-col-lg-2"><button type="button" class="ant-btn"><span>Languages</span></button></div></div></div><div class="ant-layout-content"><div class="basic_layout-module__content___3flpY ant-layout"><div class="sider-module__side___1Cadj ant-layout-sider ant-layout-sider-light" style="flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"><ul class="ant-menu sider-module__menu___2GqPr ant-menu-light ant-menu-root ant-menu-inline" role="menu"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="0$Menu" aria-haspopup="true"><span>新手指南</span><i class="ant-menu-submenu-arrow"></i></div><ul id="0$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/index.html">Egg.js 是什么?</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/egg-and-koa.html">Egg.js 和 Koa</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/quickstart.html">快速入门</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/progressive.html">渐进式开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/migration.html">2.x 升级指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="1$Menu" aria-haspopup="true"><span>基础功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="1$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/structure.html">目录结构</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/objects.html">内置对象</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/env.html">运行环境</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/config.html">配置</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/middleware.html">中间件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/router.html">Router</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/controller.html">Controller</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/service.html">Service</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/plugin.html">插件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/schedule.html">定时任务</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/extend.html">框架扩展</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/app-start.html">启动自定义</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="2$Menu" aria-haspopup="true"><span>核心功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="2$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/development.html">本地开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/unittest.html">单元测试</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/deployment.html">应用部署</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/logger.html">日志</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/httpclient.html">HttpClient</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cookie-and-session.html">Cookie and Session</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cluster-and-ipc.html">多进程模型和进程间通讯</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/view.html">模板渲染</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/error-handling.html">异常处理</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/security.html">安全</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/i18n.html">国际化</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="3$Menu" aria-haspopup="true"><span>教程</span><i class="ant-menu-submenu-arrow"></i></div><ul id="3$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/mysql.html">MySQL</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/restful.html">RESTful API</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/passport.html">Passport 鉴权</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/socketio.html">Socket.IO</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/assets.html">静态资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/typescript.html">TypeScript</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="4$Menu" aria-haspopup="true"><span>进阶</span><i class="ant-menu-submenu-arrow"></i></div><ul id="4$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/loader.html">Loader</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/plugin.html">插件开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/framework.html">框架开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/cluster-client.html">多进程研发模式增强</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/view-plugin.html">模板插件开发规范</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/style-guide.html">代码风格指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="5$Menu" aria-haspopup="true"><span>社区</span><i class="ant-menu-submenu-arrow"></i></div><ul id="5$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/plugins/">内置插件列表</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/contributing.html">如何贡献</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/resource.html">资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/faq.html">常见问题</a></li></ul></li></ul></div></div><div class="basic_layout-module__post___2Z7KK ant-layout-content"><div class="ant-row" style="margin-left:-8px;margin-right:-8px"><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-24 ant-col-md-18"><div class="markdown-body" style="font-size:14px"><div><blockquote><p><a href="https://www.typescriptlang.org/">TypeScript</a> is a typed superset of JavaScript that compiles to plain JavaScript.</p></blockquote><p>TypeScript 的静态类型检查，智能提示，IDE 友好性等特性，对于大规模企业级应用，是非常的有价值的。详见：<a href="https://juejin.im/post/59c46bc86fb9a00a4636f939">TypeScript体系调研报告</a> 。</p><p>然而，此前使用 TypeScript 开发 Egg ，会遇到一些影响 <strong>开发者体验</strong> 问题：</p><ul><li>Egg 最精髓的 Loader 自动加载机制，导致 TS 无法静态分析出部分依赖。</li><li>Config 自动合并机制下，如何在 <code>config.{env}.js</code> 里面修改插件提供的配置时，能校验并智能提示？</li><li>开发期需要独立开一个 <code>tsc -w</code> 独立进程来构建代码，带来临时文件位置纠结以及 <code>npm scripts</code> 复杂化。</li><li>单元测试，覆盖率测试，线上错误堆栈如何指向 TS 源文件，而不是编译后的 js 文件。</li></ul><p>本文主要阐述：</p><ul><li><strong>应用层 TS 开发规范</strong></li><li><strong>我们在工具链方面的支持，是如何来解决上述问题，让开发者几乎无感知并保持一致性。</strong></li></ul><p>具体的折腾过程参见：<a href="https://github.com/eggjs/egg/issues/2272">[RFC] TypeScript tool support</a></p><hr/><h2 id="快速入门">快速入门</h2><p>通过骨架快速初始化：</p><pre><code class="language-bash">$ npx egg-init --type=ts showcase
$ cd showcase &amp;&amp; npm i
$ npm run dev</code></pre><p>上述骨架会生成一个极简版的示例，更完整的示例参见：<a href="https://github.com/eggjs/examples/tree/master/hackernews-async-ts">eggjs/examples/hackernews-async-ts</a></p><p><img alt="tegg.gif" src="https://user-images.githubusercontent.com/227713/38358019-bf7890fa-38f6-11e8-8955-ea072ac6dc8c.gif"/></p><hr/><h2 id="目录规范">目录规范</h2><p><strong>一些约束：</strong></p><ul><li>Egg 目前没有计划使用 TS 重写。</li><li>Egg 以及它对应的插件，会提供对应的 <code>index.d.ts</code> 文件方便开发者使用。</li><li>TypeScript 只是其中一种社区实践，我们通过工具链给予一定程度的支持。</li><li>TypeScript 最低要求 2.8+ 版本。</li></ul><p>整体目录结构上跟 Egg 普通项目没啥区别:</p><ul><li><code>typescript</code> 代码风格，后缀名为 <code>ts</code></li><li><code>typings</code> 目录用于放置 <code>d.ts</code> 文件（大部分会自动生成）</li></ul><pre><code class="language-bash">showcase
├── app
│   ├── controller
│   │   └── home.ts
│   ├── service
│   │   └── news.ts
│   └── router.ts
├── config
│   ├── config.default.ts
│   ├── config.local.ts
│   ├── config.prod.ts
│   └── plugin.ts
├── test
│   └── **/*.test.ts
├── typings
│   └── **/*.d.ts
├── README.md
├── package.json
├── tsconfig.json
└── tslint.json</code></pre><h3 id="controller">Controller</h3><pre><code class="language-typescript">// app/controller/home.ts
import { Controller } from &#x27;egg&#x27;;

export default class HomeController extends Controller {
  public async index() {
    const { ctx, service } = this;
    const page = ctx.query.page;
    const result = await service.news.list(page);
    await ctx.render(&#x27;home.tpl&#x27;, result);
  }
}</code></pre><h3 id="router">Router</h3><pre><code class="language-typescript">// app/router.ts
import { Application } from &#x27;egg&#x27;;

export default (app: Application) =&gt; {
  const { router, controller } = app;
  router.get(&#x27;/&#x27;, controller.home.index);
};</code></pre><h3 id="service">Service</h3><pre><code class="language-typescript">// app/service/news.ts
import { Service } from &#x27;egg&#x27;;

export default class NewsService extends Service {
  public async list(page?: number): Promise&lt;NewsItem[]&gt; {
    return [];
  }
}

export interface NewsItem {
  id: number;
  title: string;
}</code></pre><h3 id="middleware">Middleware</h3><pre><code class="language-typescript">// app/middleware/robot.ts

import { Context } from &#x27;egg&#x27;;

export default function robotMiddleware() {
  return async (ctx: Context, next: any) =&gt; {
    await next();
  };
}</code></pre><p>因为 Middleware 定义是支持入参的，第一个参数为同名的 Config，如有需求，可以用完整版：</p><pre><code class="language-typescript">// app/middleware/news.ts

import { Context, Application } from &#x27;egg&#x27;;
import { BizConfig } from &#x27;../../config/config.default&#x27;;

// 注意，这里必须要用 [&#x27;news&#x27;] 而不能用 .news，因为 BizConfig 是 type，不是实例
export default function newsMiddleware(options: BizConfig[&#x27;news&#x27;], app: Application) {
  return async (ctx: Context, next: () =&gt; Promise&lt;any&gt;) =&gt; {
    console.info(options.serverUrl);
    await next();
  };
}</code></pre><h3 id="extend">Extend</h3><pre><code class="language-typescript">// app/extend/context.ts
import { Context } from &#x27;egg&#x27;;

export default {
  isAjax(this: Context) {
    return this.get(&#x27;X-Requested-With&#x27;) === &#x27;XMLHttpRequest&#x27;;
  },
}

// app.ts
export default app =&gt; {
  app.beforeStart(async () =&gt; {
    await Promise.resolve(&#x27;egg + ts&#x27;);
  });
};</code></pre><h3 id="config">Config</h3><p><code>Config</code> 这块稍微有点复杂，因为要支持：</p><ul><li>在 Controller，Service 那边使用配置，需支持多级提示，并自动关联。</li><li>Config 内部， <code>config.view = {}</code> 的写法，也应该支持提示。</li><li>在 <code>config.{env}.ts</code> 里可以用到 <code>config.default.ts</code> 自定义配置的提示。</li></ul><pre><code class="language-typescript">// app/config/config.default.ts
import { EggAppInfo, EggAppConfig, PowerPartial } from &#x27;egg&#x27;;

// 提供给 config.{env}.ts 使用
export type DefaultConfig = PowerPartial&lt;EggAppConfig &amp; BizConfig&gt;;

// 应用本身的配置 Scheme
export interface BizConfig {
  news: {
    pageSize: number;
    serverUrl: string;
  };
}

export default (appInfo: EggAppInfo) =&gt; {
  const config = {} as PowerPartial&lt;EggAppConfig&gt; &amp; BizConfig;

  // 覆盖框架，插件的配置
  config.keys = appInfo.name + &#x27;123456&#x27;;
  config.view = {
    defaultViewEngine: &#x27;nunjucks&#x27;,
    mapping: {
      &#x27;.tpl&#x27;: &#x27;nunjucks&#x27;,
    },
  };

  // 应用本身的配置
  config.news = {
    pageSize: 30,
    serverUrl: &#x27;https://hacker-news.firebaseio.com/v0&#x27;,
  };

  return config;
};</code></pre><p>简单版：</p><pre><code class="language-typescript">// app/config/config.local.ts
import { DefaultConfig } from &#x27;./config.default&#x27;;

export default () =&gt; {
  const config: DefaultConfig = {};
  config.news = {
    pageSize: 20,
  };
  return config;
};</code></pre><p>备注：</p><ul><li>TS 的 <code>Conditional Types</code> 是我们能完美解决 Config 提示的关键。</li><li>有兴趣的可以看下 <a href="https://github.com/eggjs/egg/blob/master/index.d.ts">egg/index.d.ts</a> 里面的 <code>PowerPartial</code> 实现。</li></ul><pre><code class="language-typescript">// {egg}/index.d.ts
type PowerPartial&lt;T&gt; = {
  [U in keyof T]?: T[U] extends {}
    ? PowerPartial&lt;T[U]&gt;
    : T[U]
};</code></pre><h3 id="plugin">Plugin</h3><pre><code class="language-javascript">// config/plugin.ts
import { EggPlugin } from &#x27;egg&#x27;;

const plugin: EggPlugin = {
  static: true,
  nunjucks: {
    enable: true,
    package: &#x27;egg-view-nunjucks&#x27;,
  },
};

export default plugin;</code></pre><h3 id="typings">Typings</h3><p>该目录为 TS 的规范，在里面的 <code>**/*.d.ts</code> 文件将被自动识别。</p><ul><li>开发者需要手写的建议放在 <code>typings/index.d.ts</code> 中。</li><li>工具会自动生成 <code>typings/{app,config}/**.d.ts</code> ，请勿自行修改，避免被覆盖。（见下文）</li></ul><hr/><h2 id="开发期">开发期</h2><h3 id="ts-node">ts-node</h3><p><code>egg-bin</code> 已经内建了 <a href="https://github.com/TypeStrong/ts-node">ts-node</a> ，<code>egg loader</code> 在开发期会自动加载 <code>*.ts</code> 并内存编译。</p><p>目前已支持 <code>dev</code> / <code>debug</code> / <code>test</code> / <code>cov</code> 。</p><p>开发者仅需简单配置下 <code>package.json</code> ：</p><pre><code class="language-json">{
  &quot;name&quot;: &quot;showcase&quot;,
  &quot;egg&quot;: {
    &quot;typescript&quot;: true
  }
}</code></pre><h3 id="egg-ts-helper">egg-ts-helper</h3><p>由于 Egg 的自动加载机制，导致 TS 无法静态分析依赖，关联提示。</p><p>幸亏 TS 黑魔法比较多，我们可以通过 TS 的 <a href="https://www.typescriptlang.org/docs/handbook/declaration-merging.html">Declaration Merging</a> 编写 <code>d.ts</code> 来辅助。</p><p>譬如 <code>app/service/news.ts</code> 会自动挂载为 <code>ctx.service.news</code> ，通过如下写法即识别到：</p><pre><code class="language-typescript">// typings/app/service/index.d.ts
import News from &#x27;../../../app/service/News&#x27;;

declare module &#x27;egg&#x27; {
  interface IService {
    news: News;
  }
}</code></pre><p>手动写这些文件，未免有点繁琐，因此我们提供了 <a href="https://github.com/whxaxes/egg-ts-helper">egg-ts-helper</a> 工具来自动分析源码生成对应的 <code>d.ts</code> 文件。</p><p>只需配置下 <code>package.json</code> :</p><pre><code class="language-javascript">{
  &quot;devDependencies&quot;: {
    &quot;egg-ts-helper&quot;: &quot;^1&quot;
  },
  &quot;scripts&quot;: {
    &quot;dev&quot;: &quot;egg-bin dev -r egg-ts-helper/register&quot;,
    &quot;test-local&quot;: &quot;egg-bin test -r egg-ts-helper/register&quot;,
    &quot;clean&quot;: &quot;ets clean&quot;
  }
}</code></pre><p>开发期将自动生成对应的 <code>d.ts</code> 到 <code>typings/{app,config}/</code> 下，<strong>请勿自行修改，避免被覆盖</strong>。</p><blockquote><p>后续该工具也会考虑支持  js 版 egg 应用的分析，可以一定程度上提升 js 开发体验。</p></blockquote><h3 id="unit-test-cov">Unit Test &amp;&amp; Cov</h3><p>单元测试当然少不了：</p><pre><code class="language-typescript">// test/app/service/news.test.ts
import * as assert from &#x27;assert&#x27;;
import { Context } from &#x27;egg&#x27;;
import { app } from &#x27;egg-mock/bootstrap&#x27;;

describe(&#x27;test/app/service/news.test.js&#x27;, () =&gt; {
  let ctx: Context;

  before(async () =&gt; {
    ctx = app.mockContext();
  });

  it(&#x27;list()&#x27;, async () =&gt; {
    const list = await ctx.service.news.list();
    assert(list.length === 30);
  });
});</code></pre><p>运行命令也跟之前一样，并内置了 <code>错误堆栈和覆盖率</code> 的支持：</p><pre><code class="language-json">{
  &quot;name&quot;: &quot;showcase&quot;,
  &quot;scripts&quot;: {
    &quot;test&quot;: &quot;npm run lint -- --fix &amp;&amp; npm run test-local&quot;,
    &quot;test-local&quot;: &quot;egg-bin test -r egg-ts-helper/register&quot;,
    &quot;cov&quot;: &quot;egg-bin cov -r egg-ts-helper/register&quot;,
    &quot;lint&quot;: &quot;tslint .&quot;
  }
}</code></pre><h3 id="debug">Debug</h3><p>断点调试跟之前也没啥区别，会自动通过 <code>sourcemap</code> 断点到正确的位置。</p><pre><code class="language-json">{
  &quot;name&quot;: &quot;showcase&quot;,
  &quot;scripts&quot;: {
    &quot;debug&quot;: &quot;egg-bin debug -r egg-ts-helper/register&quot;,
    &quot;debug-test&quot;: &quot;npm run test-local -- --inspect&quot;
  }
}</code></pre><ul><li><a href="https://eggjs.org/zh-cn/core/development.html#%E4%BD%BF%E7%94%A8-vscode-%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95">使用 VSCode 进行调试</a></li><li><a href="https://github.com/atian25/blog/issues/25">VSCode 调试 Egg 完美版 - 进化史</a></li></ul><hr/><h2 id="部署">部署</h2><h3 id="构建">构建</h3><ul><li>正式环境下，我们更倾向于把 ts 构建为 js ，建议在 <code>ci</code> 上构建并打包。</li></ul><p>配置 <code>package.json</code> :</p><pre><code class="language-json">{
  &quot;egg&quot;: {
    &quot;typescript&quot;: true
  }，
  &quot;scripts&quot;: {
    &quot;start&quot;: &quot;egg-scripts start --title=egg-server-showcase&quot;,
    &quot;stop&quot;: &quot;egg-scripts stop --title=egg-server-showcase&quot;,
    &quot;tsc&quot;: &quot;ets &amp;&amp; tsc -p tsconfig.json&quot;,
    &quot;ci&quot;: &quot;npm run lint &amp;&amp; npm run cov &amp;&amp; npm run tsc&quot;,
    &quot;clean&quot;: &quot;ets clean&quot;
  }
}</code></pre><p>对应的 <code>tsconfig.json</code> :</p><pre><code class="language-json">{
  &quot;compileOnSave&quot;: true,
  &quot;compilerOptions&quot;: {
    &quot;target&quot;: &quot;es2017&quot;,
    &quot;module&quot;: &quot;commonjs&quot;,
    &quot;strict&quot;: true,
    &quot;noImplicitAny&quot;: false,
    &quot;experimentalDecorators&quot;: true,
    &quot;emitDecoratorMetadata&quot;: true,
    &quot;charset&quot;: &quot;utf8&quot;,
    &quot;allowJs&quot;: false,
    &quot;pretty&quot;: true,
    &quot;noEmitOnError&quot;: false,
    &quot;noUnusedLocals&quot;: true,
    &quot;noUnusedParameters&quot;: true,
    &quot;allowUnreachableCode&quot;: false,
    &quot;allowUnusedLabels&quot;: false,
    &quot;strictPropertyInitialization&quot;: false,
    &quot;noFallthroughCasesInSwitch&quot;: true,
    &quot;skipLibCheck&quot;: true,
    &quot;skipDefaultLibCheck&quot;: true,
    &quot;inlineSourceMap&quot;: true,
    &quot;importHelpers&quot;: true
  },
  &quot;exclude&quot;: [
    &quot;app/public&quot;,
    &quot;app/web&quot;,
    &quot;app/views&quot;
  ]
}</code></pre><p><strong>注意：</strong></p><ul><li><strong>当有同名的 ts 和 js 文件时，egg 会优先加载 js 文件。</strong></li><li>因此在开发期， <code>egg-ts-helper</code> 会自动调用清除同名的 <code>js</code> 文件，也可 <code>npm run clean</code> 手动清除。</li></ul><h3 id="错误堆栈">错误堆栈</h3><p>线上服务的代码是经过编译后的 js，而我们期望看到的错误堆栈是指向 TS 源码。
因此：</p><ul><li>在构建的时候，需配置 <code>inlineSourceMap: true</code> 在 js 底部插入 sourcemap 信息。</li><li>在 <code>egg-scripts</code> 内建了处理，会自动纠正为正确的错误堆栈，应用开发者无需担心。</li></ul><p>具体内幕参见：</p><ul><li><a href="https://zhuanlan.zhihu.com/p/26267678">https://zhuanlan.zhihu.com/p/26267678</a></li><li><a href="https://github.com/eggjs/egg-scripts/pull/19">https://github.com/eggjs/egg-scripts/pull/19</a></li></ul><hr/><h2 id="插件框架开发指南">插件/框架开发指南</h2><p><strong>指导原则：</strong></p><ul><li>不建议使用 TS 直接开发插件/框架，发布到 npm 的插件应该是 js 形式。</li><li>当你开发了一个插件/框架后，需要提供对应的 <code>index.d.ts</code> 。</li><li>通过 <a href="https://www.typescriptlang.org/docs/handbook/declaration-merging.html">Declaration Merging</a> 将插件/框架的功能注入到 Egg 中。</li><li>都挂载到 <code>egg</code> 这个 module，不要用上层框架。</li></ul><h3 id="插件">插件</h3><p>可以参考 <code>egg-ts-helper</code> 自动生成的格式</p><pre><code class="language-typescript">// {plugin_root}/index.d.ts

import News from &#x27;../../../app/service/News&#x27;;

declare module &#x27;egg&#x27; {

  // 扩展 service
  interface IService {
    news: News;
  }

  // 扩展 app
  interface Application {

  }

  // 扩展 context
  interface Context {

  }

  // 扩展你的配置
  interface EggAppConfig {

  }

  // 扩展自定义环境
  type EggEnvType = &#x27;local&#x27; | &#x27;unittest&#x27; | &#x27;prod&#x27; | &#x27;sit&#x27;;
}</code></pre><h3 id="上层框架">上层框架</h3><p>定义：</p><pre><code class="language-typescript">// {framework_root}/index.d.ts

import * as Egg from &#x27;egg&#x27;;

// 将该上层框架用到的插件 import 进来
import &#x27;my-plugin&#x27;;

declare module &#x27;egg&#x27; {
  // 跟插件一样拓展 egg ...
}

// 将 Egg 整个 export 出去
export = Egg;</code></pre><p>开发者使用的时候，可以直接 import 你的框架：</p><pre><code class="language-typescript">// app/service/news.ts

// 开发者引入你的框架，也可以使用到提示到所有 Egg 的提示
import { Service } from &#x27;duck-egg&#x27;;

export default class NewsService extends Service {
  public async list(page?: number): Promise&lt;NewsItem[]&gt; {
    return [];
  }
}</code></pre></div></div></div><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-0 ant-col-md-6"><div class="markdown-body" style="font-size:14px"><div><ul><li><a href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8">快速入门</a></li><li><a href="#%E7%9B%AE%E5%BD%95%E8%A7%84%E8%8C%83">目录规范</a><ul><li><a href="#controller">Controller</a></li><li><a href="#router">Router</a></li><li><a href="#service">Service</a></li><li><a href="#middleware">Middleware</a></li><li><a href="#extend">Extend</a></li><li><a href="#config">Config</a></li><li><a href="#plugin">Plugin</a></li><li><a href="#typings">Typings</a></li></ul></li><li><a href="#%E5%BC%80%E5%8F%91%E6%9C%9F">开发期</a><ul><li><a href="#ts-node">ts-node</a></li><li><a href="#egg-ts-helper">egg-ts-helper</a></li><li><a href="#unit-test-cov">Unit Test &amp;&amp; Cov</a></li><li><a href="#debug">Debug</a></li></ul></li><li><a href="#%E9%83%A8%E7%BD%B2">部署</a><ul><li><a href="#%E6%9E%84%E5%BB%BA">构建</a></li><li><a href="#%E9%94%99%E8%AF%AF%E5%A0%86%E6%A0%88">错误堆栈</a></li></ul></li><li><a href="#%E6%8F%92%E4%BB%B6%E6%A1%86%E6%9E%B6%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97">插件/框架开发指南</a><ul><li><a href="#%E6%8F%92%E4%BB%B6">插件</a></li><li><a href="#%E4%B8%8A%E5%B1%82%E6%A1%86%E6%9E%B6">上层框架</a></li></ul></li></ul></div></div></div></div></div></div></div></div></div><script type="text/javascript">window.__INIT_STATE__={"lang":"zh","props":{"toc":"-%20%5B%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%5D(%23%25E5%25BF%25AB%25E9%2580%259F%25E5%2585%25A5%25E9%2597%25A8)%0A-%20%5B%E7%9B%AE%E5%BD%95%E8%A7%84%E8%8C%83%5D(%23%25E7%259B%25AE%25E5%25BD%2595%25E8%25A7%2584%25E8%258C%2583)%0A%20%20*%20%5BController%5D(%23controller)%0A%20%20*%20%5BRouter%5D(%23router)%0A%20%20*%20%5BService%5D(%23service)%0A%20%20*%20%5BMiddleware%5D(%23middleware)%0A%20%20*%20%5BExtend%5D(%23extend)%0A%20%20*%20%5BConfig%5D(%23config)%0A%20%20*%20%5BPlugin%5D(%23plugin)%0A%20%20*%20%5BTypings%5D(%23typings)%0A-%20%5B%E5%BC%80%E5%8F%91%E6%9C%9F%5D(%23%25E5%25BC%2580%25E5%258F%2591%25E6%259C%259F)%0A%20%20*%20%5Bts-node%5D(%23ts-node)%0A%20%20*%20%5Begg-ts-helper%5D(%23egg-ts-helper)%0A%20%20*%20%5BUnit%20Test%20%26%26%20Cov%5D(%23unit-test-cov)%0A%20%20*%20%5BDebug%5D(%23debug)%0A-%20%5B%E9%83%A8%E7%BD%B2%5D(%23%25E9%2583%25A8%25E7%25BD%25B2)%0A%20%20*%20%5B%E6%9E%84%E5%BB%BA%5D(%23%25E6%259E%2584%25E5%25BB%25BA)%0A%20%20*%20%5B%E9%94%99%E8%AF%AF%E5%A0%86%E6%A0%88%5D(%23%25E9%2594%2599%25E8%25AF%25AF%25E5%25A0%2586%25E6%25A0%2588)%0A-%20%5B%E6%8F%92%E4%BB%B6%2F%E6%A1%86%E6%9E%B6%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97%5D(%23%25E6%258F%2592%25E4%25BB%25B6%25E6%25A1%2586%25E6%259E%25B6%25E5%25BC%2580%25E5%258F%2591%25E6%258C%2587%25E5%258D%2597)%0A%20%20*%20%5B%E6%8F%92%E4%BB%B6%5D(%23%25E6%258F%2592%25E4%25BB%25B6)%0A%20%20*%20%5B%E4%B8%8A%E5%B1%82%E6%A1%86%E6%9E%B6%5D(%23%25E4%25B8%258A%25E5%25B1%2582%25E6%25A1%2586%25E6%259E%25B6)","meta":{"info":{"title":"TypeScript"}},"content":"%0A%0A%0A%3E%20%5BTypeScript%5D(https%3A%2F%2Fwww.typescriptlang.org%2F)%20is%20a%20typed%20superset%20of%20JavaScript%20that%20compiles%20to%20plain%20JavaScript.%0A%0ATypeScript%20%E7%9A%84%E9%9D%99%E6%80%81%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%9F%A5%EF%BC%8C%E6%99%BA%E8%83%BD%E6%8F%90%E7%A4%BA%EF%BC%8CIDE%20%E5%8F%8B%E5%A5%BD%E6%80%A7%E7%AD%89%E7%89%B9%E6%80%A7%EF%BC%8C%E5%AF%B9%E4%BA%8E%E5%A4%A7%E8%A7%84%E6%A8%A1%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BA%94%E7%94%A8%EF%BC%8C%E6%98%AF%E9%9D%9E%E5%B8%B8%E7%9A%84%E6%9C%89%E4%BB%B7%E5%80%BC%E7%9A%84%E3%80%82%E8%AF%A6%E8%A7%81%EF%BC%9A%5BTypeScript%E4%BD%93%E7%B3%BB%E8%B0%83%E7%A0%94%E6%8A%A5%E5%91%8A%5D(https%3A%2F%2Fjuejin.im%2Fpost%2F59c46bc86fb9a00a4636f939)%20%E3%80%82%0A%0A%E7%84%B6%E8%80%8C%EF%BC%8C%E6%AD%A4%E5%89%8D%E4%BD%BF%E7%94%A8%20TypeScript%20%E5%BC%80%E5%8F%91%20Egg%20%EF%BC%8C%E4%BC%9A%E9%81%87%E5%88%B0%E4%B8%80%E4%BA%9B%E5%BD%B1%E5%93%8D%20**%E5%BC%80%E5%8F%91%E8%80%85%E4%BD%93%E9%AA%8C**%20%E9%97%AE%E9%A2%98%EF%BC%9A%0A%0A*%20Egg%20%E6%9C%80%E7%B2%BE%E9%AB%93%E7%9A%84%20Loader%20%E8%87%AA%E5%8A%A8%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6%EF%BC%8C%E5%AF%BC%E8%87%B4%20TS%20%E6%97%A0%E6%B3%95%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E5%87%BA%E9%83%A8%E5%88%86%E4%BE%9D%E8%B5%96%E3%80%82%0A*%20Config%20%E8%87%AA%E5%8A%A8%E5%90%88%E5%B9%B6%E6%9C%BA%E5%88%B6%E4%B8%8B%EF%BC%8C%E5%A6%82%E4%BD%95%E5%9C%A8%20%60config.%7Benv%7D.js%60%20%E9%87%8C%E9%9D%A2%E4%BF%AE%E6%94%B9%E6%8F%92%E4%BB%B6%E6%8F%90%E4%BE%9B%E7%9A%84%E9%85%8D%E7%BD%AE%E6%97%B6%EF%BC%8C%E8%83%BD%E6%A0%A1%E9%AA%8C%E5%B9%B6%E6%99%BA%E8%83%BD%E6%8F%90%E7%A4%BA%EF%BC%9F%0A*%20%E5%BC%80%E5%8F%91%E6%9C%9F%E9%9C%80%E8%A6%81%E7%8B%AC%E7%AB%8B%E5%BC%80%E4%B8%80%E4%B8%AA%20%60tsc%20-w%60%20%E7%8B%AC%E7%AB%8B%E8%BF%9B%E7%A8%8B%E6%9D%A5%E6%9E%84%E5%BB%BA%E4%BB%A3%E7%A0%81%EF%BC%8C%E5%B8%A6%E6%9D%A5%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6%E4%BD%8D%E7%BD%AE%E7%BA%A0%E7%BB%93%E4%BB%A5%E5%8F%8A%20%60npm%20scripts%60%20%E5%A4%8D%E6%9D%82%E5%8C%96%E3%80%82%0A*%20%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%EF%BC%8C%E8%A6%86%E7%9B%96%E7%8E%87%E6%B5%8B%E8%AF%95%EF%BC%8C%E7%BA%BF%E4%B8%8A%E9%94%99%E8%AF%AF%E5%A0%86%E6%A0%88%E5%A6%82%E4%BD%95%E6%8C%87%E5%90%91%20TS%20%E6%BA%90%E6%96%87%E4%BB%B6%EF%BC%8C%E8%80%8C%E4%B8%8D%E6%98%AF%E7%BC%96%E8%AF%91%E5%90%8E%E7%9A%84%20js%20%E6%96%87%E4%BB%B6%E3%80%82%0A%0A%E6%9C%AC%E6%96%87%E4%B8%BB%E8%A6%81%E9%98%90%E8%BF%B0%EF%BC%9A%0A%0A*%20**%E5%BA%94%E7%94%A8%E5%B1%82%20TS%20%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83**%0A*%20**%E6%88%91%E4%BB%AC%E5%9C%A8%E5%B7%A5%E5%85%B7%E9%93%BE%E6%96%B9%E9%9D%A2%E7%9A%84%E6%94%AF%E6%8C%81%EF%BC%8C%E6%98%AF%E5%A6%82%E4%BD%95%E6%9D%A5%E8%A7%A3%E5%86%B3%E4%B8%8A%E8%BF%B0%E9%97%AE%E9%A2%98%EF%BC%8C%E8%AE%A9%E5%BC%80%E5%8F%91%E8%80%85%E5%87%A0%E4%B9%8E%E6%97%A0%E6%84%9F%E7%9F%A5%E5%B9%B6%E4%BF%9D%E6%8C%81%E4%B8%80%E8%87%B4%E6%80%A7%E3%80%82**%0A%0A%E5%85%B7%E4%BD%93%E7%9A%84%E6%8A%98%E8%85%BE%E8%BF%87%E7%A8%8B%E5%8F%82%E8%A7%81%EF%BC%9A%5B%5BRFC%5D%20TypeScript%20tool%20support%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg%2Fissues%2F2272)%0A%0A---%0A%0A%23%23%20%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%0A%0A%E9%80%9A%E8%BF%87%E9%AA%A8%E6%9E%B6%E5%BF%AB%E9%80%9F%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%9A%0A%0A%60%60%60bash%0A%24%20npx%20egg-init%20--type%3Dts%20showcase%0A%24%20cd%20showcase%20%26%26%20npm%20i%0A%24%20npm%20run%20dev%0A%60%60%60%0A%0A%E4%B8%8A%E8%BF%B0%E9%AA%A8%E6%9E%B6%E4%BC%9A%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E6%9E%81%E7%AE%80%E7%89%88%E7%9A%84%E7%A4%BA%E4%BE%8B%EF%BC%8C%E6%9B%B4%E5%AE%8C%E6%95%B4%E7%9A%84%E7%A4%BA%E4%BE%8B%E5%8F%82%E8%A7%81%EF%BC%9A%5Beggjs%2Fexamples%2Fhackernews-async-ts%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fexamples%2Ftree%2Fmaster%2Fhackernews-async-ts)%0A%0A!%5Btegg.gif%5D(https%3A%2F%2Fuser-images.githubusercontent.com%2F227713%2F38358019-bf7890fa-38f6-11e8-8955-ea072ac6dc8c.gif)%0A%0A---%0A%0A%23%23%20%E7%9B%AE%E5%BD%95%E8%A7%84%E8%8C%83%0A%0A**%E4%B8%80%E4%BA%9B%E7%BA%A6%E6%9D%9F%EF%BC%9A**%0A%0A*%20Egg%20%E7%9B%AE%E5%89%8D%E6%B2%A1%E6%9C%89%E8%AE%A1%E5%88%92%E4%BD%BF%E7%94%A8%20TS%20%E9%87%8D%E5%86%99%E3%80%82%0A*%20Egg%20%E4%BB%A5%E5%8F%8A%E5%AE%83%E5%AF%B9%E5%BA%94%E7%9A%84%E6%8F%92%E4%BB%B6%EF%BC%8C%E4%BC%9A%E6%8F%90%E4%BE%9B%E5%AF%B9%E5%BA%94%E7%9A%84%20%60index.d.ts%60%20%E6%96%87%E4%BB%B6%E6%96%B9%E4%BE%BF%E5%BC%80%E5%8F%91%E8%80%85%E4%BD%BF%E7%94%A8%E3%80%82%0A*%20TypeScript%20%E5%8F%AA%E6%98%AF%E5%85%B6%E4%B8%AD%E4%B8%80%E7%A7%8D%E7%A4%BE%E5%8C%BA%E5%AE%9E%E8%B7%B5%EF%BC%8C%E6%88%91%E4%BB%AC%E9%80%9A%E8%BF%87%E5%B7%A5%E5%85%B7%E9%93%BE%E7%BB%99%E4%BA%88%E4%B8%80%E5%AE%9A%E7%A8%8B%E5%BA%A6%E7%9A%84%E6%94%AF%E6%8C%81%E3%80%82%0A*%20TypeScript%20%E6%9C%80%E4%BD%8E%E8%A6%81%E6%B1%82%202.8%2B%20%E7%89%88%E6%9C%AC%E3%80%82%0A%0A%E6%95%B4%E4%BD%93%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E4%B8%8A%E8%B7%9F%20Egg%20%E6%99%AE%E9%80%9A%E9%A1%B9%E7%9B%AE%E6%B2%A1%E5%95%A5%E5%8C%BA%E5%88%AB%3A%0A%0A*%20%60typescript%60%20%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC%EF%BC%8C%E5%90%8E%E7%BC%80%E5%90%8D%E4%B8%BA%20%60ts%60%0A*%20%60typings%60%20%E7%9B%AE%E5%BD%95%E7%94%A8%E4%BA%8E%E6%94%BE%E7%BD%AE%20%60d.ts%60%20%E6%96%87%E4%BB%B6%EF%BC%88%E5%A4%A7%E9%83%A8%E5%88%86%E4%BC%9A%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%EF%BC%89%0A%0A%60%60%60bash%0Ashowcase%0A%E2%94%9C%E2%94%80%E2%94%80%20app%0A%E2%94%82%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20controller%0A%E2%94%82%20%20%20%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20home.ts%0A%E2%94%82%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20service%0A%E2%94%82%20%20%20%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20news.ts%0A%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20router.ts%0A%E2%94%9C%E2%94%80%E2%94%80%20config%0A%E2%94%82%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20config.default.ts%0A%E2%94%82%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20config.local.ts%0A%E2%94%82%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20config.prod.ts%0A%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20plugin.ts%0A%E2%94%9C%E2%94%80%E2%94%80%20test%0A%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20**%2F*.test.ts%0A%E2%94%9C%E2%94%80%E2%94%80%20typings%0A%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20**%2F*.d.ts%0A%E2%94%9C%E2%94%80%E2%94%80%20README.md%0A%E2%94%9C%E2%94%80%E2%94%80%20package.json%0A%E2%94%9C%E2%94%80%E2%94%80%20tsconfig.json%0A%E2%94%94%E2%94%80%E2%94%80%20tslint.json%0A%60%60%60%0A%0A%23%23%23%20Controller%0A%0A%60%60%60typescript%0A%2F%2F%20app%2Fcontroller%2Fhome.ts%0Aimport%20%7B%20Controller%20%7D%20from%20'egg'%3B%0A%0Aexport%20default%20class%20HomeController%20extends%20Controller%20%7B%0A%20%20public%20async%20index()%20%7B%0A%20%20%20%20const%20%7B%20ctx%2C%20service%20%7D%20%3D%20this%3B%0A%20%C2%A0%20%C2%A0const%20page%20%3D%20ctx.query.page%3B%0A%20%C2%A0%20%C2%A0const%20result%20%3D%20await%20service.news.list(page)%3B%0A%20%C2%A0%20%C2%A0await%20ctx.render('home.tpl'%2C%20result)%3B%0A%20%C2%A0%7D%0A%7D%0A%60%60%60%0A%0A%23%23%23%20Router%0A%0A%60%60%60typescript%0A%2F%2F%20app%2Frouter.ts%0Aimport%20%7B%20Application%20%7D%20from%20'egg'%3B%0A%0Aexport%20default%20(app%3A%20Application)%20%3D%3E%20%7B%0A%20%20const%20%7B%20router%2C%20controller%20%7D%20%3D%20app%3B%0A%20%20router.get('%2F'%2C%20controller.home.index)%3B%0A%7D%3B%0A%60%60%60%0A%0A%23%23%23%20Service%0A%0A%60%60%60typescript%0A%2F%2F%20app%2Fservice%2Fnews.ts%0Aimport%20%7B%20Service%20%7D%20from%20'egg'%3B%0A%0Aexport%20default%20class%20NewsService%20extends%20Service%20%7B%0A%20%20public%20async%20list(page%3F%3A%20number)%3A%20Promise%3CNewsItem%5B%5D%3E%20%7B%0A%20%20%20%20return%20%5B%5D%3B%0A%20%C2%A0%7D%0A%7D%0A%0Aexport%20interface%20NewsItem%20%7B%0A%20%20id%3A%20number%3B%0A%20%20title%3A%20string%3B%0A%7D%0A%60%60%60%0A%0A%23%23%23%20Middleware%0A%0A%60%60%60typescript%0A%2F%2F%20app%2Fmiddleware%2Frobot.ts%0A%0Aimport%20%7B%20Context%20%7D%20from%20'egg'%3B%0A%0Aexport%20default%20function%20robotMiddleware()%20%7B%0A%20%20return%20async%20(ctx%3A%20Context%2C%20next%3A%20any)%20%3D%3E%20%7B%0A%20%20%20%20await%20next()%3B%0A%20%20%7D%3B%0A%7D%0A%60%60%60%0A%0A%E5%9B%A0%E4%B8%BA%20Middleware%20%E5%AE%9A%E4%B9%89%E6%98%AF%E6%94%AF%E6%8C%81%E5%85%A5%E5%8F%82%E7%9A%84%EF%BC%8C%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E4%B8%BA%E5%90%8C%E5%90%8D%E7%9A%84%20Config%EF%BC%8C%E5%A6%82%E6%9C%89%E9%9C%80%E6%B1%82%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%94%A8%E5%AE%8C%E6%95%B4%E7%89%88%EF%BC%9A%0A%0A%60%60%60typescript%0A%2F%2F%20app%2Fmiddleware%2Fnews.ts%0A%0Aimport%20%7B%20Context%2C%20Application%20%7D%20from%20'egg'%3B%0Aimport%20%7B%20BizConfig%20%7D%20from%20'..%2F..%2Fconfig%2Fconfig.default'%3B%0A%0A%2F%2F%20%E6%B3%A8%E6%84%8F%EF%BC%8C%E8%BF%99%E9%87%8C%E5%BF%85%E9%A1%BB%E8%A6%81%E7%94%A8%20%5B'news'%5D%20%E8%80%8C%E4%B8%8D%E8%83%BD%E7%94%A8%20.news%EF%BC%8C%E5%9B%A0%E4%B8%BA%20BizConfig%20%E6%98%AF%20type%EF%BC%8C%E4%B8%8D%E6%98%AF%E5%AE%9E%E4%BE%8B%0Aexport%20default%20function%20newsMiddleware(options%3A%20BizConfig%5B'news'%5D%2C%20app%3A%20Application)%20%7B%0A%20%20return%20async%20(ctx%3A%20Context%2C%20next%3A%20()%20%3D%3E%20Promise%3Cany%3E)%20%3D%3E%20%7B%0A%20%20%20%20console.info(options.serverUrl)%3B%0A%20%20%20%20await%20next()%3B%0A%20%20%7D%3B%0A%7D%0A%60%60%60%0A%0A%23%23%23%20Extend%0A%0A%60%60%60typescript%0A%2F%2F%20app%2Fextend%2Fcontext.ts%0Aimport%20%7B%20Context%20%7D%20from%20'egg'%3B%0A%0Aexport%20default%20%7B%0A%20%20isAjax(this%3A%20Context)%20%7B%0A%20%20%20%20return%20this.get('X-Requested-With')%20%3D%3D%3D%20'XMLHttpRequest'%3B%0A%20%20%7D%2C%0A%7D%0A%0A%2F%2F%20app.ts%0Aexport%20default%20app%20%3D%3E%20%7B%0A%20%20app.beforeStart(async%20()%20%3D%3E%20%7B%0A%20%20%20%20await%20Promise.resolve('egg%20%2B%20ts')%3B%0A%20%20%7D)%3B%0A%7D%3B%0A%60%60%60%0A%0A%23%23%23%20Config%0A%0A%60Config%60%20%E8%BF%99%E5%9D%97%E7%A8%8D%E5%BE%AE%E6%9C%89%E7%82%B9%E5%A4%8D%E6%9D%82%EF%BC%8C%E5%9B%A0%E4%B8%BA%E8%A6%81%E6%94%AF%E6%8C%81%EF%BC%9A%0A%0A*%20%E5%9C%A8%20Controller%EF%BC%8CService%20%E9%82%A3%E8%BE%B9%E4%BD%BF%E7%94%A8%E9%85%8D%E7%BD%AE%EF%BC%8C%E9%9C%80%E6%94%AF%E6%8C%81%E5%A4%9A%E7%BA%A7%E6%8F%90%E7%A4%BA%EF%BC%8C%E5%B9%B6%E8%87%AA%E5%8A%A8%E5%85%B3%E8%81%94%E3%80%82%0A*%20Config%20%E5%86%85%E9%83%A8%EF%BC%8C%20%60config.view%20%3D%20%7B%7D%60%20%E7%9A%84%E5%86%99%E6%B3%95%EF%BC%8C%E4%B9%9F%E5%BA%94%E8%AF%A5%E6%94%AF%E6%8C%81%E6%8F%90%E7%A4%BA%E3%80%82%0A*%20%E5%9C%A8%20%60config.%7Benv%7D.ts%60%20%E9%87%8C%E5%8F%AF%E4%BB%A5%E7%94%A8%E5%88%B0%20%60config.default.ts%60%20%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%E7%9A%84%E6%8F%90%E7%A4%BA%E3%80%82%0A%0A%60%60%60typescript%0A%2F%2F%20app%2Fconfig%2Fconfig.default.ts%0Aimport%20%7B%20EggAppInfo%2C%20EggAppConfig%2C%20PowerPartial%20%7D%20from%20'egg'%3B%0A%0A%2F%2F%20%E6%8F%90%E4%BE%9B%E7%BB%99%20config.%7Benv%7D.ts%20%E4%BD%BF%E7%94%A8%0Aexport%20type%20DefaultConfig%20%3D%20PowerPartial%3CEggAppConfig%20%26%20BizConfig%3E%3B%0A%0A%2F%2F%20%E5%BA%94%E7%94%A8%E6%9C%AC%E8%BA%AB%E7%9A%84%E9%85%8D%E7%BD%AE%20Scheme%0Aexport%20interface%20BizConfig%20%7B%0A%20%20news%3A%20%7B%0A%20%20%20%20pageSize%3A%20number%3B%0A%20%20%20%20serverUrl%3A%20string%3B%0A%20%20%7D%3B%0A%7D%0A%0Aexport%20default%20(appInfo%3A%20EggAppInfo)%20%3D%3E%20%7B%0A%20%20const%20config%20%3D%20%7B%7D%20as%20PowerPartial%3CEggAppConfig%3E%20%26%20BizConfig%3B%0A%0A%20%20%2F%2F%20%E8%A6%86%E7%9B%96%E6%A1%86%E6%9E%B6%EF%BC%8C%E6%8F%92%E4%BB%B6%E7%9A%84%E9%85%8D%E7%BD%AE%0A%20%20config.keys%20%3D%20appInfo.name%20%2B%20'123456'%3B%0A%20%20config.view%20%3D%20%7B%0A%20%20%20%20defaultViewEngine%3A%20'nunjucks'%2C%0A%20%20%20%20mapping%3A%20%7B%0A%20%20%20%20%20%20'.tpl'%3A%20'nunjucks'%2C%0A%20%20%20%20%7D%2C%0A%20%20%7D%3B%0A%0A%20%20%2F%2F%20%E5%BA%94%E7%94%A8%E6%9C%AC%E8%BA%AB%E7%9A%84%E9%85%8D%E7%BD%AE%0A%20%20config.news%20%3D%20%7B%0A%20%20%20%20pageSize%3A%2030%2C%0A%20%20%20%20serverUrl%3A%20'https%3A%2F%2Fhacker-news.firebaseio.com%2Fv0'%2C%0A%20%20%7D%3B%0A%0A%20%20return%20config%3B%0A%7D%3B%0A%60%60%60%0A%0A%E7%AE%80%E5%8D%95%E7%89%88%EF%BC%9A%0A%0A%60%60%60typescript%0A%2F%2F%20app%2Fconfig%2Fconfig.local.ts%0Aimport%20%7B%20DefaultConfig%20%7D%20from%20'.%2Fconfig.default'%3B%0A%0Aexport%20default%20()%20%3D%3E%20%7B%0A%20%20const%20config%3A%20DefaultConfig%20%3D%20%7B%7D%3B%0A%20%20config.news%20%3D%20%7B%0A%20%20%20%20pageSize%3A%2020%2C%0A%20%20%7D%3B%0A%20%20return%20config%3B%0A%7D%3B%0A%0A%60%60%60%0A%0A%E5%A4%87%E6%B3%A8%EF%BC%9A%0A%0A*%20TS%20%E7%9A%84%20%60Conditional%20Types%60%20%E6%98%AF%E6%88%91%E4%BB%AC%E8%83%BD%E5%AE%8C%E7%BE%8E%E8%A7%A3%E5%86%B3%20Config%20%E6%8F%90%E7%A4%BA%E7%9A%84%E5%85%B3%E9%94%AE%E3%80%82%0A*%20%E6%9C%89%E5%85%B4%E8%B6%A3%E7%9A%84%E5%8F%AF%E4%BB%A5%E7%9C%8B%E4%B8%8B%20%5Begg%2Findex.d.ts%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg%2Fblob%2Fmaster%2Findex.d.ts)%20%E9%87%8C%E9%9D%A2%E7%9A%84%20%60PowerPartial%60%20%E5%AE%9E%E7%8E%B0%E3%80%82%0A%0A%60%60%60typescript%0A%2F%2F%20%7Begg%7D%2Findex.d.ts%0Atype%20PowerPartial%3CT%3E%20%3D%20%7B%0A%20%C2%A0%5BU%20in%20keyof%20T%5D%3F%3A%20T%5BU%5D%20extends%20%7B%7D%0A%20%20%C2%A0%20%3F%20PowerPartial%3CT%5BU%5D%3E%0A%20%20%C2%A0%20%3A%20T%5BU%5D%0A%7D%3B%0A%60%60%60%0A%0A%23%23%23%20Plugin%0A%0A%60%60%60javascript%0A%2F%2F%20config%2Fplugin.ts%0Aimport%20%7B%20EggPlugin%20%7D%20from%20'egg'%3B%0A%0Aconst%20plugin%3A%20EggPlugin%20%3D%20%7B%0A%20%20static%3A%20true%2C%0A%20%20nunjucks%3A%20%7B%0A%20%20%20%20enable%3A%20true%2C%0A%20%20%20%20package%3A%20'egg-view-nunjucks'%2C%0A%20%20%7D%2C%0A%7D%3B%0A%0Aexport%20default%20plugin%3B%0A%60%60%60%0A%0A%23%23%23%20Typings%0A%0A%E8%AF%A5%E7%9B%AE%E5%BD%95%E4%B8%BA%20TS%20%E7%9A%84%E8%A7%84%E8%8C%83%EF%BC%8C%E5%9C%A8%E9%87%8C%E9%9D%A2%E7%9A%84%20%60**%2F*.d.ts%60%20%E6%96%87%E4%BB%B6%E5%B0%86%E8%A2%AB%E8%87%AA%E5%8A%A8%E8%AF%86%E5%88%AB%E3%80%82%0A%0A*%20%E5%BC%80%E5%8F%91%E8%80%85%E9%9C%80%E8%A6%81%E6%89%8B%E5%86%99%E7%9A%84%E5%BB%BA%E8%AE%AE%E6%94%BE%E5%9C%A8%20%60typings%2Findex.d.ts%60%20%E4%B8%AD%E3%80%82%0A*%20%E5%B7%A5%E5%85%B7%E4%BC%9A%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%20%60typings%2F%7Bapp%2Cconfig%7D%2F**.d.ts%60%20%EF%BC%8C%E8%AF%B7%E5%8B%BF%E8%87%AA%E8%A1%8C%E4%BF%AE%E6%94%B9%EF%BC%8C%E9%81%BF%E5%85%8D%E8%A2%AB%E8%A6%86%E7%9B%96%E3%80%82%EF%BC%88%E8%A7%81%E4%B8%8B%E6%96%87%EF%BC%89%0A%0A---%0A%0A%23%23%20%E5%BC%80%E5%8F%91%E6%9C%9F%0A%0A%23%23%23%20ts-node%0A%0A%60egg-bin%60%20%E5%B7%B2%E7%BB%8F%E5%86%85%E5%BB%BA%E4%BA%86%20%5Bts-node%5D(https%3A%2F%2Fgithub.com%2FTypeStrong%2Fts-node)%20%EF%BC%8C%60egg%20loader%60%20%E5%9C%A8%E5%BC%80%E5%8F%91%E6%9C%9F%E4%BC%9A%E8%87%AA%E5%8A%A8%E5%8A%A0%E8%BD%BD%20%60*.ts%60%20%E5%B9%B6%E5%86%85%E5%AD%98%E7%BC%96%E8%AF%91%E3%80%82%0A%0A%E7%9B%AE%E5%89%8D%E5%B7%B2%E6%94%AF%E6%8C%81%20%60dev%60%20%2F%20%60debug%60%20%2F%20%60test%60%20%2F%20%60cov%60%20%E3%80%82%0A%0A%E5%BC%80%E5%8F%91%E8%80%85%E4%BB%85%E9%9C%80%E7%AE%80%E5%8D%95%E9%85%8D%E7%BD%AE%E4%B8%8B%20%60package.json%60%20%EF%BC%9A%0A%0A%60%60%60json%0A%7B%0A%20%20%22name%22%3A%20%22showcase%22%2C%0A%20%20%22egg%22%3A%20%7B%0A%20%20%20%20%22typescript%22%3A%20true%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A%23%23%23%20egg-ts-helper%0A%0A%E7%94%B1%E4%BA%8E%20Egg%20%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6%EF%BC%8C%E5%AF%BC%E8%87%B4%20TS%20%E6%97%A0%E6%B3%95%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E4%BE%9D%E8%B5%96%EF%BC%8C%E5%85%B3%E8%81%94%E6%8F%90%E7%A4%BA%E3%80%82%0A%0A%E5%B9%B8%E4%BA%8F%20TS%20%E9%BB%91%E9%AD%94%E6%B3%95%E6%AF%94%E8%BE%83%E5%A4%9A%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20TS%20%E7%9A%84%20%5BDeclaration%20Merging%5D(https%3A%2F%2Fwww.typescriptlang.org%2Fdocs%2Fhandbook%2Fdeclaration-merging.html)%20%E7%BC%96%E5%86%99%20%60d.ts%60%20%E6%9D%A5%E8%BE%85%E5%8A%A9%E3%80%82%0A%0A%E8%AD%AC%E5%A6%82%20%60app%2Fservice%2Fnews.ts%60%20%E4%BC%9A%E8%87%AA%E5%8A%A8%E6%8C%82%E8%BD%BD%E4%B8%BA%20%60ctx.service.news%60%20%EF%BC%8C%E9%80%9A%E8%BF%87%E5%A6%82%E4%B8%8B%E5%86%99%E6%B3%95%E5%8D%B3%E8%AF%86%E5%88%AB%E5%88%B0%EF%BC%9A%0A%0A%60%60%60typescript%0A%2F%2F%20typings%2Fapp%2Fservice%2Findex.d.ts%0Aimport%20News%20from%20'..%2F..%2F..%2Fapp%2Fservice%2FNews'%3B%0A%0Adeclare%20module%20'egg'%20%7B%0A%20%20interface%20IService%20%7B%0A%20%20%20%20news%3A%20News%3B%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A%E6%89%8B%E5%8A%A8%E5%86%99%E8%BF%99%E4%BA%9B%E6%96%87%E4%BB%B6%EF%BC%8C%E6%9C%AA%E5%85%8D%E6%9C%89%E7%82%B9%E7%B9%81%E7%90%90%EF%BC%8C%E5%9B%A0%E6%AD%A4%E6%88%91%E4%BB%AC%E6%8F%90%E4%BE%9B%E4%BA%86%20%5Begg-ts-helper%5D(https%3A%2F%2Fgithub.com%2Fwhxaxes%2Fegg-ts-helper)%20%E5%B7%A5%E5%85%B7%E6%9D%A5%E8%87%AA%E5%8A%A8%E5%88%86%E6%9E%90%E6%BA%90%E7%A0%81%E7%94%9F%E6%88%90%E5%AF%B9%E5%BA%94%E7%9A%84%20%60d.ts%60%20%E6%96%87%E4%BB%B6%E3%80%82%0A%0A%E5%8F%AA%E9%9C%80%E9%85%8D%E7%BD%AE%E4%B8%8B%20%60package.json%60%20%3A%0A%0A%60%60%60javascript%0A%7B%0A%20%C2%A0%22devDependencies%22%3A%20%7B%0A%20%20%20%20%22egg-ts-helper%22%3A%20%22%5E1%22%0A%20%C2%A0%7D%2C%0A%20%20%22scripts%22%3A%20%7B%0A%20%20%20%20%22dev%22%3A%20%22egg-bin%20dev%20-r%20egg-ts-helper%2Fregister%22%2C%0A%20%20%20%20%22test-local%22%3A%20%22egg-bin%20test%20-r%20egg-ts-helper%2Fregister%22%2C%0A%20%20%20%20%22clean%22%3A%20%22ets%20clean%22%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A%E5%BC%80%E5%8F%91%E6%9C%9F%E5%B0%86%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E5%AF%B9%E5%BA%94%E7%9A%84%20%60d.ts%60%20%E5%88%B0%20%60typings%2F%7Bapp%2Cconfig%7D%2F%60%20%E4%B8%8B%EF%BC%8C**%E8%AF%B7%E5%8B%BF%E8%87%AA%E8%A1%8C%E4%BF%AE%E6%94%B9%EF%BC%8C%E9%81%BF%E5%85%8D%E8%A2%AB%E8%A6%86%E7%9B%96**%E3%80%82%0A%0A%3E%20%E5%90%8E%E7%BB%AD%E8%AF%A5%E5%B7%A5%E5%85%B7%E4%B9%9F%E4%BC%9A%E8%80%83%E8%99%91%E6%94%AF%E6%8C%81%20%20js%20%E7%89%88%20egg%20%E5%BA%94%E7%94%A8%E7%9A%84%E5%88%86%E6%9E%90%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%B8%80%E5%AE%9A%E7%A8%8B%E5%BA%A6%E4%B8%8A%E6%8F%90%E5%8D%87%20js%20%E5%BC%80%E5%8F%91%E4%BD%93%E9%AA%8C%E3%80%82%0A%0A%23%23%23%20Unit%20Test%20%26%26%20Cov%0A%0A%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%BD%93%E7%84%B6%E5%B0%91%E4%B8%8D%E4%BA%86%EF%BC%9A%0A%0A%60%60%60typescript%0A%2F%2F%20test%2Fapp%2Fservice%2Fnews.test.ts%0Aimport%20*%20as%20assert%20from%20'assert'%3B%0Aimport%20%7B%20Context%20%7D%20from%20'egg'%3B%0Aimport%20%7B%20app%20%7D%20from%20'egg-mock%2Fbootstrap'%3B%0A%0Adescribe('test%2Fapp%2Fservice%2Fnews.test.js'%2C%20()%20%3D%3E%20%7B%0A%20%20let%20ctx%3A%20Context%3B%0A%0A%20%20before(async%20()%20%3D%3E%20%7B%0A%20%20%20%20ctx%20%3D%20app.mockContext()%3B%0A%20%20%7D)%3B%0A%0A%20%20it('list()'%2C%20async%20()%20%3D%3E%20%7B%0A%20%20%20%20const%20list%20%3D%20await%20ctx.service.news.list()%3B%0A%20%20%20%20assert(list.length%20%3D%3D%3D%2030)%3B%0A%20%20%7D)%3B%0A%7D)%3B%0A%60%60%60%0A%0A%E8%BF%90%E8%A1%8C%E5%91%BD%E4%BB%A4%E4%B9%9F%E8%B7%9F%E4%B9%8B%E5%89%8D%E4%B8%80%E6%A0%B7%EF%BC%8C%E5%B9%B6%E5%86%85%E7%BD%AE%E4%BA%86%20%60%E9%94%99%E8%AF%AF%E5%A0%86%E6%A0%88%E5%92%8C%E8%A6%86%E7%9B%96%E7%8E%87%60%20%E7%9A%84%E6%94%AF%E6%8C%81%EF%BC%9A%0A%0A%60%60%60json%0A%7B%0A%20%C2%A0%22name%22%3A%20%22showcase%22%2C%0A%20%20%22scripts%22%3A%20%7B%0A%20%20%20%20%22test%22%3A%20%22npm%20run%20lint%20--%20--fix%20%26%26%20npm%20run%20test-local%22%2C%0A%20%20%20%20%22test-local%22%3A%20%22egg-bin%20test%20-r%20egg-ts-helper%2Fregister%22%2C%0A%20%20%20%20%22cov%22%3A%20%22egg-bin%20cov%20-r%20egg-ts-helper%2Fregister%22%2C%0A%20%20%20%20%22lint%22%3A%20%22tslint%20.%22%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A%23%23%23%20Debug%0A%0A%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95%E8%B7%9F%E4%B9%8B%E5%89%8D%E4%B9%9F%E6%B2%A1%E5%95%A5%E5%8C%BA%E5%88%AB%EF%BC%8C%E4%BC%9A%E8%87%AA%E5%8A%A8%E9%80%9A%E8%BF%87%20%60sourcemap%60%20%E6%96%AD%E7%82%B9%E5%88%B0%E6%AD%A3%E7%A1%AE%E7%9A%84%E4%BD%8D%E7%BD%AE%E3%80%82%0A%0A%60%60%60json%0A%7B%0A%20%C2%A0%22name%22%3A%20%22showcase%22%2C%0A%20%20%22scripts%22%3A%20%7B%0A%20%20%20%20%22debug%22%3A%20%22egg-bin%20debug%20-r%20egg-ts-helper%2Fregister%22%2C%0A%20%20%20%20%22debug-test%22%3A%20%22npm%20run%20test-local%20--%20--inspect%22%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A*%20%5B%E4%BD%BF%E7%94%A8%20VSCode%20%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95%5D(https%3A%2F%2Feggjs.org%2Fzh-cn%2Fcore%2Fdevelopment.html%23%25E4%25BD%25BF%25E7%2594%25A8-vscode-%25E8%25BF%259B%25E8%25A1%258C%25E8%25B0%2583%25E8%25AF%2595)%0A*%20%5BVSCode%20%E8%B0%83%E8%AF%95%20Egg%20%E5%AE%8C%E7%BE%8E%E7%89%88%20-%20%E8%BF%9B%E5%8C%96%E5%8F%B2%5D(https%3A%2F%2Fgithub.com%2Fatian25%2Fblog%2Fissues%2F25)%0A%0A---%0A%0A%23%23%20%E9%83%A8%E7%BD%B2%0A%0A%23%23%23%20%E6%9E%84%E5%BB%BA%0A%0A*%20%E6%AD%A3%E5%BC%8F%E7%8E%AF%E5%A2%83%E4%B8%8B%EF%BC%8C%E6%88%91%E4%BB%AC%E6%9B%B4%E5%80%BE%E5%90%91%E4%BA%8E%E6%8A%8A%20ts%20%E6%9E%84%E5%BB%BA%E4%B8%BA%20js%20%EF%BC%8C%E5%BB%BA%E8%AE%AE%E5%9C%A8%20%60ci%60%20%E4%B8%8A%E6%9E%84%E5%BB%BA%E5%B9%B6%E6%89%93%E5%8C%85%E3%80%82%0A%0A%E9%85%8D%E7%BD%AE%20%60package.json%60%20%3A%0A%0A%60%60%60json%0A%7B%0A%20%20%22egg%22%3A%20%7B%0A%20%20%20%20%22typescript%22%3A%20true%0A%20%20%7D%EF%BC%8C%0A%20%20%22scripts%22%3A%20%7B%0A%20%C2%A0%20%C2%A0%22start%22%3A%20%22egg-scripts%20start%20--title%3Degg-server-showcase%22%2C%0A%20%20%20%20%22stop%22%3A%20%22egg-scripts%20stop%20--title%3Degg-server-showcase%22%2C%0A%20%C2%A0%20%20%22tsc%22%3A%20%22ets%20%26%26%20tsc%20-p%20tsconfig.json%22%2C%0A%20%20%20%20%22ci%22%3A%20%22npm%20run%20lint%20%26%26%20npm%20run%20cov%20%26%26%20npm%20run%20tsc%22%2C%0A%20%C2%A0%20%C2%A0%22clean%22%3A%20%22ets%20clean%22%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A%E5%AF%B9%E5%BA%94%E7%9A%84%20%60tsconfig.json%60%20%3A%0A%0A%60%60%60json%0A%7B%0A%20%20%22compileOnSave%22%3A%20true%2C%0A%20%20%22compilerOptions%22%3A%20%7B%0A%20%20%20%20%22target%22%3A%20%22es2017%22%2C%0A%20%20%20%20%22module%22%3A%20%22commonjs%22%2C%0A%20%20%20%20%22strict%22%3A%20true%2C%0A%20%20%20%20%22noImplicitAny%22%3A%20false%2C%0A%20%20%20%20%22experimentalDecorators%22%3A%20true%2C%0A%20%20%20%20%22emitDecoratorMetadata%22%3A%20true%2C%0A%20%20%20%20%22charset%22%3A%20%22utf8%22%2C%0A%20%20%20%20%22allowJs%22%3A%20false%2C%0A%20%20%20%20%22pretty%22%3A%20true%2C%0A%20%20%20%20%22noEmitOnError%22%3A%20false%2C%0A%20%20%20%20%22noUnusedLocals%22%3A%20true%2C%0A%20%20%20%20%22noUnusedParameters%22%3A%20true%2C%0A%20%20%20%20%22allowUnreachableCode%22%3A%20false%2C%0A%20%20%20%20%22allowUnusedLabels%22%3A%20false%2C%0A%20%20%20%20%22strictPropertyInitialization%22%3A%20false%2C%0A%20%20%20%20%22noFallthroughCasesInSwitch%22%3A%20true%2C%0A%20%20%20%20%22skipLibCheck%22%3A%20true%2C%0A%20%20%20%20%22skipDefaultLibCheck%22%3A%20true%2C%0A%20%20%20%20%22inlineSourceMap%22%3A%20true%2C%0A%20%20%20%20%22importHelpers%22%3A%20true%0A%20%20%7D%2C%0A%20%20%22exclude%22%3A%20%5B%0A%20%20%20%20%22app%2Fpublic%22%2C%0A%20%C2%A0%20%C2%A0%22app%2Fweb%22%2C%0A%20%20%20%20%22app%2Fviews%22%0A%20%20%5D%0A%7D%0A%60%60%60%0A%0A**%E6%B3%A8%E6%84%8F%EF%BC%9A**%0A%0A*%20**%E5%BD%93%E6%9C%89%E5%90%8C%E5%90%8D%E7%9A%84%20ts%20%E5%92%8C%20js%20%E6%96%87%E4%BB%B6%E6%97%B6%EF%BC%8Cegg%20%E4%BC%9A%E4%BC%98%E5%85%88%E5%8A%A0%E8%BD%BD%20js%20%E6%96%87%E4%BB%B6%E3%80%82**%0A*%20%E5%9B%A0%E6%AD%A4%E5%9C%A8%E5%BC%80%E5%8F%91%E6%9C%9F%EF%BC%8C%20%60egg-ts-helper%60%20%E4%BC%9A%E8%87%AA%E5%8A%A8%E8%B0%83%E7%94%A8%E6%B8%85%E9%99%A4%E5%90%8C%E5%90%8D%E7%9A%84%20%60js%60%20%E6%96%87%E4%BB%B6%EF%BC%8C%E4%B9%9F%E5%8F%AF%20%60npm%20run%20clean%60%20%E6%89%8B%E5%8A%A8%E6%B8%85%E9%99%A4%E3%80%82%0A%0A%23%23%23%20%E9%94%99%E8%AF%AF%E5%A0%86%E6%A0%88%0A%0A%E7%BA%BF%E4%B8%8A%E6%9C%8D%E5%8A%A1%E7%9A%84%E4%BB%A3%E7%A0%81%E6%98%AF%E7%BB%8F%E8%BF%87%E7%BC%96%E8%AF%91%E5%90%8E%E7%9A%84%20js%EF%BC%8C%E8%80%8C%E6%88%91%E4%BB%AC%E6%9C%9F%E6%9C%9B%E7%9C%8B%E5%88%B0%E7%9A%84%E9%94%99%E8%AF%AF%E5%A0%86%E6%A0%88%E6%98%AF%E6%8C%87%E5%90%91%20TS%20%E6%BA%90%E7%A0%81%E3%80%82%0A%E5%9B%A0%E6%AD%A4%EF%BC%9A%0A%0A*%20%E5%9C%A8%E6%9E%84%E5%BB%BA%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E9%9C%80%E9%85%8D%E7%BD%AE%20%60inlineSourceMap%3A%20true%60%20%E5%9C%A8%20js%20%E5%BA%95%E9%83%A8%E6%8F%92%E5%85%A5%20sourcemap%20%E4%BF%A1%E6%81%AF%E3%80%82%0A*%20%E5%9C%A8%20%60egg-scripts%60%20%E5%86%85%E5%BB%BA%E4%BA%86%E5%A4%84%E7%90%86%EF%BC%8C%E4%BC%9A%E8%87%AA%E5%8A%A8%E7%BA%A0%E6%AD%A3%E4%B8%BA%E6%AD%A3%E7%A1%AE%E7%9A%84%E9%94%99%E8%AF%AF%E5%A0%86%E6%A0%88%EF%BC%8C%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E8%80%85%E6%97%A0%E9%9C%80%E6%8B%85%E5%BF%83%E3%80%82%0A%0A%E5%85%B7%E4%BD%93%E5%86%85%E5%B9%95%E5%8F%82%E8%A7%81%EF%BC%9A%0A%0A*%20%5Bhttps%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F26267678%5D(https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F26267678)%0A*%20%5Bhttps%3A%2F%2Fgithub.com%2Feggjs%2Fegg-scripts%2Fpull%2F19%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-scripts%2Fpull%2F19)%0A%0A---%0A%0A%23%23%20%E6%8F%92%E4%BB%B6%2F%E6%A1%86%E6%9E%B6%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97%0A%0A**%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%99%EF%BC%9A**%0A%0A*%20%E4%B8%8D%E5%BB%BA%E8%AE%AE%E4%BD%BF%E7%94%A8%20TS%20%E7%9B%B4%E6%8E%A5%E5%BC%80%E5%8F%91%E6%8F%92%E4%BB%B6%2F%E6%A1%86%E6%9E%B6%EF%BC%8C%E5%8F%91%E5%B8%83%E5%88%B0%20npm%20%E7%9A%84%E6%8F%92%E4%BB%B6%E5%BA%94%E8%AF%A5%E6%98%AF%20js%20%E5%BD%A2%E5%BC%8F%E3%80%82%0A*%20%E5%BD%93%E4%BD%A0%E5%BC%80%E5%8F%91%E4%BA%86%E4%B8%80%E4%B8%AA%E6%8F%92%E4%BB%B6%2F%E6%A1%86%E6%9E%B6%E5%90%8E%EF%BC%8C%E9%9C%80%E8%A6%81%E6%8F%90%E4%BE%9B%E5%AF%B9%E5%BA%94%E7%9A%84%20%60index.d.ts%60%20%E3%80%82%0A*%20%E9%80%9A%E8%BF%87%20%5BDeclaration%20Merging%5D(https%3A%2F%2Fwww.typescriptlang.org%2Fdocs%2Fhandbook%2Fdeclaration-merging.html)%20%E5%B0%86%E6%8F%92%E4%BB%B6%2F%E6%A1%86%E6%9E%B6%E7%9A%84%E5%8A%9F%E8%83%BD%E6%B3%A8%E5%85%A5%E5%88%B0%20Egg%20%E4%B8%AD%E3%80%82%0A*%20%E9%83%BD%E6%8C%82%E8%BD%BD%E5%88%B0%20%60egg%60%20%E8%BF%99%E4%B8%AA%20module%EF%BC%8C%E4%B8%8D%E8%A6%81%E7%94%A8%E4%B8%8A%E5%B1%82%E6%A1%86%E6%9E%B6%E3%80%82%0A%0A%23%23%23%20%E6%8F%92%E4%BB%B6%0A%0A%E5%8F%AF%E4%BB%A5%E5%8F%82%E8%80%83%20%60egg-ts-helper%60%20%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E7%9A%84%E6%A0%BC%E5%BC%8F%0A%0A%60%60%60typescript%0A%2F%2F%20%7Bplugin_root%7D%2Findex.d.ts%0A%0Aimport%20News%20from%20'..%2F..%2F..%2Fapp%2Fservice%2FNews'%3B%0A%0Adeclare%20module%20'egg'%20%7B%0A%0A%20%20%2F%2F%20%E6%89%A9%E5%B1%95%20service%0A%20%20interface%20IService%20%7B%0A%20%C2%A0%20%C2%A0news%3A%20News%3B%0A%20%20%7D%0A%0A%20%20%2F%2F%20%E6%89%A9%E5%B1%95%20app%0A%20%20interface%20Application%20%7B%0A%0A%20%20%7D%0A%0A%20%20%2F%2F%20%E6%89%A9%E5%B1%95%20context%0A%20%20interface%20Context%20%7B%0A%0A%20%20%7D%0A%0A%20%20%2F%2F%20%E6%89%A9%E5%B1%95%E4%BD%A0%E7%9A%84%E9%85%8D%E7%BD%AE%0A%20%20interface%20EggAppConfig%20%7B%0A%0A%20%20%7D%0A%0A%20%20%2F%2F%20%E6%89%A9%E5%B1%95%E8%87%AA%E5%AE%9A%E4%B9%89%E7%8E%AF%E5%A2%83%0A%20%C2%A0type%20EggEnvType%20%3D%20'local'%20%7C%20'unittest'%20%7C%20'prod'%20%7C%20'sit'%3B%0A%7D%0A%60%60%60%0A%0A%23%23%23%20%E4%B8%8A%E5%B1%82%E6%A1%86%E6%9E%B6%0A%0A%E5%AE%9A%E4%B9%89%EF%BC%9A%0A%0A%60%60%60typescript%0A%2F%2F%20%7Bframework_root%7D%2Findex.d.ts%0A%0Aimport%20*%20as%20Egg%20from%20'egg'%3B%0A%0A%2F%2F%20%E5%B0%86%E8%AF%A5%E4%B8%8A%E5%B1%82%E6%A1%86%E6%9E%B6%E7%94%A8%E5%88%B0%E7%9A%84%E6%8F%92%E4%BB%B6%20import%20%E8%BF%9B%E6%9D%A5%0Aimport%20'my-plugin'%3B%0A%0Adeclare%20module%20'egg'%20%7B%0A%20%20%2F%2F%20%E8%B7%9F%E6%8F%92%E4%BB%B6%E4%B8%80%E6%A0%B7%E6%8B%93%E5%B1%95%20egg%20...%0A%7D%0A%0A%2F%2F%20%E5%B0%86%20Egg%20%E6%95%B4%E4%B8%AA%20export%20%E5%87%BA%E5%8E%BB%0Aexport%20%3D%20Egg%3B%0A%60%60%60%0A%0A%E5%BC%80%E5%8F%91%E8%80%85%E4%BD%BF%E7%94%A8%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%20import%20%E4%BD%A0%E7%9A%84%E6%A1%86%E6%9E%B6%EF%BC%9A%0A%0A%60%60%60typescript%0A%2F%2F%20app%2Fservice%2Fnews.ts%0A%0A%2F%2F%20%E5%BC%80%E5%8F%91%E8%80%85%E5%BC%95%E5%85%A5%E4%BD%A0%E7%9A%84%E6%A1%86%E6%9E%B6%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E5%88%B0%E6%8F%90%E7%A4%BA%E5%88%B0%E6%89%80%E6%9C%89%20Egg%20%E7%9A%84%E6%8F%90%E7%A4%BA%0Aimport%20%7B%20Service%20%7D%20from%20'duck-egg'%3B%0A%0Aexport%20default%20class%20NewsService%20extends%20Service%20%7B%0A%20%20public%20async%20list(page%3F%3A%20number)%3A%20Promise%3CNewsItem%5B%5D%3E%20%7B%0A%20%20%20%20return%20%5B%5D%3B%0A%20%C2%A0%7D%0A%7D%0A%60%60%60"}}</script><script type="text/javascript" src="/static/js/post.b9faab88.js"></script></body></html>