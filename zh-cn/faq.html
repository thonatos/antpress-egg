<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.png"><style class="_styletron_hydrate_"></style><title>常见问题</title><meta name="description" content="Born to build better enterprise frameworks and apps"><link href="/static/css/post.d62265dc.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="ant-layout" data-reactroot=""><div class="header-module__header___3ADJ9 ant-layout-header"><div class="ant-row-flex"><div class="ant-col-xs-12 ant-col-md-20 ant-col-lg-2"><div class="header-module__logo___3yTXp"><a href="/"><img src="/logo.svg" alt="logo"/></a></div></div><div class="ant-col-xs-0 ant-col-md-0 ant-col-lg-20"><ul class="ant-menu header-module__menu___3yEtW ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/intro/">指南</a></li><li class="ant-menu-item" role="menuitem"><a href="/api/">API</a></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/tutorials/index.html">教程</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/search?q=topic%3Aegg-plugin&amp;type=Repositories">插件</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/eggjs/egg/releases">发布日志</a></li></ul></div><div style="text-align:right" class="ant-col-xs-12 ant-col-md-4 ant-col-lg-2"><button type="button" class="ant-btn"><span>Languages</span></button></div></div></div><div class="ant-layout-content"><div class="basic_layout-module__content___3flpY ant-layout"><div class="sider-module__side___1Cadj ant-layout-sider ant-layout-sider-light" style="flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"><ul class="ant-menu sider-module__menu___2GqPr ant-menu-light ant-menu-root ant-menu-inline" role="menu"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="0$Menu" aria-haspopup="true"><span>新手指南</span><i class="ant-menu-submenu-arrow"></i></div><ul id="0$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/index.html">Egg.js 是什么?</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/egg-and-koa.html">Egg.js 和 Koa</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/quickstart.html">快速入门</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/progressive.html">渐进式开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/migration.html">2.x 升级指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="1$Menu" aria-haspopup="true"><span>基础功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="1$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/structure.html">目录结构</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/objects.html">内置对象</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/env.html">运行环境</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/config.html">配置</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/middleware.html">中间件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/router.html">Router</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/controller.html">Controller</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/service.html">Service</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/plugin.html">插件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/schedule.html">定时任务</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/extend.html">框架扩展</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/app-start.html">启动自定义</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="2$Menu" aria-haspopup="true"><span>核心功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="2$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/development.html">本地开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/unittest.html">单元测试</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/deployment.html">应用部署</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/logger.html">日志</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/httpclient.html">HttpClient</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cookie-and-session.html">Cookie and Session</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cluster-and-ipc.html">多进程模型和进程间通讯</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/view.html">模板渲染</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/error-handling.html">异常处理</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/security.html">安全</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/i18n.html">国际化</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="3$Menu" aria-haspopup="true"><span>教程</span><i class="ant-menu-submenu-arrow"></i></div><ul id="3$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/mysql.html">MySQL</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/restful.html">RESTful API</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/passport.html">Passport 鉴权</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/socketio.html">Socket.IO</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/assets.html">静态资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/typescript.html">TypeScript</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="4$Menu" aria-haspopup="true"><span>进阶</span><i class="ant-menu-submenu-arrow"></i></div><ul id="4$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/loader.html">Loader</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/plugin.html">插件开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/framework.html">框架开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/cluster-client.html">多进程研发模式增强</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/view-plugin.html">模板插件开发规范</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/style-guide.html">代码风格指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="5$Menu" aria-haspopup="true"><span>社区</span><i class="ant-menu-submenu-arrow"></i></div><ul id="5$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/plugins/">内置插件列表</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/contributing.html">如何贡献</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/resource.html">资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/faq.html">常见问题</a></li></ul></li></ul></div></div><div class="basic_layout-module__post___2Z7KK ant-layout-content"><div class="ant-row" style="margin-left:-8px;margin-right:-8px"><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-24 ant-col-md-18"><div class="markdown-body" style="font-size:14px"><div><p>如果下面的内容无法解决你的问题，请查看 <a href="https://github.com/eggjs/egg/issues">Egg issues</a>。</p><h2 id="如何高效的反馈问题">如何高效的反馈问题？</h2><p>感谢您向我们反馈问题。</p><ol><li>我们推荐如果是小问题（错别字修改，小的 bug fix）直接提交 PR。</li><li>如果是一个新需求，请提供：详细需求描述，最好是有伪代码示意。</li><li>如果是一个 BUG，请提供：复现步骤，错误日志以及相关配置，并尽量填写下面的模板中的条目。</li><li><strong>如果可以，尽可能使用 <code>egg-init --type=simple bug</code> 提供一个最小可复现的代码仓库，方便我们排查问题。</strong></li><li>不要挤牙膏似的交流，扩展阅读：<a href="https://zhuanlan.zhihu.com/p/25795393">如何向开源项目提交无法解答的问题</a></li></ol><p>最重要的是，请明白一件事：开源项目的用户和维护者之间并不是甲方和乙方的关系，issue 也不是客服工单。在开 issue 的时候，请抱着一种『一起合作来解决这个问题』的心态，不要期待我们单方面地为你服务。</p><h2 id="为什么我的配置不生效">为什么我的配置不生效？</h2><p>框架的配置功能比较强大，有不同环境变量，又有框架、插件、应用等很多地方配置。</p><p>如果你分析问题时，想知道当前运行时使用的最终配置，可以查看下 <code>${root}/run/application_config.json</code>（worker 进程配置） 和 <code>${root}/run/agent_config.json</code>（agent 进程配置） 这两个文件。（<code>root</code> 为应用根目录，只有在 local 和 unittest 环境下为项目所在目录，其他环境下都为 HOME 目录）</p><p>也可参见<a href="https://eggjs.org/zh-cn/basics/config.html#配置结果">配置文件</a>。</p><p>PS：请确保没有写出以下代码：</p><pre><code class="language-js">// config/config.default.js
exports.someKeys = &#x27;abc&#x27;;
module.exports = appInfo =&gt; {
  const config = {};
  config.keys = &#x27;123456&#x27;;
  return config;
};</code></pre><h2 id="线上的日志打印去哪里了">线上的日志打印去哪里了？</h2><p>默认配置下，本地开发环境的日志都会打印在应用根目录的 <code>logs</code> 文件夹下(<code>${baseDir}/logs</code>) ，但是在非开发期的环境（非 local 和 unittest 环境），所有的日志都会打印到 <code>$HOME/logs</code> 文件夹下（例如 <code>/home/admin/logs</code>）。这样可以让本地开发时应用日志互不影响，服务器运行时又有统一的日志输出目录。</p><h2 id="进程管理为什么没有选型-pm2">进程管理为什么没有选型 PM2 ？</h2><ol><li>PM2 模块本身复杂度很高，出了问题很难排查。我们认为框架使用的工具复杂度不应该过高，而 PM2 自身的复杂度超越了大部分应用本身。</li><li>没法做非常深的优化。</li><li>切实的需求问题，一个进程里跑 leader，其他进程代理到 leader 这种模式（<a href="./core/cluster-and-ipc.md">多进程模型</a>），在企业级开发中对于减少远端连接，降低数据通信压力等都是切实的需求。特别当应用规模大到一定程度，这就会是刚需。egg 本身起源于蚂蚁金服和阿里，我们对标的起点就是大规模企业应用的构建，所以要非常全面。这些特性通过 PM2 很难做到。</li></ol><p>进程模型非常重要，会影响到开发模式，运行期间的深度优化等，我们认为可能由框架来控制比较合适。</p><p><strong>如何使用 PM2 启动应用？</strong></p><p>尽管我们不推荐使用 PM2 启动，但仍然是可以做到的。</p><p>首先，在项目根目录定义启动文件：</p><pre><code class="language-js">// server.js
const egg = require(&#x27;egg&#x27;);

const workers = Number(process.argv[2] || require(&#x27;os&#x27;).cpus().length);
egg.startCluster({
  workers,
  baseDir: __dirname,
});</code></pre><p>这样，我们就可以通过 PM2 进行启动了：</p><pre><code class="language-bash">pm2 start server.js</code></pre><h2 id="为什么会有-csrf-报错">为什么会有 csrf 报错？</h2><p>通常有两种 csrf 报错：</p><ul><li><code>missing csrf token</code></li><li><code>invalid csrf token</code></li></ul><p>Egg 内置的 <a href="https://github.com/eggjs/egg-security/">egg-security</a> 插件默认对所有『非安全』的方法，例如 <code>POST</code>，<code>PUT</code>，<code>DELETE</code> 都进行 CSRF 校验。</p><p>请求遇到 csrf 报错通常是因为没有加正确的 csrf token 导致，具体实现方式，请阅读<a href="./core/security.md#安全威胁csrf的防范">安全威胁 CSRF 的防范</a>。</p><h2 id="本地开发时修改代码后为什么-worker-进程没有自动重启">本地开发时，修改代码后为什么 worker 进程没有自动重启？</h2><p>没有自动重启的情况一般是在使用 Jetbrains 旗下软件（IntelliJ IDEA, WebStorm..），并且开启了 Safe Write 选项。</p><p>Jetbrains <a href="https://www.jetbrains.com/help/webstorm/2016.3/system-settings.html">Safe Write 文档</a>中有提到：</p><blockquote><p>If this check box is selected, a changed file is first saved in a temporary file. If the save operation succeeds, the file being saved is replaced with the saved file. (Technically, the original file is deleted and the temporary file is renamed.)</p></blockquote><p>由于使用了重命名导致文件监听的失效。解决办法是关掉 Safe Write 选项。（Settings | Appearance &amp; Behavior | System Settings | Use &quot;safe write&quot; 路径可能根据版本有所不同）</p></div></div></div><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-0 ant-col-md-6"><div class="markdown-body" style="font-size:14px"><div><ul><li><a href="#%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E7%9A%84%E5%8F%8D%E9%A6%88%E9%97%AE%E9%A2%98">如何高效的反馈问题？</a></li><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E7%9A%84%E9%85%8D%E7%BD%AE%E4%B8%8D%E7%94%9F%E6%95%88">为什么我的配置不生效？</a></li><li><a href="#%E7%BA%BF%E4%B8%8A%E7%9A%84%E6%97%A5%E5%BF%97%E6%89%93%E5%8D%B0%E5%8E%BB%E5%93%AA%E9%87%8C%E4%BA%86">线上的日志打印去哪里了？</a></li><li><a href="#%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E4%B8%BA%E4%BB%80%E4%B9%88%E6%B2%A1%E6%9C%89%E9%80%89%E5%9E%8B-pm2">进程管理为什么没有选型 PM2 ？</a></li><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E6%9C%89-csrf-%E6%8A%A5%E9%94%99">为什么会有 csrf 报错？</a></li><li><a href="#%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E6%97%B6%E4%BF%AE%E6%94%B9%E4%BB%A3%E7%A0%81%E5%90%8E%E4%B8%BA%E4%BB%80%E4%B9%88-worker-%E8%BF%9B%E7%A8%8B%E6%B2%A1%E6%9C%89%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF">本地开发时，修改代码后为什么 worker 进程没有自动重启？</a></li></ul></div></div></div></div></div></div></div></div></div><script type="text/javascript">window.__INIT_STATE__={"lang":"zh","props":{"toc":"-%20%5B%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E7%9A%84%E5%8F%8D%E9%A6%88%E9%97%AE%E9%A2%98%EF%BC%9F%5D(%23%25E5%25A6%2582%25E4%25BD%2595%25E9%25AB%2598%25E6%2595%2588%25E7%259A%2584%25E5%258F%258D%25E9%25A6%2588%25E9%2597%25AE%25E9%25A2%2598)%0A-%20%5B%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E7%9A%84%E9%85%8D%E7%BD%AE%E4%B8%8D%E7%94%9F%E6%95%88%EF%BC%9F%5D(%23%25E4%25B8%25BA%25E4%25BB%2580%25E4%25B9%2588%25E6%2588%2591%25E7%259A%2584%25E9%2585%258D%25E7%25BD%25AE%25E4%25B8%258D%25E7%2594%259F%25E6%2595%2588)%0A-%20%5B%E7%BA%BF%E4%B8%8A%E7%9A%84%E6%97%A5%E5%BF%97%E6%89%93%E5%8D%B0%E5%8E%BB%E5%93%AA%E9%87%8C%E4%BA%86%EF%BC%9F%5D(%23%25E7%25BA%25BF%25E4%25B8%258A%25E7%259A%2584%25E6%2597%25A5%25E5%25BF%2597%25E6%2589%2593%25E5%258D%25B0%25E5%258E%25BB%25E5%2593%25AA%25E9%2587%258C%25E4%25BA%2586)%0A-%20%5B%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E4%B8%BA%E4%BB%80%E4%B9%88%E6%B2%A1%E6%9C%89%E9%80%89%E5%9E%8B%20PM2%20%EF%BC%9F%5D(%23%25E8%25BF%259B%25E7%25A8%258B%25E7%25AE%25A1%25E7%2590%2586%25E4%25B8%25BA%25E4%25BB%2580%25E4%25B9%2588%25E6%25B2%25A1%25E6%259C%2589%25E9%2580%2589%25E5%259E%258B-pm2)%0A-%20%5B%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E6%9C%89%20csrf%20%E6%8A%A5%E9%94%99%EF%BC%9F%5D(%23%25E4%25B8%25BA%25E4%25BB%2580%25E4%25B9%2588%25E4%25BC%259A%25E6%259C%2589-csrf-%25E6%258A%25A5%25E9%2594%2599)%0A-%20%5B%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E6%97%B6%EF%BC%8C%E4%BF%AE%E6%94%B9%E4%BB%A3%E7%A0%81%E5%90%8E%E4%B8%BA%E4%BB%80%E4%B9%88%20worker%20%E8%BF%9B%E7%A8%8B%E6%B2%A1%E6%9C%89%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%EF%BC%9F%5D(%23%25E6%259C%25AC%25E5%259C%25B0%25E5%25BC%2580%25E5%258F%2591%25E6%2597%25B6%25E4%25BF%25AE%25E6%2594%25B9%25E4%25BB%25A3%25E7%25A0%2581%25E5%2590%258E%25E4%25B8%25BA%25E4%25BB%2580%25E4%25B9%2588-worker-%25E8%25BF%259B%25E7%25A8%258B%25E6%25B2%25A1%25E6%259C%2589%25E8%2587%25AA%25E5%258A%25A8%25E9%2587%258D%25E5%2590%25AF)","meta":{"info":{"title":"常见问题"}},"content":"%0A%0A%0A%E5%A6%82%E6%9E%9C%E4%B8%8B%E9%9D%A2%E7%9A%84%E5%86%85%E5%AE%B9%E6%97%A0%E6%B3%95%E8%A7%A3%E5%86%B3%E4%BD%A0%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%8C%E8%AF%B7%E6%9F%A5%E7%9C%8B%20%5BEgg%20issues%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg%2Fissues)%E3%80%82%0A%0A%23%23%20%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E7%9A%84%E5%8F%8D%E9%A6%88%E9%97%AE%E9%A2%98%EF%BC%9F%0A%0A%E6%84%9F%E8%B0%A2%E6%82%A8%E5%90%91%E6%88%91%E4%BB%AC%E5%8F%8D%E9%A6%88%E9%97%AE%E9%A2%98%E3%80%82%0A%0A1.%20%E6%88%91%E4%BB%AC%E6%8E%A8%E8%8D%90%E5%A6%82%E6%9E%9C%E6%98%AF%E5%B0%8F%E9%97%AE%E9%A2%98%EF%BC%88%E9%94%99%E5%88%AB%E5%AD%97%E4%BF%AE%E6%94%B9%EF%BC%8C%E5%B0%8F%E7%9A%84%20bug%20fix%EF%BC%89%E7%9B%B4%E6%8E%A5%E6%8F%90%E4%BA%A4%20PR%E3%80%82%0A2.%20%E5%A6%82%E6%9E%9C%E6%98%AF%E4%B8%80%E4%B8%AA%E6%96%B0%E9%9C%80%E6%B1%82%EF%BC%8C%E8%AF%B7%E6%8F%90%E4%BE%9B%EF%BC%9A%E8%AF%A6%E7%BB%86%E9%9C%80%E6%B1%82%E6%8F%8F%E8%BF%B0%EF%BC%8C%E6%9C%80%E5%A5%BD%E6%98%AF%E6%9C%89%E4%BC%AA%E4%BB%A3%E7%A0%81%E7%A4%BA%E6%84%8F%E3%80%82%0A3.%20%E5%A6%82%E6%9E%9C%E6%98%AF%E4%B8%80%E4%B8%AA%20BUG%EF%BC%8C%E8%AF%B7%E6%8F%90%E4%BE%9B%EF%BC%9A%E5%A4%8D%E7%8E%B0%E6%AD%A5%E9%AA%A4%EF%BC%8C%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97%E4%BB%A5%E5%8F%8A%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%B9%B6%E5%B0%BD%E9%87%8F%E5%A1%AB%E5%86%99%E4%B8%8B%E9%9D%A2%E7%9A%84%E6%A8%A1%E6%9D%BF%E4%B8%AD%E7%9A%84%E6%9D%A1%E7%9B%AE%E3%80%82%0A4.%20**%E5%A6%82%E6%9E%9C%E5%8F%AF%E4%BB%A5%EF%BC%8C%E5%B0%BD%E5%8F%AF%E8%83%BD%E4%BD%BF%E7%94%A8%20%60egg-init%20--type%3Dsimple%20bug%60%20%E6%8F%90%E4%BE%9B%E4%B8%80%E4%B8%AA%E6%9C%80%E5%B0%8F%E5%8F%AF%E5%A4%8D%E7%8E%B0%E7%9A%84%E4%BB%A3%E7%A0%81%E4%BB%93%E5%BA%93%EF%BC%8C%E6%96%B9%E4%BE%BF%E6%88%91%E4%BB%AC%E6%8E%92%E6%9F%A5%E9%97%AE%E9%A2%98%E3%80%82**%0A5.%20%E4%B8%8D%E8%A6%81%E6%8C%A4%E7%89%99%E8%86%8F%E4%BC%BC%E7%9A%84%E4%BA%A4%E6%B5%81%EF%BC%8C%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB%EF%BC%9A%5B%E5%A6%82%E4%BD%95%E5%90%91%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E6%8F%90%E4%BA%A4%E6%97%A0%E6%B3%95%E8%A7%A3%E7%AD%94%E7%9A%84%E9%97%AE%E9%A2%98%5D(https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F25795393)%0A%0A%E6%9C%80%E9%87%8D%E8%A6%81%E7%9A%84%E6%98%AF%EF%BC%8C%E8%AF%B7%E6%98%8E%E7%99%BD%E4%B8%80%E4%BB%B6%E4%BA%8B%EF%BC%9A%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%94%A8%E6%88%B7%E5%92%8C%E7%BB%B4%E6%8A%A4%E8%80%85%E4%B9%8B%E9%97%B4%E5%B9%B6%E4%B8%8D%E6%98%AF%E7%94%B2%E6%96%B9%E5%92%8C%E4%B9%99%E6%96%B9%E7%9A%84%E5%85%B3%E7%B3%BB%EF%BC%8Cissue%20%E4%B9%9F%E4%B8%8D%E6%98%AF%E5%AE%A2%E6%9C%8D%E5%B7%A5%E5%8D%95%E3%80%82%E5%9C%A8%E5%BC%80%20issue%20%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E8%AF%B7%E6%8A%B1%E7%9D%80%E4%B8%80%E7%A7%8D%E3%80%8E%E4%B8%80%E8%B5%B7%E5%90%88%E4%BD%9C%E6%9D%A5%E8%A7%A3%E5%86%B3%E8%BF%99%E4%B8%AA%E9%97%AE%E9%A2%98%E3%80%8F%E7%9A%84%E5%BF%83%E6%80%81%EF%BC%8C%E4%B8%8D%E8%A6%81%E6%9C%9F%E5%BE%85%E6%88%91%E4%BB%AC%E5%8D%95%E6%96%B9%E9%9D%A2%E5%9C%B0%E4%B8%BA%E4%BD%A0%E6%9C%8D%E5%8A%A1%E3%80%82%0A%0A%23%23%20%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E7%9A%84%E9%85%8D%E7%BD%AE%E4%B8%8D%E7%94%9F%E6%95%88%EF%BC%9F%0A%0A%E6%A1%86%E6%9E%B6%E7%9A%84%E9%85%8D%E7%BD%AE%E5%8A%9F%E8%83%BD%E6%AF%94%E8%BE%83%E5%BC%BA%E5%A4%A7%EF%BC%8C%E6%9C%89%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%EF%BC%8C%E5%8F%88%E6%9C%89%E6%A1%86%E6%9E%B6%E3%80%81%E6%8F%92%E4%BB%B6%E3%80%81%E5%BA%94%E7%94%A8%E7%AD%89%E5%BE%88%E5%A4%9A%E5%9C%B0%E6%96%B9%E9%85%8D%E7%BD%AE%E3%80%82%0A%0A%E5%A6%82%E6%9E%9C%E4%BD%A0%E5%88%86%E6%9E%90%E9%97%AE%E9%A2%98%E6%97%B6%EF%BC%8C%E6%83%B3%E7%9F%A5%E9%81%93%E5%BD%93%E5%89%8D%E8%BF%90%E8%A1%8C%E6%97%B6%E4%BD%BF%E7%94%A8%E7%9A%84%E6%9C%80%E7%BB%88%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%9F%A5%E7%9C%8B%E4%B8%8B%20%60%24%7Broot%7D%2Frun%2Fapplication_config.json%60%EF%BC%88worker%20%E8%BF%9B%E7%A8%8B%E9%85%8D%E7%BD%AE%EF%BC%89%20%E5%92%8C%20%60%24%7Broot%7D%2Frun%2Fagent_config.json%60%EF%BC%88agent%20%E8%BF%9B%E7%A8%8B%E9%85%8D%E7%BD%AE%EF%BC%89%20%E8%BF%99%E4%B8%A4%E4%B8%AA%E6%96%87%E4%BB%B6%E3%80%82%EF%BC%88%60root%60%20%E4%B8%BA%E5%BA%94%E7%94%A8%E6%A0%B9%E7%9B%AE%E5%BD%95%EF%BC%8C%E5%8F%AA%E6%9C%89%E5%9C%A8%20local%20%E5%92%8C%20unittest%20%E7%8E%AF%E5%A2%83%E4%B8%8B%E4%B8%BA%E9%A1%B9%E7%9B%AE%E6%89%80%E5%9C%A8%E7%9B%AE%E5%BD%95%EF%BC%8C%E5%85%B6%E4%BB%96%E7%8E%AF%E5%A2%83%E4%B8%8B%E9%83%BD%E4%B8%BA%20HOME%20%E7%9B%AE%E5%BD%95%EF%BC%89%0A%0A%E4%B9%9F%E5%8F%AF%E5%8F%82%E8%A7%81%5B%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%5D(https%3A%2F%2Feggjs.org%2Fzh-cn%2Fbasics%2Fconfig.html%23%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C)%E3%80%82%0A%0APS%EF%BC%9A%E8%AF%B7%E7%A1%AE%E4%BF%9D%E6%B2%A1%E6%9C%89%E5%86%99%E5%87%BA%E4%BB%A5%E4%B8%8B%E4%BB%A3%E7%A0%81%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0Aexports.someKeys%20%3D%20'abc'%3B%0Amodule.exports%20%3D%20appInfo%20%3D%3E%20%7B%0A%20%20const%20config%20%3D%20%7B%7D%3B%0A%20%20config.keys%20%3D%20'123456'%3B%0A%20%20return%20config%3B%0A%7D%3B%0A%60%60%60%0A%0A%23%23%20%E7%BA%BF%E4%B8%8A%E7%9A%84%E6%97%A5%E5%BF%97%E6%89%93%E5%8D%B0%E5%8E%BB%E5%93%AA%E9%87%8C%E4%BA%86%EF%BC%9F%0A%0A%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E4%B8%8B%EF%BC%8C%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E6%97%A5%E5%BF%97%E9%83%BD%E4%BC%9A%E6%89%93%E5%8D%B0%E5%9C%A8%E5%BA%94%E7%94%A8%E6%A0%B9%E7%9B%AE%E5%BD%95%E7%9A%84%20%60logs%60%20%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%8B(%60%24%7BbaseDir%7D%2Flogs%60)%20%EF%BC%8C%E4%BD%86%E6%98%AF%E5%9C%A8%E9%9D%9E%E5%BC%80%E5%8F%91%E6%9C%9F%E7%9A%84%E7%8E%AF%E5%A2%83%EF%BC%88%E9%9D%9E%20local%20%E5%92%8C%20unittest%20%E7%8E%AF%E5%A2%83%EF%BC%89%EF%BC%8C%E6%89%80%E6%9C%89%E7%9A%84%E6%97%A5%E5%BF%97%E9%83%BD%E4%BC%9A%E6%89%93%E5%8D%B0%E5%88%B0%20%60%24HOME%2Flogs%60%20%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%8B%EF%BC%88%E4%BE%8B%E5%A6%82%20%60%2Fhome%2Fadmin%2Flogs%60%EF%BC%89%E3%80%82%E8%BF%99%E6%A0%B7%E5%8F%AF%E4%BB%A5%E8%AE%A9%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E6%97%B6%E5%BA%94%E7%94%A8%E6%97%A5%E5%BF%97%E4%BA%92%E4%B8%8D%E5%BD%B1%E5%93%8D%EF%BC%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6%E5%8F%88%E6%9C%89%E7%BB%9F%E4%B8%80%E7%9A%84%E6%97%A5%E5%BF%97%E8%BE%93%E5%87%BA%E7%9B%AE%E5%BD%95%E3%80%82%0A%0A%23%23%20%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E4%B8%BA%E4%BB%80%E4%B9%88%E6%B2%A1%E6%9C%89%E9%80%89%E5%9E%8B%20PM2%20%EF%BC%9F%0A%0A1.%20PM2%20%E6%A8%A1%E5%9D%97%E6%9C%AC%E8%BA%AB%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%BE%88%E9%AB%98%EF%BC%8C%E5%87%BA%E4%BA%86%E9%97%AE%E9%A2%98%E5%BE%88%E9%9A%BE%E6%8E%92%E6%9F%A5%E3%80%82%E6%88%91%E4%BB%AC%E8%AE%A4%E4%B8%BA%E6%A1%86%E6%9E%B6%E4%BD%BF%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7%E5%A4%8D%E6%9D%82%E5%BA%A6%E4%B8%8D%E5%BA%94%E8%AF%A5%E8%BF%87%E9%AB%98%EF%BC%8C%E8%80%8C%20PM2%20%E8%87%AA%E8%BA%AB%E7%9A%84%E5%A4%8D%E6%9D%82%E5%BA%A6%E8%B6%85%E8%B6%8A%E4%BA%86%E5%A4%A7%E9%83%A8%E5%88%86%E5%BA%94%E7%94%A8%E6%9C%AC%E8%BA%AB%E3%80%82%0A2.%20%E6%B2%A1%E6%B3%95%E5%81%9A%E9%9D%9E%E5%B8%B8%E6%B7%B1%E7%9A%84%E4%BC%98%E5%8C%96%E3%80%82%0A3.%20%E5%88%87%E5%AE%9E%E7%9A%84%E9%9C%80%E6%B1%82%E9%97%AE%E9%A2%98%EF%BC%8C%E4%B8%80%E4%B8%AA%E8%BF%9B%E7%A8%8B%E9%87%8C%E8%B7%91%20leader%EF%BC%8C%E5%85%B6%E4%BB%96%E8%BF%9B%E7%A8%8B%E4%BB%A3%E7%90%86%E5%88%B0%20leader%20%E8%BF%99%E7%A7%8D%E6%A8%A1%E5%BC%8F%EF%BC%88%5B%E5%A4%9A%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B%5D(.%2Fcore%2Fcluster-and-ipc.md)%EF%BC%89%EF%BC%8C%E5%9C%A8%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BC%80%E5%8F%91%E4%B8%AD%E5%AF%B9%E4%BA%8E%E5%87%8F%E5%B0%91%E8%BF%9C%E7%AB%AF%E8%BF%9E%E6%8E%A5%EF%BC%8C%E9%99%8D%E4%BD%8E%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E5%8E%8B%E5%8A%9B%E7%AD%89%E9%83%BD%E6%98%AF%E5%88%87%E5%AE%9E%E7%9A%84%E9%9C%80%E6%B1%82%E3%80%82%E7%89%B9%E5%88%AB%E5%BD%93%E5%BA%94%E7%94%A8%E8%A7%84%E6%A8%A1%E5%A4%A7%E5%88%B0%E4%B8%80%E5%AE%9A%E7%A8%8B%E5%BA%A6%EF%BC%8C%E8%BF%99%E5%B0%B1%E4%BC%9A%E6%98%AF%E5%88%9A%E9%9C%80%E3%80%82egg%20%E6%9C%AC%E8%BA%AB%E8%B5%B7%E6%BA%90%E4%BA%8E%E8%9A%82%E8%9A%81%E9%87%91%E6%9C%8D%E5%92%8C%E9%98%BF%E9%87%8C%EF%BC%8C%E6%88%91%E4%BB%AC%E5%AF%B9%E6%A0%87%E7%9A%84%E8%B5%B7%E7%82%B9%E5%B0%B1%E6%98%AF%E5%A4%A7%E8%A7%84%E6%A8%A1%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E7%9A%84%E6%9E%84%E5%BB%BA%EF%BC%8C%E6%89%80%E4%BB%A5%E8%A6%81%E9%9D%9E%E5%B8%B8%E5%85%A8%E9%9D%A2%E3%80%82%E8%BF%99%E4%BA%9B%E7%89%B9%E6%80%A7%E9%80%9A%E8%BF%87%20PM2%20%E5%BE%88%E9%9A%BE%E5%81%9A%E5%88%B0%E3%80%82%0A%0A%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B%E9%9D%9E%E5%B8%B8%E9%87%8D%E8%A6%81%EF%BC%8C%E4%BC%9A%E5%BD%B1%E5%93%8D%E5%88%B0%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F%EF%BC%8C%E8%BF%90%E8%A1%8C%E6%9C%9F%E9%97%B4%E7%9A%84%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%8C%96%E7%AD%89%EF%BC%8C%E6%88%91%E4%BB%AC%E8%AE%A4%E4%B8%BA%E5%8F%AF%E8%83%BD%E7%94%B1%E6%A1%86%E6%9E%B6%E6%9D%A5%E6%8E%A7%E5%88%B6%E6%AF%94%E8%BE%83%E5%90%88%E9%80%82%E3%80%82%0A%0A**%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%20PM2%20%E5%90%AF%E5%8A%A8%E5%BA%94%E7%94%A8%EF%BC%9F**%0A%0A%E5%B0%BD%E7%AE%A1%E6%88%91%E4%BB%AC%E4%B8%8D%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%20PM2%20%E5%90%AF%E5%8A%A8%EF%BC%8C%E4%BD%86%E4%BB%8D%E7%84%B6%E6%98%AF%E5%8F%AF%E4%BB%A5%E5%81%9A%E5%88%B0%E7%9A%84%E3%80%82%0A%0A%E9%A6%96%E5%85%88%EF%BC%8C%E5%9C%A8%E9%A1%B9%E7%9B%AE%E6%A0%B9%E7%9B%AE%E5%BD%95%E5%AE%9A%E4%B9%89%E5%90%AF%E5%8A%A8%E6%96%87%E4%BB%B6%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20server.js%0Aconst%20egg%20%3D%20require('egg')%3B%0A%0Aconst%20workers%20%3D%20Number(process.argv%5B2%5D%20%7C%7C%20require('os').cpus().length)%3B%0Aegg.startCluster(%7B%0A%20%20workers%2C%0A%20%20baseDir%3A%20__dirname%2C%0A%7D)%3B%0A%60%60%60%0A%0A%E8%BF%99%E6%A0%B7%EF%BC%8C%E6%88%91%E4%BB%AC%E5%B0%B1%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20PM2%20%E8%BF%9B%E8%A1%8C%E5%90%AF%E5%8A%A8%E4%BA%86%EF%BC%9A%0A%0A%60%60%60bash%0Apm2%20start%20server.js%0A%60%60%60%0A%0A%23%23%20%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E6%9C%89%20csrf%20%E6%8A%A5%E9%94%99%EF%BC%9F%0A%0A%E9%80%9A%E5%B8%B8%E6%9C%89%E4%B8%A4%E7%A7%8D%20csrf%20%E6%8A%A5%E9%94%99%EF%BC%9A%0A%0A-%20%60missing%20csrf%20token%60%0A-%20%60invalid%20csrf%20token%60%0A%0AEgg%20%E5%86%85%E7%BD%AE%E7%9A%84%20%5Begg-security%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-security%2F)%20%E6%8F%92%E4%BB%B6%E9%BB%98%E8%AE%A4%E5%AF%B9%E6%89%80%E6%9C%89%E3%80%8E%E9%9D%9E%E5%AE%89%E5%85%A8%E3%80%8F%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%8C%E4%BE%8B%E5%A6%82%20%60POST%60%EF%BC%8C%60PUT%60%EF%BC%8C%60DELETE%60%20%E9%83%BD%E8%BF%9B%E8%A1%8C%20CSRF%20%E6%A0%A1%E9%AA%8C%E3%80%82%0A%0A%E8%AF%B7%E6%B1%82%E9%81%87%E5%88%B0%20csrf%20%E6%8A%A5%E9%94%99%E9%80%9A%E5%B8%B8%E6%98%AF%E5%9B%A0%E4%B8%BA%E6%B2%A1%E6%9C%89%E5%8A%A0%E6%AD%A3%E7%A1%AE%E7%9A%84%20csrf%20token%20%E5%AF%BC%E8%87%B4%EF%BC%8C%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F%EF%BC%8C%E8%AF%B7%E9%98%85%E8%AF%BB%5B%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81%20CSRF%20%E7%9A%84%E9%98%B2%E8%8C%83%5D(.%2Fcore%2Fsecurity.md%23%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81csrf%E7%9A%84%E9%98%B2%E8%8C%83)%E3%80%82%0A%0A%23%23%20%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E6%97%B6%EF%BC%8C%E4%BF%AE%E6%94%B9%E4%BB%A3%E7%A0%81%E5%90%8E%E4%B8%BA%E4%BB%80%E4%B9%88%20worker%20%E8%BF%9B%E7%A8%8B%E6%B2%A1%E6%9C%89%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%EF%BC%9F%0A%0A%E6%B2%A1%E6%9C%89%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%80%E8%88%AC%E6%98%AF%E5%9C%A8%E4%BD%BF%E7%94%A8%20Jetbrains%20%E6%97%97%E4%B8%8B%E8%BD%AF%E4%BB%B6%EF%BC%88IntelliJ%20IDEA%2C%20WebStorm..%EF%BC%89%EF%BC%8C%E5%B9%B6%E4%B8%94%E5%BC%80%E5%90%AF%E4%BA%86%20Safe%20Write%20%E9%80%89%E9%A1%B9%E3%80%82%0A%0AJetbrains%20%5BSafe%20Write%20%E6%96%87%E6%A1%A3%5D(https%3A%2F%2Fwww.jetbrains.com%2Fhelp%2Fwebstorm%2F2016.3%2Fsystem-settings.html)%E4%B8%AD%E6%9C%89%E6%8F%90%E5%88%B0%EF%BC%9A%0A%0A%3E%20If%20this%20check%20box%20is%20selected%2C%20a%20changed%20file%20is%20first%20saved%20in%20a%20temporary%20file.%20If%20the%20save%20operation%20succeeds%2C%20the%20file%20being%20saved%20is%20replaced%20with%20the%20saved%20file.%20(Technically%2C%20the%20original%20file%20is%20deleted%20and%20the%20temporary%20file%20is%20renamed.)%0A%0A%E7%94%B1%E4%BA%8E%E4%BD%BF%E7%94%A8%E4%BA%86%E9%87%8D%E5%91%BD%E5%90%8D%E5%AF%BC%E8%87%B4%E6%96%87%E4%BB%B6%E7%9B%91%E5%90%AC%E7%9A%84%E5%A4%B1%E6%95%88%E3%80%82%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95%E6%98%AF%E5%85%B3%E6%8E%89%20Safe%20Write%20%E9%80%89%E9%A1%B9%E3%80%82%EF%BC%88Settings%20%7C%20Appearance%20%26%20Behavior%20%7C%20System%20Settings%20%7C%20Use%20%22safe%20write%22%20%E8%B7%AF%E5%BE%84%E5%8F%AF%E8%83%BD%E6%A0%B9%E6%8D%AE%E7%89%88%E6%9C%AC%E6%9C%89%E6%89%80%E4%B8%8D%E5%90%8C%EF%BC%89%0A"}}</script><script type="text/javascript" src="/static/js/post.b9faab88.js"></script></body></html>