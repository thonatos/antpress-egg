<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.png"><style class="_styletron_hydrate_"></style><title>Service</title><meta name="description" content="Born to build better enterprise frameworks and apps"><link href="/static/css/post.d62265dc.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="ant-layout" data-reactroot=""><div class="header-module__header___3ADJ9 ant-layout-header"><div class="ant-row-flex"><div class="ant-col-xs-12 ant-col-md-20 ant-col-lg-2"><div class="header-module__logo___3yTXp"><a href="/"><img src="/logo.svg" alt="logo"/></a></div></div><div class="ant-col-xs-0 ant-col-md-0 ant-col-lg-20"><ul class="ant-menu header-module__menu___3yEtW ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/intro/">指南</a></li><li class="ant-menu-item" role="menuitem"><a href="/api/">API</a></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/tutorials/index.html">教程</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/search?q=topic%3Aegg-plugin&amp;type=Repositories">插件</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/eggjs/egg/releases">发布日志</a></li></ul></div><div style="text-align:right" class="ant-col-xs-12 ant-col-md-4 ant-col-lg-2"><button type="button" class="ant-btn"><span>Languages</span></button></div></div></div><div class="ant-layout-content"><div class="basic_layout-module__content___3flpY ant-layout"><div class="sider-module__side___1Cadj ant-layout-sider ant-layout-sider-light" style="flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"><ul class="ant-menu sider-module__menu___2GqPr ant-menu-light ant-menu-root ant-menu-inline" role="menu"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="0$Menu" aria-haspopup="true"><span>新手指南</span><i class="ant-menu-submenu-arrow"></i></div><ul id="0$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/index.html">Egg.js 是什么?</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/egg-and-koa.html">Egg.js 和 Koa</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/quickstart.html">快速入门</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/progressive.html">渐进式开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/migration.html">2.x 升级指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="1$Menu" aria-haspopup="true"><span>基础功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="1$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/structure.html">目录结构</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/objects.html">内置对象</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/env.html">运行环境</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/config.html">配置</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/middleware.html">中间件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/router.html">Router</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/controller.html">Controller</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/service.html">Service</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/plugin.html">插件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/schedule.html">定时任务</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/extend.html">框架扩展</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/app-start.html">启动自定义</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="2$Menu" aria-haspopup="true"><span>核心功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="2$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/development.html">本地开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/unittest.html">单元测试</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/deployment.html">应用部署</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/logger.html">日志</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/httpclient.html">HttpClient</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cookie-and-session.html">Cookie and Session</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cluster-and-ipc.html">多进程模型和进程间通讯</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/view.html">模板渲染</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/error-handling.html">异常处理</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/security.html">安全</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/i18n.html">国际化</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="3$Menu" aria-haspopup="true"><span>教程</span><i class="ant-menu-submenu-arrow"></i></div><ul id="3$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/mysql.html">MySQL</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/restful.html">RESTful API</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/passport.html">Passport 鉴权</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/socketio.html">Socket.IO</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/assets.html">静态资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/typescript.html">TypeScript</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="4$Menu" aria-haspopup="true"><span>进阶</span><i class="ant-menu-submenu-arrow"></i></div><ul id="4$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/loader.html">Loader</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/plugin.html">插件开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/framework.html">框架开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/cluster-client.html">多进程研发模式增强</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/view-plugin.html">模板插件开发规范</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/style-guide.html">代码风格指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="5$Menu" aria-haspopup="true"><span>社区</span><i class="ant-menu-submenu-arrow"></i></div><ul id="5$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/plugins/">内置插件列表</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/contributing.html">如何贡献</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/resource.html">资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/faq.html">常见问题</a></li></ul></li></ul></div></div><div class="basic_layout-module__post___2Z7KK ant-layout-content"><div class="ant-row" style="margin-left:-8px;margin-right:-8px"><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-24 ant-col-md-18"><div class="markdown-body" style="font-size:14px"><div><p>简单来说，Service 就是在复杂业务场景下用于做业务逻辑封装的一个抽象层，提供这个抽象有以下几个好处：</p><ul><li>保持 Controller 中的逻辑更加简洁。</li><li>保持业务逻辑的独立性，抽象出来的 Service 可以被多个 Controller 重复调用。</li><li>将逻辑和展现分离，更容易编写测试用例，测试用例的编写具体可以查看<a href="../core/unittest.md">这里</a>。</li></ul><h2 id="使用场景">使用场景</h2><ul><li>复杂数据的处理，比如要展现的信息需要从数据库获取，还要经过一定的规则计算，才能返回用户显示。或者计算完成后，更新到数据库。</li><li>第三方服务的调用，比如 GitHub 信息获取等。</li></ul><h2 id="定义-service">定义 Service</h2><pre><code class="language-js">// app/service/user.js
const Service = require(&#x27;egg&#x27;).Service;

class UserService extends Service {
  async find(uid) {
    const user = await this.ctx.db.query(&#x27;select * from user where uid = ?&#x27;, uid);
    return user;
  }
}

module.exports = UserService;</code></pre><h3 id="属性">属性</h3><p>每一次用户请求，框架都会实例化对应的 Service 实例，由于它继承于 <code>egg.Service</code>，故拥有下列属性方便我们进行开发：</p><ul><li><code>this.ctx</code>: 当前请求的上下文 <a href="./extend.md#context">Context</a> 对象的实例，通过它我们可以拿到框架封装好的处理当前请求的各种便捷属性和方法。</li><li><code>this.app</code>: 当前应用 <a href="./extend.md#application">Application</a> 对象的实例，通过它我们可以拿到框架提供的全局对象和方法。</li><li><code>this.service</code>：应用定义的 <a href="./service.md">Service</a>，通过它我们可以访问到其他业务层，等价于 <code>this.ctx.service</code> 。</li><li><code>this.config</code>：应用运行时的<a href="./config.md">配置项</a>。</li><li><code>this.logger</code>：logger 对象，上面有四个方法（<code>debug</code>，<code>info</code>，<code>warn</code>，<code>error</code>），分别代表打印四个不同级别的日志，使用方法和效果与 <a href="../core/logger.md#context-logger">context logger</a> 中介绍的一样，但是通过这个 logger 对象记录的日志，在日志前面会加上打印该日志的文件路径，以便快速定位日志打印位置。</li></ul><h3 id="service-ctx-详解">Service ctx 详解</h3><p>为了可以获取用户请求的链路，我们在 Service 初始化中，注入了请求上下文, 用户在方法中可以直接通过 <code>this.ctx</code> 来获取上下文相关信息。关于上下文的具体详解可以参看 <a href="./extend.md#context">Context</a>,
有了 ctx 我们可以拿到框架给我们封装的各种便捷属性和方法。比如我们可以用：</p><ul><li><code>this.ctx.curl</code> 发起网络调用。</li><li><code>this.ctx.service.otherService</code> 调用其他 Service。</li><li><code>this.ctx.db</code> 发起数据库调用等， db 可能是其他插件提前挂载到 app 上的模块。</li></ul><h3 id="注意事项">注意事项</h3><ul><li><p>Service 文件必须放在 <code>app/service</code> 目录，可以支持多级目录，访问的时候可以通过目录名级联访问。</p><pre><code class="language-js">app/service/biz/user.js =&gt; ctx.service.biz.user
app/service/sync_user.js =&gt; ctx.service.syncUser
app/service/HackerNews.js =&gt; ctx.service.hackerNews</code></pre></li><li>一个 Service 文件只能包含一个类， 这个类需要通过 <code>module.exports</code> 的方式返回。</li><li>Service 需要通过 Class 的方式定义，父类必须是 <code>egg.Service</code>。</li><li>Service 不是单例，是 <strong>请求级别</strong> 的对象，框架在每次请求中首次访问 <code>ctx.service.xx</code> 时延迟实例化，所以 Service 中可以通过 this.ctx 获取到当前请求的上下文。</li></ul><h2 id="使用-service">使用 Service</h2><p>下面就通过一个完整的例子，看看怎么使用 Service。</p><pre><code class="language-js">// app/router.js
module.exports = app =&gt; {
  app.router.get(&#x27;/user/:id&#x27;, app.controller.user.info);
};

// app/controller/user.js
const Controller = require(&#x27;egg&#x27;).Controller;
class UserController extends Controller {
  async info() {
    const userId = ctx.params.id;
    const userInfo = await ctx.service.user.find(userId);
    ctx.body = userInfo;
  }
}
module.exports = UserController;

// app/service/user.js
const Service = require(&#x27;egg&#x27;).Service;
class UserService extends Service {
  // 默认不需要提供构造函数。
  // constructor(ctx) {
  //   super(ctx); 如果需要在构造函数做一些处理，一定要有这句话，才能保证后面 `this.ctx`的使用。
  //   // 就可以直接通过 this.ctx 获取 ctx 了
  //   // 还可以直接通过 this.app 获取 app 了
  // }
  async find(uid) {
    // 假如 我们拿到用户 id 从数据库获取用户详细信息
    const user = await this.ctx.db.query(&#x27;select * from user where uid = ?&#x27;, uid);

    // 假定这里还有一些复杂的计算，然后返回需要的信息。
    const picture = await this.getPicture(uid);

    return {
      name: user.user_name,
      age: user.age,
      picture,
    };
  }

  async getPicture(uid) {
    const result = await this.ctx.curl(`http://photoserver/uid=${uid}`, { dataType: &#x27;json&#x27; });
    return result.data;
  }
}
module.exports = UserService;

// curl http://127.0.0.1:7001/user/1234</code></pre></div></div></div><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-0 ant-col-md-6"><div class="markdown-body" style="font-size:14px"><div><ul><li><a href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">使用场景</a></li><li><a href="#%E5%AE%9A%E4%B9%89-service">定义 Service</a><ul><li><a href="#%E5%B1%9E%E6%80%A7">属性</a></li><li><a href="#service-ctx-%E8%AF%A6%E8%A7%A3">Service ctx 详解</a></li><li><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">注意事项</a></li></ul></li><li><a href="#%E4%BD%BF%E7%94%A8-service">使用 Service</a></li></ul></div></div></div></div></div></div></div></div></div><script type="text/javascript">window.__INIT_STATE__={"lang":"zh","props":{"toc":"-%20%5B%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%5D(%23%25E4%25BD%25BF%25E7%2594%25A8%25E5%259C%25BA%25E6%2599%25AF)%0A-%20%5B%E5%AE%9A%E4%B9%89%20Service%5D(%23%25E5%25AE%259A%25E4%25B9%2589-service)%0A%20%20*%20%5B%E5%B1%9E%E6%80%A7%5D(%23%25E5%25B1%259E%25E6%2580%25A7)%0A%20%20*%20%5BService%20ctx%20%E8%AF%A6%E8%A7%A3%5D(%23service-ctx-%25E8%25AF%25A6%25E8%25A7%25A3)%0A%20%20*%20%5B%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%5D(%23%25E6%25B3%25A8%25E6%2584%258F%25E4%25BA%258B%25E9%25A1%25B9)%0A-%20%5B%E4%BD%BF%E7%94%A8%20Service%5D(%23%25E4%25BD%25BF%25E7%2594%25A8-service)","meta":{"info":{"title":"Service"}},"content":"%0A%0A%0A%E7%AE%80%E5%8D%95%E6%9D%A5%E8%AF%B4%EF%BC%8CService%20%E5%B0%B1%E6%98%AF%E5%9C%A8%E5%A4%8D%E6%9D%82%E4%B8%9A%E5%8A%A1%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%94%A8%E4%BA%8E%E5%81%9A%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E5%B0%81%E8%A3%85%E7%9A%84%E4%B8%80%E4%B8%AA%E6%8A%BD%E8%B1%A1%E5%B1%82%EF%BC%8C%E6%8F%90%E4%BE%9B%E8%BF%99%E4%B8%AA%E6%8A%BD%E8%B1%A1%E6%9C%89%E4%BB%A5%E4%B8%8B%E5%87%A0%E4%B8%AA%E5%A5%BD%E5%A4%84%EF%BC%9A%0A%0A-%20%E4%BF%9D%E6%8C%81%20Controller%20%E4%B8%AD%E7%9A%84%E9%80%BB%E8%BE%91%E6%9B%B4%E5%8A%A0%E7%AE%80%E6%B4%81%E3%80%82%0A-%20%E4%BF%9D%E6%8C%81%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E7%9A%84%E7%8B%AC%E7%AB%8B%E6%80%A7%EF%BC%8C%E6%8A%BD%E8%B1%A1%E5%87%BA%E6%9D%A5%E7%9A%84%20Service%20%E5%8F%AF%E4%BB%A5%E8%A2%AB%E5%A4%9A%E4%B8%AA%20Controller%20%E9%87%8D%E5%A4%8D%E8%B0%83%E7%94%A8%E3%80%82%0A-%20%E5%B0%86%E9%80%BB%E8%BE%91%E5%92%8C%E5%B1%95%E7%8E%B0%E5%88%86%E7%A6%BB%EF%BC%8C%E6%9B%B4%E5%AE%B9%E6%98%93%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%EF%BC%8C%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%E7%9A%84%E7%BC%96%E5%86%99%E5%85%B7%E4%BD%93%E5%8F%AF%E4%BB%A5%E6%9F%A5%E7%9C%8B%5B%E8%BF%99%E9%87%8C%5D(..%2Fcore%2Funittest.md)%E3%80%82%0A%0A%23%23%20%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%0A%0A-%20%E5%A4%8D%E6%9D%82%E6%95%B0%E6%8D%AE%E7%9A%84%E5%A4%84%E7%90%86%EF%BC%8C%E6%AF%94%E5%A6%82%E8%A6%81%E5%B1%95%E7%8E%B0%E7%9A%84%E4%BF%A1%E6%81%AF%E9%9C%80%E8%A6%81%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E8%8E%B7%E5%8F%96%EF%BC%8C%E8%BF%98%E8%A6%81%E7%BB%8F%E8%BF%87%E4%B8%80%E5%AE%9A%E7%9A%84%E8%A7%84%E5%88%99%E8%AE%A1%E7%AE%97%EF%BC%8C%E6%89%8D%E8%83%BD%E8%BF%94%E5%9B%9E%E7%94%A8%E6%88%B7%E6%98%BE%E7%A4%BA%E3%80%82%E6%88%96%E8%80%85%E8%AE%A1%E7%AE%97%E5%AE%8C%E6%88%90%E5%90%8E%EF%BC%8C%E6%9B%B4%E6%96%B0%E5%88%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%82%0A-%20%E7%AC%AC%E4%B8%89%E6%96%B9%E6%9C%8D%E5%8A%A1%E7%9A%84%E8%B0%83%E7%94%A8%EF%BC%8C%E6%AF%94%E5%A6%82%20GitHub%20%E4%BF%A1%E6%81%AF%E8%8E%B7%E5%8F%96%E7%AD%89%E3%80%82%0A%0A%23%23%20%E5%AE%9A%E4%B9%89%20Service%0A%0A%60%60%60js%0A%2F%2F%20app%2Fservice%2Fuser.js%0Aconst%20Service%20%3D%20require('egg').Service%3B%0A%0Aclass%20UserService%20extends%20Service%20%7B%0A%20%20async%20find(uid)%20%7B%0A%20%20%20%20const%20user%20%3D%20await%20this.ctx.db.query('select%20*%20from%20user%20where%20uid%20%3D%20%3F'%2C%20uid)%3B%0A%20%20%20%20return%20user%3B%0A%20%20%7D%0A%7D%0A%0Amodule.exports%20%3D%20UserService%3B%0A%60%60%60%0A%0A%23%23%23%20%E5%B1%9E%E6%80%A7%0A%0A%E6%AF%8F%E4%B8%80%E6%AC%A1%E7%94%A8%E6%88%B7%E8%AF%B7%E6%B1%82%EF%BC%8C%E6%A1%86%E6%9E%B6%E9%83%BD%E4%BC%9A%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%AF%B9%E5%BA%94%E7%9A%84%20Service%20%E5%AE%9E%E4%BE%8B%EF%BC%8C%E7%94%B1%E4%BA%8E%E5%AE%83%E7%BB%A7%E6%89%BF%E4%BA%8E%20%60egg.Service%60%EF%BC%8C%E6%95%85%E6%8B%A5%E6%9C%89%E4%B8%8B%E5%88%97%E5%B1%9E%E6%80%A7%E6%96%B9%E4%BE%BF%E6%88%91%E4%BB%AC%E8%BF%9B%E8%A1%8C%E5%BC%80%E5%8F%91%EF%BC%9A%0A%0A-%20%60this.ctx%60%3A%20%E5%BD%93%E5%89%8D%E8%AF%B7%E6%B1%82%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87%20%5BContext%5D(.%2Fextend.md%23context)%20%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%9E%E4%BE%8B%EF%BC%8C%E9%80%9A%E8%BF%87%E5%AE%83%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E6%8B%BF%E5%88%B0%E6%A1%86%E6%9E%B6%E5%B0%81%E8%A3%85%E5%A5%BD%E7%9A%84%E5%A4%84%E7%90%86%E5%BD%93%E5%89%8D%E8%AF%B7%E6%B1%82%E7%9A%84%E5%90%84%E7%A7%8D%E4%BE%BF%E6%8D%B7%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95%E3%80%82%0A-%20%60this.app%60%3A%20%E5%BD%93%E5%89%8D%E5%BA%94%E7%94%A8%20%5BApplication%5D(.%2Fextend.md%23application)%20%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%9E%E4%BE%8B%EF%BC%8C%E9%80%9A%E8%BF%87%E5%AE%83%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E6%8B%BF%E5%88%B0%E6%A1%86%E6%9E%B6%E6%8F%90%E4%BE%9B%E7%9A%84%E5%85%A8%E5%B1%80%E5%AF%B9%E8%B1%A1%E5%92%8C%E6%96%B9%E6%B3%95%E3%80%82%0A-%20%60this.service%60%EF%BC%9A%E5%BA%94%E7%94%A8%E5%AE%9A%E4%B9%89%E7%9A%84%20%5BService%5D(.%2Fservice.md)%EF%BC%8C%E9%80%9A%E8%BF%87%E5%AE%83%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE%E5%88%B0%E5%85%B6%E4%BB%96%E4%B8%9A%E5%8A%A1%E5%B1%82%EF%BC%8C%E7%AD%89%E4%BB%B7%E4%BA%8E%20%60this.ctx.service%60%20%E3%80%82%0A-%20%60this.config%60%EF%BC%9A%E5%BA%94%E7%94%A8%E8%BF%90%E8%A1%8C%E6%97%B6%E7%9A%84%5B%E9%85%8D%E7%BD%AE%E9%A1%B9%5D(.%2Fconfig.md)%E3%80%82%0A-%20%60this.logger%60%EF%BC%9Alogger%20%E5%AF%B9%E8%B1%A1%EF%BC%8C%E4%B8%8A%E9%9D%A2%E6%9C%89%E5%9B%9B%E4%B8%AA%E6%96%B9%E6%B3%95%EF%BC%88%60debug%60%EF%BC%8C%60info%60%EF%BC%8C%60warn%60%EF%BC%8C%60error%60%EF%BC%89%EF%BC%8C%E5%88%86%E5%88%AB%E4%BB%A3%E8%A1%A8%E6%89%93%E5%8D%B0%E5%9B%9B%E4%B8%AA%E4%B8%8D%E5%90%8C%E7%BA%A7%E5%88%AB%E7%9A%84%E6%97%A5%E5%BF%97%EF%BC%8C%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E5%92%8C%E6%95%88%E6%9E%9C%E4%B8%8E%20%5Bcontext%20logger%5D(..%2Fcore%2Flogger.md%23context-logger)%20%E4%B8%AD%E4%BB%8B%E7%BB%8D%E7%9A%84%E4%B8%80%E6%A0%B7%EF%BC%8C%E4%BD%86%E6%98%AF%E9%80%9A%E8%BF%87%E8%BF%99%E4%B8%AA%20logger%20%E5%AF%B9%E8%B1%A1%E8%AE%B0%E5%BD%95%E7%9A%84%E6%97%A5%E5%BF%97%EF%BC%8C%E5%9C%A8%E6%97%A5%E5%BF%97%E5%89%8D%E9%9D%A2%E4%BC%9A%E5%8A%A0%E4%B8%8A%E6%89%93%E5%8D%B0%E8%AF%A5%E6%97%A5%E5%BF%97%E7%9A%84%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%EF%BC%8C%E4%BB%A5%E4%BE%BF%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E6%97%A5%E5%BF%97%E6%89%93%E5%8D%B0%E4%BD%8D%E7%BD%AE%E3%80%82%0A%0A%23%23%23%20Service%20ctx%20%E8%AF%A6%E8%A7%A3%0A%0A%E4%B8%BA%E4%BA%86%E5%8F%AF%E4%BB%A5%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E8%AF%B7%E6%B1%82%E7%9A%84%E9%93%BE%E8%B7%AF%EF%BC%8C%E6%88%91%E4%BB%AC%E5%9C%A8%20Service%20%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%AD%EF%BC%8C%E6%B3%A8%E5%85%A5%E4%BA%86%E8%AF%B7%E6%B1%82%E4%B8%8A%E4%B8%8B%E6%96%87%2C%20%E7%94%A8%E6%88%B7%E5%9C%A8%E6%96%B9%E6%B3%95%E4%B8%AD%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E9%80%9A%E8%BF%87%20%60this.ctx%60%20%E6%9D%A5%E8%8E%B7%E5%8F%96%E4%B8%8A%E4%B8%8B%E6%96%87%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%E3%80%82%E5%85%B3%E4%BA%8E%E4%B8%8A%E4%B8%8B%E6%96%87%E7%9A%84%E5%85%B7%E4%BD%93%E8%AF%A6%E8%A7%A3%E5%8F%AF%E4%BB%A5%E5%8F%82%E7%9C%8B%20%5BContext%5D(.%2Fextend.md%23context)%2C%0A%E6%9C%89%E4%BA%86%20ctx%20%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E6%8B%BF%E5%88%B0%E6%A1%86%E6%9E%B6%E7%BB%99%E6%88%91%E4%BB%AC%E5%B0%81%E8%A3%85%E7%9A%84%E5%90%84%E7%A7%8D%E4%BE%BF%E6%8D%B7%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95%E3%80%82%E6%AF%94%E5%A6%82%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E7%94%A8%EF%BC%9A%0A%0A-%20%60this.ctx.curl%60%20%E5%8F%91%E8%B5%B7%E7%BD%91%E7%BB%9C%E8%B0%83%E7%94%A8%E3%80%82%0A-%20%60this.ctx.service.otherService%60%20%E8%B0%83%E7%94%A8%E5%85%B6%E4%BB%96%20Service%E3%80%82%0A-%20%60this.ctx.db%60%20%E5%8F%91%E8%B5%B7%E6%95%B0%E6%8D%AE%E5%BA%93%E8%B0%83%E7%94%A8%E7%AD%89%EF%BC%8C%20db%20%E5%8F%AF%E8%83%BD%E6%98%AF%E5%85%B6%E4%BB%96%E6%8F%92%E4%BB%B6%E6%8F%90%E5%89%8D%E6%8C%82%E8%BD%BD%E5%88%B0%20app%20%E4%B8%8A%E7%9A%84%E6%A8%A1%E5%9D%97%E3%80%82%0A%0A%23%23%23%20%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%0A%0A-%20Service%20%E6%96%87%E4%BB%B6%E5%BF%85%E9%A1%BB%E6%94%BE%E5%9C%A8%20%60app%2Fservice%60%20%E7%9B%AE%E5%BD%95%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%94%AF%E6%8C%81%E5%A4%9A%E7%BA%A7%E7%9B%AE%E5%BD%95%EF%BC%8C%E8%AE%BF%E9%97%AE%E7%9A%84%E6%97%B6%E5%80%99%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E7%9B%AE%E5%BD%95%E5%90%8D%E7%BA%A7%E8%81%94%E8%AE%BF%E9%97%AE%E3%80%82%0A%0A%20%20%60%60%60js%0A%20%20app%2Fservice%2Fbiz%2Fuser.js%20%3D%3E%20ctx.service.biz.user%0A%20%20app%2Fservice%2Fsync_user.js%20%3D%3E%20ctx.service.syncUser%0A%20%20app%2Fservice%2FHackerNews.js%20%3D%3E%20ctx.service.hackerNews%0A%20%20%60%60%60%0A%0A-%20%E4%B8%80%E4%B8%AA%20Service%20%E6%96%87%E4%BB%B6%E5%8F%AA%E8%83%BD%E5%8C%85%E5%90%AB%E4%B8%80%E4%B8%AA%E7%B1%BB%EF%BC%8C%20%E8%BF%99%E4%B8%AA%E7%B1%BB%E9%9C%80%E8%A6%81%E9%80%9A%E8%BF%87%20%60module.exports%60%20%E7%9A%84%E6%96%B9%E5%BC%8F%E8%BF%94%E5%9B%9E%E3%80%82%0A-%20Service%20%E9%9C%80%E8%A6%81%E9%80%9A%E8%BF%87%20Class%20%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AE%9A%E4%B9%89%EF%BC%8C%E7%88%B6%E7%B1%BB%E5%BF%85%E9%A1%BB%E6%98%AF%20%60egg.Service%60%E3%80%82%0A-%20Service%20%E4%B8%8D%E6%98%AF%E5%8D%95%E4%BE%8B%EF%BC%8C%E6%98%AF%20**%E8%AF%B7%E6%B1%82%E7%BA%A7%E5%88%AB**%20%E7%9A%84%E5%AF%B9%E8%B1%A1%EF%BC%8C%E6%A1%86%E6%9E%B6%E5%9C%A8%E6%AF%8F%E6%AC%A1%E8%AF%B7%E6%B1%82%E4%B8%AD%E9%A6%96%E6%AC%A1%E8%AE%BF%E9%97%AE%20%60ctx.service.xx%60%20%E6%97%B6%E5%BB%B6%E8%BF%9F%E5%AE%9E%E4%BE%8B%E5%8C%96%EF%BC%8C%E6%89%80%E4%BB%A5%20Service%20%E4%B8%AD%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20this.ctx%20%E8%8E%B7%E5%8F%96%E5%88%B0%E5%BD%93%E5%89%8D%E8%AF%B7%E6%B1%82%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%82%0A%0A%23%23%20%E4%BD%BF%E7%94%A8%20Service%0A%0A%E4%B8%8B%E9%9D%A2%E5%B0%B1%E9%80%9A%E8%BF%87%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E7%9A%84%E4%BE%8B%E5%AD%90%EF%BC%8C%E7%9C%8B%E7%9C%8B%E6%80%8E%E4%B9%88%E4%BD%BF%E7%94%A8%20Service%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20app%2Frouter.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20app.router.get('%2Fuser%2F%3Aid'%2C%20app.controller.user.info)%3B%0A%7D%3B%0A%0A%2F%2F%20app%2Fcontroller%2Fuser.js%0Aconst%20Controller%20%3D%20require('egg').Controller%3B%0Aclass%20UserController%20extends%20Controller%20%7B%0A%20%20async%20info()%20%7B%0A%20%20%20%20const%20userId%20%3D%20ctx.params.id%3B%0A%20%20%20%20const%20userInfo%20%3D%20await%20ctx.service.user.find(userId)%3B%0A%20%20%20%20ctx.body%20%3D%20userInfo%3B%0A%20%20%7D%0A%7D%0Amodule.exports%20%3D%20UserController%3B%0A%0A%2F%2F%20app%2Fservice%2Fuser.js%0Aconst%20Service%20%3D%20require('egg').Service%3B%0Aclass%20UserService%20extends%20Service%20%7B%0A%20%20%2F%2F%20%E9%BB%98%E8%AE%A4%E4%B8%8D%E9%9C%80%E8%A6%81%E6%8F%90%E4%BE%9B%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E3%80%82%0A%20%20%2F%2F%20constructor(ctx)%20%7B%0A%20%20%2F%2F%20%20%20super(ctx)%3B%20%E5%A6%82%E6%9E%9C%E9%9C%80%E8%A6%81%E5%9C%A8%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E5%81%9A%E4%B8%80%E4%BA%9B%E5%A4%84%E7%90%86%EF%BC%8C%E4%B8%80%E5%AE%9A%E8%A6%81%E6%9C%89%E8%BF%99%E5%8F%A5%E8%AF%9D%EF%BC%8C%E6%89%8D%E8%83%BD%E4%BF%9D%E8%AF%81%E5%90%8E%E9%9D%A2%20%60this.ctx%60%E7%9A%84%E4%BD%BF%E7%94%A8%E3%80%82%0A%20%20%2F%2F%20%20%20%2F%2F%20%E5%B0%B1%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E9%80%9A%E8%BF%87%20this.ctx%20%E8%8E%B7%E5%8F%96%20ctx%20%E4%BA%86%0A%20%20%2F%2F%20%20%20%2F%2F%20%E8%BF%98%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E9%80%9A%E8%BF%87%20this.app%20%E8%8E%B7%E5%8F%96%20app%20%E4%BA%86%0A%20%20%2F%2F%20%7D%0A%20%20async%20find(uid)%20%7B%0A%20%20%20%20%2F%2F%20%E5%81%87%E5%A6%82%20%E6%88%91%E4%BB%AC%E6%8B%BF%E5%88%B0%E7%94%A8%E6%88%B7%20id%20%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF%0A%20%20%20%20const%20user%20%3D%20await%20this.ctx.db.query('select%20*%20from%20user%20where%20uid%20%3D%20%3F'%2C%20uid)%3B%0A%0A%20%20%20%20%2F%2F%20%E5%81%87%E5%AE%9A%E8%BF%99%E9%87%8C%E8%BF%98%E6%9C%89%E4%B8%80%E4%BA%9B%E5%A4%8D%E6%9D%82%E7%9A%84%E8%AE%A1%E7%AE%97%EF%BC%8C%E7%84%B6%E5%90%8E%E8%BF%94%E5%9B%9E%E9%9C%80%E8%A6%81%E7%9A%84%E4%BF%A1%E6%81%AF%E3%80%82%0A%20%20%20%20const%20picture%20%3D%20await%20this.getPicture(uid)%3B%0A%0A%20%20%20%20return%20%7B%0A%20%20%20%20%20%20name%3A%20user.user_name%2C%0A%20%20%20%20%20%20age%3A%20user.age%2C%0A%20%20%20%20%20%20picture%2C%0A%20%20%20%20%7D%3B%0A%20%20%7D%0A%0A%20%20async%20getPicture(uid)%20%7B%0A%20%20%20%20const%20result%20%3D%20await%20this.ctx.curl(%60http%3A%2F%2Fphotoserver%2Fuid%3D%24%7Buid%7D%60%2C%20%7B%20dataType%3A%20'json'%20%7D)%3B%0A%20%20%20%20return%20result.data%3B%0A%20%20%7D%0A%7D%0Amodule.exports%20%3D%20UserService%3B%0A%0A%2F%2F%20curl%20http%3A%2F%2F127.0.0.1%3A7001%2Fuser%2F1234%0A%60%60%60%0A"}}</script><script type="text/javascript" src="/static/js/post.b9faab88.js"></script></body></html>