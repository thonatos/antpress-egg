<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.png"><style class="_styletron_hydrate_"></style><title>框架内置基础对象</title><meta name="description" content="Born to build better enterprise frameworks and apps"><link href="/static/css/post.d62265dc.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="ant-layout" data-reactroot=""><div class="header-module__header___3ADJ9 ant-layout-header"><div class="ant-row-flex"><div class="ant-col-xs-12 ant-col-md-20 ant-col-lg-2"><div class="header-module__logo___3yTXp"><a href="/"><img src="/logo.svg" alt="logo"/></a></div></div><div class="ant-col-xs-0 ant-col-md-0 ant-col-lg-20"><ul class="ant-menu header-module__menu___3yEtW ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/intro/">指南</a></li><li class="ant-menu-item" role="menuitem"><a href="/api/">API</a></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/tutorials/index.html">教程</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/search?q=topic%3Aegg-plugin&amp;type=Repositories">插件</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/eggjs/egg/releases">发布日志</a></li></ul></div><div style="text-align:right" class="ant-col-xs-12 ant-col-md-4 ant-col-lg-2"><button type="button" class="ant-btn"><span>Languages</span></button></div></div></div><div class="ant-layout-content"><div class="basic_layout-module__content___3flpY ant-layout"><div class="sider-module__side___1Cadj ant-layout-sider ant-layout-sider-light" style="flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"><ul class="ant-menu sider-module__menu___2GqPr ant-menu-light ant-menu-root ant-menu-inline" role="menu"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="0$Menu" aria-haspopup="true"><span>新手指南</span><i class="ant-menu-submenu-arrow"></i></div><ul id="0$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/index.html">Egg.js 是什么?</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/egg-and-koa.html">Egg.js 和 Koa</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/quickstart.html">快速入门</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/progressive.html">渐进式开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/migration.html">2.x 升级指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="1$Menu" aria-haspopup="true"><span>基础功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="1$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/structure.html">目录结构</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/objects.html">内置对象</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/env.html">运行环境</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/config.html">配置</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/middleware.html">中间件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/router.html">Router</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/controller.html">Controller</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/service.html">Service</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/plugin.html">插件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/schedule.html">定时任务</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/extend.html">框架扩展</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/app-start.html">启动自定义</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="2$Menu" aria-haspopup="true"><span>核心功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="2$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/development.html">本地开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/unittest.html">单元测试</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/deployment.html">应用部署</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/logger.html">日志</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/httpclient.html">HttpClient</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cookie-and-session.html">Cookie and Session</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cluster-and-ipc.html">多进程模型和进程间通讯</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/view.html">模板渲染</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/error-handling.html">异常处理</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/security.html">安全</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/i18n.html">国际化</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="3$Menu" aria-haspopup="true"><span>教程</span><i class="ant-menu-submenu-arrow"></i></div><ul id="3$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/mysql.html">MySQL</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/restful.html">RESTful API</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/passport.html">Passport 鉴权</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/socketio.html">Socket.IO</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/assets.html">静态资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/typescript.html">TypeScript</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="4$Menu" aria-haspopup="true"><span>进阶</span><i class="ant-menu-submenu-arrow"></i></div><ul id="4$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/loader.html">Loader</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/plugin.html">插件开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/framework.html">框架开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/cluster-client.html">多进程研发模式增强</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/view-plugin.html">模板插件开发规范</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/style-guide.html">代码风格指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="5$Menu" aria-haspopup="true"><span>社区</span><i class="ant-menu-submenu-arrow"></i></div><ul id="5$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/plugins/">内置插件列表</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/contributing.html">如何贡献</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/resource.html">资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/faq.html">常见问题</a></li></ul></li></ul></div></div><div class="basic_layout-module__post___2Z7KK ant-layout-content"><div class="ant-row" style="margin-left:-8px;margin-right:-8px"><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-24 ant-col-md-18"><div class="markdown-body" style="font-size:14px"><div><p>在本章，我们会初步介绍一下框架中内置的一些基础对象，包括从 <a href="http://koajs.com">Koa</a> 继承而来的 4 个对象（Application, Context, Request, Response) 以及框架扩展的一些对象（Controller, Service, Helper, Config, Logger），在后续的文档阅读中我们会经常遇到它们。</p><h2 id="application">Application</h2><p>Application 是全局应用对象，在一个应用中，只会实例化一个，它继承自 <a href="http://koajs.com/#application">Koa.Application</a>，在它上面我们可以挂载一些全局的方法和对象。我们可以轻松的在插件或者应用中<a href="./extend.md#Application">扩展 Application 对象</a>。</p><h3 id="事件">事件</h3><p>在框架运行时，会在 Application 实例上触发一些事件，应用开发者或者插件开发者可以监听这些事件做一些操作。作为应用开发者，我们一般会在<a href="./app-start.md">启动自定义脚本</a>中进行监听。</p><ul><li><code>server</code>: 该事件一个 worker 进程只会触发一次，在 HTTP 服务完成启动后，会将 HTTP server 通过这个事件暴露出来给开发者。</li><li><code>error</code>: 运行时有任何的异常被 onerror 插件捕获后，都会触发 <code>error</code> 事件，将错误对象和关联的上下文（如果有）暴露给开发者，可以进行自定义的日志记录上报等处理。</li><li><code>request</code> 和 <code>response</code>: 应用收到请求和响应请求时，分别会触发 <code>request</code> 和 <code>response</code> 事件，并将当前请求上下文暴露出来，开发者可以监听这两个事件来进行日志记录。</li></ul><pre><code class="language-js">// app.js

module.exports = app =&gt; {
  app.once(&#x27;server&#x27;, server =&gt; {
    // websocket
  });
  app.on(&#x27;error&#x27;, (err, ctx) =&gt; {
    // report error
  });
  app.on(&#x27;request&#x27;, ctx =&gt; {
    // log receive request
  });
  app.on(&#x27;response&#x27;, ctx =&gt; {
    // ctx.starttime is set by framework
    const used = Date.now() - ctx.starttime;
    // log total cost
  });
};</code></pre><h3 id="获取方式">获取方式</h3><p>Application 对象几乎可以在编写应用时的任何一个地方获取到，下面介绍几个经常用到的获取方式：</p><p>几乎所有被框架 <a href="../advanced/loader.md">Loader</a> 加载的文件（Controller，Service，Schedule 等），都可以 export 一个函数，这个函数会被 Loader 调用，并使用 app 作为参数：</p><ul><li><p><a href="./app-start.md">启动自定义脚本</a></p><pre><code class="language-js">// app.js
module.exports = app =&gt; {
  app.cache = new Cache();
};</code></pre></li><li><p><a href="./controller.md">Controller 文件</a></p><pre><code class="language-js">// app/controller/user.js
class UserController extends Controller {
  async fetch() {
    this.ctx.body = app.cache.get(this.ctx.query.id);
  }
}</code></pre></li></ul><p>和 <a href="http://koajs.com">Koa</a> 一样，在 Context 对象上，可以通过 <code>ctx.app</code> 访问到 Application 对象。以上面的 Controller 文件举例：</p><pre><code class="language-js">// app/controller/user.js
class UserController extends Controller {
  async fetch() {
    this.ctx.body = this.ctx.app.cache.get(this.ctx.query.id);
  }
}</code></pre><p>在继承于 Controller, Service 基类的实例中，可以通过 <code>this.app</code> 访问到 Application 对象。</p><pre><code class="language-js">// app/controller/user.js
class UserController extends Controller {
  async fetch() {
    this.ctx.body = this.app.cache.get(this.ctx.query.id);
  }
};</code></pre><h2 id="context">Context</h2><p>Context 是一个<strong>请求级别的对象</strong>，继承自 <a href="http://koajs.com/#context">Koa.Context</a>。在每一次收到用户请求时，框架会实例化一个 Context 对象，这个对象封装了这次用户请求的信息，并提供了许多便捷的方法来获取请求参数或者设置响应信息。框架会将所有的 <a href="./service.md">Service</a> 挂载到 Context 实例上，一些插件也会将一些其他的方法和对象挂载到它上面（<a href="https://github.com/eggjs/egg-sequelize">egg-sequelize</a> 会将所有的 model 挂载在 Context 上）。</p><h3 id="获取方式">获取方式</h3><p>最常见的 Context 实例获取方式是在 <a href="./middleware.md">Middleware</a>, <a href="./controller.md">Controller</a> 以及 <a href="./service.md">Service</a> 中。Controller 中的获取方式在上面的例子中已经展示过了，在 Service 中获取和 Controller 中获取的方式一样，在 Middleware 中获取 Context 实例则和 <a href="http://koajs.com">Koa</a> 框架在中间件中获取 Context 对象的方式一致。</p><p>框架的 <a href="./middleware.md">Middleware</a> 同时支持 Koa v1 和 Koa v2 两种不同的中间件写法，根据不同的写法，获取 Context 实例的方式也稍有不同：</p><pre><code class="language-js">// Koa v1
function* middleware(next) {
  // this is instance of Context
  console.log(this.query);
  yield next;
}

// Koa v2
async function middleware(ctx, next) {
  // ctx is instance of Context
  console.log(ctx.query);
}</code></pre><p>除了在请求时可以获取 Context 实例之外， 在有些非用户请求的场景下我们需要访问 service / model 等 Context 实例上的对象，我们可以通过 <code>Application.createAnonymousContext()</code> 方法创建一个匿名 Context 实例：</p><pre><code class="language-js">// app.js
module.exports = app =&gt; {
  app.beforeStart(async () =&gt; {
    const ctx = app.createAnonymousContext();
    // preload before app start
    await ctx.service.posts.load();
  });
}</code></pre><p>在<a href="./schedule.md">定时任务</a>中的每一个 task 都接受一个 Context 实例作为参数，以便我们更方便的执行一些定时的业务逻辑：</p><pre><code class="language-js">// app/schedule/refresh.js
exports.task = async ctx =&gt; {
  await ctx.service.posts.refresh();
};</code></pre><h2 id="request-response">Request &amp; Response</h2><p>Request 是一个<strong>请求级别的对象</strong>，继承自 <a href="http://koajs.com/#request">Koa.Request</a>。封装了 Node.js 原生的 HTTP Request 对象，提供了一系列辅助方法获取 HTTP 请求常用参数。</p><p>Response 是一个<strong>请求级别的对象</strong>，继承自 <a href="http://koajs.com/#response">Koa.Response</a>。封装了 Node.js 原生的 HTTP Response 对象，提供了一系列辅助方法设置 HTTP 响应。</p><h3 id="获取方式">获取方式</h3><p>可以在 Context 的实例上获取到当前请求的 Request(<code>ctx.request</code>) 和 Response(<code>ctx.response</code>) 实例。</p><pre><code class="language-js">// app/controller/user.js
class UserController extends Controller {
  async fetch() {
    const { app, ctx } = this;
    const id = ctx.request.query.id;
    ctx.response.body = app.cache.get(id);
  }
}</code></pre><ul><li><a href="http://koajs.com">Koa</a> 会在 Context 上代理一部分 Request 和 Response 上的方法和属性，参见 <a href="http://koajs.com/#context">Koa.Context</a>。</li><li>如上面例子中的 <code>ctx.request.query.id</code> 和 <code>ctx.query.id</code> 是等价的，<code>ctx.response.body=</code> 和 <code>ctx.body=</code> 是等价的。</li><li>需要注意的是，获取 POST 的 body 应该使用 <code>ctx.request.body</code>，而不是 <code>ctx.body</code>。</li></ul><h2 id="controller">Controller</h2><p>框架提供了一个 Controller 基类，并推荐所有的 <a href="./controller.md">Controller</a> 都继承于该基类实现。这个 Controller 基类有下列属性：</p><ul><li><code>ctx</code> - 当前请求的 <a href="#context">Context</a> 实例。</li><li><code>app</code> - 应用的 <a href="#application">Application</a> 实例。</li><li><code>config</code> - 应用的<a href="./config.md">配置</a>。</li><li><code>service</code> - 应用所有的 <a href="./service.md">service</a>。</li><li><code>logger</code> - 为当前 controller 封装的 logger 对象。</li></ul><p>在 Controller 文件中，可以通过两种方式来引用 Controller 基类：</p><pre><code class="language-js">// app/controller/user.js

// 从 egg 上获取（推荐）
const Controller = require(&#x27;egg&#x27;).Controller;
class UserController extends Controller {
  // implement
}
module.exports = UserController;

// 从 app 实例上获取
module.exports = app =&gt; {
  return class UserController extends app.Controller {
    // implement
  };
};</code></pre><h2 id="service">Service</h2><p>框架提供了一个 Service 基类，并推荐所有的 <a href="./service.md">Service</a> 都继承于该基类实现。</p><p>Service 基类的属性和 <a href="#controller">Controller</a> 基类属性一致，访问方式也类似：</p><pre><code class="language-js">// app/service/user.js

// 从 egg 上获取（推荐）
const Service = require(&#x27;egg&#x27;).Service;
class UserService extends Service {
  // implement
}
module.exports = UserService;

// 从 app 实例上获取
module.exports = app =&gt; {
  return class UserService extends app.Service {
    // implement
  };
};</code></pre><h2 id="helper">Helper</h2><p>Helper 用来提供一些实用的 utility 函数。它的作用在于我们可以将一些常用的动作抽离在 helper.js 里面成为一个独立的函数，这样可以用 JavaScript 来写复杂的逻辑，避免逻辑分散各处，同时可以更好的编写测试用例。</p><p>Helper 自身是一个类，有和 <a href="#controller">Controller</a> 基类一样的属性，它也会在每次请求时进行实例化，因此 Helper 上的所有函数也能获取到当前请求相关的上下文信息。</p><h3 id="获取方式">获取方式</h3><p>可以在 Context 的实例上获取到当前请求的 Helper(<code>ctx.helper</code>) 实例。</p><pre><code class="language-js">// app/controller/user.js
class UserController extends Controller {
  async fetch() {
    const { app, ctx } = this;
    const id = ctx.query.id;
    const user = app.cache.get(id);
    ctx.body = ctx.helper.formatUser(user);
  }
}</code></pre><p>除此之外，Helper 的实例还可以在模板中获取到，例如可以在模板中获取到 <a href="../core/security.md">security</a> 插件提供的 <code>shtml</code> 方法。</p><pre><code>// app/view/home.nj
{{ helper.shtml(value) }}</code></pre><h3 id="自定义-helper-方法">自定义 helper 方法</h3><p>应用开发中，我们可能经常要自定义一些 helper 方法，例如上面例子中的 <code>formatUser</code>，我们可以通过<a href="./extend.md#helper">框架扩展</a>的形式来自定义 helper 方法。</p><pre><code class="language-js">// app/extend/helper.js
module.exports = {
  formatUser(user) {
    return only(user, [ &#x27;name&#x27;, &#x27;phone&#x27; ]);
  }
};</code></pre><h2 id="config">Config</h2><p>我们推荐应用开发遵循配置和代码分离的原则，将一些需要硬编码的业务配置都放到配置文件中，同时配置文件支持各个不同的运行环境使用不同的配置，使用起来也非常方便，所有框架、插件和应用级别的配置都可以通过 Config 对象获取到，关于框架的配置，可以详细阅读 <a href="./config.md">Config 配置</a>章节。</p><h3 id="获取方式">获取方式</h3><p>我们可以通过 <code>app.config</code> 从 Application 实例上获取到 config 对象，也可以在 Controller, Service, Helper 的实例上通过 <code>this.config</code> 获取到 config 对象。</p><h2 id="logger">Logger</h2><p>框架内置了功能强大的<a href="../core/logger.md">日志功能</a>，可以非常方便的打印各种级别的日志到对应的日志文件中，每一个 logger 对象都提供了 5 个级别的方法：</p><ul><li><code>logger.debug()</code></li><li><code>logger.info()</code></li><li><code>logger.warn()</code></li><li><code>logger.error()</code></li></ul><p>在框架中提供了多个 Logger 对象，下面我们简单的介绍一下各个 Logger 对象的获取方式和使用场景。</p><h3 id="app-logger">App Logger</h3><p>我们可以通过 <code>app.logger</code> 来获取到它，如果我们想做一些应用级别的日志记录，如记录启动阶段的一些数据信息，记录一些业务上与请求无关的信息，都可以通过 App Logger 来完成。</p><h3 id="app-corelogger">App CoreLogger</h3><p>我们可以通过 <code>app.coreLogger</code> 来获取到它，一般我们在开发应用时都不应该通过 CoreLogger 打印日志，而框架和插件则需要通过它来打印应用级别的日志，这样可以更清晰的区分应用和框架打印的日志，通过 CoreLogger 打印的日志会放到和 Logger 不同的文件中。</p><h3 id="context-logger">Context Logger</h3><p>我们可以通过 <code>ctx.logger</code> 从 Context 实例上获取到它，从访问方式上我们可以看出来，Context Logger 一定是与请求相关的，它打印的日志都会在前面带上一些当前请求相关的信息（如 <code>[$userId/$ip/$traceId/${cost}ms $method $url]</code>），通过这些信息，我们可以从日志快速定位请求，并串联一次请求中的所有的日志。</p><h3 id="context-corelogger">Context CoreLogger</h3><p>我们可以通过 <code>ctx.coreLogger</code> 获取到它，和 Context Logger 的区别是一般只有插件和框架会通过它来记录日志。</p><h3 id="controller-logger-service-logger">Controller Logger &amp; Service Logger</h3><p>我们可以在 Controller 和 Service 实例上通过 <code>this.logger</code> 获取到它们，它们本质上就是一个 Context Logger，不过在打印日志的时候还会额外的加上文件路径，方便定位日志的打印位置。</p><h2 id="subscription">Subscription</h2><p>订阅模型是一种比较常见的开发模式，譬如消息中间件的消费者或调度任务。因此我们提供了 Subscription 基类来规范化这个模式。</p><p>可以通过以下方式来引用 Subscription 基类：</p><pre><code class="language-js">const Subscription = require(&#x27;egg&#x27;).Subscription;

class Schedule extends Subscription {
  // 需要实现此方法
  // subscribe 可以为 async function 或 generator function
  async subscribe() {}
}</code></pre><p>插件开发者可以根据自己的需求基于它定制订阅规范，如<a href="./schedule.md">定时任务</a>就是使用这种规范实现的。</p></div></div></div><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-0 ant-col-md-6"><div class="markdown-body" style="font-size:14px"><div><ul><li><a href="#application">Application</a><ul><li><a href="#%E4%BA%8B%E4%BB%B6">事件</a></li><li><a href="#%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F">获取方式</a></li></ul></li><li><a href="#context">Context</a><ul><li><a href="#%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F">获取方式</a></li></ul></li><li><a href="#request-response">Request &amp; Response</a><ul><li><a href="#%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F">获取方式</a></li></ul></li><li><a href="#controller">Controller</a></li><li><a href="#service">Service</a></li><li><a href="#helper">Helper</a><ul><li><a href="#%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F">获取方式</a></li><li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89-helper-%E6%96%B9%E6%B3%95">自定义 helper 方法</a></li></ul></li><li><a href="#config">Config</a><ul><li><a href="#%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F">获取方式</a></li></ul></li><li><a href="#logger">Logger</a><ul><li><a href="#app-logger">App Logger</a></li><li><a href="#app-corelogger">App CoreLogger</a></li><li><a href="#context-logger">Context Logger</a></li><li><a href="#context-corelogger">Context CoreLogger</a></li><li><a href="#controller-logger-service-logger">Controller Logger &amp; Service Logger</a></li></ul></li><li><a href="#subscription">Subscription</a></li></ul></div></div></div></div></div></div></div></div></div><script type="text/javascript">window.__INIT_STATE__={"lang":"zh","props":{"toc":"-%20%5BApplication%5D(%23application)%0A%20%20*%20%5B%E4%BA%8B%E4%BB%B6%5D(%23%25E4%25BA%258B%25E4%25BB%25B6)%0A%20%20*%20%5B%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F%5D(%23%25E8%258E%25B7%25E5%258F%2596%25E6%2596%25B9%25E5%25BC%258F)%0A-%20%5BContext%5D(%23context)%0A%20%20*%20%5B%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F%5D(%23%25E8%258E%25B7%25E5%258F%2596%25E6%2596%25B9%25E5%25BC%258F)%0A-%20%5BRequest%20%26%20Response%5D(%23request-response)%0A%20%20*%20%5B%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F%5D(%23%25E8%258E%25B7%25E5%258F%2596%25E6%2596%25B9%25E5%25BC%258F)%0A-%20%5BController%5D(%23controller)%0A-%20%5BService%5D(%23service)%0A-%20%5BHelper%5D(%23helper)%0A%20%20*%20%5B%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F%5D(%23%25E8%258E%25B7%25E5%258F%2596%25E6%2596%25B9%25E5%25BC%258F)%0A%20%20*%20%5B%E8%87%AA%E5%AE%9A%E4%B9%89%20helper%20%E6%96%B9%E6%B3%95%5D(%23%25E8%2587%25AA%25E5%25AE%259A%25E4%25B9%2589-helper-%25E6%2596%25B9%25E6%25B3%2595)%0A-%20%5BConfig%5D(%23config)%0A%20%20*%20%5B%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F%5D(%23%25E8%258E%25B7%25E5%258F%2596%25E6%2596%25B9%25E5%25BC%258F)%0A-%20%5BLogger%5D(%23logger)%0A%20%20*%20%5BApp%20Logger%5D(%23app-logger)%0A%20%20*%20%5BApp%20CoreLogger%5D(%23app-corelogger)%0A%20%20*%20%5BContext%20Logger%5D(%23context-logger)%0A%20%20*%20%5BContext%20CoreLogger%5D(%23context-corelogger)%0A%20%20*%20%5BController%20Logger%20%26%20Service%20Logger%5D(%23controller-logger-service-logger)%0A-%20%5BSubscription%5D(%23subscription)","meta":{"info":{"title":"框架内置基础对象"}},"content":"%0A%0A%0A%E5%9C%A8%E6%9C%AC%E7%AB%A0%EF%BC%8C%E6%88%91%E4%BB%AC%E4%BC%9A%E5%88%9D%E6%AD%A5%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B%E6%A1%86%E6%9E%B6%E4%B8%AD%E5%86%85%E7%BD%AE%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9F%BA%E7%A1%80%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%8C%85%E6%8B%AC%E4%BB%8E%20%5BKoa%5D%20%E7%BB%A7%E6%89%BF%E8%80%8C%E6%9D%A5%E7%9A%84%204%20%E4%B8%AA%E5%AF%B9%E8%B1%A1%EF%BC%88Application%2C%20Context%2C%20Request%2C%20Response)%20%E4%BB%A5%E5%8F%8A%E6%A1%86%E6%9E%B6%E6%89%A9%E5%B1%95%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AF%B9%E8%B1%A1%EF%BC%88Controller%2C%20Service%2C%20Helper%2C%20Config%2C%20Logger%EF%BC%89%EF%BC%8C%E5%9C%A8%E5%90%8E%E7%BB%AD%E7%9A%84%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB%E4%B8%AD%E6%88%91%E4%BB%AC%E4%BC%9A%E7%BB%8F%E5%B8%B8%E9%81%87%E5%88%B0%E5%AE%83%E4%BB%AC%E3%80%82%0A%0A%23%23%20Application%0A%0AApplication%20%E6%98%AF%E5%85%A8%E5%B1%80%E5%BA%94%E7%94%A8%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%9C%A8%E4%B8%80%E4%B8%AA%E5%BA%94%E7%94%A8%E4%B8%AD%EF%BC%8C%E5%8F%AA%E4%BC%9A%E5%AE%9E%E4%BE%8B%E5%8C%96%E4%B8%80%E4%B8%AA%EF%BC%8C%E5%AE%83%E7%BB%A7%E6%89%BF%E8%87%AA%20%5BKoa.Application%5D%EF%BC%8C%E5%9C%A8%E5%AE%83%E4%B8%8A%E9%9D%A2%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E6%8C%82%E8%BD%BD%E4%B8%80%E4%BA%9B%E5%85%A8%E5%B1%80%E7%9A%84%E6%96%B9%E6%B3%95%E5%92%8C%E5%AF%B9%E8%B1%A1%E3%80%82%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E8%BD%BB%E6%9D%BE%E7%9A%84%E5%9C%A8%E6%8F%92%E4%BB%B6%E6%88%96%E8%80%85%E5%BA%94%E7%94%A8%E4%B8%AD%5B%E6%89%A9%E5%B1%95%20Application%20%E5%AF%B9%E8%B1%A1%5D(.%2Fextend.md%23Application)%E3%80%82%0A%0A%23%23%23%20%E4%BA%8B%E4%BB%B6%0A%0A%E5%9C%A8%E6%A1%86%E6%9E%B6%E8%BF%90%E8%A1%8C%E6%97%B6%EF%BC%8C%E4%BC%9A%E5%9C%A8%20Application%20%E5%AE%9E%E4%BE%8B%E4%B8%8A%E8%A7%A6%E5%8F%91%E4%B8%80%E4%BA%9B%E4%BA%8B%E4%BB%B6%EF%BC%8C%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E8%80%85%E6%88%96%E8%80%85%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E8%80%85%E5%8F%AF%E4%BB%A5%E7%9B%91%E5%90%AC%E8%BF%99%E4%BA%9B%E4%BA%8B%E4%BB%B6%E5%81%9A%E4%B8%80%E4%BA%9B%E6%93%8D%E4%BD%9C%E3%80%82%E4%BD%9C%E4%B8%BA%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E8%80%85%EF%BC%8C%E6%88%91%E4%BB%AC%E4%B8%80%E8%88%AC%E4%BC%9A%E5%9C%A8%5B%E5%90%AF%E5%8A%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E8%84%9A%E6%9C%AC%5D(.%2Fapp-start.md)%E4%B8%AD%E8%BF%9B%E8%A1%8C%E7%9B%91%E5%90%AC%E3%80%82%0A%0A-%20%60server%60%3A%20%08%E8%AF%A5%E4%BA%8B%E4%BB%B6%E4%B8%80%E4%B8%AA%20worker%20%E8%BF%9B%E7%A8%8B%E5%8F%AA%E4%BC%9A%E8%A7%A6%E5%8F%91%E4%B8%80%E6%AC%A1%EF%BC%8C%E5%9C%A8%20HTTP%20%E6%9C%8D%E5%8A%A1%E5%AE%8C%E6%88%90%E5%90%AF%E5%8A%A8%E5%90%8E%EF%BC%8C%E4%BC%9A%E5%B0%86%20HTTP%20server%20%E9%80%9A%E8%BF%87%E8%BF%99%E4%B8%AA%E4%BA%8B%E4%BB%B6%E6%9A%B4%E9%9C%B2%E5%87%BA%E6%9D%A5%E7%BB%99%E5%BC%80%E5%8F%91%E8%80%85%E3%80%82%0A-%20%60error%60%3A%20%E8%BF%90%E8%A1%8C%E6%97%B6%E6%9C%89%E4%BB%BB%E4%BD%95%E7%9A%84%E5%BC%82%E5%B8%B8%E8%A2%AB%20onerror%20%E6%8F%92%E4%BB%B6%E6%8D%95%E8%8E%B7%E5%90%8E%EF%BC%8C%E9%83%BD%E4%BC%9A%E8%A7%A6%E5%8F%91%20%60error%60%20%E4%BA%8B%E4%BB%B6%EF%BC%8C%E5%B0%86%E9%94%99%E8%AF%AF%E5%AF%B9%E8%B1%A1%E5%92%8C%E5%85%B3%E8%81%94%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87%EF%BC%88%E5%A6%82%E6%9E%9C%E6%9C%89%EF%BC%89%E6%9A%B4%E9%9C%B2%E7%BB%99%E5%BC%80%E5%8F%91%E8%80%85%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%BF%9B%E8%A1%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E4%B8%8A%E6%8A%A5%E7%AD%89%E5%A4%84%E7%90%86%E3%80%82%0A-%20%60request%60%20%E5%92%8C%20%60response%60%3A%20%E5%BA%94%E7%94%A8%E6%94%B6%E5%88%B0%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94%E8%AF%B7%E6%B1%82%E6%97%B6%EF%BC%8C%E5%88%86%E5%88%AB%E4%BC%9A%E8%A7%A6%E5%8F%91%20%60request%60%20%E5%92%8C%20%60response%60%20%E4%BA%8B%E4%BB%B6%EF%BC%8C%E5%B9%B6%E5%B0%86%E5%BD%93%E5%89%8D%E8%AF%B7%E6%B1%82%E4%B8%8A%E4%B8%8B%E6%96%87%E6%9A%B4%E9%9C%B2%E5%87%BA%E6%9D%A5%EF%BC%8C%E5%BC%80%E5%8F%91%E8%80%85%E5%8F%AF%E4%BB%A5%E7%9B%91%E5%90%AC%E8%BF%99%E4%B8%A4%E4%B8%AA%E4%BA%8B%E4%BB%B6%E6%9D%A5%E8%BF%9B%E8%A1%8C%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20app.js%0A%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20app.once('server'%2C%20server%20%3D%3E%20%7B%0A%20%20%20%20%2F%2F%20websocket%0A%20%20%7D)%3B%0A%20%20app.on('error'%2C%20(err%2C%20ctx)%20%3D%3E%20%7B%0A%20%20%20%20%2F%2F%20report%20error%0A%20%20%7D)%3B%0A%20%20app.on('request'%2C%20ctx%20%3D%3E%20%7B%0A%20%20%20%20%2F%2F%20log%20receive%20request%0A%20%20%7D)%3B%0A%20%20app.on('response'%2C%20ctx%20%3D%3E%20%7B%0A%20%20%20%20%2F%2F%20ctx.starttime%20is%20set%20by%20framework%0A%20%20%20%20const%20used%20%3D%20Date.now()%20-%20ctx.starttime%3B%0A%20%20%20%20%2F%2F%20log%20total%20cost%0A%20%20%7D)%3B%0A%7D%3B%0A%60%60%60%0A%0A%23%23%23%20%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F%0A%0AApplication%20%E5%AF%B9%E8%B1%A1%E5%87%A0%E4%B9%8E%E5%8F%AF%E4%BB%A5%E5%9C%A8%E7%BC%96%E5%86%99%E5%BA%94%E7%94%A8%E6%97%B6%E7%9A%84%E4%BB%BB%E4%BD%95%E4%B8%80%E4%B8%AA%E5%9C%B0%E6%96%B9%E8%8E%B7%E5%8F%96%E5%88%B0%EF%BC%8C%E4%B8%8B%E9%9D%A2%E4%BB%8B%E7%BB%8D%E5%87%A0%E4%B8%AA%E7%BB%8F%E5%B8%B8%E7%94%A8%E5%88%B0%E7%9A%84%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F%EF%BC%9A%0A%0A%E5%87%A0%E4%B9%8E%E6%89%80%E6%9C%89%E8%A2%AB%E6%A1%86%E6%9E%B6%20%5BLoader%5D(..%2Fadvanced%2Floader.md)%20%E5%8A%A0%E8%BD%BD%E7%9A%84%E6%96%87%E4%BB%B6%EF%BC%88Controller%EF%BC%8CService%EF%BC%8CSchedule%20%E7%AD%89%EF%BC%89%EF%BC%8C%E9%83%BD%E5%8F%AF%E4%BB%A5%20export%20%E4%B8%80%E4%B8%AA%E5%87%BD%E6%95%B0%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E4%BC%9A%E8%A2%AB%20Loader%20%E8%B0%83%E7%94%A8%EF%BC%8C%E5%B9%B6%E4%BD%BF%E7%94%A8%20app%20%E4%BD%9C%E4%B8%BA%E5%8F%82%E6%95%B0%EF%BC%9A%0A%0A-%20%5B%E5%90%AF%E5%8A%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E8%84%9A%E6%9C%AC%5D(.%2Fapp-start.md)%0A%0A%20%20%60%60%60js%0A%20%20%2F%2F%20app.js%0A%20%20module.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20%20%20app.cache%20%3D%20new%20Cache()%3B%0A%20%20%7D%3B%0A%20%20%60%60%60%0A%0A-%20%5BController%20%E6%96%87%E4%BB%B6%5D(.%2Fcontroller.md)%0A%0A%20%20%60%60%60js%0A%20%20%2F%2F%20app%2Fcontroller%2Fuser.js%0A%20%20class%20UserController%20extends%20Controller%20%7B%0A%20%20%20%20async%20fetch()%20%7B%0A%20%20%20%20%20%20this.ctx.body%20%3D%20app.cache.get(this.ctx.query.id)%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%20%20%60%60%60%0A%0A%E5%92%8C%20%5BKoa%5D%20%E4%B8%80%E6%A0%B7%EF%BC%8C%E5%9C%A8%20Context%20%E5%AF%B9%E8%B1%A1%E4%B8%8A%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20%60ctx.app%60%20%E8%AE%BF%E9%97%AE%E5%88%B0%20Application%20%E5%AF%B9%E8%B1%A1%E3%80%82%E4%BB%A5%E4%B8%8A%E9%9D%A2%E7%9A%84%20Controller%20%E6%96%87%E4%BB%B6%E4%B8%BE%E4%BE%8B%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fcontroller%2Fuser.js%0Aclass%20UserController%20extends%20Controller%20%7B%0A%20%20async%20fetch()%20%7B%0A%20%20%20%20this.ctx.body%20%3D%20this.ctx.app.cache.get(this.ctx.query.id)%3B%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A%E5%9C%A8%E7%BB%A7%E6%89%BF%E4%BA%8E%20Controller%2C%20Service%20%E5%9F%BA%E7%B1%BB%E7%9A%84%E5%AE%9E%E4%BE%8B%E4%B8%AD%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20%60this.app%60%20%E8%AE%BF%E9%97%AE%E5%88%B0%20Application%20%E5%AF%B9%E8%B1%A1%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20app%2Fcontroller%2Fuser.js%0Aclass%20UserController%20extends%20Controller%20%7B%0A%20%20async%20fetch()%20%7B%0A%20%20%20%20this.ctx.body%20%3D%20this.app.cache.get(this.ctx.query.id)%3B%0A%20%20%7D%0A%7D%3B%0A%60%60%60%0A%0A%23%23%20Context%0A%0AContext%20%E6%98%AF%E4%B8%80%E4%B8%AA**%E8%AF%B7%E6%B1%82%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AF%B9%E8%B1%A1**%EF%BC%8C%E7%BB%A7%E6%89%BF%E8%87%AA%20%5BKoa.Context%5D%E3%80%82%E5%9C%A8%E6%AF%8F%E4%B8%80%E6%AC%A1%E6%94%B6%E5%88%B0%E7%94%A8%E6%88%B7%E8%AF%B7%E6%B1%82%E6%97%B6%EF%BC%8C%E6%A1%86%E6%9E%B6%E4%BC%9A%E5%AE%9E%E4%BE%8B%E5%8C%96%E4%B8%80%E4%B8%AA%20Context%20%E5%AF%B9%E8%B1%A1%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%AF%B9%E8%B1%A1%E5%B0%81%E8%A3%85%E4%BA%86%E8%BF%99%E6%AC%A1%E7%94%A8%E6%88%B7%E8%AF%B7%E6%B1%82%E7%9A%84%E4%BF%A1%E6%81%AF%EF%BC%8C%E5%B9%B6%E6%8F%90%E4%BE%9B%E4%BA%86%E8%AE%B8%E5%A4%9A%E4%BE%BF%E6%8D%B7%E7%9A%84%E6%96%B9%E6%B3%95%E6%9D%A5%E8%8E%B7%E5%8F%96%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%88%96%E8%80%85%E8%AE%BE%E7%BD%AE%E5%93%8D%E5%BA%94%E4%BF%A1%E6%81%AF%E3%80%82%E6%A1%86%E6%9E%B6%E4%BC%9A%E5%B0%86%E6%89%80%E6%9C%89%E7%9A%84%20%5BService%5D%20%E6%8C%82%E8%BD%BD%E5%88%B0%20Context%20%E5%AE%9E%E4%BE%8B%E4%B8%8A%EF%BC%8C%E4%B8%80%E4%BA%9B%E6%8F%92%E4%BB%B6%E4%B9%9F%E4%BC%9A%E5%B0%86%E4%B8%80%E4%BA%9B%E5%85%B6%E4%BB%96%E7%9A%84%E6%96%B9%E6%B3%95%E5%92%8C%E5%AF%B9%E8%B1%A1%E6%8C%82%E8%BD%BD%E5%88%B0%E5%AE%83%E4%B8%8A%E9%9D%A2%EF%BC%88%5Begg-sequelize%5D%20%E4%BC%9A%E5%B0%86%E6%89%80%E6%9C%89%E7%9A%84%20model%20%E6%8C%82%E8%BD%BD%E5%9C%A8%20Context%20%E4%B8%8A%EF%BC%89%E3%80%82%0A%0A%23%23%23%20%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F%0A%0A%E6%9C%80%E5%B8%B8%E8%A7%81%E7%9A%84%20Context%20%E5%AE%9E%E4%BE%8B%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F%E6%98%AF%E5%9C%A8%20%5BMiddleware%5D%2C%20%5BController%5D%20%E4%BB%A5%E5%8F%8A%20%5BService%5D%20%E4%B8%AD%E3%80%82Controller%20%E4%B8%AD%E7%9A%84%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F%E5%9C%A8%E4%B8%8A%E9%9D%A2%E7%9A%84%E4%BE%8B%E5%AD%90%E4%B8%AD%E5%B7%B2%E7%BB%8F%E5%B1%95%E7%A4%BA%E8%BF%87%E4%BA%86%EF%BC%8C%E5%9C%A8%20Service%20%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%92%8C%20Controller%20%E4%B8%AD%E8%8E%B7%E5%8F%96%E7%9A%84%E6%96%B9%E5%BC%8F%E4%B8%80%E6%A0%B7%EF%BC%8C%E5%9C%A8%20Middleware%20%E4%B8%AD%E8%8E%B7%E5%8F%96%20Context%20%E5%AE%9E%E4%BE%8B%E5%88%99%E5%92%8C%20%5BKoa%5D%20%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%B8%AD%E8%8E%B7%E5%8F%96%20Context%20%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%B9%E5%BC%8F%E4%B8%80%E8%87%B4%E3%80%82%0A%0A%E6%A1%86%E6%9E%B6%E7%9A%84%20%5BMiddleware%5D%20%E5%90%8C%E6%97%B6%E6%94%AF%E6%8C%81%20Koa%20v1%20%E5%92%8C%20Koa%20v2%20%E4%B8%A4%E7%A7%8D%E4%B8%8D%E5%90%8C%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%86%99%E6%B3%95%EF%BC%8C%E6%A0%B9%E6%8D%AE%E4%B8%8D%E5%90%8C%E7%9A%84%E5%86%99%E6%B3%95%EF%BC%8C%E8%8E%B7%E5%8F%96%20Context%20%E5%AE%9E%E4%BE%8B%E7%9A%84%E6%96%B9%E5%BC%8F%E4%B9%9F%E7%A8%8D%E6%9C%89%E4%B8%8D%E5%90%8C%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20Koa%20v1%0Afunction*%20middleware(next)%20%7B%0A%20%20%2F%2F%20this%20is%20instance%20of%20Context%0A%20%20console.log(this.query)%3B%0A%20%20yield%20next%3B%0A%7D%0A%0A%2F%2F%20Koa%20v2%0Aasync%20function%20middleware(ctx%2C%20next)%20%7B%0A%20%20%2F%2F%20ctx%20is%20instance%20of%20Context%0A%20%20console.log(ctx.query)%3B%0A%7D%0A%60%60%60%0A%0A%E9%99%A4%E4%BA%86%E5%9C%A8%E8%AF%B7%E6%B1%82%E6%97%B6%E5%8F%AF%E4%BB%A5%E8%8E%B7%E5%8F%96%20Context%20%E5%AE%9E%E4%BE%8B%E4%B9%8B%E5%A4%96%EF%BC%8C%20%E5%9C%A8%E6%9C%89%E4%BA%9B%E9%9D%9E%E7%94%A8%E6%88%B7%E8%AF%B7%E6%B1%82%E7%9A%84%E5%9C%BA%E6%99%AF%E4%B8%8B%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E8%AE%BF%E9%97%AE%20service%20%2F%20model%20%E7%AD%89%20Context%20%E5%AE%9E%E4%BE%8B%E4%B8%8A%E7%9A%84%E5%AF%B9%E8%B1%A1%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20%60Application.createAnonymousContext()%60%20%E6%96%B9%E6%B3%95%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%8C%BF%E5%90%8D%20Context%20%E5%AE%9E%E4%BE%8B%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20app.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20app.beforeStart(async%20()%20%3D%3E%20%7B%0A%20%20%20%20const%20ctx%20%3D%20app.createAnonymousContext()%3B%0A%20%20%20%20%2F%2F%20preload%20before%20app%20start%0A%20%20%20%20await%20ctx.service.posts.load()%3B%0A%20%20%7D)%3B%0A%7D%0A%60%60%60%0A%0A%E5%9C%A8%5B%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%5D(.%2Fschedule.md)%E4%B8%AD%E7%9A%84%E6%AF%8F%E4%B8%80%E4%B8%AA%20task%20%E9%83%BD%E6%8E%A5%E5%8F%97%E4%B8%80%E4%B8%AA%20Context%20%E5%AE%9E%E4%BE%8B%E4%BD%9C%E4%B8%BA%E5%8F%82%E6%95%B0%EF%BC%8C%E4%BB%A5%E4%BE%BF%E6%88%91%E4%BB%AC%E6%9B%B4%E6%96%B9%E4%BE%BF%E7%9A%84%E6%89%A7%E8%A1%8C%E4%B8%80%E4%BA%9B%E5%AE%9A%E6%97%B6%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fschedule%2Frefresh.js%0Aexports.task%20%3D%20async%20ctx%20%3D%3E%20%7B%0A%20%20await%20ctx.service.posts.refresh()%3B%0A%7D%3B%0A%60%60%60%0A%0A%23%23%20Request%20%26%20Response%0A%0ARequest%20%E6%98%AF%E4%B8%80%E4%B8%AA**%E8%AF%B7%E6%B1%82%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AF%B9%E8%B1%A1**%EF%BC%8C%E7%BB%A7%E6%89%BF%E8%87%AA%20%5BKoa.Request%5D%E3%80%82%E5%B0%81%E8%A3%85%E4%BA%86%20Node.js%20%E5%8E%9F%E7%94%9F%E7%9A%84%20HTTP%20Request%20%E5%AF%B9%E8%B1%A1%EF%BC%8C%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E7%B3%BB%E5%88%97%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95%E8%8E%B7%E5%8F%96%20HTTP%20%E8%AF%B7%E6%B1%82%E5%B8%B8%E7%94%A8%E5%8F%82%E6%95%B0%E3%80%82%0A%0AResponse%20%E6%98%AF%E4%B8%80%E4%B8%AA**%E8%AF%B7%E6%B1%82%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AF%B9%E8%B1%A1**%EF%BC%8C%E7%BB%A7%E6%89%BF%E8%87%AA%20%5BKoa.Response%5D%E3%80%82%E5%B0%81%E8%A3%85%E4%BA%86%20Node.js%20%E5%8E%9F%E7%94%9F%E7%9A%84%20HTTP%20Response%20%E5%AF%B9%E8%B1%A1%EF%BC%8C%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E7%B3%BB%E5%88%97%E8%BE%85%E5%8A%A9%E6%96%B9%E6%B3%95%E8%AE%BE%E7%BD%AE%20HTTP%20%E5%93%8D%E5%BA%94%E3%80%82%0A%0A%23%23%23%20%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F%0A%0A%E5%8F%AF%E4%BB%A5%E5%9C%A8%20Context%20%E7%9A%84%E5%AE%9E%E4%BE%8B%E4%B8%8A%E8%8E%B7%E5%8F%96%E5%88%B0%E5%BD%93%E5%89%8D%E8%AF%B7%E6%B1%82%E7%9A%84%20Request(%60ctx.request%60)%20%E5%92%8C%20Response(%60ctx.response%60)%20%E5%AE%9E%E4%BE%8B%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20app%2Fcontroller%2Fuser.js%0Aclass%20UserController%20extends%20Controller%20%7B%0A%20%20async%20fetch()%20%7B%0A%20%20%20%20const%20%7B%20app%2C%20ctx%20%7D%20%3D%20this%3B%0A%20%20%20%20const%20id%20%3D%20ctx.request.query.id%3B%0A%20%20%20%20ctx.response.body%20%3D%20app.cache.get(id)%3B%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A-%20%5BKoa%5D%20%E4%BC%9A%E5%9C%A8%20Context%20%E4%B8%8A%E4%BB%A3%E7%90%86%E4%B8%80%E9%83%A8%E5%88%86%20Request%20%E5%92%8C%20Response%20%E4%B8%8A%E7%9A%84%E6%96%B9%E6%B3%95%E5%92%8C%E5%B1%9E%E6%80%A7%EF%BC%8C%E5%8F%82%E8%A7%81%20%5BKoa.Context%5D%E3%80%82%0A-%20%E5%A6%82%E4%B8%8A%E9%9D%A2%E4%BE%8B%E5%AD%90%E4%B8%AD%E7%9A%84%20%60ctx.request.query.id%60%20%E5%92%8C%20%60ctx.query.id%60%20%E6%98%AF%E7%AD%89%E4%BB%B7%E7%9A%84%EF%BC%8C%60ctx.response.body%3D%60%20%E5%92%8C%20%60ctx.body%3D%60%20%E6%98%AF%E7%AD%89%E4%BB%B7%E7%9A%84%E3%80%82%0A-%20%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E6%98%AF%EF%BC%8C%E8%8E%B7%E5%8F%96%20POST%20%E7%9A%84%20body%20%E5%BA%94%E8%AF%A5%E4%BD%BF%E7%94%A8%20%60ctx.request.body%60%EF%BC%8C%E8%80%8C%E4%B8%8D%E6%98%AF%20%60ctx.body%60%E3%80%82%0A%0A%23%23%20Controller%0A%0A%E6%A1%86%E6%9E%B6%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E4%B8%AA%20Controller%20%E5%9F%BA%E7%B1%BB%EF%BC%8C%E5%B9%B6%E6%8E%A8%E8%8D%90%E6%89%80%E6%9C%89%E7%9A%84%20%5BController%5D%20%E9%83%BD%E7%BB%A7%E6%89%BF%E4%BA%8E%E8%AF%A5%E5%9F%BA%E7%B1%BB%E5%AE%9E%E7%8E%B0%E3%80%82%E8%BF%99%E4%B8%AA%20Controller%20%E5%9F%BA%E7%B1%BB%E6%9C%89%E4%B8%8B%E5%88%97%E5%B1%9E%E6%80%A7%EF%BC%9A%0A%0A-%20%60ctx%60%20-%20%E5%BD%93%E5%89%8D%E8%AF%B7%E6%B1%82%E7%9A%84%20%5BContext%5D(%23context)%20%E5%AE%9E%E4%BE%8B%E3%80%82%0A-%20%60app%60%20-%20%E5%BA%94%E7%94%A8%E7%9A%84%20%5BApplication%5D(%23application)%20%E5%AE%9E%E4%BE%8B%E3%80%82%0A-%20%60config%60%20-%20%E5%BA%94%E7%94%A8%E7%9A%84%5B%E9%85%8D%E7%BD%AE%5D(.%2Fconfig.md)%E3%80%82%0A-%20%60service%60%20-%20%E5%BA%94%E7%94%A8%E6%89%80%E6%9C%89%E7%9A%84%20%5Bservice%5D(.%2Fservice.md)%E3%80%82%0A-%20%60logger%60%20-%20%E4%B8%BA%E5%BD%93%E5%89%8D%20controller%20%E5%B0%81%E8%A3%85%E7%9A%84%20logger%20%E5%AF%B9%E8%B1%A1%E3%80%82%0A%0A%E5%9C%A8%20Controller%20%E6%96%87%E4%BB%B6%E4%B8%AD%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F%E6%9D%A5%E5%BC%95%E7%94%A8%20Controller%20%E5%9F%BA%E7%B1%BB%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fcontroller%2Fuser.js%0A%0A%2F%2F%20%E4%BB%8E%20egg%20%E4%B8%8A%E8%8E%B7%E5%8F%96%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%89%0Aconst%20Controller%20%3D%20require('egg').Controller%3B%0Aclass%20UserController%20extends%20Controller%20%7B%0A%20%20%2F%2F%20implement%0A%7D%0Amodule.exports%20%3D%20UserController%3B%0A%0A%2F%2F%20%E4%BB%8E%20app%20%E5%AE%9E%E4%BE%8B%E4%B8%8A%E8%8E%B7%E5%8F%96%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20return%20class%20UserController%20extends%20app.Controller%20%7B%0A%20%20%20%20%2F%2F%20implement%0A%20%20%7D%3B%0A%7D%3B%0A%60%60%60%0A%0A%23%23%20Service%0A%0A%E6%A1%86%E6%9E%B6%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E4%B8%AA%20Service%20%E5%9F%BA%E7%B1%BB%EF%BC%8C%E5%B9%B6%E6%8E%A8%E8%8D%90%E6%89%80%E6%9C%89%E7%9A%84%20%5BService%5D%20%E9%83%BD%E7%BB%A7%E6%89%BF%E4%BA%8E%E8%AF%A5%E5%9F%BA%E7%B1%BB%E5%AE%9E%E7%8E%B0%E3%80%82%0A%0AService%20%E5%9F%BA%E7%B1%BB%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%20%5BController%5D(%23controller)%20%E5%9F%BA%E7%B1%BB%E5%B1%9E%E6%80%A7%E4%B8%80%E8%87%B4%EF%BC%8C%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F%E4%B9%9F%E7%B1%BB%E4%BC%BC%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fservice%2Fuser.js%0A%0A%2F%2F%20%E4%BB%8E%20egg%20%E4%B8%8A%E8%8E%B7%E5%8F%96%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%89%0Aconst%20Service%20%3D%20require('egg').Service%3B%0Aclass%20UserService%20extends%20Service%20%7B%0A%20%20%2F%2F%20implement%0A%7D%0Amodule.exports%20%3D%20UserService%3B%0A%0A%2F%2F%20%E4%BB%8E%20app%20%E5%AE%9E%E4%BE%8B%E4%B8%8A%E8%8E%B7%E5%8F%96%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20return%20class%20UserService%20extends%20app.Service%20%7B%0A%20%20%20%20%2F%2F%20implement%0A%20%20%7D%3B%0A%7D%3B%0A%60%60%60%0A%0A%23%23%20Helper%0A%0AHelper%20%E7%94%A8%E6%9D%A5%E6%8F%90%E4%BE%9B%E4%B8%80%E4%BA%9B%E5%AE%9E%E7%94%A8%E7%9A%84%20utility%20%E5%87%BD%E6%95%B0%E3%80%82%E5%AE%83%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9C%A8%E4%BA%8E%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%B0%86%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E7%9A%84%E5%8A%A8%E4%BD%9C%E6%8A%BD%E7%A6%BB%E5%9C%A8%20helper.js%20%E9%87%8C%E9%9D%A2%E6%88%90%E4%B8%BA%E4%B8%80%E4%B8%AA%E7%8B%AC%E7%AB%8B%E7%9A%84%E5%87%BD%E6%95%B0%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%8F%AF%E4%BB%A5%E7%94%A8%20JavaScript%20%E6%9D%A5%E5%86%99%E5%A4%8D%E6%9D%82%E7%9A%84%E9%80%BB%E8%BE%91%EF%BC%8C%E9%81%BF%E5%85%8D%E9%80%BB%E8%BE%91%E5%88%86%E6%95%A3%E5%90%84%E5%A4%84%EF%BC%8C%E5%90%8C%E6%97%B6%E5%8F%AF%E4%BB%A5%E6%9B%B4%E5%A5%BD%E7%9A%84%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%E3%80%82%0A%0AHelper%20%E8%87%AA%E8%BA%AB%E6%98%AF%E4%B8%80%E4%B8%AA%E7%B1%BB%EF%BC%8C%E6%9C%89%E5%92%8C%20%5BController%5D(%23controller)%20%E5%9F%BA%E7%B1%BB%E4%B8%80%E6%A0%B7%E7%9A%84%E5%B1%9E%E6%80%A7%EF%BC%8C%E5%AE%83%E4%B9%9F%E4%BC%9A%E5%9C%A8%E6%AF%8F%E6%AC%A1%E8%AF%B7%E6%B1%82%E6%97%B6%E8%BF%9B%E8%A1%8C%E5%AE%9E%E4%BE%8B%E5%8C%96%EF%BC%8C%E5%9B%A0%E6%AD%A4%20Helper%20%E4%B8%8A%E7%9A%84%E6%89%80%E6%9C%89%E5%87%BD%E6%95%B0%E4%B9%9F%E8%83%BD%E8%8E%B7%E5%8F%96%E5%88%B0%E5%BD%93%E5%89%8D%E8%AF%B7%E6%B1%82%E7%9B%B8%E5%85%B3%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87%E4%BF%A1%E6%81%AF%E3%80%82%0A%0A%23%23%23%20%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F%0A%0A%E5%8F%AF%E4%BB%A5%E5%9C%A8%20Context%20%E7%9A%84%E5%AE%9E%E4%BE%8B%E4%B8%8A%E8%8E%B7%E5%8F%96%E5%88%B0%E5%BD%93%E5%89%8D%E8%AF%B7%E6%B1%82%E7%9A%84%20Helper(%60ctx.helper%60)%20%E5%AE%9E%E4%BE%8B%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20app%2Fcontroller%2Fuser.js%0Aclass%20UserController%20extends%20Controller%20%7B%0A%20%20async%20fetch()%20%7B%0A%20%20%20%20const%20%7B%20app%2C%20ctx%20%7D%20%3D%20this%3B%0A%20%20%20%20const%20id%20%3D%20ctx.query.id%3B%0A%20%20%20%20const%20user%20%3D%20app.cache.get(id)%3B%0A%20%20%20%20ctx.body%20%3D%20ctx.helper.formatUser(user)%3B%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A%E9%99%A4%E6%AD%A4%E4%B9%8B%E5%A4%96%EF%BC%8CHelper%20%E7%9A%84%E5%AE%9E%E4%BE%8B%E8%BF%98%E5%8F%AF%E4%BB%A5%E5%9C%A8%E6%A8%A1%E6%9D%BF%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%88%B0%EF%BC%8C%E4%BE%8B%E5%A6%82%E5%8F%AF%E4%BB%A5%E5%9C%A8%E6%A8%A1%E6%9D%BF%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%88%B0%20%5Bsecurity%5D(..%2Fcore%2Fsecurity.md)%20%E6%8F%92%E4%BB%B6%E6%8F%90%E4%BE%9B%E7%9A%84%20%60shtml%60%20%E6%96%B9%E6%B3%95%E3%80%82%0A%0A%60%60%60%0A%2F%2F%20app%2Fview%2Fhome.nj%0A%7B%7B%20helper.shtml(value)%20%7D%7D%0A%60%60%60%0A%0A%23%23%23%20%E8%87%AA%E5%AE%9A%E4%B9%89%20helper%20%E6%96%B9%E6%B3%95%0A%0A%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E4%B8%AD%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E8%83%BD%E7%BB%8F%E5%B8%B8%E8%A6%81%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%80%E4%BA%9B%20helper%20%E6%96%B9%E6%B3%95%EF%BC%8C%E4%BE%8B%E5%A6%82%E4%B8%8A%E9%9D%A2%E4%BE%8B%E5%AD%90%E4%B8%AD%E7%9A%84%20%60formatUser%60%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%5B%E6%A1%86%E6%9E%B6%E6%89%A9%E5%B1%95%5D(.%2Fextend.md%23helper)%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%9D%A5%E8%87%AA%E5%AE%9A%E4%B9%89%20helper%20%E6%96%B9%E6%B3%95%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20app%2Fextend%2Fhelper.js%0Amodule.exports%20%3D%20%7B%0A%20%20formatUser(user)%20%7B%0A%20%20%20%20return%20only(user%2C%20%5B%20'name'%2C%20'phone'%20%5D)%3B%0A%20%20%7D%0A%7D%3B%0A%60%60%60%0A%0A%23%23%20Config%0A%0A%E6%88%91%E4%BB%AC%E6%8E%A8%E8%8D%90%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E9%81%B5%E5%BE%AA%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BB%A3%E7%A0%81%E5%88%86%E7%A6%BB%E7%9A%84%E5%8E%9F%E5%88%99%EF%BC%8C%E5%B0%86%E4%B8%80%E4%BA%9B%E9%9C%80%E8%A6%81%E7%A1%AC%E7%BC%96%E7%A0%81%E7%9A%84%E4%B8%9A%E5%8A%A1%E9%85%8D%E7%BD%AE%E9%83%BD%E6%94%BE%E5%88%B0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%EF%BC%8C%E5%90%8C%E6%97%B6%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%94%AF%E6%8C%81%E5%90%84%E4%B8%AA%E4%B8%8D%E5%90%8C%E7%9A%84%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%90%8C%E7%9A%84%E9%85%8D%E7%BD%AE%EF%BC%8C%E4%BD%BF%E7%94%A8%E8%B5%B7%E6%9D%A5%E4%B9%9F%E9%9D%9E%E5%B8%B8%E6%96%B9%E4%BE%BF%EF%BC%8C%E6%89%80%E6%9C%89%E6%A1%86%E6%9E%B6%E3%80%81%E6%8F%92%E4%BB%B6%E5%92%8C%E5%BA%94%E7%94%A8%E7%BA%A7%E5%88%AB%E7%9A%84%E9%85%8D%E7%BD%AE%E9%83%BD%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20Config%20%E5%AF%B9%E8%B1%A1%E8%8E%B7%E5%8F%96%E5%88%B0%EF%BC%8C%E5%85%B3%E4%BA%8E%E6%A1%86%E6%9E%B6%E7%9A%84%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%AF%A6%E7%BB%86%E9%98%85%E8%AF%BB%20%5BConfig%20%E9%85%8D%E7%BD%AE%5D(.%2Fconfig.md)%E7%AB%A0%E8%8A%82%E3%80%82%0A%0A%23%23%23%20%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F%0A%0A%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20%60app.config%60%20%E4%BB%8E%20Application%20%E5%AE%9E%E4%BE%8B%E4%B8%8A%E8%8E%B7%E5%8F%96%E5%88%B0%20config%20%E5%AF%B9%E8%B1%A1%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%9C%A8%20Controller%2C%20Service%2C%20Helper%20%E7%9A%84%E5%AE%9E%E4%BE%8B%E4%B8%8A%E9%80%9A%E8%BF%87%20%60this.config%60%20%E8%8E%B7%E5%8F%96%E5%88%B0%20config%20%E5%AF%B9%E8%B1%A1%E3%80%82%0A%0A%23%23%20Logger%0A%0A%E6%A1%86%E6%9E%B6%E5%86%85%E7%BD%AE%E4%BA%86%E5%8A%9F%E8%83%BD%E5%BC%BA%E5%A4%A7%E7%9A%84%5B%E6%97%A5%E5%BF%97%E5%8A%9F%E8%83%BD%5D(..%2Fcore%2Flogger.md)%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%9D%9E%E5%B8%B8%E6%96%B9%E4%BE%BF%E7%9A%84%E6%89%93%E5%8D%B0%E5%90%84%E7%A7%8D%E7%BA%A7%E5%88%AB%E7%9A%84%E6%97%A5%E5%BF%97%E5%88%B0%E5%AF%B9%E5%BA%94%E7%9A%84%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E4%B8%AD%EF%BC%8C%E6%AF%8F%E4%B8%80%E4%B8%AA%20logger%20%E5%AF%B9%E8%B1%A1%E9%83%BD%E6%8F%90%E4%BE%9B%E4%BA%86%205%20%E4%B8%AA%E7%BA%A7%E5%88%AB%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%9A%0A%0A-%20%60logger.debug()%60%0A-%20%60logger.info()%60%0A-%20%60logger.warn()%60%0A-%20%60logger.error()%60%0A%0A%E5%9C%A8%E6%A1%86%E6%9E%B6%E4%B8%AD%E6%8F%90%E4%BE%9B%E4%BA%86%E5%A4%9A%E4%B8%AA%20Logger%20%E5%AF%B9%E8%B1%A1%EF%BC%8C%E4%B8%8B%E9%9D%A2%E6%88%91%E4%BB%AC%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B%E5%90%84%E4%B8%AA%20Logger%20%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F%E5%92%8C%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E3%80%82%0A%0A%23%23%23%20App%20Logger%0A%0A%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20%60app.logger%60%20%E6%9D%A5%E8%8E%B7%E5%8F%96%E5%88%B0%E5%AE%83%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%88%91%E4%BB%AC%E6%83%B3%E5%81%9A%E4%B8%80%E4%BA%9B%E5%BA%94%E7%94%A8%E7%BA%A7%E5%88%AB%E7%9A%84%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%EF%BC%8C%E5%A6%82%E8%AE%B0%E5%BD%95%E5%90%AF%E5%8A%A8%E9%98%B6%E6%AE%B5%E7%9A%84%E4%B8%80%E4%BA%9B%E6%95%B0%E6%8D%AE%E4%BF%A1%E6%81%AF%EF%BC%8C%E8%AE%B0%E5%BD%95%E4%B8%80%E4%BA%9B%E4%B8%9A%E5%8A%A1%E4%B8%8A%E4%B8%8E%E8%AF%B7%E6%B1%82%E6%97%A0%E5%85%B3%E7%9A%84%E4%BF%A1%E6%81%AF%EF%BC%8C%E9%83%BD%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20App%20Logger%20%E6%9D%A5%E5%AE%8C%E6%88%90%E3%80%82%0A%0A%23%23%23%20App%20CoreLogger%0A%0A%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20%60app.coreLogger%60%20%E6%9D%A5%E8%8E%B7%E5%8F%96%E5%88%B0%E5%AE%83%EF%BC%8C%E4%B8%80%E8%88%AC%E6%88%91%E4%BB%AC%E5%9C%A8%E5%BC%80%E5%8F%91%E5%BA%94%E7%94%A8%E6%97%B6%E9%83%BD%E4%B8%8D%E5%BA%94%E8%AF%A5%E9%80%9A%E8%BF%87%20CoreLogger%20%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%EF%BC%8C%E8%80%8C%E6%A1%86%E6%9E%B6%E5%92%8C%E6%8F%92%E4%BB%B6%E5%88%99%E9%9C%80%E8%A6%81%E9%80%9A%E8%BF%87%E5%AE%83%E6%9D%A5%E6%89%93%E5%8D%B0%E5%BA%94%E7%94%A8%E7%BA%A7%E5%88%AB%E7%9A%84%E6%97%A5%E5%BF%97%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%8F%AF%E4%BB%A5%E6%9B%B4%E6%B8%85%E6%99%B0%E7%9A%84%E5%8C%BA%E5%88%86%E5%BA%94%E7%94%A8%E5%92%8C%E6%A1%86%E6%9E%B6%E6%89%93%E5%8D%B0%E7%9A%84%E6%97%A5%E5%BF%97%EF%BC%8C%E9%80%9A%E8%BF%87%20CoreLogger%20%E6%89%93%E5%8D%B0%E7%9A%84%E6%97%A5%E5%BF%97%E4%BC%9A%E6%94%BE%E5%88%B0%E5%92%8C%20Logger%20%E4%B8%8D%E5%90%8C%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%AD%E3%80%82%0A%0A%23%23%23%20Context%20Logger%0A%0A%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20%60ctx.logger%60%20%E4%BB%8E%20Context%20%E5%AE%9E%E4%BE%8B%E4%B8%8A%E8%8E%B7%E5%8F%96%E5%88%B0%E5%AE%83%EF%BC%8C%E4%BB%8E%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F%E4%B8%8A%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%87%BA%E6%9D%A5%EF%BC%8CContext%20Logger%20%E4%B8%80%E5%AE%9A%E6%98%AF%E4%B8%8E%E8%AF%B7%E6%B1%82%E7%9B%B8%E5%85%B3%E7%9A%84%EF%BC%8C%E5%AE%83%E6%89%93%E5%8D%B0%E7%9A%84%E6%97%A5%E5%BF%97%E9%83%BD%E4%BC%9A%E5%9C%A8%E5%89%8D%E9%9D%A2%E5%B8%A6%E4%B8%8A%E4%B8%80%E4%BA%9B%E5%BD%93%E5%89%8D%E8%AF%B7%E6%B1%82%E7%9B%B8%E5%85%B3%E7%9A%84%E4%BF%A1%E6%81%AF%EF%BC%88%E5%A6%82%20%60%5B%24userId%2F%24ip%2F%24traceId%2F%24%7Bcost%7Dms%20%24method%20%24url%5D%60%EF%BC%89%EF%BC%8C%E9%80%9A%E8%BF%87%E8%BF%99%E4%BA%9B%E4%BF%A1%E6%81%AF%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E4%BB%8E%E6%97%A5%E5%BF%97%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D%E8%AF%B7%E6%B1%82%EF%BC%8C%E5%B9%B6%E4%B8%B2%E8%81%94%E4%B8%80%E6%AC%A1%E8%AF%B7%E6%B1%82%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E7%9A%84%E6%97%A5%E5%BF%97%E3%80%82%0A%0A%23%23%23%20Context%20CoreLogger%0A%0A%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20%60ctx.coreLogger%60%20%E8%8E%B7%E5%8F%96%E5%88%B0%E5%AE%83%EF%BC%8C%E5%92%8C%20Context%20Logger%20%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%B8%80%E8%88%AC%E5%8F%AA%E6%9C%89%E6%8F%92%E4%BB%B6%E5%92%8C%E6%A1%86%E6%9E%B6%E4%BC%9A%E9%80%9A%E8%BF%87%E5%AE%83%E6%9D%A5%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97%E3%80%82%0A%0A%23%23%23%20Controller%20Logger%20%26%20Service%20Logger%0A%0A%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%9C%A8%20Controller%20%E5%92%8C%20Service%20%E5%AE%9E%E4%BE%8B%E4%B8%8A%E9%80%9A%E8%BF%87%20%60this.logger%60%20%E8%8E%B7%E5%8F%96%E5%88%B0%E5%AE%83%E4%BB%AC%EF%BC%8C%E5%AE%83%E4%BB%AC%E6%9C%AC%E8%B4%A8%E4%B8%8A%E5%B0%B1%E6%98%AF%E4%B8%80%E4%B8%AA%20Context%20Logger%EF%BC%8C%E4%B8%8D%E8%BF%87%E5%9C%A8%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%E7%9A%84%E6%97%B6%E5%80%99%E8%BF%98%E4%BC%9A%E9%A2%9D%E5%A4%96%E7%9A%84%E5%8A%A0%E4%B8%8A%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%EF%BC%8C%E6%96%B9%E4%BE%BF%E5%AE%9A%E4%BD%8D%E6%97%A5%E5%BF%97%E7%9A%84%E6%89%93%E5%8D%B0%E4%BD%8D%E7%BD%AE%E3%80%82%0A%0A%23%23%20Subscription%0A%0A%E8%AE%A2%E9%98%85%E6%A8%A1%E5%9E%8B%E6%98%AF%E4%B8%80%E7%A7%8D%E6%AF%94%E8%BE%83%E5%B8%B8%E8%A7%81%E7%9A%84%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F%EF%BC%8C%E8%AD%AC%E5%A6%82%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E6%B6%88%E8%B4%B9%E8%80%85%E6%88%96%E8%B0%83%E5%BA%A6%E4%BB%BB%E5%8A%A1%E3%80%82%E5%9B%A0%E6%AD%A4%E6%88%91%E4%BB%AC%E6%8F%90%E4%BE%9B%E4%BA%86%20Subscription%20%E5%9F%BA%E7%B1%BB%E6%9D%A5%E8%A7%84%E8%8C%83%E5%8C%96%E8%BF%99%E4%B8%AA%E6%A8%A1%E5%BC%8F%E3%80%82%0A%0A%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E4%BB%A5%E4%B8%8B%E6%96%B9%E5%BC%8F%E6%9D%A5%E5%BC%95%E7%94%A8%20Subscription%20%E5%9F%BA%E7%B1%BB%EF%BC%9A%0A%0A%60%60%60js%0Aconst%20Subscription%20%3D%20require('egg').Subscription%3B%0A%0Aclass%20Schedule%20extends%20Subscription%20%7B%0A%20%20%2F%2F%20%E9%9C%80%E8%A6%81%E5%AE%9E%E7%8E%B0%E6%AD%A4%E6%96%B9%E6%B3%95%0A%20%20%2F%2F%20subscribe%20%E5%8F%AF%E4%BB%A5%E4%B8%BA%20async%20function%20%E6%88%96%20generator%20function%0A%20%20async%20subscribe()%20%7B%7D%0A%7D%0A%60%60%60%0A%0A%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E8%80%85%E5%8F%AF%E4%BB%A5%E6%A0%B9%E6%8D%AE%E8%87%AA%E5%B7%B1%E7%9A%84%E9%9C%80%E6%B1%82%E5%9F%BA%E4%BA%8E%E5%AE%83%E5%AE%9A%E5%88%B6%E8%AE%A2%E9%98%85%E8%A7%84%E8%8C%83%EF%BC%8C%E5%A6%82%5B%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%5D(.%2Fschedule.md)%E5%B0%B1%E6%98%AF%E4%BD%BF%E7%94%A8%E8%BF%99%E7%A7%8D%E8%A7%84%E8%8C%83%E5%AE%9E%E7%8E%B0%E7%9A%84%E3%80%82%0A%0A%5BKoa%5D%3A%20http%3A%2F%2Fkoajs.com%0A%5BKoa.Application%5D%3A%20http%3A%2F%2Fkoajs.com%2F%23application%0A%5BKoa.Context%5D%3A%20http%3A%2F%2Fkoajs.com%2F%23context%0A%5BKoa.Request%5D%3A%20http%3A%2F%2Fkoajs.com%2F%23request%0A%5BKoa.Response%5D%3A%20http%3A%2F%2Fkoajs.com%2F%23response%0A%5Begg-sequelize%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-sequelize%0A%5BMiddleware%5D%3A%20.%2Fmiddleware.md%0A%5BController%5D%3A%20.%2Fcontroller.md%0A%5BService%5D%3A%20.%2Fservice.md%0A"}}</script><script type="text/javascript" src="/static/js/post.b9faab88.js"></script></body></html>