<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.png"><style class="_styletron_hydrate_"></style><title>框架扩展</title><meta name="description" content="Born to build better enterprise frameworks and apps"><link href="/static/css/post.d62265dc.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="ant-layout" data-reactroot=""><div class="header-module__header___3ADJ9 ant-layout-header"><div class="ant-row-flex"><div class="ant-col-xs-12 ant-col-md-20 ant-col-lg-2"><div class="header-module__logo___3yTXp"><a href="/"><img src="/logo.svg" alt="logo"/></a></div></div><div class="ant-col-xs-0 ant-col-md-0 ant-col-lg-20"><ul class="ant-menu header-module__menu___3yEtW ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/intro/">指南</a></li><li class="ant-menu-item" role="menuitem"><a href="/api/">API</a></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/tutorials/index.html">教程</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/search?q=topic%3Aegg-plugin&amp;type=Repositories">插件</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/eggjs/egg/releases">发布日志</a></li></ul></div><div style="text-align:right" class="ant-col-xs-12 ant-col-md-4 ant-col-lg-2"><button type="button" class="ant-btn"><span>Languages</span></button></div></div></div><div class="ant-layout-content"><div class="basic_layout-module__content___3flpY ant-layout"><div class="sider-module__side___1Cadj ant-layout-sider ant-layout-sider-light" style="flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"><ul class="ant-menu sider-module__menu___2GqPr ant-menu-light ant-menu-root ant-menu-inline" role="menu"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="0$Menu" aria-haspopup="true"><span>新手指南</span><i class="ant-menu-submenu-arrow"></i></div><ul id="0$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/index.html">Egg.js 是什么?</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/egg-and-koa.html">Egg.js 和 Koa</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/quickstart.html">快速入门</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/progressive.html">渐进式开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/migration.html">2.x 升级指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="1$Menu" aria-haspopup="true"><span>基础功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="1$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/structure.html">目录结构</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/objects.html">内置对象</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/env.html">运行环境</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/config.html">配置</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/middleware.html">中间件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/router.html">Router</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/controller.html">Controller</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/service.html">Service</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/plugin.html">插件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/schedule.html">定时任务</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/extend.html">框架扩展</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/app-start.html">启动自定义</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="2$Menu" aria-haspopup="true"><span>核心功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="2$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/development.html">本地开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/unittest.html">单元测试</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/deployment.html">应用部署</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/logger.html">日志</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/httpclient.html">HttpClient</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cookie-and-session.html">Cookie and Session</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cluster-and-ipc.html">多进程模型和进程间通讯</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/view.html">模板渲染</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/error-handling.html">异常处理</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/security.html">安全</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/i18n.html">国际化</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="3$Menu" aria-haspopup="true"><span>教程</span><i class="ant-menu-submenu-arrow"></i></div><ul id="3$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/mysql.html">MySQL</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/restful.html">RESTful API</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/passport.html">Passport 鉴权</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/socketio.html">Socket.IO</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/assets.html">静态资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/typescript.html">TypeScript</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="4$Menu" aria-haspopup="true"><span>进阶</span><i class="ant-menu-submenu-arrow"></i></div><ul id="4$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/loader.html">Loader</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/plugin.html">插件开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/framework.html">框架开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/cluster-client.html">多进程研发模式增强</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/view-plugin.html">模板插件开发规范</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/style-guide.html">代码风格指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="5$Menu" aria-haspopup="true"><span>社区</span><i class="ant-menu-submenu-arrow"></i></div><ul id="5$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/plugins/">内置插件列表</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/contributing.html">如何贡献</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/resource.html">资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/faq.html">常见问题</a></li></ul></li></ul></div></div><div class="basic_layout-module__post___2Z7KK ant-layout-content"><div class="ant-row" style="margin-left:-8px;margin-right:-8px"><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-24 ant-col-md-18"><div class="markdown-body" style="font-size:14px"><div><p>框架提供了多种扩展点扩展自身的功能：</p><ul><li>Application</li><li>Context</li><li>Request</li><li>Response</li><li>Helper</li></ul><p>在开发中，我们既可以使用已有的扩展 API 来方便开发，也可以对以上对象进行自定义扩展，进一步加强框架的功能。</p><h2 id="application">Application</h2><p><code>app</code> 对象指的是 Koa 的全局应用对象，全局只有一个，在应用启动时被创建。</p><h3 id="访问方式">访问方式</h3><ul><li><code>ctx.app</code></li><li>Controller，Middleware，Helper，Service 中都可以通过 <code>this.app</code> 访问到 Application 对象，例如 <code>this.app.config</code> 访问配置对象。</li><li><p>在 <code>app.js</code> 中 <code>app</code> 对象会作为第一个参数注入到入口函数中</p><pre><code class="language-js">// app.js
module.exports = app =&gt; {
  // 使用 app 对象
};</code></pre></li></ul><h3 id="扩展方式">扩展方式</h3><p>框架会把 <code>app/extend/application.js</code> 中定义的对象与 Koa Application 的 prototype 对象进行合并，在应用启动时会基于扩展后的 prototype 生成 <code>app</code> 对象。</p><h4 id="方法扩展">方法扩展</h4><p>例如，我们要增加一个 <code>app.foo()</code> 方法：</p><pre><code class="language-js">// app/extend/application.js
module.exports = {
  foo(param) {
    // this 就是 app 对象，在其中可以调用 app 上的其他方法，或访问属性
  },
};</code></pre><h4 id="属性扩展">属性扩展</h4><p>一般来说属性的计算只需要进行一次，那么一定要实现缓存，否则在多次访问属性时会计算多次，这样会降低应用性能。</p><p>推荐的方式是使用 Symbol + Getter 的模式。</p><p>例如，增加一个 <code>app.bar</code> 属性 Getter：</p><pre><code class="language-js">// app/extend/application.js
const BAR = Symbol(&#x27;Application#bar&#x27;);

module.exports = {
  get bar() {
    // this 就是 app 对象，在其中可以调用 app 上的其他方法，或访问属性
    if (!this[BAR]) {
      // 实际情况肯定更复杂
      this[BAR] = this.config.xx + this.config.yy;
    }
    return this[BAR];
  },
};</code></pre><h2 id="context">Context</h2><p>Context 指的是 Koa 的请求上下文，这是 <strong>请求级别</strong> 的对象，每次请求生成一个 Context 实例，通常我们也简写成 <code>ctx</code>。在所有的文档中，Context 和 <code>ctx</code> 都是指 Koa 的上下文对象。</p><h3 id="访问方式">访问方式</h3><ul><li>middleware 中 <code>this</code> 就是 ctx，例如 <code>this.cookies.get(&#x27;foo&#x27;)</code>。</li><li>controller 有两种写法，类的写法通过 <code>this.ctx</code>，方法的写法直接通过 <code>ctx</code> 入参。</li><li>helper，service 中的 this 指向 helper，service 对象本身，使用 <code>this.ctx</code> 访问 context 对象，例如 <code>this.ctx.cookies.get(&#x27;foo&#x27;)</code>。</li></ul><h3 id="扩展方式">扩展方式</h3><p>框架会把 <code>app/extend/context.js</code> 中定义的对象与 Koa Context 的 prototype 对象进行合并，在处理请求时会基于扩展后的 prototype 生成 ctx 对象。</p><h4 id="方法扩展">方法扩展</h4><p>例如，我们要增加一个 <code>ctx.foo()</code> 方法：</p><pre><code class="language-js">// app/extend/context.js
module.exports = {
  foo(param) {
    // this 就是 ctx 对象，在其中可以调用 ctx 上的其他方法，或访问属性
  },
};</code></pre><h4 id="属性扩展">属性扩展</h4><p>一般来说属性的计算在同一次请求中只需要进行一次，那么一定要实现缓存，否则在同一次请求中多次访问属性时会计算多次，这样会降低应用性能。</p><p>推荐的方式是使用 Symbol + Getter 的模式。</p><p>例如，增加一个 <code>ctx.bar</code> 属性 Getter：</p><pre><code class="language-js">// app/extend/context.js
const BAR = Symbol(&#x27;Context#bar&#x27;);

module.exports = {
  get bar() {
    // this 就是 ctx 对象，在其中可以调用 ctx 上的其他方法，或访问属性
    if (!this[BAR]) {
      // 例如，从 header 中获取，实际情况肯定更复杂
      this[BAR] = this.get(&#x27;x-bar&#x27;);
    }
    return this[BAR];
  },
};</code></pre><h2 id="request">Request</h2><p>Request 对象和 Koa 的 Request 对象相同，是 <strong>请求级别</strong> 的对象，它提供了大量请求相关的属性和方法供使用。</p><h3 id="访问方式">访问方式</h3><pre><code class="language-js">ctx.request</code></pre><p><code>ctx</code> 上的很多属性和方法都被代理到 <code>request</code> 对象上，对于这些属性和方法使用 <code>ctx</code> 和使用 <code>request</code> 去访问它们是等价的，例如 <code>ctx.url === ctx.request.url</code>。</p><p>Koa 内置的代理 <code>request</code> 的属性和方法列表：<a href="http://koajs.com/#request-aliases">Koa - Request aliases</a></p><h3 id="扩展方式">扩展方式</h3><p>框架会把 <code>app/extend/request.js</code> 中定义的对象与内置 <code>request</code> 的 prototype 对象进行合并，在处理请求时会基于扩展后的 prototype 生成 <code>request</code> 对象。</p><p>例如，增加一个 <code>request.foo</code> 属性 Getter：</p><pre><code class="language-js">// app/extend/request.js
module.exports = {
  get foo() {
    return this.get(&#x27;x-request-foo&#x27;);
  },
};</code></pre><h2 id="response">Response</h2><p>Response 对象和 Koa 的 Response 对象相同，是 <strong>请求级别</strong> 的对象，它提供了大量响应相关的属性和方法供使用。</p><h3 id="访问方式">访问方式</h3><pre><code class="language-js">ctx.response</code></pre><p>ctx 上的很多属性和方法都被代理到 <code>response</code> 对象上，对于这些属性和方法使用 <code>ctx</code> 和使用 <code>response</code> 去访问它们是等价的，例如 <code>ctx.status = 404</code> 和 <code>ctx.response.status = 404</code> 是等价的。</p><p>Koa 内置的代理 <code>response</code> 的属性和方法列表：<a href="http://koajs.com/#response-aliases">Koa Response aliases</a></p><h3 id="扩展方式">扩展方式</h3><p>框架会把 <code>app/extend/response.js</code> 中定义的对象与内置 <code>response</code> 的 prototype 对象进行合并，在处理请求时会基于扩展后的 prototype 生成 <code>response</code> 对象。</p><p>例如，增加一个 <code>response.foo</code> 属性 setter：</p><pre><code class="language-js">// app/extend/response.js
module.exports = {
  set foo(value) {
    this.set(&#x27;x-response-foo&#x27;, value);
  },
};</code></pre><p>就可以这样使用啦：<code>this.response.foo = &#x27;bar&#x27;;</code></p><h2 id="helper">Helper</h2><p>Helper 函数用来提供一些实用的 utility 函数。</p><p>它的作用在于我们可以将一些常用的动作抽离在 helper.js 里面成为一个独立的函数，这样可以用 JavaScript 来写复杂的逻辑，避免逻辑分散各处。另外还有一个好处是 Helper 这样一个简单的函数，可以让我们更容易编写测试用例。</p><p>框架内置了一些常用的 Helper 函数。我们也可以编写自定义的 Helper 函数。</p><h3 id="访问方式">访问方式</h3><p>通过 <code>ctx.helper</code> 访问到 helper 对象，例如：</p><pre><code class="language-js">// 假设在 app/router.js 中定义了 home router
app.get(&#x27;home&#x27;, &#x27;/&#x27;, &#x27;home.index&#x27;);

// 使用 helper 计算指定 url path
ctx.helper.pathFor(&#x27;home&#x27;, { by: &#x27;recent&#x27;, limit: 20 })
// =&gt; /?by=recent&amp;limit=20</code></pre><h3 id="扩展方式">扩展方式</h3><p>框架会把 <code>app/extend/helper.js</code> 中定义的对象与内置 <code>helper</code> 的 prototype 对象进行合并，在处理请求时会基于扩展后的 prototype 生成 <code>helper</code> 对象。</p><p>例如，增加一个 <code>helper.foo()</code> 方法：</p><pre><code class="language-js">// app/extend/helper.js
module.exports = {
  foo(param) {
    // this 是 helper 对象，在其中可以调用其他 helper 方法
    // this.ctx =&gt; context 对象
    // this.app =&gt; application 对象
  },
};</code></pre><h2 id="按照环境进行扩展">按照环境进行扩展</h2><p>另外，还可以根据环境进行有选择的扩展，例如，只在 unittest 环境中提供 <code>mockXX()</code> 方法以便进行 mock 方便测试。</p><pre><code class="language-js">// app/extend/application.unittest.js
module.exports = {
  mockXX(k, v) {
  }
};</code></pre><p>这个文件只会在 unittest 环境加载。</p><p>同理，对于 Application，Context，Request，Response，Helper 都可以使用这种方式针对某个环境进行扩展，更多参见<a href="./env.md">运行环境</a>。</p></div></div></div><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-0 ant-col-md-6"><div class="markdown-body" style="font-size:14px"><div><ul><li><a href="#application">Application</a><ul><li><a href="#%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F">访问方式</a></li><li><a href="#%E6%89%A9%E5%B1%95%E6%96%B9%E5%BC%8F">扩展方式</a><ul><li><a href="#%E6%96%B9%E6%B3%95%E6%89%A9%E5%B1%95">方法扩展</a></li><li><a href="#%E5%B1%9E%E6%80%A7%E6%89%A9%E5%B1%95">属性扩展</a></li></ul></li></ul></li><li><a href="#context">Context</a><ul><li><a href="#%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F">访问方式</a></li><li><a href="#%E6%89%A9%E5%B1%95%E6%96%B9%E5%BC%8F">扩展方式</a><ul><li><a href="#%E6%96%B9%E6%B3%95%E6%89%A9%E5%B1%95">方法扩展</a></li><li><a href="#%E5%B1%9E%E6%80%A7%E6%89%A9%E5%B1%95">属性扩展</a></li></ul></li></ul></li><li><a href="#request">Request</a><ul><li><a href="#%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F">访问方式</a></li><li><a href="#%E6%89%A9%E5%B1%95%E6%96%B9%E5%BC%8F">扩展方式</a></li></ul></li><li><a href="#response">Response</a><ul><li><a href="#%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F">访问方式</a></li><li><a href="#%E6%89%A9%E5%B1%95%E6%96%B9%E5%BC%8F">扩展方式</a></li></ul></li><li><a href="#helper">Helper</a><ul><li><a href="#%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F">访问方式</a></li><li><a href="#%E6%89%A9%E5%B1%95%E6%96%B9%E5%BC%8F">扩展方式</a></li></ul></li><li><a href="#%E6%8C%89%E7%85%A7%E7%8E%AF%E5%A2%83%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%B1%95">按照环境进行扩展</a></li></ul></div></div></div></div></div></div></div></div></div><script type="text/javascript">window.__INIT_STATE__={"lang":"zh","props":{"toc":"-%20%5BApplication%5D(%23application)%0A%20%20*%20%5B%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F%5D(%23%25E8%25AE%25BF%25E9%2597%25AE%25E6%2596%25B9%25E5%25BC%258F)%0A%20%20*%20%5B%E6%89%A9%E5%B1%95%E6%96%B9%E5%BC%8F%5D(%23%25E6%2589%25A9%25E5%25B1%2595%25E6%2596%25B9%25E5%25BC%258F)%0A%20%20%20%20%2B%20%5B%E6%96%B9%E6%B3%95%E6%89%A9%E5%B1%95%5D(%23%25E6%2596%25B9%25E6%25B3%2595%25E6%2589%25A9%25E5%25B1%2595)%0A%20%20%20%20%2B%20%5B%E5%B1%9E%E6%80%A7%E6%89%A9%E5%B1%95%5D(%23%25E5%25B1%259E%25E6%2580%25A7%25E6%2589%25A9%25E5%25B1%2595)%0A-%20%5BContext%5D(%23context)%0A%20%20*%20%5B%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F%5D(%23%25E8%25AE%25BF%25E9%2597%25AE%25E6%2596%25B9%25E5%25BC%258F)%0A%20%20*%20%5B%E6%89%A9%E5%B1%95%E6%96%B9%E5%BC%8F%5D(%23%25E6%2589%25A9%25E5%25B1%2595%25E6%2596%25B9%25E5%25BC%258F)%0A%20%20%20%20%2B%20%5B%E6%96%B9%E6%B3%95%E6%89%A9%E5%B1%95%5D(%23%25E6%2596%25B9%25E6%25B3%2595%25E6%2589%25A9%25E5%25B1%2595)%0A%20%20%20%20%2B%20%5B%E5%B1%9E%E6%80%A7%E6%89%A9%E5%B1%95%5D(%23%25E5%25B1%259E%25E6%2580%25A7%25E6%2589%25A9%25E5%25B1%2595)%0A-%20%5BRequest%5D(%23request)%0A%20%20*%20%5B%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F%5D(%23%25E8%25AE%25BF%25E9%2597%25AE%25E6%2596%25B9%25E5%25BC%258F)%0A%20%20*%20%5B%E6%89%A9%E5%B1%95%E6%96%B9%E5%BC%8F%5D(%23%25E6%2589%25A9%25E5%25B1%2595%25E6%2596%25B9%25E5%25BC%258F)%0A-%20%5BResponse%5D(%23response)%0A%20%20*%20%5B%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F%5D(%23%25E8%25AE%25BF%25E9%2597%25AE%25E6%2596%25B9%25E5%25BC%258F)%0A%20%20*%20%5B%E6%89%A9%E5%B1%95%E6%96%B9%E5%BC%8F%5D(%23%25E6%2589%25A9%25E5%25B1%2595%25E6%2596%25B9%25E5%25BC%258F)%0A-%20%5BHelper%5D(%23helper)%0A%20%20*%20%5B%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F%5D(%23%25E8%25AE%25BF%25E9%2597%25AE%25E6%2596%25B9%25E5%25BC%258F)%0A%20%20*%20%5B%E6%89%A9%E5%B1%95%E6%96%B9%E5%BC%8F%5D(%23%25E6%2589%25A9%25E5%25B1%2595%25E6%2596%25B9%25E5%25BC%258F)%0A-%20%5B%E6%8C%89%E7%85%A7%E7%8E%AF%E5%A2%83%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%B1%95%5D(%23%25E6%258C%2589%25E7%2585%25A7%25E7%258E%25AF%25E5%25A2%2583%25E8%25BF%259B%25E8%25A1%258C%25E6%2589%25A9%25E5%25B1%2595)","meta":{"info":{"title":"框架扩展"}},"content":"%0A%0A%0A%E6%A1%86%E6%9E%B6%E6%8F%90%E4%BE%9B%E4%BA%86%E5%A4%9A%E7%A7%8D%E6%89%A9%E5%B1%95%E7%82%B9%E6%89%A9%E5%B1%95%E8%87%AA%E8%BA%AB%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%9A%0A%0A-%20Application%0A-%20Context%0A-%20Request%0A-%20Response%0A-%20Helper%0A%0A%E5%9C%A8%E5%BC%80%E5%8F%91%E4%B8%AD%EF%BC%8C%E6%88%91%E4%BB%AC%E6%97%A2%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E5%B7%B2%E6%9C%89%E7%9A%84%E6%89%A9%E5%B1%95%20API%20%E6%9D%A5%E6%96%B9%E4%BE%BF%E5%BC%80%E5%8F%91%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%AF%B9%E4%BB%A5%E4%B8%8A%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E6%89%A9%E5%B1%95%EF%BC%8C%E8%BF%9B%E4%B8%80%E6%AD%A5%E5%8A%A0%E5%BC%BA%E6%A1%86%E6%9E%B6%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%82%0A%0A%23%23%20Application%0A%0A%60app%60%20%E5%AF%B9%E8%B1%A1%E6%8C%87%E7%9A%84%E6%98%AF%20Koa%20%E7%9A%84%E5%85%A8%E5%B1%80%E5%BA%94%E7%94%A8%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%85%A8%E5%B1%80%E5%8F%AA%E6%9C%89%E4%B8%80%E4%B8%AA%EF%BC%8C%E5%9C%A8%E5%BA%94%E7%94%A8%E5%90%AF%E5%8A%A8%E6%97%B6%E8%A2%AB%E5%88%9B%E5%BB%BA%E3%80%82%0A%0A%23%23%23%20%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F%0A%0A-%20%60ctx.app%60%0A-%20Controller%EF%BC%8CMiddleware%EF%BC%8CHelper%EF%BC%8CService%20%E4%B8%AD%E9%83%BD%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20%60this.app%60%20%E8%AE%BF%E9%97%AE%E5%88%B0%20Application%20%E5%AF%B9%E8%B1%A1%EF%BC%8C%E4%BE%8B%E5%A6%82%20%60this.app.config%60%20%E8%AE%BF%E9%97%AE%E9%85%8D%E7%BD%AE%E5%AF%B9%E8%B1%A1%E3%80%82%0A-%20%E5%9C%A8%20%60app.js%60%20%E4%B8%AD%20%60app%60%20%E5%AF%B9%E8%B1%A1%E4%BC%9A%E4%BD%9C%E4%B8%BA%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5%E5%88%B0%E5%85%A5%E5%8F%A3%E5%87%BD%E6%95%B0%E4%B8%AD%0A%0A%20%20%20%60%60%60js%0A%20%20%20%2F%2F%20app.js%0A%20%20%20module.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20%20%20%20%2F%2F%20%E4%BD%BF%E7%94%A8%20app%20%E5%AF%B9%E8%B1%A1%0A%20%20%20%7D%3B%0A%20%20%20%60%60%60%0A%0A%23%23%23%20%E6%89%A9%E5%B1%95%E6%96%B9%E5%BC%8F%0A%0A%E6%A1%86%E6%9E%B6%E4%BC%9A%E6%8A%8A%20%60app%2Fextend%2Fapplication.js%60%20%E4%B8%AD%E5%AE%9A%E4%B9%89%E7%9A%84%E5%AF%B9%E8%B1%A1%E4%B8%8E%20Koa%20Application%20%E7%9A%84%20prototype%20%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E5%90%88%E5%B9%B6%EF%BC%8C%E5%9C%A8%E5%BA%94%E7%94%A8%E5%90%AF%E5%8A%A8%E6%97%B6%E4%BC%9A%E5%9F%BA%E4%BA%8E%E6%89%A9%E5%B1%95%E5%90%8E%E7%9A%84%20prototype%20%E7%94%9F%E6%88%90%20%60app%60%20%E5%AF%B9%E8%B1%A1%E3%80%82%0A%0A%23%23%23%23%20%E6%96%B9%E6%B3%95%E6%89%A9%E5%B1%95%0A%0A%E4%BE%8B%E5%A6%82%EF%BC%8C%E6%88%91%E4%BB%AC%E8%A6%81%E5%A2%9E%E5%8A%A0%E4%B8%80%E4%B8%AA%20%60app.foo()%60%20%E6%96%B9%E6%B3%95%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fextend%2Fapplication.js%0Amodule.exports%20%3D%20%7B%0A%20%20foo(param)%20%7B%0A%20%20%20%20%2F%2F%20this%20%E5%B0%B1%E6%98%AF%20app%20%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%9C%A8%E5%85%B6%E4%B8%AD%E5%8F%AF%E4%BB%A5%E8%B0%83%E7%94%A8%20app%20%E4%B8%8A%E7%9A%84%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95%EF%BC%8C%E6%88%96%E8%AE%BF%E9%97%AE%E5%B1%9E%E6%80%A7%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%23%23%23%23%20%E5%B1%9E%E6%80%A7%E6%89%A9%E5%B1%95%0A%0A%E4%B8%80%E8%88%AC%E6%9D%A5%E8%AF%B4%E5%B1%9E%E6%80%A7%E7%9A%84%E8%AE%A1%E7%AE%97%E5%8F%AA%E9%9C%80%E8%A6%81%E8%BF%9B%E8%A1%8C%E4%B8%80%E6%AC%A1%EF%BC%8C%E9%82%A3%E4%B9%88%E4%B8%80%E5%AE%9A%E8%A6%81%E5%AE%9E%E7%8E%B0%E7%BC%93%E5%AD%98%EF%BC%8C%E5%90%A6%E5%88%99%E5%9C%A8%E5%A4%9A%E6%AC%A1%E8%AE%BF%E9%97%AE%E5%B1%9E%E6%80%A7%E6%97%B6%E4%BC%9A%E8%AE%A1%E7%AE%97%E5%A4%9A%E6%AC%A1%EF%BC%8C%E8%BF%99%E6%A0%B7%E4%BC%9A%E9%99%8D%E4%BD%8E%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%E3%80%82%0A%0A%E6%8E%A8%E8%8D%90%E7%9A%84%E6%96%B9%E5%BC%8F%E6%98%AF%E4%BD%BF%E7%94%A8%20Symbol%20%2B%20Getter%20%E7%9A%84%E6%A8%A1%E5%BC%8F%E3%80%82%0A%0A%E4%BE%8B%E5%A6%82%EF%BC%8C%E5%A2%9E%E5%8A%A0%E4%B8%80%E4%B8%AA%20%60app.bar%60%20%E5%B1%9E%E6%80%A7%20Getter%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fextend%2Fapplication.js%0Aconst%20BAR%20%3D%20Symbol('Application%23bar')%3B%0A%0Amodule.exports%20%3D%20%7B%0A%20%20get%20bar()%20%7B%0A%20%20%20%20%2F%2F%20this%20%E5%B0%B1%E6%98%AF%20app%20%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%9C%A8%E5%85%B6%E4%B8%AD%E5%8F%AF%E4%BB%A5%E8%B0%83%E7%94%A8%20app%20%E4%B8%8A%E7%9A%84%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95%EF%BC%8C%E6%88%96%E8%AE%BF%E9%97%AE%E5%B1%9E%E6%80%A7%0A%20%20%20%20if%20(!this%5BBAR%5D)%20%7B%0A%20%20%20%20%20%20%2F%2F%20%E5%AE%9E%E9%99%85%E6%83%85%E5%86%B5%E8%82%AF%E5%AE%9A%E6%9B%B4%E5%A4%8D%E6%9D%82%0A%20%20%20%20%20%20this%5BBAR%5D%20%3D%20this.config.xx%20%2B%20this.config.yy%3B%0A%20%20%20%20%7D%0A%20%20%20%20return%20this%5BBAR%5D%3B%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%23%23%20Context%0A%0AContext%20%E6%8C%87%E7%9A%84%E6%98%AF%20Koa%20%E7%9A%84%E8%AF%B7%E6%B1%82%E4%B8%8A%E4%B8%8B%E6%96%87%EF%BC%8C%E8%BF%99%E6%98%AF%20**%E8%AF%B7%E6%B1%82%E7%BA%A7%E5%88%AB**%20%E7%9A%84%E5%AF%B9%E8%B1%A1%EF%BC%8C%E6%AF%8F%E6%AC%A1%E8%AF%B7%E6%B1%82%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%20Context%20%E5%AE%9E%E4%BE%8B%EF%BC%8C%E9%80%9A%E5%B8%B8%E6%88%91%E4%BB%AC%E4%B9%9F%E7%AE%80%E5%86%99%E6%88%90%20%60ctx%60%E3%80%82%E5%9C%A8%E6%89%80%E6%9C%89%E7%9A%84%E6%96%87%E6%A1%A3%E4%B8%AD%EF%BC%8CContext%20%E5%92%8C%20%60ctx%60%20%E9%83%BD%E6%98%AF%E6%8C%87%20Koa%20%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87%E5%AF%B9%E8%B1%A1%E3%80%82%0A%0A%23%23%23%20%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F%0A%0A-%20middleware%20%E4%B8%AD%20%60this%60%20%E5%B0%B1%E6%98%AF%20ctx%EF%BC%8C%E4%BE%8B%E5%A6%82%20%60this.cookies.get('foo')%60%E3%80%82%0A-%20controller%20%E6%9C%89%E4%B8%A4%E7%A7%8D%E5%86%99%E6%B3%95%EF%BC%8C%E7%B1%BB%E7%9A%84%E5%86%99%E6%B3%95%E9%80%9A%E8%BF%87%20%60this.ctx%60%EF%BC%8C%E6%96%B9%E6%B3%95%E7%9A%84%E5%86%99%E6%B3%95%E7%9B%B4%E6%8E%A5%E9%80%9A%E8%BF%87%20%60ctx%60%20%E5%85%A5%E5%8F%82%E3%80%82%0A-%20helper%EF%BC%8Cservice%20%E4%B8%AD%E7%9A%84%20this%20%E6%8C%87%E5%90%91%20helper%EF%BC%8Cservice%20%E5%AF%B9%E8%B1%A1%E6%9C%AC%E8%BA%AB%EF%BC%8C%E4%BD%BF%E7%94%A8%20%60this.ctx%60%20%E8%AE%BF%E9%97%AE%20context%20%E5%AF%B9%E8%B1%A1%EF%BC%8C%E4%BE%8B%E5%A6%82%20%60this.ctx.cookies.get('foo')%60%E3%80%82%0A%0A%23%23%23%20%E6%89%A9%E5%B1%95%E6%96%B9%E5%BC%8F%0A%0A%E6%A1%86%E6%9E%B6%E4%BC%9A%E6%8A%8A%20%60app%2Fextend%2Fcontext.js%60%20%E4%B8%AD%E5%AE%9A%E4%B9%89%E7%9A%84%E5%AF%B9%E8%B1%A1%E4%B8%8E%20Koa%20Context%20%E7%9A%84%20prototype%20%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E5%90%88%E5%B9%B6%EF%BC%8C%E5%9C%A8%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82%E6%97%B6%E4%BC%9A%E5%9F%BA%E4%BA%8E%E6%89%A9%E5%B1%95%E5%90%8E%E7%9A%84%20prototype%20%E7%94%9F%E6%88%90%20ctx%20%E5%AF%B9%E8%B1%A1%E3%80%82%0A%0A%23%23%23%23%20%E6%96%B9%E6%B3%95%E6%89%A9%E5%B1%95%0A%0A%E4%BE%8B%E5%A6%82%EF%BC%8C%E6%88%91%E4%BB%AC%E8%A6%81%E5%A2%9E%E5%8A%A0%E4%B8%80%E4%B8%AA%20%60ctx.foo()%60%20%E6%96%B9%E6%B3%95%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fextend%2Fcontext.js%0Amodule.exports%20%3D%20%7B%0A%20%20foo(param)%20%7B%0A%20%20%20%20%2F%2F%20this%20%E5%B0%B1%E6%98%AF%20ctx%20%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%9C%A8%E5%85%B6%E4%B8%AD%E5%8F%AF%E4%BB%A5%E8%B0%83%E7%94%A8%20ctx%20%E4%B8%8A%E7%9A%84%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95%EF%BC%8C%E6%88%96%E8%AE%BF%E9%97%AE%E5%B1%9E%E6%80%A7%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%23%23%23%23%20%E5%B1%9E%E6%80%A7%E6%89%A9%E5%B1%95%0A%0A%E4%B8%80%E8%88%AC%E6%9D%A5%E8%AF%B4%E5%B1%9E%E6%80%A7%E7%9A%84%E8%AE%A1%E7%AE%97%E5%9C%A8%E5%90%8C%E4%B8%80%E6%AC%A1%E8%AF%B7%E6%B1%82%E4%B8%AD%E5%8F%AA%E9%9C%80%E8%A6%81%E8%BF%9B%E8%A1%8C%E4%B8%80%E6%AC%A1%EF%BC%8C%E9%82%A3%E4%B9%88%E4%B8%80%E5%AE%9A%E8%A6%81%E5%AE%9E%E7%8E%B0%E7%BC%93%E5%AD%98%EF%BC%8C%E5%90%A6%E5%88%99%E5%9C%A8%E5%90%8C%E4%B8%80%E6%AC%A1%E8%AF%B7%E6%B1%82%E4%B8%AD%E5%A4%9A%E6%AC%A1%E8%AE%BF%E9%97%AE%E5%B1%9E%E6%80%A7%E6%97%B6%E4%BC%9A%E8%AE%A1%E7%AE%97%E5%A4%9A%E6%AC%A1%EF%BC%8C%E8%BF%99%E6%A0%B7%E4%BC%9A%E9%99%8D%E4%BD%8E%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%E3%80%82%0A%0A%E6%8E%A8%E8%8D%90%E7%9A%84%E6%96%B9%E5%BC%8F%E6%98%AF%E4%BD%BF%E7%94%A8%20Symbol%20%2B%20Getter%20%E7%9A%84%E6%A8%A1%E5%BC%8F%E3%80%82%0A%0A%E4%BE%8B%E5%A6%82%EF%BC%8C%E5%A2%9E%E5%8A%A0%E4%B8%80%E4%B8%AA%20%60ctx.bar%60%20%E5%B1%9E%E6%80%A7%20Getter%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fextend%2Fcontext.js%0Aconst%20BAR%20%3D%20Symbol('Context%23bar')%3B%0A%0Amodule.exports%20%3D%20%7B%0A%20%20get%20bar()%20%7B%0A%20%20%20%20%2F%2F%20this%20%E5%B0%B1%E6%98%AF%20ctx%20%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%9C%A8%E5%85%B6%E4%B8%AD%E5%8F%AF%E4%BB%A5%E8%B0%83%E7%94%A8%20ctx%20%E4%B8%8A%E7%9A%84%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95%EF%BC%8C%E6%88%96%E8%AE%BF%E9%97%AE%E5%B1%9E%E6%80%A7%0A%20%20%20%20if%20(!this%5BBAR%5D)%20%7B%0A%20%20%20%20%20%20%2F%2F%20%E4%BE%8B%E5%A6%82%EF%BC%8C%E4%BB%8E%20header%20%E4%B8%AD%E8%8E%B7%E5%8F%96%EF%BC%8C%E5%AE%9E%E9%99%85%E6%83%85%E5%86%B5%E8%82%AF%E5%AE%9A%E6%9B%B4%E5%A4%8D%E6%9D%82%0A%20%20%20%20%20%20this%5BBAR%5D%20%3D%20this.get('x-bar')%3B%0A%20%20%20%20%7D%0A%20%20%20%20return%20this%5BBAR%5D%3B%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%23%23%20Request%0A%0ARequest%20%E5%AF%B9%E8%B1%A1%E5%92%8C%20Koa%20%E7%9A%84%20Request%20%E5%AF%B9%E8%B1%A1%E7%9B%B8%E5%90%8C%EF%BC%8C%E6%98%AF%20**%E8%AF%B7%E6%B1%82%E7%BA%A7%E5%88%AB**%20%E7%9A%84%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%AE%83%E6%8F%90%E4%BE%9B%E4%BA%86%E5%A4%A7%E9%87%8F%E8%AF%B7%E6%B1%82%E7%9B%B8%E5%85%B3%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95%E4%BE%9B%E4%BD%BF%E7%94%A8%E3%80%82%0A%0A%23%23%23%20%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F%0A%0A%60%60%60js%0Actx.request%0A%60%60%60%0A%0A%60ctx%60%20%E4%B8%8A%E7%9A%84%E5%BE%88%E5%A4%9A%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95%E9%83%BD%E8%A2%AB%E4%BB%A3%E7%90%86%E5%88%B0%20%60request%60%20%E5%AF%B9%E8%B1%A1%E4%B8%8A%EF%BC%8C%E5%AF%B9%E4%BA%8E%E8%BF%99%E4%BA%9B%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95%E4%BD%BF%E7%94%A8%20%60ctx%60%20%E5%92%8C%E4%BD%BF%E7%94%A8%20%60request%60%20%E5%8E%BB%E8%AE%BF%E9%97%AE%E5%AE%83%E4%BB%AC%E6%98%AF%E7%AD%89%E4%BB%B7%E7%9A%84%EF%BC%8C%E4%BE%8B%E5%A6%82%20%60ctx.url%20%3D%3D%3D%20ctx.request.url%60%E3%80%82%0A%0AKoa%20%E5%86%85%E7%BD%AE%E7%9A%84%E4%BB%A3%E7%90%86%20%60request%60%20%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95%E5%88%97%E8%A1%A8%EF%BC%9A%5BKoa%20-%20Request%20aliases%5D(http%3A%2F%2Fkoajs.com%2F%23request-aliases)%0A%0A%23%23%23%20%E6%89%A9%E5%B1%95%E6%96%B9%E5%BC%8F%0A%0A%E6%A1%86%E6%9E%B6%E4%BC%9A%E6%8A%8A%20%60app%2Fextend%2Frequest.js%60%20%E4%B8%AD%E5%AE%9A%E4%B9%89%E7%9A%84%E5%AF%B9%E8%B1%A1%E4%B8%8E%E5%86%85%E7%BD%AE%20%60request%60%20%E7%9A%84%20prototype%20%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E5%90%88%E5%B9%B6%EF%BC%8C%E5%9C%A8%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82%E6%97%B6%E4%BC%9A%E5%9F%BA%E4%BA%8E%E6%89%A9%E5%B1%95%E5%90%8E%E7%9A%84%20prototype%20%E7%94%9F%E6%88%90%20%60request%60%20%E5%AF%B9%E8%B1%A1%E3%80%82%0A%0A%E4%BE%8B%E5%A6%82%EF%BC%8C%E5%A2%9E%E5%8A%A0%E4%B8%80%E4%B8%AA%20%60request.foo%60%20%E5%B1%9E%E6%80%A7%20Getter%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fextend%2Frequest.js%0Amodule.exports%20%3D%20%7B%0A%20%20get%20foo()%20%7B%0A%20%20%20%20return%20this.get('x-request-foo')%3B%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%23%23%20Response%0A%0AResponse%20%E5%AF%B9%E8%B1%A1%E5%92%8C%20Koa%20%E7%9A%84%20Response%20%E5%AF%B9%E8%B1%A1%E7%9B%B8%E5%90%8C%EF%BC%8C%E6%98%AF%20**%E8%AF%B7%E6%B1%82%E7%BA%A7%E5%88%AB**%20%E7%9A%84%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%AE%83%E6%8F%90%E4%BE%9B%E4%BA%86%E5%A4%A7%E9%87%8F%E5%93%8D%E5%BA%94%E7%9B%B8%E5%85%B3%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95%E4%BE%9B%E4%BD%BF%E7%94%A8%E3%80%82%0A%0A%23%23%23%20%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F%0A%0A%60%60%60js%0Actx.response%0A%60%60%60%0A%0Actx%20%E4%B8%8A%E7%9A%84%E5%BE%88%E5%A4%9A%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95%E9%83%BD%E8%A2%AB%E4%BB%A3%E7%90%86%E5%88%B0%20%60response%60%20%E5%AF%B9%E8%B1%A1%E4%B8%8A%EF%BC%8C%E5%AF%B9%E4%BA%8E%E8%BF%99%E4%BA%9B%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95%E4%BD%BF%E7%94%A8%20%60ctx%60%20%E5%92%8C%E4%BD%BF%E7%94%A8%20%60response%60%20%E5%8E%BB%E8%AE%BF%E9%97%AE%E5%AE%83%E4%BB%AC%E6%98%AF%E7%AD%89%E4%BB%B7%E7%9A%84%EF%BC%8C%E4%BE%8B%E5%A6%82%20%60ctx.status%20%3D%20404%60%20%E5%92%8C%20%60ctx.response.status%20%3D%20404%60%20%E6%98%AF%E7%AD%89%E4%BB%B7%E7%9A%84%E3%80%82%0A%0AKoa%20%E5%86%85%E7%BD%AE%E7%9A%84%E4%BB%A3%E7%90%86%20%60response%60%20%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95%E5%88%97%E8%A1%A8%EF%BC%9A%5BKoa%20Response%20aliases%5D(http%3A%2F%2Fkoajs.com%2F%23response-aliases)%0A%0A%23%23%23%20%E6%89%A9%E5%B1%95%E6%96%B9%E5%BC%8F%0A%0A%E6%A1%86%E6%9E%B6%E4%BC%9A%E6%8A%8A%20%60app%2Fextend%2Fresponse.js%60%20%E4%B8%AD%E5%AE%9A%E4%B9%89%E7%9A%84%E5%AF%B9%E8%B1%A1%E4%B8%8E%E5%86%85%E7%BD%AE%20%60response%60%20%E7%9A%84%20prototype%20%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E5%90%88%E5%B9%B6%EF%BC%8C%E5%9C%A8%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82%E6%97%B6%E4%BC%9A%E5%9F%BA%E4%BA%8E%E6%89%A9%E5%B1%95%E5%90%8E%E7%9A%84%20prototype%20%E7%94%9F%E6%88%90%20%60response%60%20%E5%AF%B9%E8%B1%A1%E3%80%82%0A%0A%E4%BE%8B%E5%A6%82%EF%BC%8C%E5%A2%9E%E5%8A%A0%E4%B8%80%E4%B8%AA%20%60response.foo%60%20%E5%B1%9E%E6%80%A7%20setter%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fextend%2Fresponse.js%0Amodule.exports%20%3D%20%7B%0A%20%20set%20foo(value)%20%7B%0A%20%20%20%20this.set('x-response-foo'%2C%20value)%3B%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%E5%B0%B1%E5%8F%AF%E4%BB%A5%E8%BF%99%E6%A0%B7%E4%BD%BF%E7%94%A8%E5%95%A6%EF%BC%9A%60this.response.foo%20%3D%20'bar'%3B%60%0A%0A%23%23%20Helper%0A%0AHelper%20%E5%87%BD%E6%95%B0%E7%94%A8%E6%9D%A5%E6%8F%90%E4%BE%9B%E4%B8%80%E4%BA%9B%E5%AE%9E%E7%94%A8%E7%9A%84%20utility%20%E5%87%BD%E6%95%B0%E3%80%82%0A%0A%E5%AE%83%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9C%A8%E4%BA%8E%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%B0%86%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E7%9A%84%E5%8A%A8%E4%BD%9C%E6%8A%BD%E7%A6%BB%E5%9C%A8%20helper.js%20%E9%87%8C%E9%9D%A2%E6%88%90%E4%B8%BA%E4%B8%80%E4%B8%AA%E7%8B%AC%E7%AB%8B%E7%9A%84%E5%87%BD%E6%95%B0%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%8F%AF%E4%BB%A5%E7%94%A8%20JavaScript%20%E6%9D%A5%E5%86%99%E5%A4%8D%E6%9D%82%E7%9A%84%E9%80%BB%E8%BE%91%EF%BC%8C%E9%81%BF%E5%85%8D%E9%80%BB%E8%BE%91%E5%88%86%E6%95%A3%E5%90%84%E5%A4%84%E3%80%82%E5%8F%A6%E5%A4%96%E8%BF%98%E6%9C%89%E4%B8%80%E4%B8%AA%E5%A5%BD%E5%A4%84%E6%98%AF%20Helper%20%E8%BF%99%E6%A0%B7%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%87%BD%E6%95%B0%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%AE%A9%E6%88%91%E4%BB%AC%E6%9B%B4%E5%AE%B9%E6%98%93%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%E3%80%82%0A%0A%E6%A1%86%E6%9E%B6%E5%86%85%E7%BD%AE%E4%BA%86%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E7%9A%84%20Helper%20%E5%87%BD%E6%95%B0%E3%80%82%E6%88%91%E4%BB%AC%E4%B9%9F%E5%8F%AF%E4%BB%A5%E7%BC%96%E5%86%99%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%20Helper%20%E5%87%BD%E6%95%B0%E3%80%82%0A%0A%23%23%23%20%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F%0A%0A%E9%80%9A%E8%BF%87%20%60ctx.helper%60%20%E8%AE%BF%E9%97%AE%E5%88%B0%20helper%20%E5%AF%B9%E8%B1%A1%EF%BC%8C%E4%BE%8B%E5%A6%82%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20%E5%81%87%E8%AE%BE%E5%9C%A8%20app%2Frouter.js%20%E4%B8%AD%E5%AE%9A%E4%B9%89%E4%BA%86%20home%20router%0Aapp.get('home'%2C%20'%2F'%2C%20'home.index')%3B%0A%0A%2F%2F%20%E4%BD%BF%E7%94%A8%20helper%20%E8%AE%A1%E7%AE%97%E6%8C%87%E5%AE%9A%20url%20path%0Actx.helper.pathFor('home'%2C%20%7B%20by%3A%20'recent'%2C%20limit%3A%2020%20%7D)%0A%2F%2F%20%3D%3E%20%2F%3Fby%3Drecent%26limit%3D20%0A%60%60%60%0A%0A%23%23%23%20%E6%89%A9%E5%B1%95%E6%96%B9%E5%BC%8F%0A%0A%E6%A1%86%E6%9E%B6%E4%BC%9A%E6%8A%8A%20%60app%2Fextend%2Fhelper.js%60%20%E4%B8%AD%E5%AE%9A%E4%B9%89%E7%9A%84%E5%AF%B9%E8%B1%A1%E4%B8%8E%E5%86%85%E7%BD%AE%20%60helper%60%20%E7%9A%84%20prototype%20%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E5%90%88%E5%B9%B6%EF%BC%8C%E5%9C%A8%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82%E6%97%B6%E4%BC%9A%E5%9F%BA%E4%BA%8E%E6%89%A9%E5%B1%95%E5%90%8E%E7%9A%84%20prototype%20%E7%94%9F%E6%88%90%20%60helper%60%20%E5%AF%B9%E8%B1%A1%E3%80%82%0A%0A%E4%BE%8B%E5%A6%82%EF%BC%8C%E5%A2%9E%E5%8A%A0%E4%B8%80%E4%B8%AA%20%60helper.foo()%60%20%E6%96%B9%E6%B3%95%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fextend%2Fhelper.js%0Amodule.exports%20%3D%20%7B%0A%20%20foo(param)%20%7B%0A%20%20%20%20%2F%2F%20this%20%E6%98%AF%20helper%20%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%9C%A8%E5%85%B6%E4%B8%AD%E5%8F%AF%E4%BB%A5%E8%B0%83%E7%94%A8%E5%85%B6%E4%BB%96%20helper%20%E6%96%B9%E6%B3%95%0A%20%20%20%20%2F%2F%20this.ctx%20%3D%3E%20context%20%E5%AF%B9%E8%B1%A1%0A%20%20%20%20%2F%2F%20this.app%20%3D%3E%20application%20%E5%AF%B9%E8%B1%A1%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%0A%23%23%20%E6%8C%89%E7%85%A7%E7%8E%AF%E5%A2%83%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%B1%95%0A%0A%E5%8F%A6%E5%A4%96%EF%BC%8C%E8%BF%98%E5%8F%AF%E4%BB%A5%E6%A0%B9%E6%8D%AE%E7%8E%AF%E5%A2%83%E8%BF%9B%E8%A1%8C%E6%9C%89%E9%80%89%E6%8B%A9%E7%9A%84%E6%89%A9%E5%B1%95%EF%BC%8C%E4%BE%8B%E5%A6%82%EF%BC%8C%E5%8F%AA%E5%9C%A8%20unittest%20%E7%8E%AF%E5%A2%83%E4%B8%AD%E6%8F%90%E4%BE%9B%20%60mockXX()%60%20%E6%96%B9%E6%B3%95%E4%BB%A5%E4%BE%BF%E8%BF%9B%E8%A1%8C%20mock%20%E6%96%B9%E4%BE%BF%E6%B5%8B%E8%AF%95%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20app%2Fextend%2Fapplication.unittest.js%0Amodule.exports%20%3D%20%7B%0A%20%20mockXX(k%2C%20v)%20%7B%0A%20%20%7D%0A%7D%3B%0A%60%60%60%0A%0A%E8%BF%99%E4%B8%AA%E6%96%87%E4%BB%B6%E5%8F%AA%E4%BC%9A%E5%9C%A8%20unittest%20%E7%8E%AF%E5%A2%83%E5%8A%A0%E8%BD%BD%E3%80%82%0A%0A%E5%90%8C%E7%90%86%EF%BC%8C%E5%AF%B9%E4%BA%8E%20Application%EF%BC%8CContext%EF%BC%8CRequest%EF%BC%8CResponse%EF%BC%8CHelper%20%E9%83%BD%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E8%BF%99%E7%A7%8D%E6%96%B9%E5%BC%8F%E9%92%88%E5%AF%B9%E6%9F%90%E4%B8%AA%E7%8E%AF%E5%A2%83%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%B1%95%EF%BC%8C%E6%9B%B4%E5%A4%9A%E5%8F%82%E8%A7%81%5B%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%5D(.%2Fenv.md)%E3%80%82%0A"}}</script><script type="text/javascript" src="/static/js/post.b9faab88.js"></script></body></html>