<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.png"><style class="_styletron_hydrate_"></style><title>Router 路由</title><meta name="description" content="Born to build better enterprise frameworks and apps"><link href="/static/css/post.d62265dc.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="ant-layout" data-reactroot=""><div class="header-module__header___3ADJ9 ant-layout-header"><div class="ant-row-flex"><div class="ant-col-xs-12 ant-col-md-20 ant-col-lg-2"><div class="header-module__logo___3yTXp"><a href="/"><img src="/logo.svg" alt="logo"/></a></div></div><div class="ant-col-xs-0 ant-col-md-0 ant-col-lg-20"><ul class="ant-menu header-module__menu___3yEtW ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/intro/">指南</a></li><li class="ant-menu-item" role="menuitem"><a href="/api/">API</a></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/tutorials/index.html">教程</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/search?q=topic%3Aegg-plugin&amp;type=Repositories">插件</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/eggjs/egg/releases">发布日志</a></li></ul></div><div style="text-align:right" class="ant-col-xs-12 ant-col-md-4 ant-col-lg-2"><button type="button" class="ant-btn"><span>Languages</span></button></div></div></div><div class="ant-layout-content"><div class="basic_layout-module__content___3flpY ant-layout"><div class="sider-module__side___1Cadj ant-layout-sider ant-layout-sider-light" style="flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"><ul class="ant-menu sider-module__menu___2GqPr ant-menu-light ant-menu-root ant-menu-inline" role="menu"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="0$Menu" aria-haspopup="true"><span>新手指南</span><i class="ant-menu-submenu-arrow"></i></div><ul id="0$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/index.html">Egg.js 是什么?</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/egg-and-koa.html">Egg.js 和 Koa</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/quickstart.html">快速入门</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/progressive.html">渐进式开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/migration.html">2.x 升级指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="1$Menu" aria-haspopup="true"><span>基础功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="1$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/structure.html">目录结构</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/objects.html">内置对象</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/env.html">运行环境</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/config.html">配置</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/middleware.html">中间件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/router.html">Router</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/controller.html">Controller</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/service.html">Service</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/plugin.html">插件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/schedule.html">定时任务</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/extend.html">框架扩展</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/app-start.html">启动自定义</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="2$Menu" aria-haspopup="true"><span>核心功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="2$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/development.html">本地开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/unittest.html">单元测试</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/deployment.html">应用部署</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/logger.html">日志</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/httpclient.html">HttpClient</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cookie-and-session.html">Cookie and Session</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cluster-and-ipc.html">多进程模型和进程间通讯</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/view.html">模板渲染</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/error-handling.html">异常处理</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/security.html">安全</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/i18n.html">国际化</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="3$Menu" aria-haspopup="true"><span>教程</span><i class="ant-menu-submenu-arrow"></i></div><ul id="3$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/mysql.html">MySQL</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/restful.html">RESTful API</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/passport.html">Passport 鉴权</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/socketio.html">Socket.IO</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/assets.html">静态资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/typescript.html">TypeScript</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="4$Menu" aria-haspopup="true"><span>进阶</span><i class="ant-menu-submenu-arrow"></i></div><ul id="4$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/loader.html">Loader</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/plugin.html">插件开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/framework.html">框架开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/cluster-client.html">多进程研发模式增强</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/view-plugin.html">模板插件开发规范</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/style-guide.html">代码风格指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="5$Menu" aria-haspopup="true"><span>社区</span><i class="ant-menu-submenu-arrow"></i></div><ul id="5$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/plugins/">内置插件列表</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/contributing.html">如何贡献</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/resource.html">资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/faq.html">常见问题</a></li></ul></li></ul></div></div><div class="basic_layout-module__post___2Z7KK ant-layout-content"><div class="ant-row" style="margin-left:-8px;margin-right:-8px"><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-24 ant-col-md-18"><div class="markdown-body" style="font-size:14px"><div><p>Router 主要用来描述请求 URL 和具体承担执行动作的 Controller 的对应关系，
框架约定了 <code>app/router.js</code> 文件用于统一所有路由规则。</p><p>通过统一的配置，我们可以避免路由规则逻辑散落在多个地方，从而出现未知的冲突，集中在一起我们可以更方便的来查看全局的路由规则。</p><h2 id="如何定义-router">如何定义 Router</h2><ul><li><code>app/router.js</code> 里面定义 URL 路由规则</li></ul><pre><code class="language-js">// app/router.js
module.exports = app =&gt; {
  const { router, controller } = app;
  router.get(&#x27;/user/:id&#x27;, controller.user.info);
};</code></pre><ul><li><code>app/controller</code> 目录下面实现 Controller</li></ul><pre><code class="language-js">// app/controller/user.js
class UserController extends Controller {
  async info() {
    const { ctx } = this;
    ctx.body = {
      name: `hello ${ctx.params.id}`,
    };
  }
}</code></pre><p>这样就完成了一个最简单的 Router 定义，当用户执行 <code>GET /user/123</code>，<code>user.js</code> 这个里面的 info 方法就会执行。</p><h2 id="router-详细定义说明">Router 详细定义说明</h2><p>下面是路由的完整定义，参数可以根据场景的不同，自由选择：</p><pre><code class="language-js">router.verb(&#x27;path-match&#x27;, app.controller.action);
router.verb(&#x27;router-name&#x27;, &#x27;path-match&#x27;, app.controller.action);
router.verb(&#x27;path-match&#x27;, middleware1, ..., middlewareN, app.controller.action);
router.verb(&#x27;router-name&#x27;, &#x27;path-match&#x27;, middleware1, ..., middlewareN, app.controller.action);</code></pre><p>路由完整定义主要包括5个主要部分:</p><ul><li>verb - 用户触发动作，支持 get，post 等所有 HTTP 方法，后面会通过示例详细说明。<ul><li>router.head - HEAD</li><li>router.options - OPTIONS</li><li>router.get - GET</li><li>router.put - PUT</li><li>router.post - POST</li><li>router.patch - PATCH</li><li>router.delete - DELETE</li><li>router.del - 由于 delete 是一个保留字，所以提供了一个 delete 方法的别名。</li><li>router.redirect - 可以对 URL 进行重定向处理，比如我们最经常使用的可以把用户访问的根目录路由到某个主页。</li></ul></li><li>router-name 给路由设定一个别名，可以通过 Helper 提供的辅助函数 <code>pathFor</code> 和 <code>urlFor</code> 来生成 URL。(可选)</li><li>path-match - 路由 URL 路径。</li><li>middleware1 - 在 Router 里面可以配置多个 Middleware。(可选)</li><li>controller - 指定路由映射到的具体的 controller 上，controller 可以有两种写法：<ul><li><code>app.controller.user.fetch</code> - 直接指定一个具体的 controller</li><li><code>&#x27;user.fetch&#x27;</code> - 可以简写为字符串形式</li></ul></li></ul><h3 id="注意事项">注意事项</h3><ul><li>在 Router 定义中， 可以支持多个 Middleware 串联执行</li><li>Controller 必须定义在 <code>app/controller</code> 目录中。</li><li>一个文件里面也可以包含多个 Controller 定义，在定义路由的时候，可以通过 <code>${fileName}.${functionName}</code> 的方式指定对应的 Controller。</li><li>Controller 支持子目录，在定义路由的时候，可以通过 <code>${directoryName}.${fileName}.${functionName}</code> 的方式制定对应的 Controller。</li></ul><p>下面是一些路由定义的方式：</p><pre><code class="language-js">// app/router.js
module.exports = app =&gt; {
  const { router, controller } = app;
  router.get(&#x27;/home&#x27;, controller.home);
  router.get(&#x27;/user/:id&#x27;, controller.user.page);
  router.post(&#x27;/admin&#x27;, isAdmin, controller.admin);
  router.post(&#x27;/user&#x27;, isLoginUser, hasAdminPermission, controller.user.create);
  router.post(&#x27;/api/v1/comments&#x27;, controller.v1.comments.create); // app/controller/v1/comments.js
};</code></pre><h3 id="restful-风格的-url-定义">RESTful 风格的 URL 定义</h3><p>如果想通过 RESTful 的方式来定义路由，
我们提供了 <code>app.resources(&#x27;routerName&#x27;, &#x27;pathMatch&#x27;, controller)</code> 快速在一个路径上生成 <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> 路由结构。</p><pre><code class="language-js">// app/router.js
module.exports = app =&gt; {
  const { router, controller } = app;
  router.resources(&#x27;posts&#x27;, &#x27;/api/posts&#x27;, controller.posts);
  router.resources(&#x27;users&#x27;, &#x27;/api/v1/users&#x27;, controller.v1.users); // app/controller/v1/users.js
};</code></pre><p>上面代码就在 <code>/posts</code> 路径上部署了一组 CRUD 路径结构，对应的 Controller 为 <code>app/controller/posts.js</code> 接下来，
你只需要在 <code>posts.js</code> 里面实现对应的函数就可以了。</p><table><thead><tr><th>Method</th><th>Path</th><th>Route Name</th><th>Controller.Action</th></tr></thead><tbody><tr><td>GET</td><td>/posts</td><td>posts</td><td>app.controllers.posts.index</td></tr><tr><td>GET</td><td>/posts/new</td><td>new_post</td><td>app.controllers.posts.new</td></tr><tr><td>GET</td><td>/posts/:id</td><td>post</td><td>app.controllers.posts.show</td></tr><tr><td>GET</td><td>/posts/:id/edit</td><td>edit_post</td><td>app.controllers.posts.edit</td></tr><tr><td>POST</td><td>/posts</td><td>posts</td><td>app.controllers.posts.create</td></tr><tr><td>PUT</td><td>/posts/:id</td><td>post</td><td>app.controllers.posts.update</td></tr><tr><td>DELETE</td><td>/posts/:id</td><td>post</td><td>app.controllers.posts.destroy</td></tr></tbody></table><pre><code class="language-js">// app/controller/posts.js
exports.index = async () =&gt; {};

exports.new = async () =&gt; {};

exports.create = async () =&gt; {};

exports.show = async () =&gt; {};

exports.edit = async () =&gt; {};

exports.update = async () =&gt; {};

exports.destroy = async () =&gt; {};</code></pre><p>如果我们不需要其中的某几个方法，可以不用在 <code>posts.js</code> 里面实现，这样对应 URL 路径也不会注册到 Router。</p><h2 id="router-实战">router 实战</h2><p>下面通过更多实际的例子，来说明 router 的用法。</p><h3 id="参数获取">参数获取</h3><h4 id="query-string-方式">Query String 方式</h4><pre><code class="language-js">// app/router.js
module.exports = app =&gt; {
  app.router.get(&#x27;/search&#x27;, app.controller.search.index);
};

// app/controller/search.js
exports.index = async ctx =&gt; {
  ctx.body = `search: ${ctx.query.name}`;
};

// curl http://127.0.0.1:7001/search?name=egg</code></pre><h4 id="参数命名方式">参数命名方式</h4><pre><code class="language-js">// app/router.js
module.exports = app =&gt; {
  app.router.get(&#x27;/user/:id/:name&#x27;, app.controller.user.info);
};

// app/controller/user.js
exports.info = async ctx =&gt; {
  ctx.body = `user: ${ctx.params.id}, ${ctx.params.name}`;
};

// curl http://127.0.0.1:7001/user/123/xiaoming</code></pre><h4 id="复杂参数的获取">复杂参数的获取</h4><p>路由里面也支持定义正则，可以更加灵活的获取参数：</p><pre><code class="language-js">// app/router.js
module.exports = app =&gt; {
  app.router.get(/^\/package\/([\w-.]+\/[\w-.]+)$/, app.controller.package.detail);
};

// app/controller/package.js
exports.detail = async ctx =&gt; {
  // 如果请求 URL 被正则匹配， 可以按照捕获分组的顺序，从 ctx.params 中获取。
  // 按照下面的用户请求，`ctx.params[0]` 的 内容就是 `egg/1.0.0`
  ctx.body = `package:${ctx.params[0]}`;
};

// curl http://127.0.0.1:7001/package/egg/1.0.0</code></pre><h3 id="表单内容的获取">表单内容的获取</h3><pre><code class="language-js">// app/router.js
module.exports = app =&gt; {
  app.router.post(&#x27;/form&#x27;, app.controller.form.post);
};

// app/controller/form.js
exports.post = async ctx =&gt; {
  ctx.body = `body: ${JSON.stringify(ctx.request.body)}`;
};

// 模拟发起 post 请求。
// curl -X POST http://127.0.0.1:7001/form --data &#x27;{&quot;name&quot;:&quot;controller&quot;}&#x27; --header &#x27;Content-Type:application/json&#x27;</code></pre><blockquote><p>附：</p><p>这里直接发起 POST 请求会<strong>报错</strong>：&#x27;secret is missing&#x27;。错误信息来自 <a href="https://github.com/koajs/csrf/blob/2.5.0/index.js#L69">koa-csrf/index.js#L69</a> 。</p><p><strong>原因</strong>：框架内部针对表单 POST 请求均会验证 CSRF 的值，因此我们在表单提交时，请带上 CSRF key 进行提交，可参考<a href="https://eggjs.org/zh-cn/core/security.html#安全威胁csrf的防范">安全威胁csrf的防范</a></p><p><strong>注意</strong>：上面的校验是因为框架中内置了安全插件 <a href="https://github.com/eggjs/egg-security">egg-security</a>，提供了一些默认的安全实践，并且框架的安全插件是默认开启的，如果需要关闭其中一些安全防范，直接设置该项的 enable 属性为 false 即可。</p><p>「除非清楚的确认后果，否则不建议擅自关闭安全插件提供的功能。」</p><p>这里在写例子的话可临时在 <code>config/config.default.js</code> 中设置</p><pre><code>exports.security = {
  csrf: false
};</code></pre></blockquote><h3 id="表单校验">表单校验</h3><pre><code class="language-js">// app/router.js
module.exports = app =&gt; {
  app.router.post(&#x27;/user&#x27;, app.controller.user);
};

// app/controller/user.js
const createRule = {
  username: {
    type: &#x27;email&#x27;,
  },
  password: {
    type: &#x27;password&#x27;,
    compare: &#x27;re-password&#x27;,
  },
};

exports.create = async ctx =&gt; {
  // 如果校验报错，会抛出异常
  ctx.validate(createRule);
  ctx.body = ctx.request.body;
};

// curl -X POST http://127.0.0.1:7001/user --data &#x27;username=abc@abc.com&amp;password=111111&amp;re-password=111111&#x27;</code></pre><h3 id="重定向">重定向</h3><h4 id="内部重定向">内部重定向</h4><pre><code class="language-js">// app/router.js
module.exports = app =&gt; {
  app.router.get(&#x27;index&#x27;, &#x27;/home/index&#x27;, app.controller.home.index);
  app.router.redirect(&#x27;/&#x27;, &#x27;/home/index&#x27;, 302);
};

// app/controller/home.js
exports.index = async ctx =&gt; {
  ctx.body = &#x27;hello controller&#x27;;
};

// curl -L http://localhost:7001</code></pre><h4 id="外部重定向">外部重定向</h4><pre><code class="language-js">// app/router.js
module.exports = app =&gt; {
  app.router.get(&#x27;/search&#x27;, app.controller.search.index);
};

// app/controller/search.js
exports.index = async ctx =&gt; {
  const type = ctx.query.type;
  const q = ctx.query.q || &#x27;nodejs&#x27;;

  if (type === &#x27;bing&#x27;) {
    ctx.redirect(`http://cn.bing.com/search?q=${q}`);
  } else {
    ctx.redirect(`https://www.google.co.kr/search?q=${q}`);
  }
};

// curl http://localhost:7001/search?type=bing&amp;q=node.js
// curl http://localhost:7001/search?q=node.js</code></pre><h3 id="中间件的使用">中间件的使用</h3><p>如果我们想把用户某一类请求的参数都大写，可以通过中间件来实现。
这里我们只是简单说明下如何使用中间件，更多请查看 <a href="./middleware.md">中间件</a>。</p><pre><code class="language-js">// app/controller/search.js
exports.index = async ctx =&gt; {
  ctx.body = `search: ${ctx.query.name}`;
};

// app/middleware/uppercase.js
module.exports = () =&gt; {
  return async function uppercase(ctx, next) {
    ctx.query.name = ctx.query.name &amp;&amp; ctx.query.name.toUpperCase();
    await next();
  };
};

// app/router.js
module.exports = app =&gt; {
  app.router.get(&#x27;s&#x27;, &#x27;/search&#x27;, app.middlewares.uppercase(), app.controller.search)
};

// curl http://localhost:7001/search?name=egg</code></pre><h3 id="太多路由映射">太多路由映射?</h3><p>如上所述，我们并不建议把路由规则逻辑散落在多个地方，会给排查问题带来困扰。</p><p>若确实有需求，可以如下拆分：</p><pre><code class="language-js">// app/router.js
module.exports = app =&gt; {
  require(&#x27;./router/news&#x27;)(app);
  require(&#x27;./router/admin&#x27;)(app);
};

// app/router/news.js
module.exports = app =&gt; {
  app.router.get(&#x27;/news/list&#x27;, app.controller.news.list);
  app.router.get(&#x27;/news/detail&#x27;, app.controller.news.detail);
};

// app/router/admin.js
module.exports = app =&gt; {
  app.router.get(&#x27;/admin/user&#x27;, app.controller.admin.user);
  app.router.get(&#x27;/admin/log&#x27;, app.controller.admin.log);
};</code></pre><p>也可直接使用 <a href="https://github.com/eggjs/egg-router-plus">egg-router-plus</a>。</p></div></div></div><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-0 ant-col-md-6"><div class="markdown-body" style="font-size:14px"><div><ul><li><a href="#%E5%A6%82%E4%BD%95%E5%AE%9A%E4%B9%89-router">如何定义 Router</a></li><li><a href="#router-%E8%AF%A6%E7%BB%86%E5%AE%9A%E4%B9%89%E8%AF%B4%E6%98%8E">Router 详细定义说明</a><ul><li><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">注意事项</a></li><li><a href="#restful-%E9%A3%8E%E6%A0%BC%E7%9A%84-url-%E5%AE%9A%E4%B9%89">RESTful 风格的 URL 定义</a></li></ul></li><li><a href="#router-%E5%AE%9E%E6%88%98">router 实战</a><ul><li><a href="#%E5%8F%82%E6%95%B0%E8%8E%B7%E5%8F%96">参数获取</a><ul><li><a href="#query-string-%E6%96%B9%E5%BC%8F">Query String 方式</a></li><li><a href="#%E5%8F%82%E6%95%B0%E5%91%BD%E5%90%8D%E6%96%B9%E5%BC%8F">参数命名方式</a></li><li><a href="#%E5%A4%8D%E6%9D%82%E5%8F%82%E6%95%B0%E7%9A%84%E8%8E%B7%E5%8F%96">复杂参数的获取</a></li></ul></li><li><a href="#%E8%A1%A8%E5%8D%95%E5%86%85%E5%AE%B9%E7%9A%84%E8%8E%B7%E5%8F%96">表单内容的获取</a></li><li><a href="#%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C">表单校验</a></li><li><a href="#%E9%87%8D%E5%AE%9A%E5%90%91">重定向</a><ul><li><a href="#%E5%86%85%E9%83%A8%E9%87%8D%E5%AE%9A%E5%90%91">内部重定向</a></li><li><a href="#%E5%A4%96%E9%83%A8%E9%87%8D%E5%AE%9A%E5%90%91">外部重定向</a></li></ul></li><li><a href="#%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8">中间件的使用</a></li><li><a href="#%E5%A4%AA%E5%A4%9A%E8%B7%AF%E7%94%B1%E6%98%A0%E5%B0%84">太多路由映射?</a></li></ul></li></ul></div></div></div></div></div></div></div></div></div><script type="text/javascript">window.__INIT_STATE__={"lang":"zh","props":{"toc":"-%20%5B%E5%A6%82%E4%BD%95%E5%AE%9A%E4%B9%89%20Router%5D(%23%25E5%25A6%2582%25E4%25BD%2595%25E5%25AE%259A%25E4%25B9%2589-router)%0A-%20%5BRouter%20%E8%AF%A6%E7%BB%86%E5%AE%9A%E4%B9%89%E8%AF%B4%E6%98%8E%5D(%23router-%25E8%25AF%25A6%25E7%25BB%2586%25E5%25AE%259A%25E4%25B9%2589%25E8%25AF%25B4%25E6%2598%258E)%0A%20%20*%20%5B%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%5D(%23%25E6%25B3%25A8%25E6%2584%258F%25E4%25BA%258B%25E9%25A1%25B9)%0A%20%20*%20%5BRESTful%20%E9%A3%8E%E6%A0%BC%E7%9A%84%20URL%20%E5%AE%9A%E4%B9%89%5D(%23restful-%25E9%25A3%258E%25E6%25A0%25BC%25E7%259A%2584-url-%25E5%25AE%259A%25E4%25B9%2589)%0A-%20%5Brouter%20%E5%AE%9E%E6%88%98%5D(%23router-%25E5%25AE%259E%25E6%2588%2598)%0A%20%20*%20%5B%E5%8F%82%E6%95%B0%E8%8E%B7%E5%8F%96%5D(%23%25E5%258F%2582%25E6%2595%25B0%25E8%258E%25B7%25E5%258F%2596)%0A%20%20%20%20%2B%20%5BQuery%20String%20%E6%96%B9%E5%BC%8F%5D(%23query-string-%25E6%2596%25B9%25E5%25BC%258F)%0A%20%20%20%20%2B%20%5B%E5%8F%82%E6%95%B0%E5%91%BD%E5%90%8D%E6%96%B9%E5%BC%8F%5D(%23%25E5%258F%2582%25E6%2595%25B0%25E5%2591%25BD%25E5%2590%258D%25E6%2596%25B9%25E5%25BC%258F)%0A%20%20%20%20%2B%20%5B%E5%A4%8D%E6%9D%82%E5%8F%82%E6%95%B0%E7%9A%84%E8%8E%B7%E5%8F%96%5D(%23%25E5%25A4%258D%25E6%259D%2582%25E5%258F%2582%25E6%2595%25B0%25E7%259A%2584%25E8%258E%25B7%25E5%258F%2596)%0A%20%20*%20%5B%E8%A1%A8%E5%8D%95%E5%86%85%E5%AE%B9%E7%9A%84%E8%8E%B7%E5%8F%96%5D(%23%25E8%25A1%25A8%25E5%258D%2595%25E5%2586%2585%25E5%25AE%25B9%25E7%259A%2584%25E8%258E%25B7%25E5%258F%2596)%0A%20%20*%20%5B%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C%5D(%23%25E8%25A1%25A8%25E5%258D%2595%25E6%25A0%25A1%25E9%25AA%258C)%0A%20%20*%20%5B%E9%87%8D%E5%AE%9A%E5%90%91%5D(%23%25E9%2587%258D%25E5%25AE%259A%25E5%2590%2591)%0A%20%20%20%20%2B%20%5B%E5%86%85%E9%83%A8%E9%87%8D%E5%AE%9A%E5%90%91%5D(%23%25E5%2586%2585%25E9%2583%25A8%25E9%2587%258D%25E5%25AE%259A%25E5%2590%2591)%0A%20%20%20%20%2B%20%5B%E5%A4%96%E9%83%A8%E9%87%8D%E5%AE%9A%E5%90%91%5D(%23%25E5%25A4%2596%25E9%2583%25A8%25E9%2587%258D%25E5%25AE%259A%25E5%2590%2591)%0A%20%20*%20%5B%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8%5D(%23%25E4%25B8%25AD%25E9%2597%25B4%25E4%25BB%25B6%25E7%259A%2584%25E4%25BD%25BF%25E7%2594%25A8)%0A%20%20*%20%5B%E5%A4%AA%E5%A4%9A%E8%B7%AF%E7%94%B1%E6%98%A0%E5%B0%84%3F%5D(%23%25E5%25A4%25AA%25E5%25A4%259A%25E8%25B7%25AF%25E7%2594%25B1%25E6%2598%25A0%25E5%25B0%2584)","meta":{"info":{"title":"Router 路由"}},"content":"%0A%0A%0ARouter%20%E4%B8%BB%E8%A6%81%E7%94%A8%E6%9D%A5%E6%8F%8F%E8%BF%B0%E8%AF%B7%E6%B1%82%20URL%20%E5%92%8C%E5%85%B7%E4%BD%93%E6%89%BF%E6%8B%85%E6%89%A7%E8%A1%8C%E5%8A%A8%E4%BD%9C%E7%9A%84%20Controller%20%E7%9A%84%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB%EF%BC%8C%0A%E6%A1%86%E6%9E%B6%E7%BA%A6%E5%AE%9A%E4%BA%86%20%60app%2Frouter.js%60%20%E6%96%87%E4%BB%B6%E7%94%A8%E4%BA%8E%E7%BB%9F%E4%B8%80%E6%89%80%E6%9C%89%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99%E3%80%82%0A%0A%E9%80%9A%E8%BF%87%E7%BB%9F%E4%B8%80%E7%9A%84%E9%85%8D%E7%BD%AE%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%81%BF%E5%85%8D%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99%E9%80%BB%E8%BE%91%E6%95%A3%E8%90%BD%E5%9C%A8%E5%A4%9A%E4%B8%AA%E5%9C%B0%E6%96%B9%EF%BC%8C%E4%BB%8E%E8%80%8C%E5%87%BA%E7%8E%B0%E6%9C%AA%E7%9F%A5%E7%9A%84%E5%86%B2%E7%AA%81%EF%BC%8C%E9%9B%86%E4%B8%AD%E5%9C%A8%E4%B8%80%E8%B5%B7%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E6%9B%B4%E6%96%B9%E4%BE%BF%E7%9A%84%E6%9D%A5%E6%9F%A5%E7%9C%8B%E5%85%A8%E5%B1%80%E7%9A%84%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99%E3%80%82%0A%0A%23%23%20%E5%A6%82%E4%BD%95%E5%AE%9A%E4%B9%89%20Router%0A%0A-%20%60app%2Frouter.js%60%20%E9%87%8C%E9%9D%A2%E5%AE%9A%E4%B9%89%20URL%20%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99%0A%0A%60%60%60js%0A%2F%2F%20app%2Frouter.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20const%20%7B%20router%2C%20controller%20%7D%20%3D%20app%3B%0A%20%20router.get('%2Fuser%2F%3Aid'%2C%20controller.user.info)%3B%0A%7D%3B%0A%60%60%60%0A%0A-%20%60app%2Fcontroller%60%20%E7%9B%AE%E5%BD%95%E4%B8%8B%E9%9D%A2%E5%AE%9E%E7%8E%B0%20Controller%0A%0A%60%60%60js%0A%2F%2F%20app%2Fcontroller%2Fuser.js%0Aclass%20UserController%20extends%20Controller%20%7B%0A%20%20async%20info()%20%7B%0A%20%20%20%20const%20%7B%20ctx%20%7D%20%3D%20this%3B%0A%20%20%20%20ctx.body%20%3D%20%7B%0A%20%20%20%20%20%20name%3A%20%60hello%20%24%7Bctx.params.id%7D%60%2C%0A%20%20%20%20%7D%3B%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A%E8%BF%99%E6%A0%B7%E5%B0%B1%E5%AE%8C%E6%88%90%E4%BA%86%E4%B8%80%E4%B8%AA%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%20Router%20%E5%AE%9A%E4%B9%89%EF%BC%8C%E5%BD%93%E7%94%A8%E6%88%B7%E6%89%A7%E8%A1%8C%20%60GET%20%2Fuser%2F123%60%EF%BC%8C%60user.js%60%20%E8%BF%99%E4%B8%AA%E9%87%8C%E9%9D%A2%E7%9A%84%20info%20%E6%96%B9%E6%B3%95%E5%B0%B1%E4%BC%9A%E6%89%A7%E8%A1%8C%E3%80%82%0A%0A%23%23%20Router%20%E8%AF%A6%E7%BB%86%E5%AE%9A%E4%B9%89%E8%AF%B4%E6%98%8E%0A%0A%E4%B8%8B%E9%9D%A2%E6%98%AF%E8%B7%AF%E7%94%B1%E7%9A%84%E5%AE%8C%E6%95%B4%E5%AE%9A%E4%B9%89%EF%BC%8C%E5%8F%82%E6%95%B0%E5%8F%AF%E4%BB%A5%E6%A0%B9%E6%8D%AE%E5%9C%BA%E6%99%AF%E7%9A%84%E4%B8%8D%E5%90%8C%EF%BC%8C%E8%87%AA%E7%94%B1%E9%80%89%E6%8B%A9%EF%BC%9A%0A%0A%60%60%60js%0Arouter.verb('path-match'%2C%20app.controller.action)%3B%0Arouter.verb('router-name'%2C%20'path-match'%2C%20app.controller.action)%3B%0Arouter.verb('path-match'%2C%20middleware1%2C%20...%2C%20middlewareN%2C%20app.controller.action)%3B%0Arouter.verb('router-name'%2C%20'path-match'%2C%20middleware1%2C%20...%2C%20middlewareN%2C%20app.controller.action)%3B%0A%60%60%60%0A%0A%E8%B7%AF%E7%94%B1%E5%AE%8C%E6%95%B4%E5%AE%9A%E4%B9%89%E4%B8%BB%E8%A6%81%E5%8C%85%E6%8B%AC5%E4%B8%AA%E4%B8%BB%E8%A6%81%E9%83%A8%E5%88%86%3A%0A%0A-%20verb%20-%20%E7%94%A8%E6%88%B7%E8%A7%A6%E5%8F%91%E5%8A%A8%E4%BD%9C%EF%BC%8C%E6%94%AF%E6%8C%81%20get%EF%BC%8Cpost%20%E7%AD%89%E6%89%80%E6%9C%89%20HTTP%20%E6%96%B9%E6%B3%95%EF%BC%8C%E5%90%8E%E9%9D%A2%E4%BC%9A%E9%80%9A%E8%BF%87%E7%A4%BA%E4%BE%8B%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E%E3%80%82%0A%20%20*%20router.head%20-%20HEAD%0A%20%20*%20router.options%20-%20OPTIONS%0A%20%20*%20router.get%20-%20GET%0A%20%20*%20router.put%20-%20PUT%0A%20%20*%20router.post%20-%20POST%0A%20%20*%20router.patch%20-%20PATCH%0A%20%20*%20router.delete%20-%20DELETE%0A%20%20*%20router.del%20-%20%E7%94%B1%E4%BA%8E%20delete%20%E6%98%AF%E4%B8%80%E4%B8%AA%E4%BF%9D%E7%95%99%E5%AD%97%EF%BC%8C%E6%89%80%E4%BB%A5%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E4%B8%AA%20delete%20%E6%96%B9%E6%B3%95%E7%9A%84%E5%88%AB%E5%90%8D%E3%80%82%0A%20%20*%20router.redirect%20-%20%E5%8F%AF%E4%BB%A5%E5%AF%B9%20URL%20%E8%BF%9B%E8%A1%8C%E9%87%8D%E5%AE%9A%E5%90%91%E5%A4%84%E7%90%86%EF%BC%8C%E6%AF%94%E5%A6%82%E6%88%91%E4%BB%AC%E6%9C%80%E7%BB%8F%E5%B8%B8%E4%BD%BF%E7%94%A8%E7%9A%84%E5%8F%AF%E4%BB%A5%E6%8A%8A%E7%94%A8%E6%88%B7%E8%AE%BF%E9%97%AE%E7%9A%84%E6%A0%B9%E7%9B%AE%E5%BD%95%E8%B7%AF%E7%94%B1%E5%88%B0%E6%9F%90%E4%B8%AA%E4%B8%BB%E9%A1%B5%E3%80%82%0A-%20router-name%20%E7%BB%99%E8%B7%AF%E7%94%B1%E8%AE%BE%E5%AE%9A%E4%B8%80%E4%B8%AA%E5%88%AB%E5%90%8D%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20Helper%20%E6%8F%90%E4%BE%9B%E7%9A%84%E8%BE%85%E5%8A%A9%E5%87%BD%E6%95%B0%20%60pathFor%60%20%E5%92%8C%20%60urlFor%60%20%E6%9D%A5%E7%94%9F%E6%88%90%20URL%E3%80%82(%E5%8F%AF%E9%80%89)%0A-%20path-match%20-%20%E8%B7%AF%E7%94%B1%20URL%20%E8%B7%AF%E5%BE%84%E3%80%82%0A-%20middleware1%20-%20%E5%9C%A8%20Router%20%E9%87%8C%E9%9D%A2%E5%8F%AF%E4%BB%A5%E9%85%8D%E7%BD%AE%E5%A4%9A%E4%B8%AA%20Middleware%E3%80%82(%E5%8F%AF%E9%80%89)%0A-%20controller%20-%20%E6%8C%87%E5%AE%9A%E8%B7%AF%E7%94%B1%E6%98%A0%E5%B0%84%E5%88%B0%E7%9A%84%E5%85%B7%E4%BD%93%E7%9A%84%20controller%20%E4%B8%8A%EF%BC%8Ccontroller%20%E5%8F%AF%E4%BB%A5%E6%9C%89%E4%B8%A4%E7%A7%8D%E5%86%99%E6%B3%95%EF%BC%9A%0A%20%20*%20%60app.controller.user.fetch%60%20-%20%E7%9B%B4%E6%8E%A5%E6%8C%87%E5%AE%9A%E4%B8%80%E4%B8%AA%E5%85%B7%E4%BD%93%E7%9A%84%20controller%0A%20%20*%20%60'user.fetch'%60%20-%20%E5%8F%AF%E4%BB%A5%E7%AE%80%E5%86%99%E4%B8%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%BD%A2%E5%BC%8F%0A%0A%23%23%23%20%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%0A%0A-%20%E5%9C%A8%20Router%20%E5%AE%9A%E4%B9%89%E4%B8%AD%EF%BC%8C%20%E5%8F%AF%E4%BB%A5%E6%94%AF%E6%8C%81%E5%A4%9A%E4%B8%AA%20Middleware%20%E4%B8%B2%E8%81%94%E6%89%A7%E8%A1%8C%0A-%20Controller%20%E5%BF%85%E9%A1%BB%E5%AE%9A%E4%B9%89%E5%9C%A8%20%60app%2Fcontroller%60%20%E7%9B%AE%E5%BD%95%E4%B8%AD%E3%80%82%0A-%20%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E9%87%8C%E9%9D%A2%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%8C%85%E5%90%AB%E5%A4%9A%E4%B8%AA%20Controller%20%E5%AE%9A%E4%B9%89%EF%BC%8C%E5%9C%A8%E5%AE%9A%E4%B9%89%E8%B7%AF%E7%94%B1%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20%60%24%7BfileName%7D.%24%7BfunctionName%7D%60%20%E7%9A%84%E6%96%B9%E5%BC%8F%E6%8C%87%E5%AE%9A%E5%AF%B9%E5%BA%94%E7%9A%84%20Controller%E3%80%82%0A-%20Controller%20%E6%94%AF%E6%8C%81%E5%AD%90%E7%9B%AE%E5%BD%95%EF%BC%8C%E5%9C%A8%E5%AE%9A%E4%B9%89%E8%B7%AF%E7%94%B1%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20%60%24%7BdirectoryName%7D.%24%7BfileName%7D.%24%7BfunctionName%7D%60%20%E7%9A%84%E6%96%B9%E5%BC%8F%E5%88%B6%E5%AE%9A%E5%AF%B9%E5%BA%94%E7%9A%84%20Controller%E3%80%82%0A%0A%E4%B8%8B%E9%9D%A2%E6%98%AF%E4%B8%80%E4%BA%9B%E8%B7%AF%E7%94%B1%E5%AE%9A%E4%B9%89%E7%9A%84%E6%96%B9%E5%BC%8F%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20app%2Frouter.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20const%20%7B%20router%2C%20controller%20%7D%20%3D%20app%3B%0A%20%20router.get('%2Fhome'%2C%20controller.home)%3B%0A%20%20router.get('%2Fuser%2F%3Aid'%2C%20controller.user.page)%3B%0A%20%20router.post('%2Fadmin'%2C%20isAdmin%2C%20controller.admin)%3B%0A%20%20router.post('%2Fuser'%2C%20isLoginUser%2C%20hasAdminPermission%2C%20controller.user.create)%3B%0A%20%20router.post('%2Fapi%2Fv1%2Fcomments'%2C%20controller.v1.comments.create)%3B%20%2F%2F%20app%2Fcontroller%2Fv1%2Fcomments.js%0A%7D%3B%0A%60%60%60%0A%0A%23%23%23%20RESTful%20%E9%A3%8E%E6%A0%BC%E7%9A%84%20URL%20%E5%AE%9A%E4%B9%89%0A%0A%E5%A6%82%E6%9E%9C%E6%83%B3%E9%80%9A%E8%BF%87%20RESTful%20%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9D%A5%E5%AE%9A%E4%B9%89%E8%B7%AF%E7%94%B1%EF%BC%8C%0A%E6%88%91%E4%BB%AC%E6%8F%90%E4%BE%9B%E4%BA%86%20%60app.resources('routerName'%2C%20'pathMatch'%2C%20controller)%60%20%E5%BF%AB%E9%80%9F%E5%9C%A8%E4%B8%80%E4%B8%AA%E8%B7%AF%E5%BE%84%E4%B8%8A%E7%94%9F%E6%88%90%20%5BCRUD%5D(https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FCreate%2C_read%2C_update_and_delete)%20%E8%B7%AF%E7%94%B1%E7%BB%93%E6%9E%84%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20app%2Frouter.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20const%20%7B%20router%2C%20controller%20%7D%20%3D%20app%3B%0A%20%20router.resources('posts'%2C%20'%2Fapi%2Fposts'%2C%20controller.posts)%3B%0A%20%20router.resources('users'%2C%20'%2Fapi%2Fv1%2Fusers'%2C%20controller.v1.users)%3B%20%2F%2F%20app%2Fcontroller%2Fv1%2Fusers.js%0A%7D%3B%0A%60%60%60%0A%0A%E4%B8%8A%E9%9D%A2%E4%BB%A3%E7%A0%81%E5%B0%B1%E5%9C%A8%20%60%2Fposts%60%20%E8%B7%AF%E5%BE%84%E4%B8%8A%E9%83%A8%E7%BD%B2%E4%BA%86%E4%B8%80%E7%BB%84%20CRUD%20%E8%B7%AF%E5%BE%84%E7%BB%93%E6%9E%84%EF%BC%8C%E5%AF%B9%E5%BA%94%E7%9A%84%20Controller%20%E4%B8%BA%20%60app%2Fcontroller%2Fposts.js%60%20%E6%8E%A5%E4%B8%8B%E6%9D%A5%EF%BC%8C%0A%E4%BD%A0%E5%8F%AA%E9%9C%80%E8%A6%81%E5%9C%A8%20%60posts.js%60%20%E9%87%8C%E9%9D%A2%E5%AE%9E%E7%8E%B0%E5%AF%B9%E5%BA%94%E7%9A%84%E5%87%BD%E6%95%B0%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BA%86%E3%80%82%0A%0AMethod%20%7C%20Path%20%20%20%20%20%20%20%20%20%20%20%20%7C%20Route%20Name%20%20%20%20%20%7C%20Controller.Action%0A-------%7C-----------------%7C----------------%7C-----------------------------%0AGET%20%20%20%20%7C%20%2Fposts%20%20%20%20%20%20%20%20%20%20%7C%20posts%20%20%20%20%20%20%20%20%20%20%7C%20app.controllers.posts.index%0AGET%20%20%20%20%7C%20%2Fposts%2Fnew%20%20%20%20%20%20%7C%20new_post%20%20%20%20%20%20%20%7C%20app.controllers.posts.new%0AGET%20%20%20%20%7C%20%2Fposts%2F%3Aid%20%20%20%20%20%20%7C%20post%20%20%20%20%20%20%20%20%20%20%20%7C%20app.controllers.posts.show%0AGET%20%20%20%20%7C%20%2Fposts%2F%3Aid%2Fedit%20%7C%20edit_post%20%20%20%20%20%20%7C%20app.controllers.posts.edit%0APOST%20%20%20%7C%20%2Fposts%20%20%20%20%20%20%20%20%20%20%7C%20posts%20%20%20%20%20%20%20%20%20%20%7C%20app.controllers.posts.create%0APUT%20%20%20%20%7C%20%2Fposts%2F%3Aid%20%20%20%20%20%20%7C%20post%20%20%20%20%20%20%20%20%20%20%20%7C%20app.controllers.posts.update%0ADELETE%20%7C%20%2Fposts%2F%3Aid%20%20%20%20%20%20%7C%20post%20%20%20%20%20%20%20%20%20%20%20%7C%20app.controllers.posts.destroy%0A%0A%60%60%60js%0A%2F%2F%20app%2Fcontroller%2Fposts.js%0Aexports.index%20%3D%20async%20()%20%3D%3E%20%7B%7D%3B%0A%0Aexports.new%20%3D%20async%20()%20%3D%3E%20%7B%7D%3B%0A%0Aexports.create%20%3D%20async%20()%20%3D%3E%20%7B%7D%3B%0A%0Aexports.show%20%3D%20async%20()%20%3D%3E%20%7B%7D%3B%0A%0Aexports.edit%20%3D%20async%20()%20%3D%3E%20%7B%7D%3B%0A%0Aexports.update%20%3D%20async%20()%20%3D%3E%20%7B%7D%3B%0A%0Aexports.destroy%20%3D%20async%20()%20%3D%3E%20%7B%7D%3B%0A%60%60%60%0A%0A%E5%A6%82%E6%9E%9C%E6%88%91%E4%BB%AC%E4%B8%8D%E9%9C%80%E8%A6%81%E5%85%B6%E4%B8%AD%E7%9A%84%E6%9F%90%E5%87%A0%E4%B8%AA%E6%96%B9%E6%B3%95%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%B8%8D%E7%94%A8%E5%9C%A8%20%60posts.js%60%20%E9%87%8C%E9%9D%A2%E5%AE%9E%E7%8E%B0%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%AF%B9%E5%BA%94%20URL%20%E8%B7%AF%E5%BE%84%E4%B9%9F%E4%B8%8D%E4%BC%9A%E6%B3%A8%E5%86%8C%E5%88%B0%20Router%E3%80%82%0A%0A%23%23%20router%20%E5%AE%9E%E6%88%98%0A%0A%E4%B8%8B%E9%9D%A2%E9%80%9A%E8%BF%87%E6%9B%B4%E5%A4%9A%E5%AE%9E%E9%99%85%E7%9A%84%E4%BE%8B%E5%AD%90%EF%BC%8C%E6%9D%A5%E8%AF%B4%E6%98%8E%20router%20%E7%9A%84%E7%94%A8%E6%B3%95%E3%80%82%0A%0A%23%23%23%20%E5%8F%82%E6%95%B0%E8%8E%B7%E5%8F%96%0A%0A%23%23%23%23%20Query%20String%20%E6%96%B9%E5%BC%8F%0A%0A%60%60%60js%0A%2F%2F%20app%2Frouter.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20app.router.get('%2Fsearch'%2C%20app.controller.search.index)%3B%0A%7D%3B%0A%0A%2F%2F%20app%2Fcontroller%2Fsearch.js%0Aexports.index%20%3D%20async%20ctx%20%3D%3E%20%7B%0A%20%20ctx.body%20%3D%20%60search%3A%20%24%7Bctx.query.name%7D%60%3B%0A%7D%3B%0A%0A%2F%2F%20curl%20http%3A%2F%2F127.0.0.1%3A7001%2Fsearch%3Fname%3Degg%0A%60%60%60%0A%0A%23%23%23%23%20%E5%8F%82%E6%95%B0%E5%91%BD%E5%90%8D%E6%96%B9%E5%BC%8F%0A%0A%60%60%60js%0A%2F%2F%20app%2Frouter.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20app.router.get('%2Fuser%2F%3Aid%2F%3Aname'%2C%20app.controller.user.info)%3B%0A%7D%3B%0A%0A%2F%2F%20app%2Fcontroller%2Fuser.js%0Aexports.info%20%3D%20async%20ctx%20%3D%3E%20%7B%0A%20%20ctx.body%20%3D%20%60user%3A%20%24%7Bctx.params.id%7D%2C%20%24%7Bctx.params.name%7D%60%3B%0A%7D%3B%0A%0A%2F%2F%20curl%20http%3A%2F%2F127.0.0.1%3A7001%2Fuser%2F123%2Fxiaoming%0A%60%60%60%0A%0A%23%23%23%23%20%E5%A4%8D%E6%9D%82%E5%8F%82%E6%95%B0%E7%9A%84%E8%8E%B7%E5%8F%96%0A%0A%E8%B7%AF%E7%94%B1%E9%87%8C%E9%9D%A2%E4%B9%9F%E6%94%AF%E6%8C%81%E5%AE%9A%E4%B9%89%E6%AD%A3%E5%88%99%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%9B%B4%E5%8A%A0%E7%81%B5%E6%B4%BB%E7%9A%84%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20app%2Frouter.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20app.router.get(%2F%5E%5C%2Fpackage%5C%2F(%5B%5Cw-.%5D%2B%5C%2F%5B%5Cw-.%5D%2B)%24%2F%2C%20app.controller.package.detail)%3B%0A%7D%3B%0A%0A%2F%2F%20app%2Fcontroller%2Fpackage.js%0Aexports.detail%20%3D%20async%20ctx%20%3D%3E%20%7B%0A%20%20%2F%2F%20%E5%A6%82%E6%9E%9C%E8%AF%B7%E6%B1%82%20URL%20%E8%A2%AB%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D%EF%BC%8C%20%E5%8F%AF%E4%BB%A5%E6%8C%89%E7%85%A7%E6%8D%95%E8%8E%B7%E5%88%86%E7%BB%84%E7%9A%84%E9%A1%BA%E5%BA%8F%EF%BC%8C%E4%BB%8E%20ctx.params%20%E4%B8%AD%E8%8E%B7%E5%8F%96%E3%80%82%0A%20%20%2F%2F%20%E6%8C%89%E7%85%A7%E4%B8%8B%E9%9D%A2%E7%9A%84%E7%94%A8%E6%88%B7%E8%AF%B7%E6%B1%82%EF%BC%8C%60ctx.params%5B0%5D%60%20%E7%9A%84%20%E5%86%85%E5%AE%B9%E5%B0%B1%E6%98%AF%20%60egg%2F1.0.0%60%0A%20%20ctx.body%20%3D%20%60package%3A%24%7Bctx.params%5B0%5D%7D%60%3B%0A%7D%3B%0A%0A%2F%2F%20curl%20http%3A%2F%2F127.0.0.1%3A7001%2Fpackage%2Fegg%2F1.0.0%0A%60%60%60%0A%0A%23%23%23%20%E8%A1%A8%E5%8D%95%E5%86%85%E5%AE%B9%E7%9A%84%E8%8E%B7%E5%8F%96%0A%0A%60%60%60js%0A%2F%2F%20app%2Frouter.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20app.router.post('%2Fform'%2C%20app.controller.form.post)%3B%0A%7D%3B%0A%0A%2F%2F%20app%2Fcontroller%2Fform.js%0Aexports.post%20%3D%20async%20ctx%20%3D%3E%20%7B%0A%20%20ctx.body%20%3D%20%60body%3A%20%24%7BJSON.stringify(ctx.request.body)%7D%60%3B%0A%7D%3B%0A%0A%2F%2F%20%E6%A8%A1%E6%8B%9F%E5%8F%91%E8%B5%B7%20post%20%E8%AF%B7%E6%B1%82%E3%80%82%0A%2F%2F%20curl%20-X%20POST%20http%3A%2F%2F127.0.0.1%3A7001%2Fform%20--data%20'%7B%22name%22%3A%22controller%22%7D'%20--header%20'Content-Type%3Aapplication%2Fjson'%0A%60%60%60%0A%0A%3E%20%E9%99%84%EF%BC%9A%0A%0A%3E%20%E8%BF%99%E9%87%8C%E7%9B%B4%E6%8E%A5%E5%8F%91%E8%B5%B7%20POST%20%E8%AF%B7%E6%B1%82%E4%BC%9A**%E6%8A%A5%E9%94%99**%EF%BC%9A'secret%20is%20missing'%E3%80%82%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%E6%9D%A5%E8%87%AA%20%5Bkoa-csrf%2Findex.js%23L69%5D(https%3A%2F%2Fgithub.com%2Fkoajs%2Fcsrf%2Fblob%2F2.5.0%2Findex.js%23L69)%20%E3%80%82%0A%0A%3E%20**%E5%8E%9F%E5%9B%A0**%EF%BC%9A%E6%A1%86%E6%9E%B6%E5%86%85%E9%83%A8%E9%92%88%E5%AF%B9%E8%A1%A8%E5%8D%95%20POST%20%E8%AF%B7%E6%B1%82%E5%9D%87%E4%BC%9A%E9%AA%8C%E8%AF%81%20CSRF%20%E7%9A%84%E5%80%BC%EF%BC%8C%E5%9B%A0%E6%AD%A4%E6%88%91%E4%BB%AC%E5%9C%A8%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4%E6%97%B6%EF%BC%8C%E8%AF%B7%E5%B8%A6%E4%B8%8A%20CSRF%20key%20%E8%BF%9B%E8%A1%8C%E6%8F%90%E4%BA%A4%EF%BC%8C%E5%8F%AF%E5%8F%82%E8%80%83%5B%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81csrf%E7%9A%84%E9%98%B2%E8%8C%83%5D(https%3A%2F%2Feggjs.org%2Fzh-cn%2Fcore%2Fsecurity.html%23%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81csrf%E7%9A%84%E9%98%B2%E8%8C%83)%0A%0A%3E%20**%E6%B3%A8%E6%84%8F**%EF%BC%9A%E4%B8%8A%E9%9D%A2%E7%9A%84%E6%A0%A1%E9%AA%8C%E6%98%AF%E5%9B%A0%E4%B8%BA%E6%A1%86%E6%9E%B6%E4%B8%AD%E5%86%85%E7%BD%AE%E4%BA%86%E5%AE%89%E5%85%A8%E6%8F%92%E4%BB%B6%20%5Begg-security%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-security)%EF%BC%8C%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E4%BA%9B%E9%BB%98%E8%AE%A4%E7%9A%84%E5%AE%89%E5%85%A8%E5%AE%9E%E8%B7%B5%EF%BC%8C%E5%B9%B6%E4%B8%94%E6%A1%86%E6%9E%B6%E7%9A%84%E5%AE%89%E5%85%A8%E6%8F%92%E4%BB%B6%E6%98%AF%E9%BB%98%E8%AE%A4%E5%BC%80%E5%90%AF%E7%9A%84%EF%BC%8C%E5%A6%82%E6%9E%9C%E9%9C%80%E8%A6%81%E5%85%B3%E9%97%AD%E5%85%B6%E4%B8%AD%E4%B8%80%E4%BA%9B%E5%AE%89%E5%85%A8%E9%98%B2%E8%8C%83%EF%BC%8C%E7%9B%B4%E6%8E%A5%E8%AE%BE%E7%BD%AE%E8%AF%A5%E9%A1%B9%E7%9A%84%20enable%20%E5%B1%9E%E6%80%A7%E4%B8%BA%20false%20%E5%8D%B3%E5%8F%AF%E3%80%82%0A%0A%3E%E3%80%8C%E9%99%A4%E9%9D%9E%E6%B8%85%E6%A5%9A%E7%9A%84%E7%A1%AE%E8%AE%A4%E5%90%8E%E6%9E%9C%EF%BC%8C%E5%90%A6%E5%88%99%E4%B8%8D%E5%BB%BA%E8%AE%AE%E6%93%85%E8%87%AA%E5%85%B3%E9%97%AD%E5%AE%89%E5%85%A8%E6%8F%92%E4%BB%B6%E6%8F%90%E4%BE%9B%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%82%E3%80%8D%0A%0A%3E%20%E8%BF%99%E9%87%8C%E5%9C%A8%E5%86%99%E4%BE%8B%E5%AD%90%E7%9A%84%E8%AF%9D%E5%8F%AF%E4%B8%B4%E6%97%B6%E5%9C%A8%20%60config%2Fconfig.default.js%60%20%E4%B8%AD%E8%AE%BE%E7%BD%AE%0A%60%60%60%0Aexports.security%20%3D%20%7B%0A%20%20csrf%3A%20false%0A%7D%3B%0A%60%60%60%0A%0A%23%23%23%20%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C%0A%0A%60%60%60js%0A%2F%2F%20app%2Frouter.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20app.router.post('%2Fuser'%2C%20app.controller.user)%3B%0A%7D%3B%0A%0A%2F%2F%20app%2Fcontroller%2Fuser.js%0Aconst%20createRule%20%3D%20%7B%0A%20%20username%3A%20%7B%0A%20%20%20%20type%3A%20'email'%2C%0A%20%20%7D%2C%0A%20%20password%3A%20%7B%0A%20%20%20%20type%3A%20'password'%2C%0A%20%20%20%20compare%3A%20're-password'%2C%0A%20%20%7D%2C%0A%7D%3B%0A%0Aexports.create%20%3D%20async%20ctx%20%3D%3E%20%7B%0A%20%20%2F%2F%20%E5%A6%82%E6%9E%9C%E6%A0%A1%E9%AA%8C%E6%8A%A5%E9%94%99%EF%BC%8C%E4%BC%9A%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%0A%20%20ctx.validate(createRule)%3B%0A%20%20ctx.body%20%3D%20ctx.request.body%3B%0A%7D%3B%0A%0A%2F%2F%20curl%20-X%20POST%20http%3A%2F%2F127.0.0.1%3A7001%2Fuser%20--data%20'username%3Dabc%40abc.com%26password%3D111111%26re-password%3D111111'%0A%60%60%60%0A%0A%23%23%23%20%E9%87%8D%E5%AE%9A%E5%90%91%0A%0A%23%23%23%23%20%E5%86%85%E9%83%A8%E9%87%8D%E5%AE%9A%E5%90%91%0A%0A%60%60%60js%0A%2F%2F%20app%2Frouter.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20app.router.get('index'%2C%20'%2Fhome%2Findex'%2C%20app.controller.home.index)%3B%0A%20%20app.router.redirect('%2F'%2C%20'%2Fhome%2Findex'%2C%20302)%3B%0A%7D%3B%0A%0A%2F%2F%20app%2Fcontroller%2Fhome.js%0Aexports.index%20%3D%20async%20ctx%20%3D%3E%20%7B%0A%20%20ctx.body%20%3D%20'hello%20controller'%3B%0A%7D%3B%0A%0A%2F%2F%20curl%20-L%20http%3A%2F%2Flocalhost%3A7001%0A%60%60%60%0A%0A%23%23%23%23%20%E5%A4%96%E9%83%A8%E9%87%8D%E5%AE%9A%E5%90%91%0A%0A%60%60%60js%0A%2F%2F%20app%2Frouter.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20app.router.get('%2Fsearch'%2C%20app.controller.search.index)%3B%0A%7D%3B%0A%0A%2F%2F%20app%2Fcontroller%2Fsearch.js%0Aexports.index%20%3D%20async%20ctx%20%3D%3E%20%7B%0A%20%20const%20type%20%3D%20ctx.query.type%3B%0A%20%20const%20q%20%3D%20ctx.query.q%20%7C%7C%20'nodejs'%3B%0A%0A%20%20if%20(type%20%3D%3D%3D%20'bing')%20%7B%0A%20%20%20%20ctx.redirect(%60http%3A%2F%2Fcn.bing.com%2Fsearch%3Fq%3D%24%7Bq%7D%60)%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20ctx.redirect(%60https%3A%2F%2Fwww.google.co.kr%2Fsearch%3Fq%3D%24%7Bq%7D%60)%3B%0A%20%20%7D%0A%7D%3B%0A%0A%2F%2F%20curl%20http%3A%2F%2Flocalhost%3A7001%2Fsearch%3Ftype%3Dbing%26q%3Dnode.js%0A%2F%2F%20curl%20http%3A%2F%2Flocalhost%3A7001%2Fsearch%3Fq%3Dnode.js%0A%60%60%60%0A%0A%23%23%23%20%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8%0A%0A%E5%A6%82%E6%9E%9C%E6%88%91%E4%BB%AC%E6%83%B3%E6%8A%8A%E7%94%A8%E6%88%B7%E6%9F%90%E4%B8%80%E7%B1%BB%E8%AF%B7%E6%B1%82%E7%9A%84%E5%8F%82%E6%95%B0%E9%83%BD%E5%A4%A7%E5%86%99%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%9D%A5%E5%AE%9E%E7%8E%B0%E3%80%82%0A%E8%BF%99%E9%87%8C%E6%88%91%E4%BB%AC%E5%8F%AA%E6%98%AF%E7%AE%80%E5%8D%95%E8%AF%B4%E6%98%8E%E4%B8%8B%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E4%B8%AD%E9%97%B4%E4%BB%B6%EF%BC%8C%E6%9B%B4%E5%A4%9A%E8%AF%B7%E6%9F%A5%E7%9C%8B%20%5B%E4%B8%AD%E9%97%B4%E4%BB%B6%5D(.%2Fmiddleware.md)%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20app%2Fcontroller%2Fsearch.js%0Aexports.index%20%3D%20async%20ctx%20%3D%3E%20%7B%0A%20%20ctx.body%20%3D%20%60search%3A%20%24%7Bctx.query.name%7D%60%3B%0A%7D%3B%0A%0A%2F%2F%20app%2Fmiddleware%2Fuppercase.js%0Amodule.exports%20%3D%20()%20%3D%3E%20%7B%0A%20%20return%20async%20function%20uppercase(ctx%2C%20next)%20%7B%0A%20%20%20%20ctx.query.name%20%3D%20ctx.query.name%20%26%26%20ctx.query.name.toUpperCase()%3B%0A%20%20%20%20await%20next()%3B%0A%20%20%7D%3B%0A%7D%3B%0A%0A%2F%2F%20app%2Frouter.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20app.router.get('s'%2C%20'%2Fsearch'%2C%20app.middlewares.uppercase()%2C%20app.controller.search)%0A%7D%3B%0A%0A%2F%2F%20curl%20http%3A%2F%2Flocalhost%3A7001%2Fsearch%3Fname%3Degg%0A%60%60%60%0A%0A%23%23%23%20%E5%A4%AA%E5%A4%9A%E8%B7%AF%E7%94%B1%E6%98%A0%E5%B0%84%3F%0A%0A%E5%A6%82%E4%B8%8A%E6%89%80%E8%BF%B0%EF%BC%8C%E6%88%91%E4%BB%AC%E5%B9%B6%E4%B8%8D%E5%BB%BA%E8%AE%AE%E6%8A%8A%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99%E9%80%BB%E8%BE%91%E6%95%A3%E8%90%BD%E5%9C%A8%E5%A4%9A%E4%B8%AA%E5%9C%B0%E6%96%B9%EF%BC%8C%E4%BC%9A%E7%BB%99%E6%8E%92%E6%9F%A5%E9%97%AE%E9%A2%98%E5%B8%A6%E6%9D%A5%E5%9B%B0%E6%89%B0%E3%80%82%0A%0A%E8%8B%A5%E7%A1%AE%E5%AE%9E%E6%9C%89%E9%9C%80%E6%B1%82%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%A6%82%E4%B8%8B%E6%8B%86%E5%88%86%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20app%2Frouter.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20require('.%2Frouter%2Fnews')(app)%3B%0A%20%20require('.%2Frouter%2Fadmin')(app)%3B%0A%7D%3B%0A%0A%2F%2F%20app%2Frouter%2Fnews.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20app.router.get('%2Fnews%2Flist'%2C%20app.controller.news.list)%3B%0A%20%20app.router.get('%2Fnews%2Fdetail'%2C%20app.controller.news.detail)%3B%0A%7D%3B%0A%0A%2F%2F%20app%2Frouter%2Fadmin.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20app.router.get('%2Fadmin%2Fuser'%2C%20app.controller.admin.user)%3B%0A%20%20app.router.get('%2Fadmin%2Flog'%2C%20app.controller.admin.log)%3B%0A%7D%3B%0A%60%60%60%0A%0A%E4%B9%9F%E5%8F%AF%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8%20%5Begg-router-plus%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-router-plus)%E3%80%82"}}</script><script type="text/javascript" src="/static/js/post.b9faab88.js"></script></body></html>