<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.png"><style class="_styletron_hydrate_"></style><title>Config 配置</title><meta name="description" content="Born to build better enterprise frameworks and apps"><link href="/static/css/post.d62265dc.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="ant-layout" data-reactroot=""><div class="header-module__header___3ADJ9 ant-layout-header"><div class="ant-row-flex"><div class="ant-col-xs-12 ant-col-md-20 ant-col-lg-2"><div class="header-module__logo___3yTXp"><a href="/"><img src="/logo.svg" alt="logo"/></a></div></div><div class="ant-col-xs-0 ant-col-md-0 ant-col-lg-20"><ul class="ant-menu header-module__menu___3yEtW ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/intro/">指南</a></li><li class="ant-menu-item" role="menuitem"><a href="/api/">API</a></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/tutorials/index.html">教程</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/search?q=topic%3Aegg-plugin&amp;type=Repositories">插件</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/eggjs/egg/releases">发布日志</a></li></ul></div><div style="text-align:right" class="ant-col-xs-12 ant-col-md-4 ant-col-lg-2"><button type="button" class="ant-btn"><span>Languages</span></button></div></div></div><div class="ant-layout-content"><div class="basic_layout-module__content___3flpY ant-layout"><div class="sider-module__side___1Cadj ant-layout-sider ant-layout-sider-light" style="flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"><ul class="ant-menu sider-module__menu___2GqPr ant-menu-light ant-menu-root ant-menu-inline" role="menu"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="0$Menu" aria-haspopup="true"><span>新手指南</span><i class="ant-menu-submenu-arrow"></i></div><ul id="0$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/index.html">Egg.js 是什么?</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/egg-and-koa.html">Egg.js 和 Koa</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/quickstart.html">快速入门</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/progressive.html">渐进式开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/migration.html">2.x 升级指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="1$Menu" aria-haspopup="true"><span>基础功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="1$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/structure.html">目录结构</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/objects.html">内置对象</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/env.html">运行环境</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/config.html">配置</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/middleware.html">中间件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/router.html">Router</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/controller.html">Controller</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/service.html">Service</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/plugin.html">插件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/schedule.html">定时任务</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/extend.html">框架扩展</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/app-start.html">启动自定义</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="2$Menu" aria-haspopup="true"><span>核心功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="2$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/development.html">本地开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/unittest.html">单元测试</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/deployment.html">应用部署</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/logger.html">日志</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/httpclient.html">HttpClient</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cookie-and-session.html">Cookie and Session</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cluster-and-ipc.html">多进程模型和进程间通讯</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/view.html">模板渲染</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/error-handling.html">异常处理</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/security.html">安全</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/i18n.html">国际化</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="3$Menu" aria-haspopup="true"><span>教程</span><i class="ant-menu-submenu-arrow"></i></div><ul id="3$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/mysql.html">MySQL</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/restful.html">RESTful API</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/passport.html">Passport 鉴权</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/socketio.html">Socket.IO</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/assets.html">静态资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/typescript.html">TypeScript</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="4$Menu" aria-haspopup="true"><span>进阶</span><i class="ant-menu-submenu-arrow"></i></div><ul id="4$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/loader.html">Loader</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/plugin.html">插件开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/framework.html">框架开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/cluster-client.html">多进程研发模式增强</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/view-plugin.html">模板插件开发规范</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/style-guide.html">代码风格指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="5$Menu" aria-haspopup="true"><span>社区</span><i class="ant-menu-submenu-arrow"></i></div><ul id="5$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/plugins/">内置插件列表</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/contributing.html">如何贡献</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/resource.html">资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/faq.html">常见问题</a></li></ul></li></ul></div></div><div class="basic_layout-module__post___2Z7KK ant-layout-content"><div class="ant-row" style="margin-left:-8px;margin-right:-8px"><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-24 ant-col-md-18"><div class="markdown-body" style="font-size:14px"><div><p>框架提供了强大且可扩展的配置功能，可以自动合并应用、插件、框架的配置，按顺序覆盖，且可以根据环境维护不同的配置。合并后的配置可直接从 <code>app.config</code> 获取。</p><p>配置的管理有多种方案，以下列一些常见的方案</p><ol><li>使用平台管理配置，应用构建时将当前环境的配置放入包内，启动时指定该配置。但应用就无法一次构建多次部署，而且本地开发环境想使用配置会变的很麻烦。</li><li>使用平台管理配置，在启动时将当前环境的配置通过环境变量传入，这是比较优雅的方式，但框架对运维的要求会比较高，需要部署平台支持，同时开发环境也有相同痛点。</li><li>使用代码管理配置，在代码中添加多个环境的配置，在启动时传入当前环境的参数即可。但无法全局配置，必须修改代码。</li></ol><p>我们选择了最后一种配置方案，<strong>配置即代码</strong>，配置的变更也应该经过 review 后才能发布。应用包本身是可以部署在多个环境的，只需要指定运行环境即可。</p><h3 id="多环境配置">多环境配置</h3><p>框架支持根据环境来加载配置，定义多个环境的配置文件，具体环境请查看<a href="./env.md">运行环境配置</a></p><pre><code>config
|- config.default.js
|- config.prod.js
|- config.unittest.js
`- config.local.js</code></pre><p><code>config.default.js</code> 为默认的配置文件，所有环境都会加载这个配置文件，一般也会作为开发环境的默认配置文件。</p><p>当指定 env 时会同时加载对应的配置文件，并覆盖默认配置文件的同名配置。如 <code>prod</code> 环境会加载 <code>config.prod.js</code> 和 <code>config.default.js</code> 文件，<code>config.prod.js</code> 会覆盖 <code>config.default.js</code> 的同名配置。</p><h3 id="配置写法">配置写法</h3><p>配置文件返回的是一个 object 对象，可以覆盖框架的一些配置，应用也可以将自己业务的配置放到这里方便管理。</p><pre><code class="language-js">// 配置 logger 文件的目录，logger 默认配置由框架提供
module.exports = {
  logger: {
    dir: &#x27;/home/admin/logs/demoapp&#x27;,
  },
};</code></pre><p>配置文件也可以简化的写成 <code>exports.key = value</code> 形式</p><pre><code class="language-js">exports.keys = &#x27;my-cookie-secret-key&#x27;;
exports.logger = {
  level: &#x27;DEBUG&#x27;,
};</code></pre><p>配置文件也可以返回一个 function，可以接受 appInfo 参数</p><pre><code class="language-js">// 将 logger 目录放到代码目录下
const path = require(&#x27;path&#x27;);
module.exports = appInfo =&gt; {
  return {
    logger: {
      dir: path.join(appInfo.baseDir, &#x27;logs&#x27;),
    },
  };
};</code></pre><p>内置的 appInfo 有</p><table><thead><tr><th>appInfo</th><th>说明</th></tr></thead><tbody><tr><td>pkg</td><td>package.json</td></tr><tr><td>name</td><td>应用名，同 pkg.name</td></tr><tr><td>baseDir</td><td>应用代码的目录</td></tr><tr><td>HOME</td><td>用户目录，如 admin 账户为 /home/admin</td></tr><tr><td>root</td><td>应用根目录，只有在 local 和 unittest 环境下为 baseDir，其他都为 HOME。</td></tr></tbody></table><p><code>appInfo.root</code> 是一个优雅的适配，比如在服务器环境我们会使用 <code>/home/admin/logs</code> 作为日志目录，而本地开发时又不想污染用户目录，这样的适配就很好解决这个问题。</p><p>请根据具体场合选择合适的写法，但请确保没有写出以下代码：</p><pre><code class="language-js">// config/config.default.js
exports.someKeys = &#x27;abc&#x27;;
module.exports = appInfo =&gt; {
  const config = {};
  config.keys = &#x27;123456&#x27;;
  return config;
};</code></pre><h3 id="配置加载顺序">配置加载顺序</h3><p>应用、插件、框架都可以定义这些配置，而且目录结构都是一致的，但存在优先级（应用 &gt; 框架 &gt; 插件），相对于此运行环境的优先级会更高。</p><p>比如在 prod 环境加载一个配置的加载顺序如下，后加载的会覆盖前面的同名配置。</p><pre><code>-&gt; 插件 config.default.js
-&gt; 框架 config.default.js
-&gt; 应用 config.default.js
-&gt; 插件 config.prod.js
-&gt; 框架 config.prod.js
-&gt; 应用 config.prod.js</code></pre><p><strong>注意：插件之间也会有加载顺序，但大致顺序类似，具体逻辑可<a href="../advanced/loader.md">查看加载器</a>。</strong></p><h3 id="合并规则">合并规则</h3><p>配置的合并使用 <a href="https://github.com/eggjs/extend2">extend2</a> 模块进行深度拷贝，<a href="https://github.com/eggjs/extend2">extend2</a> fork 自 <a href="https://github.com/justmoon/node-extend">extend</a>，处理数组时会存在差异。</p><pre><code class="language-js">const a = {
  arr: [ 1, 2 ],
};
const b = {
  arr: [ 3 ],
};
extend(true, a, b);
// =&gt; { arr: [ 3 ] }</code></pre><p>根据上面的例子，框架直接覆盖数组而不是进行合并。</p><h2 id="配置结果">配置结果</h2><p>框架在启动时会把合并后的最终配置 dump 到 <code>run/application_config.json</code>（worker 进程）和 <code>run/agent_config.json</code>（agent 进程）中，可以用来分析问题。</p><p>配置文件中会隐藏一些字段，主要包括两类:</p><ul><li>如密码、密钥等安全字段，这里可以通过 <code>config.dump.ignore</code> 配置，必须是 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set">Set</a> 类型，查看<a href="https://github.com/eggjs/egg/blob/master/config/config.default.js">默认配置</a>。</li><li>如函数、Buffer 等类型，<code>JSON.stringify</code> 后的内容特别大</li></ul><p>还会生成 <code>run/application_config_meta.json</code>（worker 进程）和 <code>run/agent_config_meta.json</code>（agent 进程）文件，用来排查属性的来源，如</p><pre><code class="language-json">{
  &quot;logger&quot;: {
    &quot;dir&quot;: &quot;/path/to/config/config.default.js&quot;
  }
}</code></pre></div></div></div><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-0 ant-col-md-6"><div class="markdown-body" style="font-size:14px"><div><ul><li><a href="#%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE">多环境配置</a></li><li><a href="#%E9%85%8D%E7%BD%AE%E5%86%99%E6%B3%95">配置写法</a></li><li><a href="#%E9%85%8D%E7%BD%AE%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F">配置加载顺序</a></li><li><a href="#%E5%90%88%E5%B9%B6%E8%A7%84%E5%88%99">合并规则</a></li></ul><ul><li><a href="#%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C">配置结果</a></li></ul></div></div></div></div></div></div></div></div></div><script type="text/javascript">window.__INIT_STATE__={"lang":"zh","props":{"toc":"%20%20*%20%5B%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%5D(%23%25E5%25A4%259A%25E7%258E%25AF%25E5%25A2%2583%25E9%2585%258D%25E7%25BD%25AE)%0A%20%20*%20%5B%E9%85%8D%E7%BD%AE%E5%86%99%E6%B3%95%5D(%23%25E9%2585%258D%25E7%25BD%25AE%25E5%2586%2599%25E6%25B3%2595)%0A%20%20*%20%5B%E9%85%8D%E7%BD%AE%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F%5D(%23%25E9%2585%258D%25E7%25BD%25AE%25E5%258A%25A0%25E8%25BD%25BD%25E9%25A1%25BA%25E5%25BA%258F)%0A%20%20*%20%5B%E5%90%88%E5%B9%B6%E8%A7%84%E5%88%99%5D(%23%25E5%2590%2588%25E5%25B9%25B6%25E8%25A7%2584%25E5%2588%2599)%0A-%20%5B%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C%5D(%23%25E9%2585%258D%25E7%25BD%25AE%25E7%25BB%2593%25E6%259E%259C)","meta":{"info":{"title":"Config 配置"}},"content":"%0A%0A%0A%E6%A1%86%E6%9E%B6%E6%8F%90%E4%BE%9B%E4%BA%86%E5%BC%BA%E5%A4%A7%E4%B8%94%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84%E9%85%8D%E7%BD%AE%E5%8A%9F%E8%83%BD%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%8A%A8%E5%90%88%E5%B9%B6%E5%BA%94%E7%94%A8%E3%80%81%E6%8F%92%E4%BB%B6%E3%80%81%E6%A1%86%E6%9E%B6%E7%9A%84%E9%85%8D%E7%BD%AE%EF%BC%8C%E6%8C%89%E9%A1%BA%E5%BA%8F%E8%A6%86%E7%9B%96%EF%BC%8C%E4%B8%94%E5%8F%AF%E4%BB%A5%E6%A0%B9%E6%8D%AE%E7%8E%AF%E5%A2%83%E7%BB%B4%E6%8A%A4%E4%B8%8D%E5%90%8C%E7%9A%84%E9%85%8D%E7%BD%AE%E3%80%82%E5%90%88%E5%B9%B6%E5%90%8E%E7%9A%84%E9%85%8D%E7%BD%AE%E5%8F%AF%E7%9B%B4%E6%8E%A5%E4%BB%8E%20%60app.config%60%20%E8%8E%B7%E5%8F%96%E3%80%82%0A%0A%E9%85%8D%E7%BD%AE%E7%9A%84%E7%AE%A1%E7%90%86%E6%9C%89%E5%A4%9A%E7%A7%8D%E6%96%B9%E6%A1%88%EF%BC%8C%E4%BB%A5%E4%B8%8B%E5%88%97%E4%B8%80%E4%BA%9B%E5%B8%B8%E8%A7%81%E7%9A%84%E6%96%B9%E6%A1%88%0A%0A1.%20%E4%BD%BF%E7%94%A8%E5%B9%B3%E5%8F%B0%E7%AE%A1%E7%90%86%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%BA%94%E7%94%A8%E6%9E%84%E5%BB%BA%E6%97%B6%E5%B0%86%E5%BD%93%E5%89%8D%E7%8E%AF%E5%A2%83%E7%9A%84%E9%85%8D%E7%BD%AE%E6%94%BE%E5%85%A5%E5%8C%85%E5%86%85%EF%BC%8C%E5%90%AF%E5%8A%A8%E6%97%B6%E6%8C%87%E5%AE%9A%E8%AF%A5%E9%85%8D%E7%BD%AE%E3%80%82%E4%BD%86%E5%BA%94%E7%94%A8%E5%B0%B1%E6%97%A0%E6%B3%95%E4%B8%80%E6%AC%A1%E6%9E%84%E5%BB%BA%E5%A4%9A%E6%AC%A1%E9%83%A8%E7%BD%B2%EF%BC%8C%E8%80%8C%E4%B8%94%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%83%B3%E4%BD%BF%E7%94%A8%E9%85%8D%E7%BD%AE%E4%BC%9A%E5%8F%98%E7%9A%84%E5%BE%88%E9%BA%BB%E7%83%A6%E3%80%82%0A1.%20%E4%BD%BF%E7%94%A8%E5%B9%B3%E5%8F%B0%E7%AE%A1%E7%90%86%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%9C%A8%E5%90%AF%E5%8A%A8%E6%97%B6%E5%B0%86%E5%BD%93%E5%89%8D%E7%8E%AF%E5%A2%83%E7%9A%84%E9%85%8D%E7%BD%AE%E9%80%9A%E8%BF%87%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%BC%A0%E5%85%A5%EF%BC%8C%E8%BF%99%E6%98%AF%E6%AF%94%E8%BE%83%E4%BC%98%E9%9B%85%E7%9A%84%E6%96%B9%E5%BC%8F%EF%BC%8C%E4%BD%86%E6%A1%86%E6%9E%B6%E5%AF%B9%E8%BF%90%E7%BB%B4%E7%9A%84%E8%A6%81%E6%B1%82%E4%BC%9A%E6%AF%94%E8%BE%83%E9%AB%98%EF%BC%8C%E9%9C%80%E8%A6%81%E9%83%A8%E7%BD%B2%E5%B9%B3%E5%8F%B0%E6%94%AF%E6%8C%81%EF%BC%8C%E5%90%8C%E6%97%B6%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E4%B9%9F%E6%9C%89%E7%9B%B8%E5%90%8C%E7%97%9B%E7%82%B9%E3%80%82%0A1.%20%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%A0%81%E7%AE%A1%E7%90%86%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%A4%9A%E4%B8%AA%E7%8E%AF%E5%A2%83%E7%9A%84%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%9C%A8%E5%90%AF%E5%8A%A8%E6%97%B6%E4%BC%A0%E5%85%A5%E5%BD%93%E5%89%8D%E7%8E%AF%E5%A2%83%E7%9A%84%E5%8F%82%E6%95%B0%E5%8D%B3%E5%8F%AF%E3%80%82%E4%BD%86%E6%97%A0%E6%B3%95%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%BF%85%E9%A1%BB%E4%BF%AE%E6%94%B9%E4%BB%A3%E7%A0%81%E3%80%82%0A%0A%E6%88%91%E4%BB%AC%E9%80%89%E6%8B%A9%E4%BA%86%E6%9C%80%E5%90%8E%E4%B8%80%E7%A7%8D%E9%85%8D%E7%BD%AE%E6%96%B9%E6%A1%88%EF%BC%8C**%E9%85%8D%E7%BD%AE%E5%8D%B3%E4%BB%A3%E7%A0%81**%EF%BC%8C%E9%85%8D%E7%BD%AE%E7%9A%84%E5%8F%98%E6%9B%B4%E4%B9%9F%E5%BA%94%E8%AF%A5%E7%BB%8F%E8%BF%87%20review%20%E5%90%8E%E6%89%8D%E8%83%BD%E5%8F%91%E5%B8%83%E3%80%82%E5%BA%94%E7%94%A8%E5%8C%85%E6%9C%AC%E8%BA%AB%E6%98%AF%E5%8F%AF%E4%BB%A5%E9%83%A8%E7%BD%B2%E5%9C%A8%E5%A4%9A%E4%B8%AA%E7%8E%AF%E5%A2%83%E7%9A%84%EF%BC%8C%E5%8F%AA%E9%9C%80%E8%A6%81%E6%8C%87%E5%AE%9A%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E5%8D%B3%E5%8F%AF%E3%80%82%0A%0A%23%23%23%20%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%0A%0A%E6%A1%86%E6%9E%B6%E6%94%AF%E6%8C%81%E6%A0%B9%E6%8D%AE%E7%8E%AF%E5%A2%83%E6%9D%A5%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%AE%9A%E4%B9%89%E5%A4%9A%E4%B8%AA%E7%8E%AF%E5%A2%83%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%8C%E5%85%B7%E4%BD%93%E7%8E%AF%E5%A2%83%E8%AF%B7%E6%9F%A5%E7%9C%8B%5B%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%5D(.%2Fenv.md)%0A%0A%60%60%60%0Aconfig%0A%7C-%20config.default.js%0A%7C-%20config.prod.js%0A%7C-%20config.unittest.js%0A%60-%20config.local.js%0A%60%60%60%0A%0A%60config.default.js%60%20%E4%B8%BA%E9%BB%98%E8%AE%A4%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%8C%E6%89%80%E6%9C%89%E7%8E%AF%E5%A2%83%E9%83%BD%E4%BC%9A%E5%8A%A0%E8%BD%BD%E8%BF%99%E4%B8%AA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%8C%E4%B8%80%E8%88%AC%E4%B9%9F%E4%BC%9A%E4%BD%9C%E4%B8%BA%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E3%80%82%0A%0A%E5%BD%93%E6%8C%87%E5%AE%9A%20env%20%E6%97%B6%E4%BC%9A%E5%90%8C%E6%97%B6%E5%8A%A0%E8%BD%BD%E5%AF%B9%E5%BA%94%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%8C%E5%B9%B6%E8%A6%86%E7%9B%96%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%90%8C%E5%90%8D%E9%85%8D%E7%BD%AE%E3%80%82%E5%A6%82%20%60prod%60%20%E7%8E%AF%E5%A2%83%E4%BC%9A%E5%8A%A0%E8%BD%BD%20%60config.prod.js%60%20%E5%92%8C%20%60config.default.js%60%20%E6%96%87%E4%BB%B6%EF%BC%8C%60config.prod.js%60%20%E4%BC%9A%E8%A6%86%E7%9B%96%20%60config.default.js%60%20%E7%9A%84%E5%90%8C%E5%90%8D%E9%85%8D%E7%BD%AE%E3%80%82%0A%0A%23%23%23%20%E9%85%8D%E7%BD%AE%E5%86%99%E6%B3%95%0A%0A%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%BF%94%E5%9B%9E%E7%9A%84%E6%98%AF%E4%B8%80%E4%B8%AA%20object%20%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%A6%86%E7%9B%96%E6%A1%86%E6%9E%B6%E7%9A%84%E4%B8%80%E4%BA%9B%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%BA%94%E7%94%A8%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%B0%86%E8%87%AA%E5%B7%B1%E4%B8%9A%E5%8A%A1%E7%9A%84%E9%85%8D%E7%BD%AE%E6%94%BE%E5%88%B0%E8%BF%99%E9%87%8C%E6%96%B9%E4%BE%BF%E7%AE%A1%E7%90%86%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20%E9%85%8D%E7%BD%AE%20logger%20%E6%96%87%E4%BB%B6%E7%9A%84%E7%9B%AE%E5%BD%95%EF%BC%8Clogger%20%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E7%94%B1%E6%A1%86%E6%9E%B6%E6%8F%90%E4%BE%9B%0Amodule.exports%20%3D%20%7B%0A%20%20logger%3A%20%7B%0A%20%20%20%20dir%3A%20'%2Fhome%2Fadmin%2Flogs%2Fdemoapp'%2C%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B9%9F%E5%8F%AF%E4%BB%A5%E7%AE%80%E5%8C%96%E7%9A%84%E5%86%99%E6%88%90%20%60exports.key%20%3D%20value%60%20%E5%BD%A2%E5%BC%8F%0A%0A%60%60%60js%0Aexports.keys%20%3D%20'my-cookie-secret-key'%3B%0Aexports.logger%20%3D%20%7B%0A%20%20level%3A%20'DEBUG'%2C%0A%7D%3B%0A%60%60%60%0A%0A%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B9%9F%E5%8F%AF%E4%BB%A5%E8%BF%94%E5%9B%9E%E4%B8%80%E4%B8%AA%20function%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%8E%A5%E5%8F%97%20appInfo%20%E5%8F%82%E6%95%B0%0A%0A%60%60%60js%0A%2F%2F%20%E5%B0%86%20logger%20%E7%9B%AE%E5%BD%95%E6%94%BE%E5%88%B0%E4%BB%A3%E7%A0%81%E7%9B%AE%E5%BD%95%E4%B8%8B%0Aconst%20path%20%3D%20require('path')%3B%0Amodule.exports%20%3D%20appInfo%20%3D%3E%20%7B%0A%20%20return%20%7B%0A%20%20%20%20logger%3A%20%7B%0A%20%20%20%20%20%20dir%3A%20path.join(appInfo.baseDir%2C%20'logs')%2C%0A%20%20%20%20%7D%2C%0A%20%20%7D%3B%0A%7D%3B%0A%60%60%60%0A%0A%E5%86%85%E7%BD%AE%E7%9A%84%20appInfo%20%E6%9C%89%0A%0AappInfo%20%7C%20%E8%AF%B4%E6%98%8E%0A---%20%7C%20---%0Apkg%20%7C%20package.json%0Aname%20%7C%20%E5%BA%94%E7%94%A8%E5%90%8D%EF%BC%8C%E5%90%8C%20pkg.name%0AbaseDir%20%7C%20%E5%BA%94%E7%94%A8%E4%BB%A3%E7%A0%81%E7%9A%84%E7%9B%AE%E5%BD%95%0AHOME%20%7C%20%E7%94%A8%E6%88%B7%E7%9B%AE%E5%BD%95%EF%BC%8C%E5%A6%82%20admin%20%E8%B4%A6%E6%88%B7%E4%B8%BA%20%2Fhome%2Fadmin%0Aroot%20%7C%20%E5%BA%94%E7%94%A8%E6%A0%B9%E7%9B%AE%E5%BD%95%EF%BC%8C%E5%8F%AA%E6%9C%89%E5%9C%A8%20local%20%E5%92%8C%20unittest%20%E7%8E%AF%E5%A2%83%E4%B8%8B%E4%B8%BA%20baseDir%EF%BC%8C%E5%85%B6%E4%BB%96%E9%83%BD%E4%B8%BA%20HOME%E3%80%82%0A%0A%60appInfo.root%60%20%E6%98%AF%E4%B8%80%E4%B8%AA%E4%BC%98%E9%9B%85%E7%9A%84%E9%80%82%E9%85%8D%EF%BC%8C%E6%AF%94%E5%A6%82%E5%9C%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%8E%AF%E5%A2%83%E6%88%91%E4%BB%AC%E4%BC%9A%E4%BD%BF%E7%94%A8%20%60%2Fhome%2Fadmin%2Flogs%60%20%E4%BD%9C%E4%B8%BA%E6%97%A5%E5%BF%97%E7%9B%AE%E5%BD%95%EF%BC%8C%E8%80%8C%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E6%97%B6%E5%8F%88%E4%B8%8D%E6%83%B3%E6%B1%A1%E6%9F%93%E7%94%A8%E6%88%B7%E7%9B%AE%E5%BD%95%EF%BC%8C%E8%BF%99%E6%A0%B7%E7%9A%84%E9%80%82%E9%85%8D%E5%B0%B1%E5%BE%88%E5%A5%BD%E8%A7%A3%E5%86%B3%E8%BF%99%E4%B8%AA%E9%97%AE%E9%A2%98%E3%80%82%0A%0A%0A%E8%AF%B7%E6%A0%B9%E6%8D%AE%E5%85%B7%E4%BD%93%E5%9C%BA%E5%90%88%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E7%9A%84%E5%86%99%E6%B3%95%EF%BC%8C%E4%BD%86%E8%AF%B7%E7%A1%AE%E4%BF%9D%E6%B2%A1%E6%9C%89%E5%86%99%E5%87%BA%E4%BB%A5%E4%B8%8B%E4%BB%A3%E7%A0%81%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0Aexports.someKeys%20%3D%20'abc'%3B%0Amodule.exports%20%3D%20appInfo%20%3D%3E%20%7B%0A%20%20const%20config%20%3D%20%7B%7D%3B%0A%20%20config.keys%20%3D%20'123456'%3B%0A%20%20return%20config%3B%0A%7D%3B%0A%60%60%60%0A%0A%23%23%23%20%E9%85%8D%E7%BD%AE%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F%0A%0A%E5%BA%94%E7%94%A8%E3%80%81%E6%8F%92%E4%BB%B6%E3%80%81%E6%A1%86%E6%9E%B6%E9%83%BD%E5%8F%AF%E4%BB%A5%E5%AE%9A%E4%B9%89%E8%BF%99%E4%BA%9B%E9%85%8D%E7%BD%AE%EF%BC%8C%E8%80%8C%E4%B8%94%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E9%83%BD%E6%98%AF%E4%B8%80%E8%87%B4%E7%9A%84%EF%BC%8C%E4%BD%86%E5%AD%98%E5%9C%A8%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%88%E5%BA%94%E7%94%A8%20%3E%20%E6%A1%86%E6%9E%B6%20%3E%20%E6%8F%92%E4%BB%B6%EF%BC%89%EF%BC%8C%E7%9B%B8%E5%AF%B9%E4%BA%8E%E6%AD%A4%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E4%BC%9A%E6%9B%B4%E9%AB%98%E3%80%82%0A%0A%E6%AF%94%E5%A6%82%E5%9C%A8%20prod%20%E7%8E%AF%E5%A2%83%E5%8A%A0%E8%BD%BD%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E7%9A%84%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F%E5%A6%82%E4%B8%8B%EF%BC%8C%E5%90%8E%E5%8A%A0%E8%BD%BD%E7%9A%84%E4%BC%9A%E8%A6%86%E7%9B%96%E5%89%8D%E9%9D%A2%E7%9A%84%E5%90%8C%E5%90%8D%E9%85%8D%E7%BD%AE%E3%80%82%0A%0A%60%60%60%0A-%3E%20%E6%8F%92%E4%BB%B6%20config.default.js%0A-%3E%20%E6%A1%86%E6%9E%B6%20config.default.js%0A-%3E%20%E5%BA%94%E7%94%A8%20config.default.js%0A-%3E%20%E6%8F%92%E4%BB%B6%20config.prod.js%0A-%3E%20%E6%A1%86%E6%9E%B6%20config.prod.js%0A-%3E%20%E5%BA%94%E7%94%A8%20config.prod.js%0A%60%60%60%0A%0A**%E6%B3%A8%E6%84%8F%EF%BC%9A%E6%8F%92%E4%BB%B6%E4%B9%8B%E9%97%B4%E4%B9%9F%E4%BC%9A%E6%9C%89%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F%EF%BC%8C%E4%BD%86%E5%A4%A7%E8%87%B4%E9%A1%BA%E5%BA%8F%E7%B1%BB%E4%BC%BC%EF%BC%8C%E5%85%B7%E4%BD%93%E9%80%BB%E8%BE%91%E5%8F%AF%5B%E6%9F%A5%E7%9C%8B%E5%8A%A0%E8%BD%BD%E5%99%A8%5D(..%2Fadvanced%2Floader.md)%E3%80%82**%0A%0A%23%23%23%20%E5%90%88%E5%B9%B6%E8%A7%84%E5%88%99%0A%0A%E9%85%8D%E7%BD%AE%E7%9A%84%E5%90%88%E5%B9%B6%E4%BD%BF%E7%94%A8%20%5Bextend2%5D%20%E6%A8%A1%E5%9D%97%E8%BF%9B%E8%A1%8C%E6%B7%B1%E5%BA%A6%E6%8B%B7%E8%B4%9D%EF%BC%8C%5Bextend2%5D%20fork%20%E8%87%AA%20%5Bextend%5D%EF%BC%8C%E5%A4%84%E7%90%86%E6%95%B0%E7%BB%84%E6%97%B6%E4%BC%9A%E5%AD%98%E5%9C%A8%E5%B7%AE%E5%BC%82%E3%80%82%0A%0A%60%60%60js%0Aconst%20a%20%3D%20%7B%0A%20%20arr%3A%20%5B%201%2C%202%20%5D%2C%0A%7D%3B%0Aconst%20b%20%3D%20%7B%0A%20%20arr%3A%20%5B%203%20%5D%2C%0A%7D%3B%0Aextend(true%2C%20a%2C%20b)%3B%0A%2F%2F%20%3D%3E%20%7B%20arr%3A%20%5B%203%20%5D%20%7D%0A%60%60%60%0A%0A%E6%A0%B9%E6%8D%AE%E4%B8%8A%E9%9D%A2%E7%9A%84%E4%BE%8B%E5%AD%90%EF%BC%8C%E6%A1%86%E6%9E%B6%E7%9B%B4%E6%8E%A5%E8%A6%86%E7%9B%96%E6%95%B0%E7%BB%84%E8%80%8C%E4%B8%8D%E6%98%AF%E8%BF%9B%E8%A1%8C%E5%90%88%E5%B9%B6%E3%80%82%0A%0A%23%23%20%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C%0A%0A%E6%A1%86%E6%9E%B6%E5%9C%A8%E5%90%AF%E5%8A%A8%E6%97%B6%E4%BC%9A%E6%8A%8A%E5%90%88%E5%B9%B6%E5%90%8E%E7%9A%84%E6%9C%80%E7%BB%88%E9%85%8D%E7%BD%AE%20dump%20%E5%88%B0%20%60run%2Fapplication_config.json%60%EF%BC%88worker%20%E8%BF%9B%E7%A8%8B%EF%BC%89%E5%92%8C%20%60run%2Fagent_config.json%60%EF%BC%88agent%20%E8%BF%9B%E7%A8%8B%EF%BC%89%E4%B8%AD%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%94%A8%E6%9D%A5%E5%88%86%E6%9E%90%E9%97%AE%E9%A2%98%E3%80%82%0A%0A%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E4%BC%9A%E9%9A%90%E8%97%8F%E4%B8%80%E4%BA%9B%E5%AD%97%E6%AE%B5%EF%BC%8C%E4%B8%BB%E8%A6%81%E5%8C%85%E6%8B%AC%E4%B8%A4%E7%B1%BB%3A%0A%0A-%20%E5%A6%82%E5%AF%86%E7%A0%81%E3%80%81%E5%AF%86%E9%92%A5%E7%AD%89%E5%AE%89%E5%85%A8%E5%AD%97%E6%AE%B5%EF%BC%8C%E8%BF%99%E9%87%8C%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20%60config.dump.ignore%60%20%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%BF%85%E9%A1%BB%E6%98%AF%20%5BSet%5D%20%E7%B1%BB%E5%9E%8B%EF%BC%8C%E6%9F%A5%E7%9C%8B%5B%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg%2Fblob%2Fmaster%2Fconfig%2Fconfig.default.js)%E3%80%82%0A-%20%E5%A6%82%E5%87%BD%E6%95%B0%E3%80%81Buffer%20%E7%AD%89%E7%B1%BB%E5%9E%8B%EF%BC%8C%60JSON.stringify%60%20%E5%90%8E%E7%9A%84%E5%86%85%E5%AE%B9%E7%89%B9%E5%88%AB%E5%A4%A7%0A%0A%E8%BF%98%E4%BC%9A%E7%94%9F%E6%88%90%20%60run%2Fapplication_config_meta.json%60%EF%BC%88worker%20%E8%BF%9B%E7%A8%8B%EF%BC%89%E5%92%8C%20%60run%2Fagent_config_meta.json%60%EF%BC%88agent%20%E8%BF%9B%E7%A8%8B%EF%BC%89%E6%96%87%E4%BB%B6%EF%BC%8C%E7%94%A8%E6%9D%A5%E6%8E%92%E6%9F%A5%E5%B1%9E%E6%80%A7%E7%9A%84%E6%9D%A5%E6%BA%90%EF%BC%8C%E5%A6%82%0A%0A%60%60%60json%0A%7B%0A%20%20%22logger%22%3A%20%7B%0A%20%20%20%20%22dir%22%3A%20%22%2Fpath%2Fto%2Fconfig%2Fconfig.default.js%22%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A%5BSet%5D%3A%20https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FSet%0A%5Bextend%5D%3A%20https%3A%2F%2Fgithub.com%2Fjustmoon%2Fnode-extend%0A%5Bextend2%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fextend2%0A"}}</script><script type="text/javascript" src="/static/js/post.b9faab88.js"></script></body></html>