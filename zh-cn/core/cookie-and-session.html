<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.png"><style class="_styletron_hydrate_"></style><title>Cookie 与 Session</title><meta name="description" content="Born to build better enterprise frameworks and apps"><link href="/static/css/post.d62265dc.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="ant-layout" data-reactroot=""><div class="header-module__header___3ADJ9 ant-layout-header"><div class="ant-row-flex"><div class="ant-col-xs-12 ant-col-md-20 ant-col-lg-2"><div class="header-module__logo___3yTXp"><a href="/"><img src="/logo.svg" alt="logo"/></a></div></div><div class="ant-col-xs-0 ant-col-md-0 ant-col-lg-20"><ul class="ant-menu header-module__menu___3yEtW ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/intro/">指南</a></li><li class="ant-menu-item" role="menuitem"><a href="/api/">API</a></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/tutorials/index.html">教程</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/search?q=topic%3Aegg-plugin&amp;type=Repositories">插件</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/eggjs/egg/releases">发布日志</a></li></ul></div><div style="text-align:right" class="ant-col-xs-12 ant-col-md-4 ant-col-lg-2"><button type="button" class="ant-btn"><span>Languages</span></button></div></div></div><div class="ant-layout-content"><div class="basic_layout-module__content___3flpY ant-layout"><div class="sider-module__side___1Cadj ant-layout-sider ant-layout-sider-light" style="flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"><ul class="ant-menu sider-module__menu___2GqPr ant-menu-light ant-menu-root ant-menu-inline" role="menu"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="0$Menu" aria-haspopup="true"><span>新手指南</span><i class="ant-menu-submenu-arrow"></i></div><ul id="0$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/index.html">Egg.js 是什么?</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/egg-and-koa.html">Egg.js 和 Koa</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/quickstart.html">快速入门</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/progressive.html">渐进式开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/migration.html">2.x 升级指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="1$Menu" aria-haspopup="true"><span>基础功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="1$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/structure.html">目录结构</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/objects.html">内置对象</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/env.html">运行环境</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/config.html">配置</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/middleware.html">中间件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/router.html">Router</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/controller.html">Controller</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/service.html">Service</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/plugin.html">插件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/schedule.html">定时任务</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/extend.html">框架扩展</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/app-start.html">启动自定义</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="2$Menu" aria-haspopup="true"><span>核心功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="2$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/development.html">本地开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/unittest.html">单元测试</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/deployment.html">应用部署</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/logger.html">日志</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/httpclient.html">HttpClient</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cookie-and-session.html">Cookie and Session</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cluster-and-ipc.html">多进程模型和进程间通讯</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/view.html">模板渲染</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/error-handling.html">异常处理</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/security.html">安全</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/i18n.html">国际化</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="3$Menu" aria-haspopup="true"><span>教程</span><i class="ant-menu-submenu-arrow"></i></div><ul id="3$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/mysql.html">MySQL</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/restful.html">RESTful API</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/passport.html">Passport 鉴权</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/socketio.html">Socket.IO</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/assets.html">静态资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/typescript.html">TypeScript</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="4$Menu" aria-haspopup="true"><span>进阶</span><i class="ant-menu-submenu-arrow"></i></div><ul id="4$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/loader.html">Loader</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/plugin.html">插件开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/framework.html">框架开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/cluster-client.html">多进程研发模式增强</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/view-plugin.html">模板插件开发规范</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/style-guide.html">代码风格指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="5$Menu" aria-haspopup="true"><span>社区</span><i class="ant-menu-submenu-arrow"></i></div><ul id="5$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/plugins/">内置插件列表</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/contributing.html">如何贡献</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/resource.html">资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/faq.html">常见问题</a></li></ul></li></ul></div></div><div class="basic_layout-module__post___2Z7KK ant-layout-content"><div class="ant-row" style="margin-left:-8px;margin-right:-8px"><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-24 ant-col-md-18"><div class="markdown-body" style="font-size:14px"><div><h2 id="cookie">Cookie</h2><p>HTTP 请求都是无状态的，但是我们的 Web 应用通常都需要知道发起请求的人是谁。为了解决这个问题，HTTP 协议设计了一个特殊的请求头：<a href="https://en.wikipedia.org/wiki/HTTP_cookie">Cookie</a>。服务端可以通过响应头（set-cookie）将少量数据响应给客户端，浏览器会遵循协议将数据保存，并在下次请求同一个服务的时候带上（浏览器也会遵循协议，只在访问符合 Cookie 指定规则的网站时带上对应的 Cookie 来保证安全性）。</p><p>通过 <code>ctx.cookies</code>，我们可以在 controller 中便捷、安全的设置和读取 Cookie。</p><pre><code class="language-js">class HomeController extends Controller {
  async add() {
    const ctx = this.ctx;
    let count = ctx.cookies.get(&#x27;count&#x27;);
    count = count ? Number(count) : 0;
    ctx.cookies.set(&#x27;count&#x27;, ++count);
    ctx.body = count;
  }
  async remove() {
    const ctx = this.ctx;
    ctx.cookies.set(&#x27;count&#x27;, null);
    ctx.status = 204;
  }
}</code></pre><h4 id="ctxcookiessetkey-value-options"><code>ctx.cookies.set(key, value, options)</code></h4><p>设置 Cookie 其实是通过在 HTTP 响应中设置 set-cookie 头完成的，每一个 set-cookie 都会让浏览器在 Cookie 中存一个键值对。在设置 Cookie 值的同时，协议还支持许多参数来配置这个 Cookie 的传输、存储和权限。</p><ul><li><code>{Number} maxAge</code>: 设置这个键值对在浏览器的最长保存时间。是一个从服务器当前时刻开始的毫秒数。</li><li><code>{Date} expires</code>: 设置这个键值对的失效时间，如果设置了 maxAge，expires 将会被覆盖。如果 maxAge 和 expires 都没设置，Cookie 将会在浏览器的会话失效（一般是关闭浏览器时）的时候失效。</li><li><code>{String} path</code>: 设置键值对生效的 URL 路径，默认设置在根路径上（<code>/</code>），也就是当前域名下的所有 URL 都可以访问这个 Cookie。</li><li><code>{String} domain</code>: 设置键值对生效的域名，默认没有配置，可以配置成只在指定域名才能访问。</li><li><code>{Boolean} httpOnly</code>: 设置键值对是否可以被 js 访问，默认为 true，不允许被 js 访问。</li><li><code>{Boolean} secure</code>: 设置键值对<a href="http://stackoverflow.com/questions/13729749/how-does-cookie-secure-flag-work">只在 HTTPS 连接上传输</a>，框架会帮我们判断当前是否在 HTTPS 连接上自动设置 secure 的值。</li></ul><p>除了这些属性之外，框架另外扩展了 3 个参数的支持：</p><ul><li><code>{Boolean} overwrite</code>：设置 key 相同的键值对如何处理，如果设置为 true，则后设置的值会覆盖前面设置的，否则将会发送两个 set-cookie 响应头。</li><li><code>{Boolean} signed</code>：设置是否对 Cookie 进行签名，如果设置为 true，则设置键值对的时候会同时对这个键值对的值进行签名，后面取的时候做校验，可以防止前端对这个值进行篡改。默认为 true。</li><li><code>{Boolean} encrypt</code>：设置是否对 Cookie 进行加密，如果设置为 true，则在发送 Cookie 前会对这个键值对的值进行加密，客户端无法读取到 Cookie 的明文值。默认为 false。</li></ul><p>在设置 Cookie 时我们需要思考清楚这个 Cookie 的作用，它需要被浏览器保存多久？是否可以被 js 获取到？是否可以被前端修改？</p><p><strong>默认的配置下，Cookie 是加签不加密的，浏览器可以看到明文，js 不能访问，不能被客户端（手工）篡改。</strong></p><ul><li>如果想要 Cookie 在浏览器端可以被 js 访问并修改:</li></ul><pre><code class="language-js">ctx.cookies.set(key, value, {
  httpOnly: false,
  signed: false,
});</code></pre><ul><li>如果想要 Cookie 在浏览器端不能被修改，不能看到明文：</li></ul><pre><code class="language-js">ctx.cookies.set(key, value, {
  httpOnly: true, // 默认就是 true
  encrypt: true, // 加密传输
});</code></pre><p>注意：</p><ol><li>由于<a href="http://stackoverflow.com/questions/7567154/can-i-use-unicode-characters-in-http-headers">浏览器和其他客户端实现的不确定性</a>，为了保证 Cookie 可以写入成功，建议 value 通过 base64 编码或者其他形式 encode 之后再写入。</li><li>由于<a href="http://stackoverflow.com/questions/640938/what-is-the-maximum-size-of-a-web-browsers-cookies-key">浏览器对 Cookie 有长度限制限制</a>，所以尽量不要设置太长的 Cookie。一般来说不要超过 4093 bytes。当设置的 Cookie value 大于这个值时，框架会打印一条警告日志。</li></ol><h4 id="ctxcookiesgetkey-options"><code>ctx.cookies.get(key, options)</code></h4><p>由于 HTTP 请求中的 Cookie 是在一个 header 中传输过来的，通过框架提供的这个方法可以快速的从整段 Cookie 中获取对应的键值对的值。上面在设置 Cookie 的时候，我们可以设置 <code>options.signed</code> 和 <code>options.encrypt</code> 来对 Cookie 进行签名或加密，因此对应的在获取 Cookie 的时候也要传相匹配的选项。</p><ul><li>如果设置的时候指定为 signed，获取时未指定，则不会在获取时对取到的值做验签，导致可能被客户端篡改。</li><li>如果设置的时候指定为 encrypt，获取时未指定，则无法获取到真实的值，而是加密过后的密文。</li></ul><p>如果要获取前端或者其他系统设置的 cookie，需要指定参数 <code>signed</code> 为 <code>false</code>，避免对它做验签导致获取不到 cookie 的值。</p><pre><code class="language-js">ctx.cookies.get(&#x27;frontend-cookie&#x27;, {
  signed: false,
});</code></pre><h3 id="cookie-秘钥">Cookie 秘钥</h3><p>由于我们在 Cookie 中需要用到加解密和验签，所以需要配置一个秘钥供加密使用。在 <code>config/config.default.js</code> 中</p><pre><code class="language-js">module.exports = {
  keys: &#x27;key1,key2&#x27;,
};</code></pre><p>keys 配置成一个字符串，可以按照逗号分隔配置多个 key。Cookie 在使用这个配置进行加解密时：</p><ul><li>加密和加签时只会使用第一个秘钥。</li><li>解密和验签时会遍历 keys 进行解密。</li></ul><p>如果我们想要更新 Cookie 的秘钥，但是又不希望之前设置到用户浏览器上的 Cookie 失效，可以将新的秘钥配置到 keys 最前面，等过一段时间之后再删去不需要的秘钥即可。</p><h2 id="session">Session</h2><p>Cookie 在 Web 应用中经常承担标识请求方身份的功能，所以 Web 应用在 Cookie 的基础上封装了 Session 的概念，专门用做用户身份识别。</p><p>框架内置了 <a href="https://github.com/eggjs/egg-session">Session</a> 插件，给我们提供了 <code>ctx.session</code> 来访问或者修改当前用户 Session 。</p><pre><code class="language-js">class HomeController extends Controller {
  async fetchPosts() {
    const ctx = this.ctx;
    // 获取 Session 上的内容
    const userId = ctx.session.userId;
    const posts = await ctx.service.post.fetch(userId);
    // 修改 Session 的值
    ctx.session.visited = ctx.session.visited ? (ctx.session.visited + 1) : 1;
    ctx.body = {
      success: true,
      posts,
    };
  }
}</code></pre><p>Session 的使用方法非常直观，直接读取它或者修改它就可以了，如果要删除它，直接将它赋值为 null：</p><pre><code class="language-js">ctx.session = null;</code></pre><p>Session 的实现是基于 Cookie 的，默认配置下，用户 Session 的内容加密后直接存储在 Cookie 中的一个字段中，用户每次请求我们网站的时候都会带上这个 Cookie，我们在服务端解密后使用。Session 的默认配置如下：</p><pre><code class="language-js">exports.session = {
  key: &#x27;EGG_SESS&#x27;,
  maxAge: 24 * 3600 * 1000, // 1 天
  httpOnly: true,
  encrypt: true,
};</code></pre><p>可以看到这些参数除了 <code>key</code> 都是 Cookie 的参数，<code>key</code> 代表了存储 Session 的 Cookie 键值对的 key 是什么。在默认的配置下，存放 Session 的 Cookie 将会加密存储、不可被前端 js 访问，这样可以保证用户的 Session 是安全的。</p><h3 id="扩展存储">扩展存储</h3><p>Session 默认存放在 Cookie 中，但是如果我们的 Session 对象过于庞大，就会带来一些额外的问题：</p><ul><li>前面提到，浏览器通常都有限制最大的 Cookie 长度，当设置的 Session 过大时，浏览器可能拒绝保存。</li><li>Cookie 在每次请求时都会带上，当 Session 过大时，每次请求都要额外带上庞大的 Cookie 信息。</li></ul><p>框架提供了将 Session 存储到除了 Cookie 之外的其他存储的扩展方案，我们只需要设置 <code>app.sessionStore</code> 即可将 Session 存储到指定的存储中。</p><pre><code class="language-js">// app.js
module.exports = app =&gt; {
  app.sessionStore = {
    // support promise / async
    async get (key) {
      // return value;
    },
    async set (key, value, maxAge) {
      // set key to store
    },
    async destroy (key) {
      // destroy key
    },
  };
};</code></pre><p>sessionStore 的实现我们也可以封装到插件中，例如 <a href="https://github.com/eggjs/egg-session-redis">egg-session-redis</a> 就提供了将 Session 存储到 redis 中的能力，在应用层，我们只需要引入 <a href="https://github.com/eggjs/egg-redis">egg-redis</a> 和 <a href="https://github.com/eggjs/egg-session-redis">egg-session-redis</a> 插件即可。</p><pre><code class="language-js">// plugin.js
exports.redis = {
  enable: true,
  package: &#x27;egg-redis&#x27;,
};
exports.sessionRedis = {
  enable: true,
  package: &#x27;egg-session-redis&#x27;,
};</code></pre><p><strong>注意：一旦选择了将 Session 存入到外部存储中，就意味着系统将强依赖于这个外部存储，当它挂了的时候，我们就完全无法使用 Session 相关的功能了。因此我们更推荐大家只将必要的信息存储在 Session 中，保持 Session 的精简并使用默认的 Cookie 存储，用户级别的缓存不要存储在 Session 中。</strong></p><h3 id="session-实践">Session 实践</h3><h4 id="修改用户-session-失效时间">修改用户 Session 失效时间</h4><p>虽然在 Session 的配置中有一项是 maxAge，但是它只能全局设置 Session 的有效期，我们经常可以在一些网站的登陆页上看到有 <strong>记住我</strong> 的选项框，勾选之后可以让登陆用户的 Session 有效期更长。这种针对特定用户的 Session 有效时间设置我们可以通过 <code>ctx.session.maxAge=</code> 来实现。</p><pre><code class="language-js">const ms = require(&#x27;ms&#x27;);
class UserController extends Controller {
  async login() {
    const ctx = this.ctx;
    const { username, password, rememberMe } = ctx.request.body;
    const user = await ctx.loginAndGetUser(username, password);

    // 设置 Session
    ctx.session.user = user;
    // 如果用户勾选了 `记住我`，设置 30 天的过期时间
    if (rememberMe) ctx.session.maxAge = ms(&#x27;30d&#x27;);
  }
}</code></pre><h4 id="延长用户-session-有效期">延长用户 Session 有效期</h4><p>默认情况下，当用户请求没有导致 Session 被修改时，框架都不会延长 Session 的有效期，但是在有些场景下，我们希望用户如果长时间都在访问我们的站点，则延长他们的 Session 有效期，不让用户退出登录态。框架提供了一个 <code>renew</code> 配置项用于实现此功能，它会在发现当用户 Session 的有效期仅剩下最大有效期一半的时候，重置 Session 的有效期。</p><pre><code class="language-js">// config/config.default.js
module.exports = {
  session: {
    renew: true,
  },
};</code></pre></div></div></div><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-0 ant-col-md-6"><div class="markdown-body" style="font-size:14px"><div><ul><li><a href="#cookie">Cookie</a><ul><li><a href="#ctxcookiessetkey-value-options"><code>ctx.cookies.set(key, value, options)</code></a></li><li><a href="#ctxcookiesgetkey-options"><code>ctx.cookies.get(key, options)</code></a></li></ul><ul><li><a href="#cookie-%E7%A7%98%E9%92%A5">Cookie 秘钥</a></li></ul></li><li><a href="#session">Session</a><ul><li><a href="#%E6%89%A9%E5%B1%95%E5%AD%98%E5%82%A8">扩展存储</a></li><li><a href="#session-%E5%AE%9E%E8%B7%B5">Session 实践</a><ul><li><a href="#%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7-session-%E5%A4%B1%E6%95%88%E6%97%B6%E9%97%B4">修改用户 Session 失效时间</a></li><li><a href="#%E5%BB%B6%E9%95%BF%E7%94%A8%E6%88%B7-session-%E6%9C%89%E6%95%88%E6%9C%9F">延长用户 Session 有效期</a></li></ul></li></ul></li></ul></div></div></div></div></div></div></div></div></div><script type="text/javascript">window.__INIT_STATE__={"lang":"zh","props":{"toc":"-%20%5BCookie%5D(%23cookie)%0A%20%20%20%20%2B%20%5B%60ctx.cookies.set(key%2C%20value%2C%20options)%60%5D(%23ctxcookiessetkey-value-options)%0A%20%20%20%20%2B%20%5B%60ctx.cookies.get(key%2C%20options)%60%5D(%23ctxcookiesgetkey-options)%0A%20%20*%20%5BCookie%20%E7%A7%98%E9%92%A5%5D(%23cookie-%25E7%25A7%2598%25E9%2592%25A5)%0A-%20%5BSession%5D(%23session)%0A%20%20*%20%5B%E6%89%A9%E5%B1%95%E5%AD%98%E5%82%A8%5D(%23%25E6%2589%25A9%25E5%25B1%2595%25E5%25AD%2598%25E5%2582%25A8)%0A%20%20*%20%5BSession%20%E5%AE%9E%E8%B7%B5%5D(%23session-%25E5%25AE%259E%25E8%25B7%25B5)%0A%20%20%20%20%2B%20%5B%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%20Session%20%E5%A4%B1%E6%95%88%E6%97%B6%E9%97%B4%5D(%23%25E4%25BF%25AE%25E6%2594%25B9%25E7%2594%25A8%25E6%2588%25B7-session-%25E5%25A4%25B1%25E6%2595%2588%25E6%2597%25B6%25E9%2597%25B4)%0A%20%20%20%20%2B%20%5B%E5%BB%B6%E9%95%BF%E7%94%A8%E6%88%B7%20Session%20%E6%9C%89%E6%95%88%E6%9C%9F%5D(%23%25E5%25BB%25B6%25E9%2595%25BF%25E7%2594%25A8%25E6%2588%25B7-session-%25E6%259C%2589%25E6%2595%2588%25E6%259C%259F)","meta":{"info":{"title":"Cookie 与 Session"}},"content":"%0A%0A%0A%23%23%20Cookie%0A%0AHTTP%20%E8%AF%B7%E6%B1%82%E9%83%BD%E6%98%AF%E6%97%A0%E7%8A%B6%E6%80%81%E7%9A%84%EF%BC%8C%E4%BD%86%E6%98%AF%E6%88%91%E4%BB%AC%E7%9A%84%20Web%20%E5%BA%94%E7%94%A8%E9%80%9A%E5%B8%B8%E9%83%BD%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E5%8F%91%E8%B5%B7%E8%AF%B7%E6%B1%82%E7%9A%84%E4%BA%BA%E6%98%AF%E8%B0%81%E3%80%82%E4%B8%BA%E4%BA%86%E8%A7%A3%E5%86%B3%E8%BF%99%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%8CHTTP%20%E5%8D%8F%E8%AE%AE%E8%AE%BE%E8%AE%A1%E4%BA%86%E4%B8%80%E4%B8%AA%E7%89%B9%E6%AE%8A%E7%9A%84%E8%AF%B7%E6%B1%82%E5%A4%B4%EF%BC%9A%5BCookie%5D(https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FHTTP_cookie)%E3%80%82%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E5%93%8D%E5%BA%94%E5%A4%B4%EF%BC%88set-cookie%EF%BC%89%E5%B0%86%E5%B0%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%93%8D%E5%BA%94%E7%BB%99%E5%AE%A2%E6%88%B7%E7%AB%AF%EF%BC%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BC%9A%E9%81%B5%E5%BE%AA%E5%8D%8F%E8%AE%AE%E5%B0%86%E6%95%B0%E6%8D%AE%E4%BF%9D%E5%AD%98%EF%BC%8C%E5%B9%B6%E5%9C%A8%E4%B8%8B%E6%AC%A1%E8%AF%B7%E6%B1%82%E5%90%8C%E4%B8%80%E4%B8%AA%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%97%B6%E5%80%99%E5%B8%A6%E4%B8%8A%EF%BC%88%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B9%9F%E4%BC%9A%E9%81%B5%E5%BE%AA%E5%8D%8F%E8%AE%AE%EF%BC%8C%E5%8F%AA%E5%9C%A8%E8%AE%BF%E9%97%AE%E7%AC%A6%E5%90%88%20Cookie%20%E6%8C%87%E5%AE%9A%E8%A7%84%E5%88%99%E7%9A%84%E7%BD%91%E7%AB%99%E6%97%B6%E5%B8%A6%E4%B8%8A%E5%AF%B9%E5%BA%94%E7%9A%84%20Cookie%20%E6%9D%A5%E4%BF%9D%E8%AF%81%E5%AE%89%E5%85%A8%E6%80%A7%EF%BC%89%E3%80%82%0A%0A%E9%80%9A%E8%BF%87%20%60ctx.cookies%60%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%9C%A8%20controller%20%E4%B8%AD%E4%BE%BF%E6%8D%B7%E3%80%81%E5%AE%89%E5%85%A8%E7%9A%84%E8%AE%BE%E7%BD%AE%E5%92%8C%E8%AF%BB%E5%8F%96%20Cookie%E3%80%82%0A%0A%60%60%60js%0Aclass%20HomeController%20extends%20Controller%20%7B%0A%20%20async%20add()%20%7B%0A%20%20%20%20const%20ctx%20%3D%20this.ctx%3B%0A%20%20%20%20let%20count%20%3D%20ctx.cookies.get('count')%3B%0A%20%20%20%20count%20%3D%20count%20%3F%20Number(count)%20%3A%200%3B%0A%20%20%20%20ctx.cookies.set('count'%2C%20%2B%2Bcount)%3B%0A%20%20%20%20ctx.body%20%3D%20count%3B%0A%20%20%7D%0A%20%20async%20remove()%20%7B%0A%20%20%20%20const%20ctx%20%3D%20this.ctx%3B%0A%20%20%20%20ctx.cookies.set('count'%2C%20null)%3B%0A%20%20%20%20ctx.status%20%3D%20204%3B%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A%23%23%23%23%20%60ctx.cookies.set(key%2C%20value%2C%20options)%60%0A%0A%E8%AE%BE%E7%BD%AE%20Cookie%20%E5%85%B6%E5%AE%9E%E6%98%AF%E9%80%9A%E8%BF%87%E5%9C%A8%20HTTP%20%E5%93%8D%E5%BA%94%E4%B8%AD%E8%AE%BE%E7%BD%AE%20set-cookie%20%E5%A4%B4%E5%AE%8C%E6%88%90%E7%9A%84%EF%BC%8C%E6%AF%8F%E4%B8%80%E4%B8%AA%20set-cookie%20%E9%83%BD%E4%BC%9A%E8%AE%A9%E6%B5%8F%E8%A7%88%E5%99%A8%E5%9C%A8%20Cookie%20%E4%B8%AD%E5%AD%98%E4%B8%80%E4%B8%AA%E9%94%AE%E5%80%BC%E5%AF%B9%E3%80%82%E5%9C%A8%E8%AE%BE%E7%BD%AE%20Cookie%20%E5%80%BC%E7%9A%84%E5%90%8C%E6%97%B6%EF%BC%8C%E5%8D%8F%E8%AE%AE%E8%BF%98%E6%94%AF%E6%8C%81%E8%AE%B8%E5%A4%9A%E5%8F%82%E6%95%B0%E6%9D%A5%E9%85%8D%E7%BD%AE%E8%BF%99%E4%B8%AA%20Cookie%20%E7%9A%84%E4%BC%A0%E8%BE%93%E3%80%81%E5%AD%98%E5%82%A8%E5%92%8C%E6%9D%83%E9%99%90%E3%80%82%0A%0A-%20%60%7BNumber%7D%20maxAge%60%3A%20%E8%AE%BE%E7%BD%AE%E8%BF%99%E4%B8%AA%E9%94%AE%E5%80%BC%E5%AF%B9%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E6%9C%80%E9%95%BF%E4%BF%9D%E5%AD%98%E6%97%B6%E9%97%B4%E3%80%82%E6%98%AF%E4%B8%80%E4%B8%AA%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BD%93%E5%89%8D%E6%97%B6%E5%88%BB%E5%BC%80%E5%A7%8B%E7%9A%84%E6%AF%AB%E7%A7%92%E6%95%B0%E3%80%82%0A-%20%60%7BDate%7D%20expires%60%3A%20%E8%AE%BE%E7%BD%AE%E8%BF%99%E4%B8%AA%E9%94%AE%E5%80%BC%E5%AF%B9%E7%9A%84%E5%A4%B1%E6%95%88%E6%97%B6%E9%97%B4%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%AE%BE%E7%BD%AE%E4%BA%86%20maxAge%EF%BC%8Cexpires%20%E5%B0%86%E4%BC%9A%E8%A2%AB%E8%A6%86%E7%9B%96%E3%80%82%E5%A6%82%E6%9E%9C%20maxAge%20%E5%92%8C%20expires%20%E9%83%BD%E6%B2%A1%E8%AE%BE%E7%BD%AE%EF%BC%8CCookie%20%E5%B0%86%E4%BC%9A%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E4%BC%9A%E8%AF%9D%E5%A4%B1%E6%95%88%EF%BC%88%E4%B8%80%E8%88%AC%E6%98%AF%E5%85%B3%E9%97%AD%E6%B5%8F%E8%A7%88%E5%99%A8%E6%97%B6%EF%BC%89%E7%9A%84%E6%97%B6%E5%80%99%E5%A4%B1%E6%95%88%E3%80%82%0A-%20%60%7BString%7D%20path%60%3A%20%E8%AE%BE%E7%BD%AE%E9%94%AE%E5%80%BC%E5%AF%B9%E7%94%9F%E6%95%88%E7%9A%84%20URL%20%E8%B7%AF%E5%BE%84%EF%BC%8C%E9%BB%98%E8%AE%A4%E8%AE%BE%E7%BD%AE%E5%9C%A8%E6%A0%B9%E8%B7%AF%E5%BE%84%E4%B8%8A%EF%BC%88%60%2F%60%EF%BC%89%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E5%BD%93%E5%89%8D%E5%9F%9F%E5%90%8D%E4%B8%8B%E7%9A%84%E6%89%80%E6%9C%89%20URL%20%E9%83%BD%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE%E8%BF%99%E4%B8%AA%20Cookie%E3%80%82%0A-%20%60%7BString%7D%20domain%60%3A%20%E8%AE%BE%E7%BD%AE%E9%94%AE%E5%80%BC%E5%AF%B9%E7%94%9F%E6%95%88%E7%9A%84%E5%9F%9F%E5%90%8D%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%B2%A1%E6%9C%89%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%85%8D%E7%BD%AE%E6%88%90%E5%8F%AA%E5%9C%A8%E6%8C%87%E5%AE%9A%E5%9F%9F%E5%90%8D%E6%89%8D%E8%83%BD%E8%AE%BF%E9%97%AE%E3%80%82%0A-%20%60%7BBoolean%7D%20httpOnly%60%3A%20%E8%AE%BE%E7%BD%AE%E9%94%AE%E5%80%BC%E5%AF%B9%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E8%A2%AB%20js%20%E8%AE%BF%E9%97%AE%EF%BC%8C%E9%BB%98%E8%AE%A4%E4%B8%BA%20true%EF%BC%8C%E4%B8%8D%E5%85%81%E8%AE%B8%E8%A2%AB%20js%20%E8%AE%BF%E9%97%AE%E3%80%82%0A-%20%60%7BBoolean%7D%20secure%60%3A%20%E8%AE%BE%E7%BD%AE%E9%94%AE%E5%80%BC%E5%AF%B9%5B%E5%8F%AA%E5%9C%A8%20HTTPS%20%E8%BF%9E%E6%8E%A5%E4%B8%8A%E4%BC%A0%E8%BE%93%5D(http%3A%2F%2Fstackoverflow.com%2Fquestions%2F13729749%2Fhow-does-cookie-secure-flag-work)%EF%BC%8C%E6%A1%86%E6%9E%B6%E4%BC%9A%E5%B8%AE%E6%88%91%E4%BB%AC%E5%88%A4%E6%96%AD%E5%BD%93%E5%89%8D%E6%98%AF%E5%90%A6%E5%9C%A8%20HTTPS%20%E8%BF%9E%E6%8E%A5%E4%B8%8A%E8%87%AA%E5%8A%A8%E8%AE%BE%E7%BD%AE%20secure%20%E7%9A%84%E5%80%BC%E3%80%82%0A%0A%E9%99%A4%E4%BA%86%E8%BF%99%E4%BA%9B%E5%B1%9E%E6%80%A7%E4%B9%8B%E5%A4%96%EF%BC%8C%E6%A1%86%E6%9E%B6%E5%8F%A6%E5%A4%96%E6%89%A9%E5%B1%95%E4%BA%86%203%20%E4%B8%AA%E5%8F%82%E6%95%B0%E7%9A%84%E6%94%AF%E6%8C%81%EF%BC%9A%0A%0A-%20%60%7BBoolean%7D%20overwrite%60%EF%BC%9A%E8%AE%BE%E7%BD%AE%20key%20%E7%9B%B8%E5%90%8C%E7%9A%84%E9%94%AE%E5%80%BC%E5%AF%B9%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%AE%BE%E7%BD%AE%E4%B8%BA%20true%EF%BC%8C%E5%88%99%E5%90%8E%E8%AE%BE%E7%BD%AE%E7%9A%84%E5%80%BC%E4%BC%9A%E8%A6%86%E7%9B%96%E5%89%8D%E9%9D%A2%E8%AE%BE%E7%BD%AE%E7%9A%84%EF%BC%8C%E5%90%A6%E5%88%99%E5%B0%86%E4%BC%9A%E5%8F%91%E9%80%81%E4%B8%A4%E4%B8%AA%20set-cookie%20%E5%93%8D%E5%BA%94%E5%A4%B4%E3%80%82%0A-%20%60%7BBoolean%7D%20signed%60%EF%BC%9A%E8%AE%BE%E7%BD%AE%E6%98%AF%E5%90%A6%E5%AF%B9%20Cookie%20%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%AE%BE%E7%BD%AE%E4%B8%BA%20true%EF%BC%8C%E5%88%99%E8%AE%BE%E7%BD%AE%E9%94%AE%E5%80%BC%E5%AF%B9%E7%9A%84%E6%97%B6%E5%80%99%E4%BC%9A%E5%90%8C%E6%97%B6%E5%AF%B9%E8%BF%99%E4%B8%AA%E9%94%AE%E5%80%BC%E5%AF%B9%E7%9A%84%E5%80%BC%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D%EF%BC%8C%E5%90%8E%E9%9D%A2%E5%8F%96%E7%9A%84%E6%97%B6%E5%80%99%E5%81%9A%E6%A0%A1%E9%AA%8C%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%98%B2%E6%AD%A2%E5%89%8D%E7%AB%AF%E5%AF%B9%E8%BF%99%E4%B8%AA%E5%80%BC%E8%BF%9B%E8%A1%8C%E7%AF%A1%E6%94%B9%E3%80%82%E9%BB%98%E8%AE%A4%E4%B8%BA%20true%E3%80%82%0A-%20%60%7BBoolean%7D%20encrypt%60%EF%BC%9A%E8%AE%BE%E7%BD%AE%E6%98%AF%E5%90%A6%E5%AF%B9%20Cookie%20%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%AE%BE%E7%BD%AE%E4%B8%BA%20true%EF%BC%8C%E5%88%99%E5%9C%A8%E5%8F%91%E9%80%81%20Cookie%20%E5%89%8D%E4%BC%9A%E5%AF%B9%E8%BF%99%E4%B8%AA%E9%94%AE%E5%80%BC%E5%AF%B9%E7%9A%84%E5%80%BC%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86%EF%BC%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%97%A0%E6%B3%95%E8%AF%BB%E5%8F%96%E5%88%B0%20Cookie%20%E7%9A%84%E6%98%8E%E6%96%87%E5%80%BC%E3%80%82%E9%BB%98%E8%AE%A4%E4%B8%BA%20false%E3%80%82%0A%0A%E5%9C%A8%E8%AE%BE%E7%BD%AE%20Cookie%20%E6%97%B6%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E6%80%9D%E8%80%83%E6%B8%85%E6%A5%9A%E8%BF%99%E4%B8%AA%20Cookie%20%E7%9A%84%E4%BD%9C%E7%94%A8%EF%BC%8C%E5%AE%83%E9%9C%80%E8%A6%81%E8%A2%AB%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BF%9D%E5%AD%98%E5%A4%9A%E4%B9%85%EF%BC%9F%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E8%A2%AB%20js%20%E8%8E%B7%E5%8F%96%E5%88%B0%EF%BC%9F%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E8%A2%AB%E5%89%8D%E7%AB%AF%E4%BF%AE%E6%94%B9%EF%BC%9F%0A%0A**%E9%BB%98%E8%AE%A4%E7%9A%84%E9%85%8D%E7%BD%AE%E4%B8%8B%EF%BC%8CCookie%20%E6%98%AF%E5%8A%A0%E7%AD%BE%E4%B8%8D%E5%8A%A0%E5%AF%86%E7%9A%84%EF%BC%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E6%98%8E%E6%96%87%EF%BC%8Cjs%20%E4%B8%8D%E8%83%BD%E8%AE%BF%E9%97%AE%EF%BC%8C%E4%B8%8D%E8%83%BD%E8%A2%AB%E5%AE%A2%E6%88%B7%E7%AB%AF%EF%BC%88%E6%89%8B%E5%B7%A5%EF%BC%89%E7%AF%A1%E6%94%B9%E3%80%82**%0A%0A-%20%E5%A6%82%E6%9E%9C%E6%83%B3%E8%A6%81%20Cookie%20%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E7%AB%AF%E5%8F%AF%E4%BB%A5%E8%A2%AB%20js%20%E8%AE%BF%E9%97%AE%E5%B9%B6%E4%BF%AE%E6%94%B9%3A%0A%0A%60%60%60js%0Actx.cookies.set(key%2C%20value%2C%20%7B%0A%20%20httpOnly%3A%20false%2C%0A%20%20signed%3A%20false%2C%0A%7D)%3B%0A%60%60%60%0A%0A-%20%E5%A6%82%E6%9E%9C%E6%83%B3%E8%A6%81%20Cookie%20%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E7%AB%AF%E4%B8%8D%E8%83%BD%E8%A2%AB%E4%BF%AE%E6%94%B9%EF%BC%8C%E4%B8%8D%E8%83%BD%E7%9C%8B%E5%88%B0%E6%98%8E%E6%96%87%EF%BC%9A%0A%0A%60%60%60js%0Actx.cookies.set(key%2C%20value%2C%20%7B%0A%20%20httpOnly%3A%20true%2C%20%2F%2F%20%E9%BB%98%E8%AE%A4%E5%B0%B1%E6%98%AF%20true%0A%20%20encrypt%3A%20true%2C%20%2F%2F%20%E5%8A%A0%E5%AF%86%E4%BC%A0%E8%BE%93%0A%7D)%3B%0A%60%60%60%0A%0A%E6%B3%A8%E6%84%8F%EF%BC%9A%0A%0A1.%20%E7%94%B1%E4%BA%8E%5B%E6%B5%8F%E8%A7%88%E5%99%A8%E5%92%8C%E5%85%B6%E4%BB%96%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%9E%E7%8E%B0%E7%9A%84%E4%B8%8D%E7%A1%AE%E5%AE%9A%E6%80%A7%5D(http%3A%2F%2Fstackoverflow.com%2Fquestions%2F7567154%2Fcan-i-use-unicode-characters-in-http-headers)%EF%BC%8C%E4%B8%BA%E4%BA%86%E4%BF%9D%E8%AF%81%20Cookie%20%E5%8F%AF%E4%BB%A5%E5%86%99%E5%85%A5%E6%88%90%E5%8A%9F%EF%BC%8C%E5%BB%BA%E8%AE%AE%20value%20%E9%80%9A%E8%BF%87%20base64%20%E7%BC%96%E7%A0%81%E6%88%96%E8%80%85%E5%85%B6%E4%BB%96%E5%BD%A2%E5%BC%8F%20encode%20%E4%B9%8B%E5%90%8E%E5%86%8D%E5%86%99%E5%85%A5%E3%80%82%0A2.%20%E7%94%B1%E4%BA%8E%5B%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AF%B9%20Cookie%20%E6%9C%89%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6%E9%99%90%E5%88%B6%5D(http%3A%2F%2Fstackoverflow.com%2Fquestions%2F640938%2Fwhat-is-the-maximum-size-of-a-web-browsers-cookies-key)%EF%BC%8C%E6%89%80%E4%BB%A5%E5%B0%BD%E9%87%8F%E4%B8%8D%E8%A6%81%E8%AE%BE%E7%BD%AE%E5%A4%AA%E9%95%BF%E7%9A%84%20Cookie%E3%80%82%E4%B8%80%E8%88%AC%E6%9D%A5%E8%AF%B4%E4%B8%8D%E8%A6%81%E8%B6%85%E8%BF%87%204093%20bytes%E3%80%82%E5%BD%93%E8%AE%BE%E7%BD%AE%E7%9A%84%20Cookie%20value%20%E5%A4%A7%E4%BA%8E%E8%BF%99%E4%B8%AA%E5%80%BC%E6%97%B6%EF%BC%8C%E6%A1%86%E6%9E%B6%E4%BC%9A%E6%89%93%E5%8D%B0%E4%B8%80%E6%9D%A1%E8%AD%A6%E5%91%8A%E6%97%A5%E5%BF%97%E3%80%82%0A%0A%23%23%23%23%20%60ctx.cookies.get(key%2C%20options)%60%0A%0A%E7%94%B1%E4%BA%8E%20HTTP%20%E8%AF%B7%E6%B1%82%E4%B8%AD%E7%9A%84%20Cookie%20%E6%98%AF%E5%9C%A8%E4%B8%80%E4%B8%AA%20header%20%E4%B8%AD%E4%BC%A0%E8%BE%93%E8%BF%87%E6%9D%A5%E7%9A%84%EF%BC%8C%E9%80%9A%E8%BF%87%E6%A1%86%E6%9E%B6%E6%8F%90%E4%BE%9B%E7%9A%84%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%E5%8F%AF%E4%BB%A5%E5%BF%AB%E9%80%9F%E7%9A%84%E4%BB%8E%E6%95%B4%E6%AE%B5%20Cookie%20%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%AF%B9%E5%BA%94%E7%9A%84%E9%94%AE%E5%80%BC%E5%AF%B9%E7%9A%84%E5%80%BC%E3%80%82%E4%B8%8A%E9%9D%A2%E5%9C%A8%E8%AE%BE%E7%BD%AE%20Cookie%20%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E8%AE%BE%E7%BD%AE%20%60options.signed%60%20%E5%92%8C%20%60options.encrypt%60%20%E6%9D%A5%E5%AF%B9%20Cookie%20%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D%E6%88%96%E5%8A%A0%E5%AF%86%EF%BC%8C%E5%9B%A0%E6%AD%A4%E5%AF%B9%E5%BA%94%E7%9A%84%E5%9C%A8%E8%8E%B7%E5%8F%96%20Cookie%20%E7%9A%84%E6%97%B6%E5%80%99%E4%B9%9F%E8%A6%81%E4%BC%A0%E7%9B%B8%E5%8C%B9%E9%85%8D%E7%9A%84%E9%80%89%E9%A1%B9%E3%80%82%0A%0A-%20%E5%A6%82%E6%9E%9C%E8%AE%BE%E7%BD%AE%E7%9A%84%E6%97%B6%E5%80%99%E6%8C%87%E5%AE%9A%E4%B8%BA%20signed%EF%BC%8C%E8%8E%B7%E5%8F%96%E6%97%B6%E6%9C%AA%E6%8C%87%E5%AE%9A%EF%BC%8C%E5%88%99%E4%B8%8D%E4%BC%9A%E5%9C%A8%E8%8E%B7%E5%8F%96%E6%97%B6%E5%AF%B9%E5%8F%96%E5%88%B0%E7%9A%84%E5%80%BC%E5%81%9A%E9%AA%8C%E7%AD%BE%EF%BC%8C%E5%AF%BC%E8%87%B4%E5%8F%AF%E8%83%BD%E8%A2%AB%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%AF%A1%E6%94%B9%E3%80%82%0A-%20%E5%A6%82%E6%9E%9C%E8%AE%BE%E7%BD%AE%E7%9A%84%E6%97%B6%E5%80%99%E6%8C%87%E5%AE%9A%E4%B8%BA%20encrypt%EF%BC%8C%E8%8E%B7%E5%8F%96%E6%97%B6%E6%9C%AA%E6%8C%87%E5%AE%9A%EF%BC%8C%E5%88%99%E6%97%A0%E6%B3%95%E8%8E%B7%E5%8F%96%E5%88%B0%E7%9C%9F%E5%AE%9E%E7%9A%84%E5%80%BC%EF%BC%8C%E8%80%8C%E6%98%AF%E5%8A%A0%E5%AF%86%E8%BF%87%E5%90%8E%E7%9A%84%E5%AF%86%E6%96%87%E3%80%82%0A%0A%E5%A6%82%E6%9E%9C%E8%A6%81%E8%8E%B7%E5%8F%96%E5%89%8D%E7%AB%AF%E6%88%96%E8%80%85%E5%85%B6%E4%BB%96%E7%B3%BB%E7%BB%9F%E8%AE%BE%E7%BD%AE%E7%9A%84%20cookie%EF%BC%8C%E9%9C%80%E8%A6%81%E6%8C%87%E5%AE%9A%E5%8F%82%E6%95%B0%20%60signed%60%20%E4%B8%BA%20%60false%60%EF%BC%8C%E9%81%BF%E5%85%8D%E5%AF%B9%E5%AE%83%E5%81%9A%E9%AA%8C%E7%AD%BE%E5%AF%BC%E8%87%B4%E8%8E%B7%E5%8F%96%E4%B8%8D%E5%88%B0%20cookie%20%E7%9A%84%E5%80%BC%E3%80%82%0A%0A%60%60%60js%0Actx.cookies.get('frontend-cookie'%2C%20%7B%0A%20%20signed%3A%20false%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%20Cookie%20%E7%A7%98%E9%92%A5%0A%0A%E7%94%B1%E4%BA%8E%E6%88%91%E4%BB%AC%E5%9C%A8%20Cookie%20%E4%B8%AD%E9%9C%80%E8%A6%81%E7%94%A8%E5%88%B0%E5%8A%A0%E8%A7%A3%E5%AF%86%E5%92%8C%E9%AA%8C%E7%AD%BE%EF%BC%8C%E6%89%80%E4%BB%A5%E9%9C%80%E8%A6%81%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AA%E7%A7%98%E9%92%A5%E4%BE%9B%E5%8A%A0%E5%AF%86%E4%BD%BF%E7%94%A8%E3%80%82%E5%9C%A8%20%60config%2Fconfig.default.js%60%20%E4%B8%AD%0A%0A%60%60%60js%0Amodule.exports%20%3D%20%7B%0A%20%20keys%3A%20'key1%2Ckey2'%2C%0A%7D%3B%0A%60%60%60%0A%0Akeys%20%E9%85%8D%E7%BD%AE%E6%88%90%E4%B8%80%E4%B8%AA%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%8C%89%E7%85%A7%E9%80%97%E5%8F%B7%E5%88%86%E9%9A%94%E9%85%8D%E7%BD%AE%E5%A4%9A%E4%B8%AA%20key%E3%80%82Cookie%20%E5%9C%A8%E4%BD%BF%E7%94%A8%E8%BF%99%E4%B8%AA%E9%85%8D%E7%BD%AE%E8%BF%9B%E8%A1%8C%E5%8A%A0%E8%A7%A3%E5%AF%86%E6%97%B6%EF%BC%9A%0A%0A-%20%E5%8A%A0%E5%AF%86%E5%92%8C%E5%8A%A0%E7%AD%BE%E6%97%B6%E5%8F%AA%E4%BC%9A%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%A7%98%E9%92%A5%E3%80%82%0A-%20%E8%A7%A3%E5%AF%86%E5%92%8C%E9%AA%8C%E7%AD%BE%E6%97%B6%E4%BC%9A%E9%81%8D%E5%8E%86%20keys%20%E8%BF%9B%E8%A1%8C%E8%A7%A3%E5%AF%86%E3%80%82%0A%0A%E5%A6%82%E6%9E%9C%E6%88%91%E4%BB%AC%E6%83%B3%E8%A6%81%E6%9B%B4%E6%96%B0%20Cookie%20%E7%9A%84%E7%A7%98%E9%92%A5%EF%BC%8C%E4%BD%86%E6%98%AF%E5%8F%88%E4%B8%8D%E5%B8%8C%E6%9C%9B%E4%B9%8B%E5%89%8D%E8%AE%BE%E7%BD%AE%E5%88%B0%E7%94%A8%E6%88%B7%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%8A%E7%9A%84%20Cookie%20%E5%A4%B1%E6%95%88%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%B0%86%E6%96%B0%E7%9A%84%E7%A7%98%E9%92%A5%E9%85%8D%E7%BD%AE%E5%88%B0%20keys%20%E6%9C%80%E5%89%8D%E9%9D%A2%EF%BC%8C%E7%AD%89%E8%BF%87%E4%B8%80%E6%AE%B5%E6%97%B6%E9%97%B4%E4%B9%8B%E5%90%8E%E5%86%8D%E5%88%A0%E5%8E%BB%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9A%84%E7%A7%98%E9%92%A5%E5%8D%B3%E5%8F%AF%E3%80%82%0A%0A%23%23%20Session%0A%0ACookie%20%E5%9C%A8%20Web%20%E5%BA%94%E7%94%A8%E4%B8%AD%E7%BB%8F%E5%B8%B8%E6%89%BF%E6%8B%85%E6%A0%87%E8%AF%86%E8%AF%B7%E6%B1%82%E6%96%B9%E8%BA%AB%E4%BB%BD%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%8C%E6%89%80%E4%BB%A5%20Web%20%E5%BA%94%E7%94%A8%E5%9C%A8%20Cookie%20%E7%9A%84%E5%9F%BA%E7%A1%80%E4%B8%8A%E5%B0%81%E8%A3%85%E4%BA%86%20Session%20%E7%9A%84%E6%A6%82%E5%BF%B5%EF%BC%8C%E4%B8%93%E9%97%A8%E7%94%A8%E5%81%9A%E7%94%A8%E6%88%B7%E8%BA%AB%E4%BB%BD%E8%AF%86%E5%88%AB%E3%80%82%0A%0A%E6%A1%86%E6%9E%B6%E5%86%85%E7%BD%AE%E4%BA%86%20%5BSession%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-session)%20%E6%8F%92%E4%BB%B6%EF%BC%8C%E7%BB%99%E6%88%91%E4%BB%AC%E6%8F%90%E4%BE%9B%E4%BA%86%20%60ctx.session%60%20%E6%9D%A5%E8%AE%BF%E9%97%AE%E6%88%96%E8%80%85%E4%BF%AE%E6%94%B9%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%20Session%20%E3%80%82%0A%0A%60%60%60js%0Aclass%20HomeController%20extends%20Controller%20%7B%0A%20%20async%20fetchPosts()%20%7B%0A%20%20%20%20const%20ctx%20%3D%20this.ctx%3B%0A%20%20%20%20%2F%2F%20%E8%8E%B7%E5%8F%96%20Session%20%E4%B8%8A%E7%9A%84%E5%86%85%E5%AE%B9%0A%20%20%20%20const%20userId%20%3D%20ctx.session.userId%3B%0A%20%20%20%20const%20posts%20%3D%20await%20ctx.service.post.fetch(userId)%3B%0A%20%20%20%20%2F%2F%20%E4%BF%AE%E6%94%B9%20Session%20%E7%9A%84%E5%80%BC%0A%20%20%20%20ctx.session.visited%20%3D%20ctx.session.visited%20%3F%20(ctx.session.visited%20%2B%201)%20%3A%201%3B%0A%20%20%20%20ctx.body%20%3D%20%7B%0A%20%20%20%20%20%20success%3A%20true%2C%0A%20%20%20%20%20%20posts%2C%0A%20%20%20%20%7D%3B%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0ASession%20%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E9%9D%9E%E5%B8%B8%E7%9B%B4%E8%A7%82%EF%BC%8C%E7%9B%B4%E6%8E%A5%E8%AF%BB%E5%8F%96%E5%AE%83%E6%88%96%E8%80%85%E4%BF%AE%E6%94%B9%E5%AE%83%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BA%86%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%A6%81%E5%88%A0%E9%99%A4%E5%AE%83%EF%BC%8C%E7%9B%B4%E6%8E%A5%E5%B0%86%E5%AE%83%E8%B5%8B%E5%80%BC%E4%B8%BA%20null%EF%BC%9A%0A%0A%60%60%60js%0Actx.session%20%3D%20null%3B%0A%60%60%60%0A%0ASession%20%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%98%AF%E5%9F%BA%E4%BA%8E%20Cookie%20%E7%9A%84%EF%BC%8C%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E4%B8%8B%EF%BC%8C%E7%94%A8%E6%88%B7%20Session%20%E7%9A%84%E5%86%85%E5%AE%B9%E5%8A%A0%E5%AF%86%E5%90%8E%E7%9B%B4%E6%8E%A5%E5%AD%98%E5%82%A8%E5%9C%A8%20Cookie%20%E4%B8%AD%E7%9A%84%E4%B8%80%E4%B8%AA%E5%AD%97%E6%AE%B5%E4%B8%AD%EF%BC%8C%E7%94%A8%E6%88%B7%E6%AF%8F%E6%AC%A1%E8%AF%B7%E6%B1%82%E6%88%91%E4%BB%AC%E7%BD%91%E7%AB%99%E7%9A%84%E6%97%B6%E5%80%99%E9%83%BD%E4%BC%9A%E5%B8%A6%E4%B8%8A%E8%BF%99%E4%B8%AA%20Cookie%EF%BC%8C%E6%88%91%E4%BB%AC%E5%9C%A8%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%A7%A3%E5%AF%86%E5%90%8E%E4%BD%BF%E7%94%A8%E3%80%82Session%20%E7%9A%84%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%0A%60%60%60js%0Aexports.session%20%3D%20%7B%0A%20%20key%3A%20'EGG_SESS'%2C%0A%20%20maxAge%3A%2024%20*%203600%20*%201000%2C%20%2F%2F%201%20%E5%A4%A9%0A%20%20httpOnly%3A%20true%2C%0A%20%20encrypt%3A%20true%2C%0A%7D%3B%0A%60%60%60%0A%0A%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E8%BF%99%E4%BA%9B%E5%8F%82%E6%95%B0%E9%99%A4%E4%BA%86%20%60key%60%20%E9%83%BD%E6%98%AF%20Cookie%20%E7%9A%84%E5%8F%82%E6%95%B0%EF%BC%8C%60key%60%20%E4%BB%A3%E8%A1%A8%E4%BA%86%E5%AD%98%E5%82%A8%20Session%20%E7%9A%84%20Cookie%20%E9%94%AE%E5%80%BC%E5%AF%B9%E7%9A%84%20key%20%E6%98%AF%E4%BB%80%E4%B9%88%E3%80%82%E5%9C%A8%E9%BB%98%E8%AE%A4%E7%9A%84%E9%85%8D%E7%BD%AE%E4%B8%8B%EF%BC%8C%E5%AD%98%E6%94%BE%20Session%20%E7%9A%84%20Cookie%20%E5%B0%86%E4%BC%9A%E5%8A%A0%E5%AF%86%E5%AD%98%E5%82%A8%E3%80%81%E4%B8%8D%E5%8F%AF%E8%A2%AB%E5%89%8D%E7%AB%AF%20js%20%E8%AE%BF%E9%97%AE%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%8F%AF%E4%BB%A5%E4%BF%9D%E8%AF%81%E7%94%A8%E6%88%B7%E7%9A%84%20Session%20%E6%98%AF%E5%AE%89%E5%85%A8%E7%9A%84%E3%80%82%0A%0A%23%23%23%20%E6%89%A9%E5%B1%95%E5%AD%98%E5%82%A8%0A%0ASession%20%E9%BB%98%E8%AE%A4%E5%AD%98%E6%94%BE%E5%9C%A8%20Cookie%20%E4%B8%AD%EF%BC%8C%E4%BD%86%E6%98%AF%E5%A6%82%E6%9E%9C%E6%88%91%E4%BB%AC%E7%9A%84%20Session%20%E5%AF%B9%E8%B1%A1%E8%BF%87%E4%BA%8E%E5%BA%9E%E5%A4%A7%EF%BC%8C%E5%B0%B1%E4%BC%9A%E5%B8%A6%E6%9D%A5%E4%B8%80%E4%BA%9B%E9%A2%9D%E5%A4%96%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%9A%0A%0A-%20%E5%89%8D%E9%9D%A2%E6%8F%90%E5%88%B0%EF%BC%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E9%80%9A%E5%B8%B8%E9%83%BD%E6%9C%89%E9%99%90%E5%88%B6%E6%9C%80%E5%A4%A7%E7%9A%84%20Cookie%20%E9%95%BF%E5%BA%A6%EF%BC%8C%E5%BD%93%E8%AE%BE%E7%BD%AE%E7%9A%84%20Session%20%E8%BF%87%E5%A4%A7%E6%97%B6%EF%BC%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8F%AF%E8%83%BD%E6%8B%92%E7%BB%9D%E4%BF%9D%E5%AD%98%E3%80%82%0A-%20Cookie%20%E5%9C%A8%E6%AF%8F%E6%AC%A1%E8%AF%B7%E6%B1%82%E6%97%B6%E9%83%BD%E4%BC%9A%E5%B8%A6%E4%B8%8A%EF%BC%8C%E5%BD%93%20Session%20%E8%BF%87%E5%A4%A7%E6%97%B6%EF%BC%8C%E6%AF%8F%E6%AC%A1%E8%AF%B7%E6%B1%82%E9%83%BD%E8%A6%81%E9%A2%9D%E5%A4%96%E5%B8%A6%E4%B8%8A%E5%BA%9E%E5%A4%A7%E7%9A%84%20Cookie%20%E4%BF%A1%E6%81%AF%E3%80%82%0A%0A%E6%A1%86%E6%9E%B6%E6%8F%90%E4%BE%9B%E4%BA%86%E5%B0%86%20Session%20%E5%AD%98%E5%82%A8%E5%88%B0%E9%99%A4%E4%BA%86%20Cookie%20%E4%B9%8B%E5%A4%96%E7%9A%84%E5%85%B6%E4%BB%96%E5%AD%98%E5%82%A8%E7%9A%84%E6%89%A9%E5%B1%95%E6%96%B9%E6%A1%88%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AA%E9%9C%80%E8%A6%81%E8%AE%BE%E7%BD%AE%20%60app.sessionStore%60%20%E5%8D%B3%E5%8F%AF%E5%B0%86%20Session%20%E5%AD%98%E5%82%A8%E5%88%B0%E6%8C%87%E5%AE%9A%E7%9A%84%E5%AD%98%E5%82%A8%E4%B8%AD%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20app.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20app.sessionStore%20%3D%20%7B%0A%20%20%20%20%2F%2F%20support%20promise%20%2F%20async%0A%20%20%20%20async%20get%20(key)%20%7B%0A%20%20%20%20%20%20%2F%2F%20return%20value%3B%0A%20%20%20%20%7D%2C%0A%20%20%20%20async%20set%20(key%2C%20value%2C%20maxAge)%20%7B%0A%20%20%20%20%20%20%2F%2F%20set%20key%20to%20store%0A%20%20%20%20%7D%2C%0A%20%20%20%20async%20destroy%20(key)%20%7B%0A%20%20%20%20%20%20%2F%2F%20destroy%20key%0A%20%20%20%20%7D%2C%0A%20%20%7D%3B%0A%7D%3B%0A%60%60%60%0A%0AsessionStore%20%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%88%91%E4%BB%AC%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%B0%81%E8%A3%85%E5%88%B0%E6%8F%92%E4%BB%B6%E4%B8%AD%EF%BC%8C%E4%BE%8B%E5%A6%82%20%5Begg-session-redis%5D%20%E5%B0%B1%E6%8F%90%E4%BE%9B%E4%BA%86%E5%B0%86%20Session%20%E5%AD%98%E5%82%A8%E5%88%B0%20redis%20%E4%B8%AD%E7%9A%84%E8%83%BD%E5%8A%9B%EF%BC%8C%E5%9C%A8%E5%BA%94%E7%94%A8%E5%B1%82%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AA%E9%9C%80%E8%A6%81%E5%BC%95%E5%85%A5%20%5Begg-redis%5D%20%E5%92%8C%20%5Begg-session-redis%5D%20%E6%8F%92%E4%BB%B6%E5%8D%B3%E5%8F%AF%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20plugin.js%0Aexports.redis%20%3D%20%7B%0A%20%20enable%3A%20true%2C%0A%20%20package%3A%20'egg-redis'%2C%0A%7D%3B%0Aexports.sessionRedis%20%3D%20%7B%0A%20%20enable%3A%20true%2C%0A%20%20package%3A%20'egg-session-redis'%2C%0A%7D%3B%0A%60%60%60%0A%0A**%E6%B3%A8%E6%84%8F%EF%BC%9A%E4%B8%80%E6%97%A6%E9%80%89%E6%8B%A9%E4%BA%86%E5%B0%86%20Session%20%E5%AD%98%E5%85%A5%E5%88%B0%E5%A4%96%E9%83%A8%E5%AD%98%E5%82%A8%E4%B8%AD%EF%BC%8C%E5%B0%B1%E6%84%8F%E5%91%B3%E7%9D%80%E7%B3%BB%E7%BB%9F%E5%B0%86%E5%BC%BA%E4%BE%9D%E8%B5%96%E4%BA%8E%E8%BF%99%E4%B8%AA%E5%A4%96%E9%83%A8%E5%AD%98%E5%82%A8%EF%BC%8C%E5%BD%93%E5%AE%83%E6%8C%82%E4%BA%86%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E6%88%91%E4%BB%AC%E5%B0%B1%E5%AE%8C%E5%85%A8%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%20Session%20%E7%9B%B8%E5%85%B3%E7%9A%84%E5%8A%9F%E8%83%BD%E4%BA%86%E3%80%82%E5%9B%A0%E6%AD%A4%E6%88%91%E4%BB%AC%E6%9B%B4%E6%8E%A8%E8%8D%90%E5%A4%A7%E5%AE%B6%E5%8F%AA%E5%B0%86%E5%BF%85%E8%A6%81%E7%9A%84%E4%BF%A1%E6%81%AF%E5%AD%98%E5%82%A8%E5%9C%A8%20Session%20%E4%B8%AD%EF%BC%8C%E4%BF%9D%E6%8C%81%20Session%20%E7%9A%84%E7%B2%BE%E7%AE%80%E5%B9%B6%E4%BD%BF%E7%94%A8%E9%BB%98%E8%AE%A4%E7%9A%84%20Cookie%20%E5%AD%98%E5%82%A8%EF%BC%8C%E7%94%A8%E6%88%B7%E7%BA%A7%E5%88%AB%E7%9A%84%E7%BC%93%E5%AD%98%E4%B8%8D%E8%A6%81%E5%AD%98%E5%82%A8%E5%9C%A8%20Session%20%E4%B8%AD%E3%80%82**%0A%0A%23%23%23%20Session%20%E5%AE%9E%E8%B7%B5%0A%0A%23%23%23%23%20%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%20Session%20%E5%A4%B1%E6%95%88%E6%97%B6%E9%97%B4%0A%0A%E8%99%BD%E7%84%B6%E5%9C%A8%20Session%20%E7%9A%84%E9%85%8D%E7%BD%AE%E4%B8%AD%E6%9C%89%E4%B8%80%E9%A1%B9%E6%98%AF%20maxAge%EF%BC%8C%E4%BD%86%E6%98%AF%E5%AE%83%E5%8F%AA%E8%83%BD%E5%85%A8%E5%B1%80%E8%AE%BE%E7%BD%AE%20Session%20%E7%9A%84%E6%9C%89%E6%95%88%E6%9C%9F%EF%BC%8C%E6%88%91%E4%BB%AC%E7%BB%8F%E5%B8%B8%E5%8F%AF%E4%BB%A5%E5%9C%A8%E4%B8%80%E4%BA%9B%E7%BD%91%E7%AB%99%E7%9A%84%E7%99%BB%E9%99%86%E9%A1%B5%E4%B8%8A%E7%9C%8B%E5%88%B0%E6%9C%89%20**%E8%AE%B0%E4%BD%8F%E6%88%91**%20%E7%9A%84%E9%80%89%E9%A1%B9%E6%A1%86%EF%BC%8C%E5%8B%BE%E9%80%89%E4%B9%8B%E5%90%8E%E5%8F%AF%E4%BB%A5%E8%AE%A9%E7%99%BB%E9%99%86%E7%94%A8%E6%88%B7%E7%9A%84%20Session%20%E6%9C%89%E6%95%88%E6%9C%9F%E6%9B%B4%E9%95%BF%E3%80%82%E8%BF%99%E7%A7%8D%E9%92%88%E5%AF%B9%E7%89%B9%E5%AE%9A%E7%94%A8%E6%88%B7%E7%9A%84%20Session%20%E6%9C%89%E6%95%88%E6%97%B6%E9%97%B4%E8%AE%BE%E7%BD%AE%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20%60ctx.session.maxAge%3D%60%20%E6%9D%A5%E5%AE%9E%E7%8E%B0%E3%80%82%0A%0A%60%60%60js%0Aconst%20ms%20%3D%20require('ms')%3B%0Aclass%20UserController%20extends%20Controller%20%7B%0A%20%20async%20login()%20%7B%0A%20%20%20%20const%20ctx%20%3D%20this.ctx%3B%0A%20%20%20%20const%20%7B%20username%2C%20password%2C%20rememberMe%20%7D%20%3D%20ctx.request.body%3B%0A%20%20%20%20const%20user%20%3D%20await%20ctx.loginAndGetUser(username%2C%20password)%3B%0A%0A%20%20%20%20%2F%2F%20%E8%AE%BE%E7%BD%AE%20Session%0A%20%20%20%20ctx.session.user%20%3D%20user%3B%0A%20%20%20%20%2F%2F%20%E5%A6%82%E6%9E%9C%E7%94%A8%E6%88%B7%E5%8B%BE%E9%80%89%E4%BA%86%20%60%E8%AE%B0%E4%BD%8F%E6%88%91%60%EF%BC%8C%E8%AE%BE%E7%BD%AE%2030%20%E5%A4%A9%E7%9A%84%E8%BF%87%E6%9C%9F%E6%97%B6%E9%97%B4%0A%20%20%20%20if%20(rememberMe)%20ctx.session.maxAge%20%3D%20ms('30d')%3B%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A%23%23%23%23%20%E5%BB%B6%E9%95%BF%E7%94%A8%E6%88%B7%20Session%20%E6%9C%89%E6%95%88%E6%9C%9F%0A%0A%E9%BB%98%E8%AE%A4%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E5%BD%93%E7%94%A8%E6%88%B7%E8%AF%B7%E6%B1%82%E6%B2%A1%E6%9C%89%E5%AF%BC%E8%87%B4%20Session%20%E8%A2%AB%E4%BF%AE%E6%94%B9%E6%97%B6%EF%BC%8C%E6%A1%86%E6%9E%B6%E9%83%BD%E4%B8%8D%E4%BC%9A%E5%BB%B6%E9%95%BF%20Session%20%E7%9A%84%E6%9C%89%E6%95%88%E6%9C%9F%EF%BC%8C%E4%BD%86%E6%98%AF%E5%9C%A8%E6%9C%89%E4%BA%9B%E5%9C%BA%E6%99%AF%E4%B8%8B%EF%BC%8C%E6%88%91%E4%BB%AC%E5%B8%8C%E6%9C%9B%E7%94%A8%E6%88%B7%E5%A6%82%E6%9E%9C%E9%95%BF%E6%97%B6%E9%97%B4%E9%83%BD%E5%9C%A8%E8%AE%BF%E9%97%AE%E6%88%91%E4%BB%AC%E7%9A%84%E7%AB%99%E7%82%B9%EF%BC%8C%E5%88%99%E5%BB%B6%E9%95%BF%E4%BB%96%E4%BB%AC%E7%9A%84%20Session%20%E6%9C%89%E6%95%88%E6%9C%9F%EF%BC%8C%E4%B8%8D%E8%AE%A9%E7%94%A8%E6%88%B7%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95%E6%80%81%E3%80%82%E6%A1%86%E6%9E%B6%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E4%B8%AA%20%60renew%60%20%E9%85%8D%E7%BD%AE%E9%A1%B9%E7%94%A8%E4%BA%8E%E5%AE%9E%E7%8E%B0%E6%AD%A4%E5%8A%9F%E8%83%BD%EF%BC%8C%E5%AE%83%E4%BC%9A%E5%9C%A8%E5%8F%91%E7%8E%B0%E5%BD%93%E7%94%A8%E6%88%B7%20Session%20%E7%9A%84%E6%9C%89%E6%95%88%E6%9C%9F%E4%BB%85%E5%89%A9%E4%B8%8B%E6%9C%80%E5%A4%A7%E6%9C%89%E6%95%88%E6%9C%9F%E4%B8%80%E5%8D%8A%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E9%87%8D%E7%BD%AE%20Session%20%E7%9A%84%E6%9C%89%E6%95%88%E6%9C%9F%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0Amodule.exports%20%3D%20%7B%0A%20%20session%3A%20%7B%0A%20%20%20%20renew%3A%20true%2C%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%5Begg-redis%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-redis%0A%5Begg-session-redis%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-session-redis%0A"}}</script><script type="text/javascript" src="/static/js/post.b9faab88.js"></script></body></html>