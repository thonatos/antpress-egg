<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.png"><style class="_styletron_hydrate_"></style><title>HttpClient</title><meta name="description" content="Born to build better enterprise frameworks and apps"><link href="/static/css/post.d62265dc.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="ant-layout" data-reactroot=""><div class="header-module__header___3ADJ9 ant-layout-header"><div class="ant-row-flex"><div class="ant-col-xs-12 ant-col-md-20 ant-col-lg-2"><div class="header-module__logo___3yTXp"><a href="/"><img src="/logo.svg" alt="logo"/></a></div></div><div class="ant-col-xs-0 ant-col-md-0 ant-col-lg-20"><ul class="ant-menu header-module__menu___3yEtW ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/intro/">指南</a></li><li class="ant-menu-item" role="menuitem"><a href="/api/">API</a></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/tutorials/index.html">教程</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/search?q=topic%3Aegg-plugin&amp;type=Repositories">插件</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/eggjs/egg/releases">发布日志</a></li></ul></div><div style="text-align:right" class="ant-col-xs-12 ant-col-md-4 ant-col-lg-2"><button type="button" class="ant-btn"><span>Languages</span></button></div></div></div><div class="ant-layout-content"><div class="basic_layout-module__content___3flpY ant-layout"><div class="sider-module__side___1Cadj ant-layout-sider ant-layout-sider-light" style="flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"><ul class="ant-menu sider-module__menu___2GqPr ant-menu-light ant-menu-root ant-menu-inline" role="menu"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="0$Menu" aria-haspopup="true"><span>新手指南</span><i class="ant-menu-submenu-arrow"></i></div><ul id="0$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/index.html">Egg.js 是什么?</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/egg-and-koa.html">Egg.js 和 Koa</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/quickstart.html">快速入门</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/progressive.html">渐进式开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/migration.html">2.x 升级指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="1$Menu" aria-haspopup="true"><span>基础功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="1$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/structure.html">目录结构</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/objects.html">内置对象</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/env.html">运行环境</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/config.html">配置</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/middleware.html">中间件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/router.html">Router</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/controller.html">Controller</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/service.html">Service</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/plugin.html">插件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/schedule.html">定时任务</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/extend.html">框架扩展</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/app-start.html">启动自定义</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="2$Menu" aria-haspopup="true"><span>核心功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="2$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/development.html">本地开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/unittest.html">单元测试</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/deployment.html">应用部署</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/logger.html">日志</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/httpclient.html">HttpClient</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cookie-and-session.html">Cookie and Session</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cluster-and-ipc.html">多进程模型和进程间通讯</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/view.html">模板渲染</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/error-handling.html">异常处理</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/security.html">安全</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/i18n.html">国际化</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="3$Menu" aria-haspopup="true"><span>教程</span><i class="ant-menu-submenu-arrow"></i></div><ul id="3$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/mysql.html">MySQL</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/restful.html">RESTful API</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/passport.html">Passport 鉴权</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/socketio.html">Socket.IO</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/assets.html">静态资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/typescript.html">TypeScript</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="4$Menu" aria-haspopup="true"><span>进阶</span><i class="ant-menu-submenu-arrow"></i></div><ul id="4$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/loader.html">Loader</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/plugin.html">插件开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/framework.html">框架开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/cluster-client.html">多进程研发模式增强</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/view-plugin.html">模板插件开发规范</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/style-guide.html">代码风格指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="5$Menu" aria-haspopup="true"><span>社区</span><i class="ant-menu-submenu-arrow"></i></div><ul id="5$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/plugins/">内置插件列表</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/contributing.html">如何贡献</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/resource.html">资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/faq.html">常见问题</a></li></ul></li></ul></div></div><div class="basic_layout-module__post___2Z7KK ant-layout-content"><div class="ant-row" style="margin-left:-8px;margin-right:-8px"><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-24 ant-col-md-18"><div class="markdown-body" style="font-size:14px"><div><p>互联网时代，无数服务是基于 HTTP 协议进行通信的，Web 应用调用后端 HTTP 服务是一种非常常见的应用场景。</p><p>为此框架基于 <a href="https://github.com/node-modules/urllib">urllib</a> 内置实现了一个 <a href="https://github.com/eggjs/egg/blob/master/lib/core/httpclient.js">HttpClient</a>，应用可以非常便捷地完成任何 HTTP 请求。</p><h2 id="通过-app-使用-httpclient">通过 app 使用 HttpClient</h2><p>框架在应用初始化的时候，会自动将 <a href="https://github.com/eggjs/egg/blob/master/lib/core/httpclient.js">HttpClient</a> 初始化到 <code>app.httpclient</code>。
同时增加了一个 <code>app.curl(url, options)</code> 方法，它等价于 <code>app.httpclient.request(url, options)</code>。</p><p>这样就可以非常方便地使用 <code>app.curl</code> 方法完成一次 HTTP 请求。</p><pre><code class="language-js">// app.js
module.exports = app =&gt; {
  app.beforeStart(async () =&gt; {
    // 示例：启动的时候去读取 https://registry.npm.taobao.org/egg/latest 的版本信息
    const result = await app.curl(&#x27;https://registry.npm.taobao.org/egg/latest&#x27;, {
      dataType: &#x27;json&#x27;,
    });
    app.logger.info(&#x27;Egg latest version: %s&#x27;, result.data.version);
  });
};</code></pre><h2 id="通过-context-使用-httpclient">通过 Context 使用 HttpClient</h2><p>框架在 Context 中同样提供了 <code>ctx.curl(url, options)</code> 和 <code>ctx.httpclient</code>，保持跟 app 下的使用体验一致。
这样就可以在有 Context 的地方（如在 controller 中）非常方便地使用 <code>ctx.curl()</code> 方法完成一次 HTTP 请求。</p><pre><code class="language-js">// app/controller/npm.js
class NpmController extends Controller {
  async index() {
    const ctx = this.ctx;

    // 示例：请求一个 npm 模块信息
    const result = await ctx.curl(&#x27;https://registry.npm.taobao.org/egg/latest&#x27;, {
      // 自动解析 JSON response
      dataType: &#x27;json&#x27;,
      // 3 秒超时
      timeout: 3000,
    });

    ctx.body = {
      status: result.status,
      headers: result.headers,
      package: result.data,
    };
  }
}</code></pre><h2 id="基本-http-请求">基本 HTTP 请求</h2><p>HTTP 已经被广泛大量使用，尽管 HTTP 有多种请求方式，但是万变不离其宗，我们先以基本的4个请求方法为例子，
逐步讲解一下更多的复杂应用场景。</p><p>以下例子都会在 controller 代码中对 <a href="https://httpbin.org">https://httpbin.org</a> 发起请求来完成。</p><h3 id="get">GET</h3><p>读取数据几乎都是使用 GET 请求，它是 HTTP 世界最常见的一种，也是最广泛的一种，它的请求参数也是最容易构造的。</p><pre><code class="language-js">// app/controller/npm.js
class NpmController extends Controller {
  async get() {
    const ctx = this.ctx;
    const result = await ctx.curl(&#x27;https://httpbin.org/get?foo=bar&#x27;);
    ctx.status = result.status;
    ctx.set(result.headers);
    ctx.body = result.data;
  }
}</code></pre><ul><li>GET 请求可以不用设置 <code>options.method</code> 参数，HttpClient 的默认 method 会设置为 <code>GET</code>。</li><li>返回值 <code>result</code> 会包含 3 个属性：<code>status</code>, <code>headers</code> 和 <code>data</code><ul><li><code>status</code>: 响应状态码，如 <code>200</code>, <code>302</code>, <code>404</code>, <code>500</code> 等等</li><li><code>headers</code>: 响应头，类似 <code>{ &#x27;content-type&#x27;: &#x27;text/html&#x27;, ... }</code></li><li><code>data</code>: 响应 body，默认 HttpClient 不会做任何处理，会直接返回 Buffer 类型数据。
一旦设置了 <code>options.dataType</code>，HttpClient 将会根据此参数对 <code>data</code> 进行相应的处理。</li></ul></li></ul><p>完整的请求参数 <code>options</code> 和返回值 <code>result</code> 的说明请看下文的 <a href="#options-参数详解">options 参数详解</a> 章节。</p><h3 id="post">POST</h3><p>创建数据的场景一般来说都会使用 POST 请求，它相对于 GET 来说多了请求 body 这个参数。</p><p>以发送 JSON body 的场景举例：</p><pre><code class="language-js">// app/controller/npm.js
class NpmController extends Controller {
  async post() {
    const ctx = this.ctx;
    const result = await ctx.curl(&#x27;https://httpbin.org/post&#x27;, {
      // 必须指定 method
      method: &#x27;POST&#x27;,
      // 通过 contentType 告诉 HttpClient 以 JSON 格式发送
      contentType: &#x27;json&#x27;,
      data: {
        hello: &#x27;world&#x27;,
        now: Date.now(),
      },
      // 明确告诉 HttpClient 以 JSON 格式处理返回的响应 body
      dataType: &#x27;json&#x27;,
    });
    ctx.body = result.data;
  }
}</code></pre><p>下文还会详细讲解以 POST 实现 Form 表单提交和文件上传的功能。</p><h3 id="put">PUT</h3><p>PUT 与 POST 类似，它更加适合更新数据和替换数据的语义。
除了 method 参数需要设置为 <code>PUT</code>，其他参数几乎跟 POST 一模一样。</p><pre><code class="language-js">// app/controller/npm.js
class NpmController extends Controller {
  async put() {
    const ctx = this.ctx;
    const result = await ctx.curl(&#x27;https://httpbin.org/put&#x27;, {
      // 必须指定 method
      method: &#x27;PUT&#x27;,
      // 通过 contentType 告诉 HttpClient 以 JSON 格式发送
      contentType: &#x27;json&#x27;,
      data: {
        update: &#x27;foo bar&#x27;,
      },
      // 明确告诉 HttpClient 以 JSON 格式处理响应 body
      dataType: &#x27;json&#x27;,
    });
    ctx.body = result.data;
  }
}</code></pre><h3 id="delete">DELETE</h3><p>删除数据会选择 DELETE 请求，它通常可以不需要加请求 body，但是 HttpClient 不会限制。</p><pre><code class="language-js">// app/controller/npm.js
class NpmController extends Controller {
  async del() {
    const ctx = this.ctx;
    const result = await ctx.curl(&#x27;https://httpbin.org/delete&#x27;, {
      // 必须指定 method
      method: &#x27;DELETE&#x27;,
      // 明确告诉 HttpClient 以 JSON 格式处理响应 body
      dataType: &#x27;json&#x27;,
    });
    ctx.body = result.data;
  }
}</code></pre><h2 id="高级-http-请求">高级 HTTP 请求</h2><p>在真实的应用场景下，还是会包含一些较为复杂的 HTTP 请求。</p><h3 id="form-表单提交">Form 表单提交</h3><p>面向浏览器设计的 Form 表单（不包含文件）提交接口，通常都要求以 <code>content-type: application/x-www-form-urlencoded</code>
的格式提交请求数据。</p><pre><code class="language-js">// app/controller/npm.js
class NpmController extends Controller {
  async submit() {
    const ctx = this.ctx;
    const result = await ctx.curl(&#x27;https://httpbin.org/post&#x27;, {
      // 必须指定 method，支持 POST，PUT 和 DELETE
      method: &#x27;POST&#x27;,
      // 不需要设置 contentType，HttpClient 会默认以 application/x-www-form-urlencoded 格式发送请求
      data: {
        now: Date.now(),
        foo: &#x27;bar&#x27;,
      },
      // 明确告诉 HttpClient 以 JSON 格式处理响应 body
      dataType: &#x27;json&#x27;,
    });
    ctx.body = result.data.form;
    // 响应最终会是类似以下的结果：
    // {
    //   &quot;foo&quot;: &quot;bar&quot;,
    //   &quot;now&quot;: &quot;1483864184348&quot;
    // }
  }
}</code></pre><h3 id="以-multipart-方式上传文件">以 Multipart 方式上传文件</h3><p>当一个 Form 表单提交包含文件的时候，请求数据格式就必须以 <a href="http://tools.ietf.org/html/rfc2388">multipart/form-data</a>
进行提交了。
这个时候需要引入 <a href="https://github.com/node-modules/formstream">formstream</a> 这个第三方模块来帮助我们生成可以被 HttpClient 消费的 <code>form</code> 对象。</p><pre><code class="language-js">// app/controller/npm.js
const FormStream = require(&#x27;formstream&#x27;);
class NpmController extends Controller {
  async upload() {
    const ctx = this.ctx;
    const form = new FormStream();
    // 设置普通的 key value
    form.field(&#x27;foo&#x27;, &#x27;bar&#x27;);
    // 上传当前文件本身用于测试
    form.file(&#x27;file&#x27;, __filename);

    const result = await ctx.curl(&#x27;https://httpbin.org/post&#x27;, {
      // 必须指定 method，支持 POST，PUT
      method: &#x27;POST&#x27;,
      // 生成符合 multipart/form-data 要求的请求 headers
      headers: form.headers(),
      // 以 stream 模式提交
      stream: form,
      // 明确告诉 HttpClient 以 JSON 格式处理响应 body
      dataType: &#x27;json&#x27;,
    });
    ctx.body = result.data.files;
    // 响应最终会是类似以下的结果：
    // {
    //   &quot;file&quot;: &quot;&#x27;use strict&#x27;;\n\nconst For....&quot;
    // }
  }
}</code></pre><p>当然，你还可以继续通过 <code>form.file()</code> 添加更多文件以实现一次性上传多个文件的需求。</p><pre><code class="language-js">form.file(&#x27;file1&#x27;, file1);
form.file(&#x27;file2&#x27;, file2);</code></pre><h3 id="以-stream-方式上传文件">以 Stream 方式上传文件</h3><p>其实，在 Node.js 的世界里面，Stream 才是主流。
如果服务端支持流式上传，最友好的方式还是直接发送 Stream。
Stream 实际会以 <code>Transfer-Encoding: chunked</code> 传输编码格式发送，这个转换是 <a href="https://nodejs.org/api/http.html">HTTP</a> 模块自动实现的。</p><pre><code class="language-js">// app/controller/npm.js
const fs = require(&#x27;fs&#x27;);
const FormStream = require(&#x27;formstream&#x27;);
class NpmController extends Controller {
  async uploadByStream() {
    const ctx = this.ctx;
    // 上传当前文件本身用于测试
    const fileStream = fs.createReadStream(__filename);
    // httpbin.org 不支持 stream 模式，使用本地 stream 接口代替
    const url = `${ctx.protocol}://${ctx.host}/stream`;
    const result = await ctx.curl(url, {
      // 必须指定 method，支持 POST，PUT
      method: &#x27;POST&#x27;,
      // 以 stream 模式提交
      stream: fileStream,
    });
    ctx.status = result.status;
    ctx.set(result.headers);
    ctx.body = result.data;
    // 响应最终会是类似以下的结果：
    // {&quot;streamSize&quot;:574}
  }
}</code></pre><h2 id="options-参数详解">options 参数详解</h2><p>由于 HTTP 请求的复杂性，导致 <code>httpclient.request(url, options)</code> 的 options 参数会非常多。
接下来将会以参数说明和代码配合一起讲解每个可选参数的实际用途。</p><h3 id="httpclient-默认全局配置">HttpClient 默认全局配置</h3><pre><code class="language-js">// config/config.default.js
exports.httpclient = {
  // 是否开启本地 DNS 缓存，默认关闭，开启后有两个特性
  // 1. 所有的 DNS 查询都会默认优先使用缓存的，即使 DNS 查询错误也不影响应用
  // 2. 对同一个域名，在 dnsCacheLookupInterval 的间隔内（默认 10s）只会查询一次
  enableDNSCache: false,
  // 对同一个域名进行 DNS 查询的最小间隔时间
  dnsCacheLookupInterval: 10000,
  // DNS 同时缓存的最大域名数量，默认 1000
  dnsCacheMaxLength: 1000,

  request: {
    // 默认 request 超时时间
    timeout: 3000,
  },

  httpAgent: {
    // 默认开启 http KeepAlive 功能
    keepAlive: true,
    // 空闲的 KeepAlive socket 最长可以存活 4 秒
    freeSocketKeepAliveTimeout: 4000,
    // 当 socket 超过 30 秒都没有任何活动，就会被当作超时处理掉
    timeout: 30000,
    // 允许创建的最大 socket 数
    maxSockets: Number.MAX_SAFE_INTEGER,
    // 最大空闲 socket 数
    maxFreeSockets: 256,
  },

  httpsAgent: {
    // 默认开启 https KeepAlive 功能
    keepAlive: true,
    // 空闲的 KeepAlive socket 最长可以存活 4 秒
    freeSocketKeepAliveTimeout: 4000,
    // 当 socket 超过 30 秒都没有任何活动，就会被当作超时处理掉
    timeout: 30000,
    // 允许创建的最大 socket 数
    maxSockets: Number.MAX_SAFE_INTEGER,
    // 最大空闲 socket 数
    maxFreeSockets: 256,
  },
};</code></pre><p>应用可以通过 <code>config/config.default.js</code> 覆盖此配置。</p><h3 id="data-object"><code>data: Object</code></h3><p>需要发送的请求数据，根据 <code>method</code> 自动选择正确的数据处理方式。</p><ul><li>GET，HEAD：通过 <code>querystring.stringify(data)</code> 处理后拼接到 url 的 query 参数上。</li><li>POST，PUT 和 DELETE 等：需要根据 <code>contentType</code> 做进一步判断处理。<ul><li><code>contentType = json</code>：通过 <code>JSON.stringify(data)</code> 处理，并设置为 body 发送。</li><li>其他：通过 <code>querystring.stringify(data)</code> 处理，并设置为 body 发送。</li></ul></li></ul><pre><code class="language-js">// GET + data
ctx.curl(url, {
  data: { foo: &#x27;bar&#x27; },
});

// POST + data
ctx.curl(url, {
  method: &#x27;POST&#x27;,
  data: { foo: &#x27;bar&#x27; },
});

// POST + JSON + data
ctx.curl(url, {
  method: &#x27;POST&#x27;,
  contentType: &#x27;json&#x27;,
  data: { foo: &#x27;bar&#x27; },
});</code></pre><h3 id="dataasquerystring-boolean"><code>dataAsQueryString: Boolean</code></h3><p>如果设置了 <code>dataAsQueryString=true</code>，那么即使在 POST 情况下，
也会强制将 <code>options.data</code> 以 <code>querystring.stringify</code> 处理之后拼接到 <code>url</code> 的 query 参数上。</p><p>可以很好地解决以 <code>stream</code> 发送数据，且额外的请求参数以 <code>url</code> query 形式传递的应用场景：</p><pre><code class="language-js">ctx.curl(url, {
  method: &#x27;POST&#x27;,
  dataAsQueryString: true,
  data: {
    // 一般来说都是 access token 之类的权限验证参数
    accessToken: &#x27;some access token value&#x27;,
  },
  stream: myFileStream,
});</code></pre><h3 id="content-stringbuffer"><code>content: String|Buffer</code></h3><p>发送请求正文，如果设置了此参数，那么会直接忽略 <code>data</code> 参数。</p><pre><code class="language-js">ctx.curl(url, {
  method: &#x27;POST&#x27;,
  // 直接发送原始 xml 数据，不需要 HttpClient 做特殊处理
  content: &#x27;&lt;xml&gt;&lt;hello&gt;world&lt;/hello&gt;&lt;/xml&gt;&#x27;,
  headers: {
    &#x27;content-type&#x27;: &#x27;text/html&#x27;,
  },
});</code></pre><h3 id="stream-readstream"><code>stream: ReadStream</code></h3><p>设置发送请求正文的可读数据流，默认是 <code>null</code>。
一旦设置了此参数，HttpClient 将会忽略 <code>data</code> 和 <code>content</code>。</p><pre><code class="language-js">ctx.curl(url, {
  method: &#x27;POST&#x27;,
  stream: fs.createReadStream(&#x27;/path/to/read&#x27;),
});</code></pre><h3 id="writestream-writestream"><code>writeStream: WriteStream</code></h3><p>设置接受响应数据的可写数据流，默认是 <code>null</code>。
一旦设置此参数，那么返回值 <code>result.data</code> 将会被设置为 <code>null</code>，
因为数据已经全部写入到 <code>writeStream</code> 中了。</p><pre><code class="language-js">ctx.curl(url, {
  writeStream: fs.createWriteStream(&#x27;/path/to/store&#x27;),
});</code></pre><h3 id="consumewritestream-boolean"><code>consumeWriteStream: Boolean</code></h3><p>是否等待 <code>writeStream</code> 完全写完才算响应全部接收完毕，默认是 <code>true</code>。
此参数不建议修改默认值，除非我们明确知道它的副作用是可接受的，
否则很可能会导致 <code>writeStream</code> 数据不完整。</p><h3 id="method-string"><code>method: String</code></h3><p>设置请求方法，默认是 <code>GET</code>。
支持 <code>GET、POST、PUT、DELETE、PATCH</code> 等<a href="https://nodejs.org/api/http.html#http_http_methods">所有 HTTP 方法</a>。</p><h3 id="contenttype-string"><code>contentType: String</code></h3><p>设置请求数据格式，默认是 <code>undefined</code>，HttpClient 会自动根据 <code>data</code> 和 <code>content</code> 参数自动设置。
<code>data</code> 是 object 的时候默认设置的是 <code>form</code>。支持 <code>json</code> 格式。</p><p>如需要以 JSON 格式发送 <code>data</code>：</p><pre><code class="language-js">ctx.curl(url, {
  method: &#x27;POST&#x27;,
  data: {
    foo: &#x27;bar&#x27;,
    now: Date.now(),
  },
  contentType: &#x27;json&#x27;,
});</code></pre><h3 id="datatype-string"><code>dataType: String</code></h3><p>设置响应数据格式，默认不对响应数据做任何处理，直接返回原始的 buffer 格式数据。
支持 <code>text</code> 和 <code>json</code> 两种格式。</p><p><strong>注意：设置成 <code>json</code> 时，如果响应数据解析失败会抛 <code>JSONResponseFormatError</code> 异常。</strong></p><pre><code class="language-js">const jsonResult = await ctx.curl(url, {
  dataType: &#x27;json&#x27;,
});
console.log(jsonResult.data);

const htmlResult = await ctx.curl(url, {
  dataType: &#x27;text&#x27;,
});
console.log(htmlResult.data);</code></pre><h3 id="fixjsonctlchars-boolean"><code>fixJSONCtlChars: Boolean</code></h3><p>是否自动过滤响应数据中的特殊控制字符 (U+0000 ~ U+001F)，默认是 <code>false</code>。
通常一些 CGI 系统返回的 JSON 数据会包含这些特殊控制字符，通过此参数可以自动过滤掉它们。</p><pre><code class="language-js">ctx.curl(url, {
  fixJSONCtlChars: true,
  dataType: &#x27;json&#x27;,
});</code></pre><h3 id="headers-object"><code>headers: Object</code></h3><p>自定义请求头。</p><pre><code class="language-js">ctx.curl(url, {
  headers: {
    &#x27;x-foo&#x27;: &#x27;bar&#x27;,
  },
});</code></pre><h3 id="timeout-numberarray"><code>timeout: Number|Array</code></h3><p>请求超时时间，默认是 <code>[ 5000, 5000 ]</code>，即创建连接超时是 5 秒，接收响应超时是 5 秒。</p><pre><code class="language-js">ctx.curl(url, {
  // 创建连接超时 3 秒，接收响应超时 3 秒
  timeout: 3000,
});

ctx.curl(url, {
  // 创建连接超时 1 秒，接收响应超时 30 秒，用于响应比较大的场景
  timeout: [ 1000, 30000 ],
});</code></pre><h3 id="agent-httpagent"><code>agent: HttpAgent</code></h3><p>允许通过此参数覆盖默认的 HttpAgent，如果你不想开启 KeepAlive，可以设置此参数为 <code>false</code>。</p><pre><code class="language-js">ctx.curl(url, {
  agent: false,
});</code></pre><h3 id="httpsagent-httpsagent"><code>httpsAgent: HttpsAgent</code></h3><p>允许通过此参数覆盖默认的 HttpsAgent，如果你不想开启 KeepAlive，可以设置此参数为 <code>false</code>。</p><pre><code class="language-js">ctx.curl(url, {
  httpsAgent: false,
});</code></pre><h3 id="auth-string"><code>auth: String</code></h3><p>简单登录授权（Basic Authentication）参数，将以明文方式将登录信息以 <code>Authorization</code> 请求头发送出去。</p><pre><code class="language-js">ctx.curl(url, {
  // 参数必须按照 `user:password` 格式设置
  auth: &#x27;foo:bar&#x27;,
});</code></pre><h3 id="digestauth-string"><code>digestAuth: String</code></h3><p>摘要登录授权（Digest Authentication）参数，设置此参数会自动对 401 响应尝试生成 <code>Authorization</code> 请求头，
尝试以授权方式请求一次。</p><pre><code class="language-js">ctx.curl(url, {
  // 参数必须按照 `user:password` 格式设置
  digestAuth: &#x27;foo:bar&#x27;,
});</code></pre><h3 id="followredirect-boolean"><code>followRedirect: Boolean</code></h3><p>是否自动跟进 3xx 的跳转响应，默认是 <code>false</code>。</p><pre><code class="language-js">ctx.curl(url, {
  followRedirect: true,
});</code></pre><h3 id="maxredirects-number"><code>maxRedirects: Number</code></h3><p>设置最大自动跳转次数，避免循环跳转无法终止，默认是 10 次。
此参数不宜设置过大，它只在 <code>followRedirect=true</code> 情况下才会生效。</p><pre><code class="language-js">ctx.curl(url, {
  followRedirect: true,
  // 最大只允许自动跳转 5 次。
  maxRedirects: 5,
});</code></pre><h3 id="formatredirecturl-functionfrom-to"><code>formatRedirectUrl: Function(from, to)</code></h3><p>允许我们通过 <code>formatRedirectUrl</code> 自定义实现 302、301 等跳转 url 拼接， 默认是 <code>url.resolve(from, to)</code>。</p><pre><code class="language-js">ctx.curl(url, {
  formatRedirectUrl: (from, to) =&gt; {
    // 例如可在这里修正跳转不正确的 url
    if (to === &#x27;//foo/&#x27;) {
      to = &#x27;/foo&#x27;;
    }
    return url.resolve(from, to);
  },
});</code></pre><h3 id="beforerequest-functionoptions"><code>beforeRequest: Function(options)</code></h3><p>HttpClient 在请求正式发送之前，会尝试调用 <code>beforeRequest</code> 钩子，允许我们在这里对请求参数做最后一次修改。</p><pre><code class="language-js">ctx.curl(url, {
  beforeRequest: options =&gt; {
    // 例如我们可以设置全局请求 id，方便日志跟踪
    options.headers[&#x27;x-request-id&#x27;] = uuid.v1();
  },
});</code></pre><h3 id="streaming-boolean"><code>streaming: Boolean</code></h3><p>是否直接返回响应流，默认为 <code>false</code>。
开启 streaming 之后，HttpClient 会在拿到响应对象 res 之后马上返回，
此时 <code>result.headers</code> 和 <code>result.status</code> 已经可以读取到，只是没有读取 data 数据而已。</p><pre><code class="language-js">const result = await ctx.curl(url, {
  streaming: true,
});

console.log(result.status, result.data);
// result.res 是一个 ReadStream 对象
ctx.body = result.res;</code></pre><p><strong>注意：如果 res 不是直接传递给 body，那么我们必须消费这个 stream，并且要做好 error 事件处理。</strong></p><h3 id="gzip-boolean"><code>gzip: Boolean</code></h3><p>是否支持 gzip 响应格式，默认为 <code>false</code>。
开启 gzip 之后，HttpClient 将自动设置 <code>Accept-Encoding: gzip</code> 请求头，
并且会自动解压带 <code>Content-Encoding: gzip</code> 响应头的数据。</p><pre><code class="language-js">ctx.curl(url, {
  gzip: true,
});</code></pre><h3 id="timing-boolean"><code>timing: Boolean</code></h3><p>是否开启请求各阶段的时间测量，默认为 <code>false</code>。
开启 timing 之后，可以通过 <code>result.res.timing</code> 拿到这次 HTTP 请求各阶段的时间测量值（单位是毫秒），
通过这些测量值，我们可以非常方便地定位到这次请求最慢的环境发生在那个阶段，效果如同 Chrome network timing 的作用。</p><p>timing 各阶段测量值解析：</p><ul><li>queuing：分配 socket 耗时</li><li>dnslookup：DNS 查询耗时</li><li>connected：socket 三次握手连接成功耗时</li><li>requestSent：请求数据完整发送完毕耗时</li><li>waiting：收到第一个字节的响应数据耗时</li><li>contentDownload：全部响应数据接收完毕耗时</li></ul><pre><code class="language-js">const result = await ctx.curl(url, {
  timing: true,
});
console.log(result.res.timing);
// {
//   &quot;queuing&quot;:29,
//   &quot;dnslookup&quot;:37,
//   &quot;connected&quot;:370,
//   &quot;requestSent&quot;:1001,
//   &quot;waiting&quot;:1833,
//   &quot;contentDownload&quot;:3416
// }</code></pre><h3 id="carejectunauthorizedpfxkeycertpassphrasecipherssecureprotocol"><code>ca，rejectUnauthorized，pfx，key，cert，passphrase，ciphers，secureProtocol</code></h3><p>这几个都是透传给 <a href="https://nodejs.org/api/https.html">HTTPS</a> 模块的参数，具体请查看 <a href="https://nodejs.org/api/https.html#https_https_request_options_callback"><code>https.request(options, callback)</code></a>。</p><h2 id="调试辅助">调试辅助</h2><p>框架还提供了 <a href="https://github.com/eggjs/egg-development-proxyagent">egg-development-proxyagent</a> 插件来方便开发者调试。</p><p>先安装和开启插件：</p><pre><code class="language-bash">$ npm i egg-development-proxyagent --save</code></pre><pre><code class="language-js">// config/plugin.js
exports.proxyagent = {
  enable: true,
  package: &#x27;egg-development-proxyagent&#x27;,
}</code></pre><p>开启抓包工具，可以用 <a href="https://www.charlesproxy.com/">charles</a> 或 <a href="http://www.telerik.com/fiddler">fiddler</a>，此处我们用 <a href="https://github.com/alibaba/anyproxy">anyproxy</a> 来演示下。</p><pre><code class="language-bash">$ npm install anyproxy -g
$ anyproxy --port 8888</code></pre><p>使用环境变量启动应用：</p><pre><code class="language-bash">$ http_proxy=http://127.0.0.1:8888 npm run dev</code></pre><p>然后就可以正常操作了，所有经过 HttpClient 的请求，都可以在 <a href="http://localhost:8002">http://localhost:8002</a> 这个控制台中查看到。</p><p><img alt="anyproxy" src="https://cloud.githubusercontent.com/assets/227713/21976937/06a63694-dc0f-11e6-98b5-e9e279c4867c.png"/></p><p><strong>注意：该插件默认只在 local 环境下启动。</strong></p><h2 id="常见错误">常见错误</h2><h3 id="创建连接超时">创建连接超时</h3><ul><li>异常名称：<code>ConnectionTimeoutError</code></li><li>出现场景：通常是 DNS 查询比较慢，或者客户端与服务端之间的网络速度比较慢导致的。</li><li>排查建议：请适当增大 <code>timeout</code> 参数。</li></ul><h3 id="服务响应超时">服务响应超时</h3><ul><li>异常名称：<code>ResponseTimeoutError</code></li><li>出现场景：通常是客户端与服务端之间网络速度比较慢，并且响应数据比较大的情况下会发生。</li><li>排查建议：请适当增大 <code>timeout</code> 参数。</li></ul><h3 id="服务主动断开连接">服务主动断开连接</h3><ul><li>异常名称：<code>ResponseError, code: ECONNRESET</code></li><li>出现场景：通常是服务端主动断开 socket 连接，导致 HTTP 请求链路异常。</li><li>排查建议：请检查当时服务端是否发生网络异常。</li></ul><h3 id="服务不可达">服务不可达</h3><ul><li>异常名称：<code>RequestError, code: ECONNREFUSED, status: -1</code></li><li>出现场景：通常是因为请求的 url 所属 IP 或者端口无法连接成功。</li><li>排查建议：请确保 IP 或者端口设置正确。</li></ul><h3 id="域名不存在">域名不存在</h3><ul><li>异常名称：<code>RequestError, code: ENOTFOUND, status: -1</code></li><li>出现场景：通常是因为请求的 url 所在的域名无法通过 DNS 解析成功。</li><li>排查建议：请确保域名存在，也需要排查一下 DNS 服务是否配置正确。</li></ul><h3 id="json-响应数据格式错误">JSON 响应数据格式错误</h3><ul><li>异常名称：<code>JSONResponseFormatError</code></li><li>出现场景：设置了 <code>dataType=json</code> 并且响应数据不符合 JSON 格式，就会抛出此异常。</li><li>排查建议：确保服务端无论在什么情况下都要正确返回 JSON 格式的数据。</li></ul><h2 id="全局-request-和-response-事件">全局 <code>request</code> 和 <code>response</code> 事件</h2><p>在企业应用场景，常常会有统一 tracer 日志的需求。
为了方便在 app 层面统一监听 HttpClient 的请求和响应，我们约定了全局 <code>request</code> 和 <code>response</code> 事件来暴露这两个时机。</p><pre><code class="language-bash">    init options
        |
        V
    emit `request` event
        |
        V
    send request and receive response
        |
        V
    emit `response` event
        |
        V
       end</code></pre><h3 id="request-事件发生在网络操作发生之前"><code>request</code> 事件：发生在网络操作发生之前</h3><p>请求发送之前，会触发一个 <code>request</code> 事件，允许对请求做拦截。</p><pre><code class="language-js">app.httpclient.on(&#x27;request&#x27;, req =&gt; {
  req.url //请求 url
  req.ctx //是发起这次请求的当前上下文

  // 可以在这里设置一些 trace headers，方便全链路跟踪
});</code></pre><h3 id="response-事件发生在网络操作结束之后"><code>response</code> 事件：发生在网络操作结束之后</h3><p>请求结束之后会触发一个 <code>response</code> 事件，这样外部就可以订阅这个事件打印日志。</p><pre><code class="language-js">app.httpclient.on(&#x27;response&#x27;, result =&gt; {
  result.res.status
  result.ctx //是发起这次请求的当前上下文
  result.req //对应的 req 对象，即 request 事件里面那个 req
});</code></pre><h2 id="示例代码">示例代码</h2><p>完整示例代码可以在 <a href="https://github.com/eggjs/examples/blob/master/httpclient">eggjs/exmaples/httpclient</a> 找到。</p></div></div></div><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-0 ant-col-md-6"><div class="markdown-body" style="font-size:14px"><div><ul><li><a href="#%E9%80%9A%E8%BF%87-app-%E4%BD%BF%E7%94%A8-httpclient">通过 app 使用 HttpClient</a></li><li><a href="#%E9%80%9A%E8%BF%87-context-%E4%BD%BF%E7%94%A8-httpclient">通过 Context 使用 HttpClient</a></li><li><a href="#%E5%9F%BA%E6%9C%AC-http-%E8%AF%B7%E6%B1%82">基本 HTTP 请求</a><ul><li><a href="#get">GET</a></li><li><a href="#post">POST</a></li><li><a href="#put">PUT</a></li><li><a href="#delete">DELETE</a></li></ul></li><li><a href="#%E9%AB%98%E7%BA%A7-http-%E8%AF%B7%E6%B1%82">高级 HTTP 请求</a><ul><li><a href="#form-%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4">Form 表单提交</a></li><li><a href="#%E4%BB%A5-multipart-%E6%96%B9%E5%BC%8F%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6">以 Multipart 方式上传文件</a></li><li><a href="#%E4%BB%A5-stream-%E6%96%B9%E5%BC%8F%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6">以 Stream 方式上传文件</a></li></ul></li><li><a href="#options-%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3">options 参数详解</a><ul><li><a href="#httpclient-%E9%BB%98%E8%AE%A4%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE">HttpClient 默认全局配置</a></li><li><a href="#data-object"><code>data: Object</code></a></li><li><a href="#dataasquerystring-boolean"><code>dataAsQueryString: Boolean</code></a></li><li><a href="#content-stringbuffer"><code>content: String|Buffer</code></a></li><li><a href="#stream-readstream"><code>stream: ReadStream</code></a></li><li><a href="#writestream-writestream"><code>writeStream: WriteStream</code></a></li><li><a href="#consumewritestream-boolean"><code>consumeWriteStream: Boolean</code></a></li><li><a href="#method-string"><code>method: String</code></a></li><li><a href="#contenttype-string"><code>contentType: String</code></a></li><li><a href="#datatype-string"><code>dataType: String</code></a></li><li><a href="#fixjsonctlchars-boolean"><code>fixJSONCtlChars: Boolean</code></a></li><li><a href="#headers-object"><code>headers: Object</code></a></li><li><a href="#timeout-numberarray"><code>timeout: Number|Array</code></a></li><li><a href="#agent-httpagent"><code>agent: HttpAgent</code></a></li><li><a href="#httpsagent-httpsagent"><code>httpsAgent: HttpsAgent</code></a></li><li><a href="#auth-string"><code>auth: String</code></a></li><li><a href="#digestauth-string"><code>digestAuth: String</code></a></li><li><a href="#followredirect-boolean"><code>followRedirect: Boolean</code></a></li><li><a href="#maxredirects-number"><code>maxRedirects: Number</code></a></li><li><a href="#formatredirecturl-functionfrom-to"><code>formatRedirectUrl: Function(from, to)</code></a></li><li><a href="#beforerequest-functionoptions"><code>beforeRequest: Function(options)</code></a></li><li><a href="#streaming-boolean"><code>streaming: Boolean</code></a></li><li><a href="#gzip-boolean"><code>gzip: Boolean</code></a></li><li><a href="#timing-boolean"><code>timing: Boolean</code></a></li><li><a href="#carejectunauthorizedpfxkeycertpassphrasecipherssecureprotocol"><code>ca，rejectUnauthorized，pfx，key，cert，passphrase，ciphers，secureProtocol</code></a></li></ul></li><li><a href="#%E8%B0%83%E8%AF%95%E8%BE%85%E5%8A%A9">调试辅助</a></li><li><a href="#%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF">常见错误</a><ul><li><a href="#%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6">创建连接超时</a></li><li><a href="#%E6%9C%8D%E5%8A%A1%E5%93%8D%E5%BA%94%E8%B6%85%E6%97%B6">服务响应超时</a></li><li><a href="#%E6%9C%8D%E5%8A%A1%E4%B8%BB%E5%8A%A8%E6%96%AD%E5%BC%80%E8%BF%9E%E6%8E%A5">服务主动断开连接</a></li><li><a href="#%E6%9C%8D%E5%8A%A1%E4%B8%8D%E5%8F%AF%E8%BE%BE">服务不可达</a></li><li><a href="#%E5%9F%9F%E5%90%8D%E4%B8%8D%E5%AD%98%E5%9C%A8">域名不存在</a></li><li><a href="#json-%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E9%94%99%E8%AF%AF">JSON 响应数据格式错误</a></li></ul></li><li><a href="#%E5%85%A8%E5%B1%80-request-%E5%92%8C-response-%E4%BA%8B%E4%BB%B6">全局 <code>request</code> 和 <code>response</code> 事件</a><ul><li><a href="#request-%E4%BA%8B%E4%BB%B6%E5%8F%91%E7%94%9F%E5%9C%A8%E7%BD%91%E7%BB%9C%E6%93%8D%E4%BD%9C%E5%8F%91%E7%94%9F%E4%B9%8B%E5%89%8D"><code>request</code> 事件：发生在网络操作发生之前</a></li><li><a href="#response-%E4%BA%8B%E4%BB%B6%E5%8F%91%E7%94%9F%E5%9C%A8%E7%BD%91%E7%BB%9C%E6%93%8D%E4%BD%9C%E7%BB%93%E6%9D%9F%E4%B9%8B%E5%90%8E"><code>response</code> 事件：发生在网络操作结束之后</a></li></ul></li><li><a href="#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81">示例代码</a></li></ul></div></div></div></div></div></div></div></div></div><script type="text/javascript">window.__INIT_STATE__={"lang":"zh","props":{"toc":"-%20%5B%E9%80%9A%E8%BF%87%20app%20%E4%BD%BF%E7%94%A8%20HttpClient%5D(%23%25E9%2580%259A%25E8%25BF%2587-app-%25E4%25BD%25BF%25E7%2594%25A8-httpclient)%0A-%20%5B%E9%80%9A%E8%BF%87%20Context%20%E4%BD%BF%E7%94%A8%20HttpClient%5D(%23%25E9%2580%259A%25E8%25BF%2587-context-%25E4%25BD%25BF%25E7%2594%25A8-httpclient)%0A-%20%5B%E5%9F%BA%E6%9C%AC%20HTTP%20%E8%AF%B7%E6%B1%82%5D(%23%25E5%259F%25BA%25E6%259C%25AC-http-%25E8%25AF%25B7%25E6%25B1%2582)%0A%20%20*%20%5BGET%5D(%23get)%0A%20%20*%20%5BPOST%5D(%23post)%0A%20%20*%20%5BPUT%5D(%23put)%0A%20%20*%20%5BDELETE%5D(%23delete)%0A-%20%5B%E9%AB%98%E7%BA%A7%20HTTP%20%E8%AF%B7%E6%B1%82%5D(%23%25E9%25AB%2598%25E7%25BA%25A7-http-%25E8%25AF%25B7%25E6%25B1%2582)%0A%20%20*%20%5BForm%20%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4%5D(%23form-%25E8%25A1%25A8%25E5%258D%2595%25E6%258F%2590%25E4%25BA%25A4)%0A%20%20*%20%5B%E4%BB%A5%20Multipart%20%E6%96%B9%E5%BC%8F%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%5D(%23%25E4%25BB%25A5-multipart-%25E6%2596%25B9%25E5%25BC%258F%25E4%25B8%258A%25E4%25BC%25A0%25E6%2596%2587%25E4%25BB%25B6)%0A%20%20*%20%5B%E4%BB%A5%20Stream%20%E6%96%B9%E5%BC%8F%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%5D(%23%25E4%25BB%25A5-stream-%25E6%2596%25B9%25E5%25BC%258F%25E4%25B8%258A%25E4%25BC%25A0%25E6%2596%2587%25E4%25BB%25B6)%0A-%20%5Boptions%20%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3%5D(%23options-%25E5%258F%2582%25E6%2595%25B0%25E8%25AF%25A6%25E8%25A7%25A3)%0A%20%20*%20%5BHttpClient%20%E9%BB%98%E8%AE%A4%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%5D(%23httpclient-%25E9%25BB%2598%25E8%25AE%25A4%25E5%2585%25A8%25E5%25B1%2580%25E9%2585%258D%25E7%25BD%25AE)%0A%20%20*%20%5B%60data%3A%20Object%60%5D(%23data-object)%0A%20%20*%20%5B%60dataAsQueryString%3A%20Boolean%60%5D(%23dataasquerystring-boolean)%0A%20%20*%20%5B%60content%3A%20String%7CBuffer%60%5D(%23content-stringbuffer)%0A%20%20*%20%5B%60stream%3A%20ReadStream%60%5D(%23stream-readstream)%0A%20%20*%20%5B%60writeStream%3A%20WriteStream%60%5D(%23writestream-writestream)%0A%20%20*%20%5B%60consumeWriteStream%3A%20Boolean%60%5D(%23consumewritestream-boolean)%0A%20%20*%20%5B%60method%3A%20String%60%5D(%23method-string)%0A%20%20*%20%5B%60contentType%3A%20String%60%5D(%23contenttype-string)%0A%20%20*%20%5B%60dataType%3A%20String%60%5D(%23datatype-string)%0A%20%20*%20%5B%60fixJSONCtlChars%3A%20Boolean%60%5D(%23fixjsonctlchars-boolean)%0A%20%20*%20%5B%60headers%3A%20Object%60%5D(%23headers-object)%0A%20%20*%20%5B%60timeout%3A%20Number%7CArray%60%5D(%23timeout-numberarray)%0A%20%20*%20%5B%60agent%3A%20HttpAgent%60%5D(%23agent-httpagent)%0A%20%20*%20%5B%60httpsAgent%3A%20HttpsAgent%60%5D(%23httpsagent-httpsagent)%0A%20%20*%20%5B%60auth%3A%20String%60%5D(%23auth-string)%0A%20%20*%20%5B%60digestAuth%3A%20String%60%5D(%23digestauth-string)%0A%20%20*%20%5B%60followRedirect%3A%20Boolean%60%5D(%23followredirect-boolean)%0A%20%20*%20%5B%60maxRedirects%3A%20Number%60%5D(%23maxredirects-number)%0A%20%20*%20%5B%60formatRedirectUrl%3A%20Function(from%2C%20to)%60%5D(%23formatredirecturl-functionfrom-to)%0A%20%20*%20%5B%60beforeRequest%3A%20Function(options)%60%5D(%23beforerequest-functionoptions)%0A%20%20*%20%5B%60streaming%3A%20Boolean%60%5D(%23streaming-boolean)%0A%20%20*%20%5B%60gzip%3A%20Boolean%60%5D(%23gzip-boolean)%0A%20%20*%20%5B%60timing%3A%20Boolean%60%5D(%23timing-boolean)%0A%20%20*%20%5B%60ca%EF%BC%8CrejectUnauthorized%EF%BC%8Cpfx%EF%BC%8Ckey%EF%BC%8Ccert%EF%BC%8Cpassphrase%EF%BC%8Cciphers%EF%BC%8CsecureProtocol%60%5D(%23carejectunauthorizedpfxkeycertpassphrasecipherssecureprotocol)%0A-%20%5B%E8%B0%83%E8%AF%95%E8%BE%85%E5%8A%A9%5D(%23%25E8%25B0%2583%25E8%25AF%2595%25E8%25BE%2585%25E5%258A%25A9)%0A-%20%5B%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%5D(%23%25E5%25B8%25B8%25E8%25A7%2581%25E9%2594%2599%25E8%25AF%25AF)%0A%20%20*%20%5B%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6%5D(%23%25E5%2588%259B%25E5%25BB%25BA%25E8%25BF%259E%25E6%258E%25A5%25E8%25B6%2585%25E6%2597%25B6)%0A%20%20*%20%5B%E6%9C%8D%E5%8A%A1%E5%93%8D%E5%BA%94%E8%B6%85%E6%97%B6%5D(%23%25E6%259C%258D%25E5%258A%25A1%25E5%2593%258D%25E5%25BA%2594%25E8%25B6%2585%25E6%2597%25B6)%0A%20%20*%20%5B%E6%9C%8D%E5%8A%A1%E4%B8%BB%E5%8A%A8%E6%96%AD%E5%BC%80%E8%BF%9E%E6%8E%A5%5D(%23%25E6%259C%258D%25E5%258A%25A1%25E4%25B8%25BB%25E5%258A%25A8%25E6%2596%25AD%25E5%25BC%2580%25E8%25BF%259E%25E6%258E%25A5)%0A%20%20*%20%5B%E6%9C%8D%E5%8A%A1%E4%B8%8D%E5%8F%AF%E8%BE%BE%5D(%23%25E6%259C%258D%25E5%258A%25A1%25E4%25B8%258D%25E5%258F%25AF%25E8%25BE%25BE)%0A%20%20*%20%5B%E5%9F%9F%E5%90%8D%E4%B8%8D%E5%AD%98%E5%9C%A8%5D(%23%25E5%259F%259F%25E5%2590%258D%25E4%25B8%258D%25E5%25AD%2598%25E5%259C%25A8)%0A%20%20*%20%5BJSON%20%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E9%94%99%E8%AF%AF%5D(%23json-%25E5%2593%258D%25E5%25BA%2594%25E6%2595%25B0%25E6%258D%25AE%25E6%25A0%25BC%25E5%25BC%258F%25E9%2594%2599%25E8%25AF%25AF)%0A-%20%5B%E5%85%A8%E5%B1%80%20%60request%60%20%E5%92%8C%20%60response%60%20%E4%BA%8B%E4%BB%B6%5D(%23%25E5%2585%25A8%25E5%25B1%2580-request-%25E5%2592%258C-response-%25E4%25BA%258B%25E4%25BB%25B6)%0A%20%20*%20%5B%60request%60%20%E4%BA%8B%E4%BB%B6%EF%BC%9A%E5%8F%91%E7%94%9F%E5%9C%A8%E7%BD%91%E7%BB%9C%E6%93%8D%E4%BD%9C%E5%8F%91%E7%94%9F%E4%B9%8B%E5%89%8D%5D(%23request-%25E4%25BA%258B%25E4%25BB%25B6%25E5%258F%2591%25E7%2594%259F%25E5%259C%25A8%25E7%25BD%2591%25E7%25BB%259C%25E6%2593%258D%25E4%25BD%259C%25E5%258F%2591%25E7%2594%259F%25E4%25B9%258B%25E5%2589%258D)%0A%20%20*%20%5B%60response%60%20%E4%BA%8B%E4%BB%B6%EF%BC%9A%E5%8F%91%E7%94%9F%E5%9C%A8%E7%BD%91%E7%BB%9C%E6%93%8D%E4%BD%9C%E7%BB%93%E6%9D%9F%E4%B9%8B%E5%90%8E%5D(%23response-%25E4%25BA%258B%25E4%25BB%25B6%25E5%258F%2591%25E7%2594%259F%25E5%259C%25A8%25E7%25BD%2591%25E7%25BB%259C%25E6%2593%258D%25E4%25BD%259C%25E7%25BB%2593%25E6%259D%259F%25E4%25B9%258B%25E5%2590%258E)%0A-%20%5B%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81%5D(%23%25E7%25A4%25BA%25E4%25BE%258B%25E4%25BB%25A3%25E7%25A0%2581)","meta":{"info":{"title":"HttpClient"}},"content":"%0A%0A%0A%E4%BA%92%E8%81%94%E7%BD%91%E6%97%B6%E4%BB%A3%EF%BC%8C%E6%97%A0%E6%95%B0%E6%9C%8D%E5%8A%A1%E6%98%AF%E5%9F%BA%E4%BA%8E%20HTTP%20%E5%8D%8F%E8%AE%AE%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1%E7%9A%84%EF%BC%8CWeb%20%E5%BA%94%E7%94%A8%E8%B0%83%E7%94%A8%E5%90%8E%E7%AB%AF%20HTTP%20%E6%9C%8D%E5%8A%A1%E6%98%AF%E4%B8%80%E7%A7%8D%E9%9D%9E%E5%B8%B8%E5%B8%B8%E8%A7%81%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E3%80%82%0A%0A%E4%B8%BA%E6%AD%A4%E6%A1%86%E6%9E%B6%E5%9F%BA%E4%BA%8E%20%5Burllib%5D%20%E5%86%85%E7%BD%AE%E5%AE%9E%E7%8E%B0%E4%BA%86%E4%B8%80%E4%B8%AA%20%5BHttpClient%5D%EF%BC%8C%E5%BA%94%E7%94%A8%E5%8F%AF%E4%BB%A5%E9%9D%9E%E5%B8%B8%E4%BE%BF%E6%8D%B7%E5%9C%B0%E5%AE%8C%E6%88%90%E4%BB%BB%E4%BD%95%20HTTP%20%E8%AF%B7%E6%B1%82%E3%80%82%0A%0A%23%23%20%E9%80%9A%E8%BF%87%20app%20%E4%BD%BF%E7%94%A8%20HttpClient%0A%0A%E6%A1%86%E6%9E%B6%E5%9C%A8%E5%BA%94%E7%94%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E4%BC%9A%E8%87%AA%E5%8A%A8%E5%B0%86%20%5BHttpClient%5D%20%E5%88%9D%E5%A7%8B%E5%8C%96%E5%88%B0%20%60app.httpclient%60%E3%80%82%0A%E5%90%8C%E6%97%B6%E5%A2%9E%E5%8A%A0%E4%BA%86%E4%B8%80%E4%B8%AA%20%60app.curl(url%2C%20options)%60%20%E6%96%B9%E6%B3%95%EF%BC%8C%E5%AE%83%E7%AD%89%E4%BB%B7%E4%BA%8E%20%60app.httpclient.request(url%2C%20options)%60%E3%80%82%0A%0A%E8%BF%99%E6%A0%B7%E5%B0%B1%E5%8F%AF%E4%BB%A5%E9%9D%9E%E5%B8%B8%E6%96%B9%E4%BE%BF%E5%9C%B0%E4%BD%BF%E7%94%A8%20%60app.curl%60%20%E6%96%B9%E6%B3%95%E5%AE%8C%E6%88%90%E4%B8%80%E6%AC%A1%20HTTP%20%E8%AF%B7%E6%B1%82%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20app.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20app.beforeStart(async%20()%20%3D%3E%20%7B%0A%20%20%20%20%2F%2F%20%E7%A4%BA%E4%BE%8B%EF%BC%9A%E5%90%AF%E5%8A%A8%E7%9A%84%E6%97%B6%E5%80%99%E5%8E%BB%E8%AF%BB%E5%8F%96%20https%3A%2F%2Fregistry.npm.taobao.org%2Fegg%2Flatest%20%E7%9A%84%E7%89%88%E6%9C%AC%E4%BF%A1%E6%81%AF%0A%20%20%20%20const%20result%20%3D%20await%20app.curl('https%3A%2F%2Fregistry.npm.taobao.org%2Fegg%2Flatest'%2C%20%7B%0A%20%20%20%20%20%20dataType%3A%20'json'%2C%0A%20%20%20%20%7D)%3B%0A%20%20%20%20app.logger.info('Egg%20latest%20version%3A%20%25s'%2C%20result.data.version)%3B%0A%20%20%7D)%3B%0A%7D%3B%0A%60%60%60%0A%0A%23%23%20%E9%80%9A%E8%BF%87%20Context%20%E4%BD%BF%E7%94%A8%20HttpClient%0A%0A%E6%A1%86%E6%9E%B6%E5%9C%A8%20Context%20%E4%B8%AD%E5%90%8C%E6%A0%B7%E6%8F%90%E4%BE%9B%E4%BA%86%20%60ctx.curl(url%2C%20options)%60%20%E5%92%8C%20%60ctx.httpclient%60%EF%BC%8C%E4%BF%9D%E6%8C%81%E8%B7%9F%20app%20%E4%B8%8B%E7%9A%84%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C%E4%B8%80%E8%87%B4%E3%80%82%0A%E8%BF%99%E6%A0%B7%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%9C%A8%E6%9C%89%20Context%20%E7%9A%84%E5%9C%B0%E6%96%B9%EF%BC%88%E5%A6%82%E5%9C%A8%20controller%20%E4%B8%AD%EF%BC%89%E9%9D%9E%E5%B8%B8%E6%96%B9%E4%BE%BF%E5%9C%B0%E4%BD%BF%E7%94%A8%20%60ctx.curl()%60%20%E6%96%B9%E6%B3%95%E5%AE%8C%E6%88%90%E4%B8%80%E6%AC%A1%20HTTP%20%E8%AF%B7%E6%B1%82%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20app%2Fcontroller%2Fnpm.js%0Aclass%20NpmController%20extends%20Controller%20%7B%0A%20%20async%20index()%20%7B%0A%20%20%20%20const%20ctx%20%3D%20this.ctx%3B%0A%0A%20%20%20%20%2F%2F%20%E7%A4%BA%E4%BE%8B%EF%BC%9A%E8%AF%B7%E6%B1%82%E4%B8%80%E4%B8%AA%20npm%20%E6%A8%A1%E5%9D%97%E4%BF%A1%E6%81%AF%0A%20%20%20%20const%20result%20%3D%20await%20ctx.curl('https%3A%2F%2Fregistry.npm.taobao.org%2Fegg%2Flatest'%2C%20%7B%0A%20%20%20%20%20%20%2F%2F%20%E8%87%AA%E5%8A%A8%E8%A7%A3%E6%9E%90%20JSON%20response%0A%20%20%20%20%20%20dataType%3A%20'json'%2C%0A%20%20%20%20%20%20%2F%2F%203%20%E7%A7%92%E8%B6%85%E6%97%B6%0A%20%20%20%20%20%20timeout%3A%203000%2C%0A%20%20%20%20%7D)%3B%0A%0A%20%20%20%20ctx.body%20%3D%20%7B%0A%20%20%20%20%20%20status%3A%20result.status%2C%0A%20%20%20%20%20%20headers%3A%20result.headers%2C%0A%20%20%20%20%20%20package%3A%20result.data%2C%0A%20%20%20%20%7D%3B%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A%23%23%20%E5%9F%BA%E6%9C%AC%20HTTP%20%E8%AF%B7%E6%B1%82%0A%0AHTTP%20%E5%B7%B2%E7%BB%8F%E8%A2%AB%E5%B9%BF%E6%B3%9B%E5%A4%A7%E9%87%8F%E4%BD%BF%E7%94%A8%EF%BC%8C%E5%B0%BD%E7%AE%A1%20HTTP%20%E6%9C%89%E5%A4%9A%E7%A7%8D%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F%EF%BC%8C%E4%BD%86%E6%98%AF%E4%B8%87%E5%8F%98%E4%B8%8D%E7%A6%BB%E5%85%B6%E5%AE%97%EF%BC%8C%E6%88%91%E4%BB%AC%E5%85%88%E4%BB%A5%E5%9F%BA%E6%9C%AC%E7%9A%844%E4%B8%AA%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95%E4%B8%BA%E4%BE%8B%E5%AD%90%EF%BC%8C%0A%E9%80%90%E6%AD%A5%E8%AE%B2%E8%A7%A3%E4%B8%80%E4%B8%8B%E6%9B%B4%E5%A4%9A%E7%9A%84%E5%A4%8D%E6%9D%82%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E3%80%82%0A%0A%E4%BB%A5%E4%B8%8B%E4%BE%8B%E5%AD%90%E9%83%BD%E4%BC%9A%E5%9C%A8%20controller%20%E4%BB%A3%E7%A0%81%E4%B8%AD%E5%AF%B9%20https%3A%2F%2Fhttpbin.org%20%E5%8F%91%E8%B5%B7%E8%AF%B7%E6%B1%82%E6%9D%A5%E5%AE%8C%E6%88%90%E3%80%82%0A%0A%23%23%23%20GET%0A%0A%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%E5%87%A0%E4%B9%8E%E9%83%BD%E6%98%AF%E4%BD%BF%E7%94%A8%20GET%20%E8%AF%B7%E6%B1%82%EF%BC%8C%E5%AE%83%E6%98%AF%20HTTP%20%E4%B8%96%E7%95%8C%E6%9C%80%E5%B8%B8%E8%A7%81%E7%9A%84%E4%B8%80%E7%A7%8D%EF%BC%8C%E4%B9%9F%E6%98%AF%E6%9C%80%E5%B9%BF%E6%B3%9B%E7%9A%84%E4%B8%80%E7%A7%8D%EF%BC%8C%E5%AE%83%E7%9A%84%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E4%B9%9F%E6%98%AF%E6%9C%80%E5%AE%B9%E6%98%93%E6%9E%84%E9%80%A0%E7%9A%84%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20app%2Fcontroller%2Fnpm.js%0Aclass%20NpmController%20extends%20Controller%20%7B%0A%20%20async%20get()%20%7B%0A%20%20%20%20const%20ctx%20%3D%20this.ctx%3B%0A%20%20%20%20const%20result%20%3D%20await%20ctx.curl('https%3A%2F%2Fhttpbin.org%2Fget%3Ffoo%3Dbar')%3B%0A%20%20%20%20ctx.status%20%3D%20result.status%3B%0A%20%20%20%20ctx.set(result.headers)%3B%0A%20%20%20%20ctx.body%20%3D%20result.data%3B%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A-%20GET%20%E8%AF%B7%E6%B1%82%E5%8F%AF%E4%BB%A5%E4%B8%8D%E7%94%A8%E8%AE%BE%E7%BD%AE%20%60options.method%60%20%E5%8F%82%E6%95%B0%EF%BC%8CHttpClient%20%E7%9A%84%E9%BB%98%E8%AE%A4%20method%20%E4%BC%9A%E8%AE%BE%E7%BD%AE%E4%B8%BA%20%60GET%60%E3%80%82%0A-%20%E8%BF%94%E5%9B%9E%E5%80%BC%20%60result%60%20%E4%BC%9A%E5%8C%85%E5%90%AB%203%20%E4%B8%AA%E5%B1%9E%E6%80%A7%EF%BC%9A%60status%60%2C%20%60headers%60%20%E5%92%8C%20%60data%60%0A%20%20-%20%60status%60%3A%20%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81%E7%A0%81%EF%BC%8C%E5%A6%82%20%60200%60%2C%20%60302%60%2C%20%60404%60%2C%20%60500%60%20%E7%AD%89%E7%AD%89%0A%20%20-%20%60headers%60%3A%20%E5%93%8D%E5%BA%94%E5%A4%B4%EF%BC%8C%E7%B1%BB%E4%BC%BC%20%60%7B%20'content-type'%3A%20'text%2Fhtml'%2C%20...%20%7D%60%0A%20%20-%20%60data%60%3A%20%E5%93%8D%E5%BA%94%20body%EF%BC%8C%E9%BB%98%E8%AE%A4%20HttpClient%20%E4%B8%8D%E4%BC%9A%E5%81%9A%E4%BB%BB%E4%BD%95%E5%A4%84%E7%90%86%EF%BC%8C%E4%BC%9A%E7%9B%B4%E6%8E%A5%E8%BF%94%E5%9B%9E%20Buffer%20%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E3%80%82%0A%20%20%20%20%E4%B8%80%E6%97%A6%E8%AE%BE%E7%BD%AE%E4%BA%86%20%60options.dataType%60%EF%BC%8CHttpClient%20%E5%B0%86%E4%BC%9A%E6%A0%B9%E6%8D%AE%E6%AD%A4%E5%8F%82%E6%95%B0%E5%AF%B9%20%60data%60%20%E8%BF%9B%E8%A1%8C%E7%9B%B8%E5%BA%94%E7%9A%84%E5%A4%84%E7%90%86%E3%80%82%0A%0A%E5%AE%8C%E6%95%B4%E7%9A%84%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%20%60options%60%20%E5%92%8C%E8%BF%94%E5%9B%9E%E5%80%BC%20%60result%60%20%E7%9A%84%E8%AF%B4%E6%98%8E%E8%AF%B7%E7%9C%8B%E4%B8%8B%E6%96%87%E7%9A%84%20%5Boptions%20%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3%5D(%23options-%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3)%20%E7%AB%A0%E8%8A%82%E3%80%82%0A%0A%23%23%23%20POST%0A%0A%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E7%9A%84%E5%9C%BA%E6%99%AF%E4%B8%80%E8%88%AC%E6%9D%A5%E8%AF%B4%E9%83%BD%E4%BC%9A%E4%BD%BF%E7%94%A8%20POST%20%E8%AF%B7%E6%B1%82%EF%BC%8C%E5%AE%83%E7%9B%B8%E5%AF%B9%E4%BA%8E%20GET%20%E6%9D%A5%E8%AF%B4%E5%A4%9A%E4%BA%86%E8%AF%B7%E6%B1%82%20body%20%E8%BF%99%E4%B8%AA%E5%8F%82%E6%95%B0%E3%80%82%0A%0A%E4%BB%A5%E5%8F%91%E9%80%81%20JSON%20body%20%E7%9A%84%E5%9C%BA%E6%99%AF%E4%B8%BE%E4%BE%8B%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fcontroller%2Fnpm.js%0Aclass%20NpmController%20extends%20Controller%20%7B%0A%20%20async%20post()%20%7B%0A%20%20%20%20const%20ctx%20%3D%20this.ctx%3B%0A%20%20%20%20const%20result%20%3D%20await%20ctx.curl('https%3A%2F%2Fhttpbin.org%2Fpost'%2C%20%7B%0A%20%20%20%20%20%20%2F%2F%20%E5%BF%85%E9%A1%BB%E6%8C%87%E5%AE%9A%20method%0A%20%20%20%20%20%20method%3A%20'POST'%2C%0A%20%20%20%20%20%20%2F%2F%20%E9%80%9A%E8%BF%87%20contentType%20%E5%91%8A%E8%AF%89%20HttpClient%20%E4%BB%A5%20JSON%20%E6%A0%BC%E5%BC%8F%E5%8F%91%E9%80%81%0A%20%20%20%20%20%20contentType%3A%20'json'%2C%0A%20%20%20%20%20%20data%3A%20%7B%0A%20%20%20%20%20%20%20%20hello%3A%20'world'%2C%0A%20%20%20%20%20%20%20%20now%3A%20Date.now()%2C%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%2F%2F%20%E6%98%8E%E7%A1%AE%E5%91%8A%E8%AF%89%20HttpClient%20%E4%BB%A5%20JSON%20%E6%A0%BC%E5%BC%8F%E5%A4%84%E7%90%86%E8%BF%94%E5%9B%9E%E7%9A%84%E5%93%8D%E5%BA%94%20body%0A%20%20%20%20%20%20dataType%3A%20'json'%2C%0A%20%20%20%20%7D)%3B%0A%20%20%20%20ctx.body%20%3D%20result.data%3B%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A%E4%B8%8B%E6%96%87%E8%BF%98%E4%BC%9A%E8%AF%A6%E7%BB%86%E8%AE%B2%E8%A7%A3%E4%BB%A5%20POST%20%E5%AE%9E%E7%8E%B0%20Form%20%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4%E5%92%8C%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%82%0A%0A%23%23%23%20PUT%0A%0APUT%20%E4%B8%8E%20POST%20%E7%B1%BB%E4%BC%BC%EF%BC%8C%E5%AE%83%E6%9B%B4%E5%8A%A0%E9%80%82%E5%90%88%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E5%92%8C%E6%9B%BF%E6%8D%A2%E6%95%B0%E6%8D%AE%E7%9A%84%E8%AF%AD%E4%B9%89%E3%80%82%0A%E9%99%A4%E4%BA%86%20method%20%E5%8F%82%E6%95%B0%E9%9C%80%E8%A6%81%E8%AE%BE%E7%BD%AE%E4%B8%BA%20%60PUT%60%EF%BC%8C%E5%85%B6%E4%BB%96%E5%8F%82%E6%95%B0%E5%87%A0%E4%B9%8E%E8%B7%9F%20POST%20%E4%B8%80%E6%A8%A1%E4%B8%80%E6%A0%B7%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20app%2Fcontroller%2Fnpm.js%0Aclass%20NpmController%20extends%20Controller%20%7B%0A%20%20async%20put()%20%7B%0A%20%20%20%20const%20ctx%20%3D%20this.ctx%3B%0A%20%20%20%20const%20result%20%3D%20await%20ctx.curl('https%3A%2F%2Fhttpbin.org%2Fput'%2C%20%7B%0A%20%20%20%20%20%20%2F%2F%20%E5%BF%85%E9%A1%BB%E6%8C%87%E5%AE%9A%20method%0A%20%20%20%20%20%20method%3A%20'PUT'%2C%0A%20%20%20%20%20%20%2F%2F%20%E9%80%9A%E8%BF%87%20contentType%20%E5%91%8A%E8%AF%89%20HttpClient%20%E4%BB%A5%20JSON%20%E6%A0%BC%E5%BC%8F%E5%8F%91%E9%80%81%0A%20%20%20%20%20%20contentType%3A%20'json'%2C%0A%20%20%20%20%20%20data%3A%20%7B%0A%20%20%20%20%20%20%20%20update%3A%20'foo%20bar'%2C%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%2F%2F%20%E6%98%8E%E7%A1%AE%E5%91%8A%E8%AF%89%20HttpClient%20%E4%BB%A5%20JSON%20%E6%A0%BC%E5%BC%8F%E5%A4%84%E7%90%86%E5%93%8D%E5%BA%94%20body%0A%20%20%20%20%20%20dataType%3A%20'json'%2C%0A%20%20%20%20%7D)%3B%0A%20%20%20%20ctx.body%20%3D%20result.data%3B%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A%23%23%23%20DELETE%0A%0A%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E4%BC%9A%E9%80%89%E6%8B%A9%20DELETE%20%E8%AF%B7%E6%B1%82%EF%BC%8C%E5%AE%83%E9%80%9A%E5%B8%B8%E5%8F%AF%E4%BB%A5%E4%B8%8D%E9%9C%80%E8%A6%81%E5%8A%A0%E8%AF%B7%E6%B1%82%20body%EF%BC%8C%E4%BD%86%E6%98%AF%20HttpClient%20%E4%B8%8D%E4%BC%9A%E9%99%90%E5%88%B6%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20app%2Fcontroller%2Fnpm.js%0Aclass%20NpmController%20extends%20Controller%20%7B%0A%20%20async%20del()%20%7B%0A%20%20%20%20const%20ctx%20%3D%20this.ctx%3B%0A%20%20%20%20const%20result%20%3D%20await%20ctx.curl('https%3A%2F%2Fhttpbin.org%2Fdelete'%2C%20%7B%0A%20%20%20%20%20%20%2F%2F%20%E5%BF%85%E9%A1%BB%E6%8C%87%E5%AE%9A%20method%0A%20%20%20%20%20%20method%3A%20'DELETE'%2C%0A%20%20%20%20%20%20%2F%2F%20%E6%98%8E%E7%A1%AE%E5%91%8A%E8%AF%89%20HttpClient%20%E4%BB%A5%20JSON%20%E6%A0%BC%E5%BC%8F%E5%A4%84%E7%90%86%E5%93%8D%E5%BA%94%20body%0A%20%20%20%20%20%20dataType%3A%20'json'%2C%0A%20%20%20%20%7D)%3B%0A%20%20%20%20ctx.body%20%3D%20result.data%3B%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A%23%23%20%E9%AB%98%E7%BA%A7%20HTTP%20%E8%AF%B7%E6%B1%82%0A%0A%E5%9C%A8%E7%9C%9F%E5%AE%9E%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E4%B8%8B%EF%BC%8C%E8%BF%98%E6%98%AF%E4%BC%9A%E5%8C%85%E5%90%AB%E4%B8%80%E4%BA%9B%E8%BE%83%E4%B8%BA%E5%A4%8D%E6%9D%82%E7%9A%84%20HTTP%20%E8%AF%B7%E6%B1%82%E3%80%82%0A%0A%23%23%23%20Form%20%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4%0A%0A%E9%9D%A2%E5%90%91%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BE%E8%AE%A1%E7%9A%84%20Form%20%E8%A1%A8%E5%8D%95%EF%BC%88%E4%B8%8D%E5%8C%85%E5%90%AB%E6%96%87%E4%BB%B6%EF%BC%89%E6%8F%90%E4%BA%A4%E6%8E%A5%E5%8F%A3%EF%BC%8C%E9%80%9A%E5%B8%B8%E9%83%BD%E8%A6%81%E6%B1%82%E4%BB%A5%20%60content-type%3A%20application%2Fx-www-form-urlencoded%60%0A%E7%9A%84%E6%A0%BC%E5%BC%8F%E6%8F%90%E4%BA%A4%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20app%2Fcontroller%2Fnpm.js%0Aclass%20NpmController%20extends%20Controller%20%7B%0A%20%20async%20submit()%20%7B%0A%20%20%20%20const%20ctx%20%3D%20this.ctx%3B%0A%20%20%20%20const%20result%20%3D%20await%20ctx.curl('https%3A%2F%2Fhttpbin.org%2Fpost'%2C%20%7B%0A%20%20%20%20%20%20%2F%2F%20%E5%BF%85%E9%A1%BB%E6%8C%87%E5%AE%9A%20method%EF%BC%8C%E6%94%AF%E6%8C%81%20POST%EF%BC%8CPUT%20%E5%92%8C%20DELETE%0A%20%20%20%20%20%20method%3A%20'POST'%2C%0A%20%20%20%20%20%20%2F%2F%20%E4%B8%8D%E9%9C%80%E8%A6%81%E8%AE%BE%E7%BD%AE%20contentType%EF%BC%8CHttpClient%20%E4%BC%9A%E9%BB%98%E8%AE%A4%E4%BB%A5%20application%2Fx-www-form-urlencoded%20%E6%A0%BC%E5%BC%8F%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82%0A%20%20%20%20%20%20data%3A%20%7B%0A%20%20%20%20%20%20%20%20now%3A%20Date.now()%2C%0A%20%20%20%20%20%20%20%20foo%3A%20'bar'%2C%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%2F%2F%20%E6%98%8E%E7%A1%AE%E5%91%8A%E8%AF%89%20HttpClient%20%E4%BB%A5%20JSON%20%E6%A0%BC%E5%BC%8F%E5%A4%84%E7%90%86%E5%93%8D%E5%BA%94%20body%0A%20%20%20%20%20%20dataType%3A%20'json'%2C%0A%20%20%20%20%7D)%3B%0A%20%20%20%20ctx.body%20%3D%20result.data.form%3B%0A%20%20%20%20%2F%2F%20%E5%93%8D%E5%BA%94%E6%9C%80%E7%BB%88%E4%BC%9A%E6%98%AF%E7%B1%BB%E4%BC%BC%E4%BB%A5%E4%B8%8B%E7%9A%84%E7%BB%93%E6%9E%9C%EF%BC%9A%0A%20%20%20%20%2F%2F%20%7B%0A%20%20%20%20%2F%2F%20%20%20%22foo%22%3A%20%22bar%22%2C%0A%20%20%20%20%2F%2F%20%20%20%22now%22%3A%20%221483864184348%22%0A%20%20%20%20%2F%2F%20%7D%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A%23%23%23%20%E4%BB%A5%20Multipart%20%E6%96%B9%E5%BC%8F%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%0A%0A%E5%BD%93%E4%B8%80%E4%B8%AA%20Form%20%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4%E5%8C%85%E5%90%AB%E6%96%87%E4%BB%B6%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E5%B0%B1%E5%BF%85%E9%A1%BB%E4%BB%A5%20%5Bmultipart%2Fform-data%5D(http%3A%2F%2Ftools.ietf.org%2Fhtml%2Frfc2388)%0A%E8%BF%9B%E8%A1%8C%E6%8F%90%E4%BA%A4%E4%BA%86%E3%80%82%0A%E8%BF%99%E4%B8%AA%E6%97%B6%E5%80%99%E9%9C%80%E8%A6%81%E5%BC%95%E5%85%A5%20%5Bformstream%5D%20%E8%BF%99%E4%B8%AA%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97%E6%9D%A5%E5%B8%AE%E5%8A%A9%E6%88%91%E4%BB%AC%E7%94%9F%E6%88%90%E5%8F%AF%E4%BB%A5%E8%A2%AB%20HttpClient%20%E6%B6%88%E8%B4%B9%E7%9A%84%20%60form%60%20%E5%AF%B9%E8%B1%A1%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20app%2Fcontroller%2Fnpm.js%0Aconst%20FormStream%20%3D%20require('formstream')%3B%0Aclass%20NpmController%20extends%20Controller%20%7B%0A%20%20async%20upload()%20%7B%0A%20%20%20%20const%20ctx%20%3D%20this.ctx%3B%0A%20%20%20%20const%20form%20%3D%20new%20FormStream()%3B%0A%20%20%20%20%2F%2F%20%E8%AE%BE%E7%BD%AE%E6%99%AE%E9%80%9A%E7%9A%84%20key%20value%0A%20%20%20%20form.field('foo'%2C%20'bar')%3B%0A%20%20%20%20%2F%2F%20%E4%B8%8A%E4%BC%A0%E5%BD%93%E5%89%8D%E6%96%87%E4%BB%B6%E6%9C%AC%E8%BA%AB%E7%94%A8%E4%BA%8E%E6%B5%8B%E8%AF%95%0A%20%20%20%20form.file('file'%2C%20__filename)%3B%0A%0A%20%20%20%20const%20result%20%3D%20await%20ctx.curl('https%3A%2F%2Fhttpbin.org%2Fpost'%2C%20%7B%0A%20%20%20%20%20%20%2F%2F%20%E5%BF%85%E9%A1%BB%E6%8C%87%E5%AE%9A%20method%EF%BC%8C%E6%94%AF%E6%8C%81%20POST%EF%BC%8CPUT%0A%20%20%20%20%20%20method%3A%20'POST'%2C%0A%20%20%20%20%20%20%2F%2F%20%E7%94%9F%E6%88%90%E7%AC%A6%E5%90%88%20multipart%2Fform-data%20%E8%A6%81%E6%B1%82%E7%9A%84%E8%AF%B7%E6%B1%82%20headers%0A%20%20%20%20%20%20headers%3A%20form.headers()%2C%0A%20%20%20%20%20%20%2F%2F%20%E4%BB%A5%20stream%20%E6%A8%A1%E5%BC%8F%E6%8F%90%E4%BA%A4%0A%20%20%20%20%20%20stream%3A%20form%2C%0A%20%20%20%20%20%20%2F%2F%20%E6%98%8E%E7%A1%AE%E5%91%8A%E8%AF%89%20HttpClient%20%E4%BB%A5%20JSON%20%E6%A0%BC%E5%BC%8F%E5%A4%84%E7%90%86%E5%93%8D%E5%BA%94%20body%0A%20%20%20%20%20%20dataType%3A%20'json'%2C%0A%20%20%20%20%7D)%3B%0A%20%20%20%20ctx.body%20%3D%20result.data.files%3B%0A%20%20%20%20%2F%2F%20%E5%93%8D%E5%BA%94%E6%9C%80%E7%BB%88%E4%BC%9A%E6%98%AF%E7%B1%BB%E4%BC%BC%E4%BB%A5%E4%B8%8B%E7%9A%84%E7%BB%93%E6%9E%9C%EF%BC%9A%0A%20%20%20%20%2F%2F%20%7B%0A%20%20%20%20%2F%2F%20%20%20%22file%22%3A%20%22'use%20strict'%3B%5Cn%5Cnconst%20For....%22%0A%20%20%20%20%2F%2F%20%7D%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A%E5%BD%93%E7%84%B6%EF%BC%8C%E4%BD%A0%E8%BF%98%E5%8F%AF%E4%BB%A5%E7%BB%A7%E7%BB%AD%E9%80%9A%E8%BF%87%20%60form.file()%60%20%E6%B7%BB%E5%8A%A0%E6%9B%B4%E5%A4%9A%E6%96%87%E4%BB%B6%E4%BB%A5%E5%AE%9E%E7%8E%B0%E4%B8%80%E6%AC%A1%E6%80%A7%E4%B8%8A%E4%BC%A0%E5%A4%9A%E4%B8%AA%E6%96%87%E4%BB%B6%E7%9A%84%E9%9C%80%E6%B1%82%E3%80%82%0A%0A%60%60%60js%0Aform.file('file1'%2C%20file1)%3B%0Aform.file('file2'%2C%20file2)%3B%0A%60%60%60%0A%0A%23%23%23%20%E4%BB%A5%20Stream%20%E6%96%B9%E5%BC%8F%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%0A%0A%E5%85%B6%E5%AE%9E%EF%BC%8C%E5%9C%A8%20Node.js%20%E7%9A%84%E4%B8%96%E7%95%8C%E9%87%8C%E9%9D%A2%EF%BC%8CStream%20%E6%89%8D%E6%98%AF%E4%B8%BB%E6%B5%81%E3%80%82%0A%E5%A6%82%E6%9E%9C%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%94%AF%E6%8C%81%E6%B5%81%E5%BC%8F%E4%B8%8A%E4%BC%A0%EF%BC%8C%E6%9C%80%E5%8F%8B%E5%A5%BD%E7%9A%84%E6%96%B9%E5%BC%8F%E8%BF%98%E6%98%AF%E7%9B%B4%E6%8E%A5%E5%8F%91%E9%80%81%20Stream%E3%80%82%0AStream%20%E5%AE%9E%E9%99%85%E4%BC%9A%E4%BB%A5%20%60Transfer-Encoding%3A%20chunked%60%20%E4%BC%A0%E8%BE%93%E7%BC%96%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8F%91%E9%80%81%EF%BC%8C%E8%BF%99%E4%B8%AA%E8%BD%AC%E6%8D%A2%E6%98%AF%20%5BHTTP%5D%20%E6%A8%A1%E5%9D%97%E8%87%AA%E5%8A%A8%E5%AE%9E%E7%8E%B0%E7%9A%84%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20app%2Fcontroller%2Fnpm.js%0Aconst%20fs%20%3D%20require('fs')%3B%0Aconst%20FormStream%20%3D%20require('formstream')%3B%0Aclass%20NpmController%20extends%20Controller%20%7B%0A%20%20async%20uploadByStream()%20%7B%0A%20%20%20%20const%20ctx%20%3D%20this.ctx%3B%0A%20%20%20%20%2F%2F%20%E4%B8%8A%E4%BC%A0%E5%BD%93%E5%89%8D%E6%96%87%E4%BB%B6%E6%9C%AC%E8%BA%AB%E7%94%A8%E4%BA%8E%E6%B5%8B%E8%AF%95%0A%20%20%20%20const%20fileStream%20%3D%20fs.createReadStream(__filename)%3B%0A%20%20%20%20%2F%2F%20httpbin.org%20%E4%B8%8D%E6%94%AF%E6%8C%81%20stream%20%E6%A8%A1%E5%BC%8F%EF%BC%8C%E4%BD%BF%E7%94%A8%E6%9C%AC%E5%9C%B0%20stream%20%E6%8E%A5%E5%8F%A3%E4%BB%A3%E6%9B%BF%0A%20%20%20%20const%20url%20%3D%20%60%24%7Bctx.protocol%7D%3A%2F%2F%24%7Bctx.host%7D%2Fstream%60%3B%0A%20%20%20%20const%20result%20%3D%20await%20ctx.curl(url%2C%20%7B%0A%20%20%20%20%20%20%2F%2F%20%E5%BF%85%E9%A1%BB%E6%8C%87%E5%AE%9A%20method%EF%BC%8C%E6%94%AF%E6%8C%81%20POST%EF%BC%8CPUT%0A%20%20%20%20%20%20method%3A%20'POST'%2C%0A%20%20%20%20%20%20%2F%2F%20%E4%BB%A5%20stream%20%E6%A8%A1%E5%BC%8F%E6%8F%90%E4%BA%A4%0A%20%20%20%20%20%20stream%3A%20fileStream%2C%0A%20%20%20%20%7D)%3B%0A%20%20%20%20ctx.status%20%3D%20result.status%3B%0A%20%20%20%20ctx.set(result.headers)%3B%0A%20%20%20%20ctx.body%20%3D%20result.data%3B%0A%20%20%20%20%2F%2F%20%E5%93%8D%E5%BA%94%E6%9C%80%E7%BB%88%E4%BC%9A%E6%98%AF%E7%B1%BB%E4%BC%BC%E4%BB%A5%E4%B8%8B%E7%9A%84%E7%BB%93%E6%9E%9C%EF%BC%9A%0A%20%20%20%20%2F%2F%20%7B%22streamSize%22%3A574%7D%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A%23%23%20options%20%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3%0A%0A%E7%94%B1%E4%BA%8E%20HTTP%20%E8%AF%B7%E6%B1%82%E7%9A%84%E5%A4%8D%E6%9D%82%E6%80%A7%EF%BC%8C%E5%AF%BC%E8%87%B4%20%60httpclient.request(url%2C%20options)%60%20%E7%9A%84%20options%20%E5%8F%82%E6%95%B0%E4%BC%9A%E9%9D%9E%E5%B8%B8%E5%A4%9A%E3%80%82%0A%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%B0%86%E4%BC%9A%E4%BB%A5%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E%E5%92%8C%E4%BB%A3%E7%A0%81%E9%85%8D%E5%90%88%E4%B8%80%E8%B5%B7%E8%AE%B2%E8%A7%A3%E6%AF%8F%E4%B8%AA%E5%8F%AF%E9%80%89%E5%8F%82%E6%95%B0%E7%9A%84%E5%AE%9E%E9%99%85%E7%94%A8%E9%80%94%E3%80%82%0A%0A%23%23%23%20HttpClient%20%E9%BB%98%E8%AE%A4%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0Aexports.httpclient%20%3D%20%7B%0A%20%20%2F%2F%20%E6%98%AF%E5%90%A6%E5%BC%80%E5%90%AF%E6%9C%AC%E5%9C%B0%20DNS%20%E7%BC%93%E5%AD%98%EF%BC%8C%E9%BB%98%E8%AE%A4%E5%85%B3%E9%97%AD%EF%BC%8C%E5%BC%80%E5%90%AF%E5%90%8E%E6%9C%89%E4%B8%A4%E4%B8%AA%E7%89%B9%E6%80%A7%0A%20%20%2F%2F%201.%20%E6%89%80%E6%9C%89%E7%9A%84%20DNS%20%E6%9F%A5%E8%AF%A2%E9%83%BD%E4%BC%9A%E9%BB%98%E8%AE%A4%E4%BC%98%E5%85%88%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98%E7%9A%84%EF%BC%8C%E5%8D%B3%E4%BD%BF%20DNS%20%E6%9F%A5%E8%AF%A2%E9%94%99%E8%AF%AF%E4%B9%9F%E4%B8%8D%E5%BD%B1%E5%93%8D%E5%BA%94%E7%94%A8%0A%20%20%2F%2F%202.%20%E5%AF%B9%E5%90%8C%E4%B8%80%E4%B8%AA%E5%9F%9F%E5%90%8D%EF%BC%8C%E5%9C%A8%20dnsCacheLookupInterval%20%E7%9A%84%E9%97%B4%E9%9A%94%E5%86%85%EF%BC%88%E9%BB%98%E8%AE%A4%2010s%EF%BC%89%E5%8F%AA%E4%BC%9A%E6%9F%A5%E8%AF%A2%E4%B8%80%E6%AC%A1%0A%20%20enableDNSCache%3A%20false%2C%0A%20%20%2F%2F%20%E5%AF%B9%E5%90%8C%E4%B8%80%E4%B8%AA%E5%9F%9F%E5%90%8D%E8%BF%9B%E8%A1%8C%20DNS%20%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%9C%80%E5%B0%8F%E9%97%B4%E9%9A%94%E6%97%B6%E9%97%B4%0A%20%20dnsCacheLookupInterval%3A%2010000%2C%0A%20%20%2F%2F%20DNS%20%E5%90%8C%E6%97%B6%E7%BC%93%E5%AD%98%E7%9A%84%E6%9C%80%E5%A4%A7%E5%9F%9F%E5%90%8D%E6%95%B0%E9%87%8F%EF%BC%8C%E9%BB%98%E8%AE%A4%201000%0A%20%20dnsCacheMaxLength%3A%201000%2C%0A%0A%20%20request%3A%20%7B%0A%20%20%20%20%2F%2F%20%E9%BB%98%E8%AE%A4%20request%20%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4%0A%20%20%20%20timeout%3A%203000%2C%0A%20%20%7D%2C%0A%0A%20%20httpAgent%3A%20%7B%0A%20%20%20%20%2F%2F%20%E9%BB%98%E8%AE%A4%E5%BC%80%E5%90%AF%20http%20KeepAlive%20%E5%8A%9F%E8%83%BD%0A%20%20%20%20keepAlive%3A%20true%2C%0A%20%20%20%20%2F%2F%20%E7%A9%BA%E9%97%B2%E7%9A%84%20KeepAlive%20socket%20%E6%9C%80%E9%95%BF%E5%8F%AF%E4%BB%A5%E5%AD%98%E6%B4%BB%204%20%E7%A7%92%0A%20%20%20%20freeSocketKeepAliveTimeout%3A%204000%2C%0A%20%20%20%20%2F%2F%20%E5%BD%93%20socket%20%E8%B6%85%E8%BF%87%2030%20%E7%A7%92%E9%83%BD%E6%B2%A1%E6%9C%89%E4%BB%BB%E4%BD%95%E6%B4%BB%E5%8A%A8%EF%BC%8C%E5%B0%B1%E4%BC%9A%E8%A2%AB%E5%BD%93%E4%BD%9C%E8%B6%85%E6%97%B6%E5%A4%84%E7%90%86%E6%8E%89%0A%20%20%20%20timeout%3A%2030000%2C%0A%20%20%20%20%2F%2F%20%E5%85%81%E8%AE%B8%E5%88%9B%E5%BB%BA%E7%9A%84%E6%9C%80%E5%A4%A7%20socket%20%E6%95%B0%0A%20%20%20%20maxSockets%3A%20Number.MAX_SAFE_INTEGER%2C%0A%20%20%20%20%2F%2F%20%E6%9C%80%E5%A4%A7%E7%A9%BA%E9%97%B2%20socket%20%E6%95%B0%0A%20%20%20%20maxFreeSockets%3A%20256%2C%0A%20%20%7D%2C%0A%0A%20%20httpsAgent%3A%20%7B%0A%20%20%20%20%2F%2F%20%E9%BB%98%E8%AE%A4%E5%BC%80%E5%90%AF%20https%20KeepAlive%20%E5%8A%9F%E8%83%BD%0A%20%20%20%20keepAlive%3A%20true%2C%0A%20%20%20%20%2F%2F%20%E7%A9%BA%E9%97%B2%E7%9A%84%20KeepAlive%20socket%20%E6%9C%80%E9%95%BF%E5%8F%AF%E4%BB%A5%E5%AD%98%E6%B4%BB%204%20%E7%A7%92%0A%20%20%20%20freeSocketKeepAliveTimeout%3A%204000%2C%0A%20%20%20%20%2F%2F%20%E5%BD%93%20socket%20%E8%B6%85%E8%BF%87%2030%20%E7%A7%92%E9%83%BD%E6%B2%A1%E6%9C%89%E4%BB%BB%E4%BD%95%E6%B4%BB%E5%8A%A8%EF%BC%8C%E5%B0%B1%E4%BC%9A%E8%A2%AB%E5%BD%93%E4%BD%9C%E8%B6%85%E6%97%B6%E5%A4%84%E7%90%86%E6%8E%89%0A%20%20%20%20timeout%3A%2030000%2C%0A%20%20%20%20%2F%2F%20%E5%85%81%E8%AE%B8%E5%88%9B%E5%BB%BA%E7%9A%84%E6%9C%80%E5%A4%A7%20socket%20%E6%95%B0%0A%20%20%20%20maxSockets%3A%20Number.MAX_SAFE_INTEGER%2C%0A%20%20%20%20%2F%2F%20%E6%9C%80%E5%A4%A7%E7%A9%BA%E9%97%B2%20socket%20%E6%95%B0%0A%20%20%20%20maxFreeSockets%3A%20256%2C%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%E5%BA%94%E7%94%A8%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20%60config%2Fconfig.default.js%60%20%E8%A6%86%E7%9B%96%E6%AD%A4%E9%85%8D%E7%BD%AE%E3%80%82%0A%0A%23%23%23%20%60data%3A%20Object%60%0A%0A%E9%9C%80%E8%A6%81%E5%8F%91%E9%80%81%E7%9A%84%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE%EF%BC%8C%E6%A0%B9%E6%8D%AE%20%60method%60%20%E8%87%AA%E5%8A%A8%E9%80%89%E6%8B%A9%E6%AD%A3%E7%A1%AE%E7%9A%84%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F%E3%80%82%0A%0A-%20GET%EF%BC%8CHEAD%EF%BC%9A%E9%80%9A%E8%BF%87%20%60querystring.stringify(data)%60%20%E5%A4%84%E7%90%86%E5%90%8E%E6%8B%BC%E6%8E%A5%E5%88%B0%20url%20%E7%9A%84%20query%20%E5%8F%82%E6%95%B0%E4%B8%8A%E3%80%82%0A-%20POST%EF%BC%8CPUT%20%E5%92%8C%20DELETE%20%E7%AD%89%EF%BC%9A%E9%9C%80%E8%A6%81%E6%A0%B9%E6%8D%AE%20%60contentType%60%20%E5%81%9A%E8%BF%9B%E4%B8%80%E6%AD%A5%E5%88%A4%E6%96%AD%E5%A4%84%E7%90%86%E3%80%82%0A%20%20-%20%60contentType%20%3D%20json%60%EF%BC%9A%E9%80%9A%E8%BF%87%20%60JSON.stringify(data)%60%20%E5%A4%84%E7%90%86%EF%BC%8C%E5%B9%B6%E8%AE%BE%E7%BD%AE%E4%B8%BA%20body%20%E5%8F%91%E9%80%81%E3%80%82%0A%20%20-%20%E5%85%B6%E4%BB%96%EF%BC%9A%E9%80%9A%E8%BF%87%20%60querystring.stringify(data)%60%20%E5%A4%84%E7%90%86%EF%BC%8C%E5%B9%B6%E8%AE%BE%E7%BD%AE%E4%B8%BA%20body%20%E5%8F%91%E9%80%81%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20GET%20%2B%20data%0Actx.curl(url%2C%20%7B%0A%20%20data%3A%20%7B%20foo%3A%20'bar'%20%7D%2C%0A%7D)%3B%0A%0A%2F%2F%20POST%20%2B%20data%0Actx.curl(url%2C%20%7B%0A%20%20method%3A%20'POST'%2C%0A%20%20data%3A%20%7B%20foo%3A%20'bar'%20%7D%2C%0A%7D)%3B%0A%0A%2F%2F%20POST%20%2B%20JSON%20%2B%20data%0Actx.curl(url%2C%20%7B%0A%20%20method%3A%20'POST'%2C%0A%20%20contentType%3A%20'json'%2C%0A%20%20data%3A%20%7B%20foo%3A%20'bar'%20%7D%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%20%60dataAsQueryString%3A%20Boolean%60%0A%0A%E5%A6%82%E6%9E%9C%E8%AE%BE%E7%BD%AE%E4%BA%86%20%60dataAsQueryString%3Dtrue%60%EF%BC%8C%E9%82%A3%E4%B9%88%E5%8D%B3%E4%BD%BF%E5%9C%A8%20POST%20%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%0A%E4%B9%9F%E4%BC%9A%E5%BC%BA%E5%88%B6%E5%B0%86%20%60options.data%60%20%E4%BB%A5%20%60querystring.stringify%60%20%E5%A4%84%E7%90%86%E4%B9%8B%E5%90%8E%E6%8B%BC%E6%8E%A5%E5%88%B0%20%60url%60%20%E7%9A%84%20query%20%E5%8F%82%E6%95%B0%E4%B8%8A%E3%80%82%0A%0A%E5%8F%AF%E4%BB%A5%E5%BE%88%E5%A5%BD%E5%9C%B0%E8%A7%A3%E5%86%B3%E4%BB%A5%20%60stream%60%20%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE%EF%BC%8C%E4%B8%94%E9%A2%9D%E5%A4%96%E7%9A%84%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E4%BB%A5%20%60url%60%20query%20%E5%BD%A2%E5%BC%8F%E4%BC%A0%E9%80%92%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9A%0A%0A%60%60%60js%0Actx.curl(url%2C%20%7B%0A%20%20method%3A%20'POST'%2C%0A%20%20dataAsQueryString%3A%20true%2C%0A%20%20data%3A%20%7B%0A%20%20%20%20%2F%2F%20%E4%B8%80%E8%88%AC%E6%9D%A5%E8%AF%B4%E9%83%BD%E6%98%AF%20access%20token%20%E4%B9%8B%E7%B1%BB%E7%9A%84%E6%9D%83%E9%99%90%E9%AA%8C%E8%AF%81%E5%8F%82%E6%95%B0%0A%20%20%20%20accessToken%3A%20'some%20access%20token%20value'%2C%0A%20%20%7D%2C%0A%20%20stream%3A%20myFileStream%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%20%60content%3A%20String%7CBuffer%60%0A%0A%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82%E6%AD%A3%E6%96%87%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%AE%BE%E7%BD%AE%E4%BA%86%E6%AD%A4%E5%8F%82%E6%95%B0%EF%BC%8C%E9%82%A3%E4%B9%88%E4%BC%9A%E7%9B%B4%E6%8E%A5%E5%BF%BD%E7%95%A5%20%60data%60%20%E5%8F%82%E6%95%B0%E3%80%82%0A%0A%60%60%60js%0Actx.curl(url%2C%20%7B%0A%20%20method%3A%20'POST'%2C%0A%20%20%2F%2F%20%E7%9B%B4%E6%8E%A5%E5%8F%91%E9%80%81%E5%8E%9F%E5%A7%8B%20xml%20%E6%95%B0%E6%8D%AE%EF%BC%8C%E4%B8%8D%E9%9C%80%E8%A6%81%20HttpClient%20%E5%81%9A%E7%89%B9%E6%AE%8A%E5%A4%84%E7%90%86%0A%20%20content%3A%20'%3Cxml%3E%3Chello%3Eworld%3C%2Fhello%3E%3C%2Fxml%3E'%2C%0A%20%20headers%3A%20%7B%0A%20%20%20%20'content-type'%3A%20'text%2Fhtml'%2C%0A%20%20%7D%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%20%60stream%3A%20ReadStream%60%0A%0A%E8%AE%BE%E7%BD%AE%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82%E6%AD%A3%E6%96%87%E7%9A%84%E5%8F%AF%E8%AF%BB%E6%95%B0%E6%8D%AE%E6%B5%81%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%98%AF%20%60null%60%E3%80%82%0A%E4%B8%80%E6%97%A6%E8%AE%BE%E7%BD%AE%E4%BA%86%E6%AD%A4%E5%8F%82%E6%95%B0%EF%BC%8CHttpClient%20%E5%B0%86%E4%BC%9A%E5%BF%BD%E7%95%A5%20%60data%60%20%E5%92%8C%20%60content%60%E3%80%82%0A%0A%60%60%60js%0Actx.curl(url%2C%20%7B%0A%20%20method%3A%20'POST'%2C%0A%20%20stream%3A%20fs.createReadStream('%2Fpath%2Fto%2Fread')%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%20%60writeStream%3A%20WriteStream%60%0A%0A%E8%AE%BE%E7%BD%AE%E6%8E%A5%E5%8F%97%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8F%AF%E5%86%99%E6%95%B0%E6%8D%AE%E6%B5%81%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%98%AF%20%60null%60%E3%80%82%0A%E4%B8%80%E6%97%A6%E8%AE%BE%E7%BD%AE%E6%AD%A4%E5%8F%82%E6%95%B0%EF%BC%8C%E9%82%A3%E4%B9%88%E8%BF%94%E5%9B%9E%E5%80%BC%20%60result.data%60%20%E5%B0%86%E4%BC%9A%E8%A2%AB%E8%AE%BE%E7%BD%AE%E4%B8%BA%20%60null%60%EF%BC%8C%0A%E5%9B%A0%E4%B8%BA%E6%95%B0%E6%8D%AE%E5%B7%B2%E7%BB%8F%E5%85%A8%E9%83%A8%E5%86%99%E5%85%A5%E5%88%B0%20%60writeStream%60%20%E4%B8%AD%E4%BA%86%E3%80%82%0A%0A%60%60%60js%0Actx.curl(url%2C%20%7B%0A%20%20writeStream%3A%20fs.createWriteStream('%2Fpath%2Fto%2Fstore')%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%20%60consumeWriteStream%3A%20Boolean%60%0A%0A%E6%98%AF%E5%90%A6%E7%AD%89%E5%BE%85%20%60writeStream%60%20%E5%AE%8C%E5%85%A8%E5%86%99%E5%AE%8C%E6%89%8D%E7%AE%97%E5%93%8D%E5%BA%94%E5%85%A8%E9%83%A8%E6%8E%A5%E6%94%B6%E5%AE%8C%E6%AF%95%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%98%AF%20%60true%60%E3%80%82%0A%E6%AD%A4%E5%8F%82%E6%95%B0%E4%B8%8D%E5%BB%BA%E8%AE%AE%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E5%80%BC%EF%BC%8C%E9%99%A4%E9%9D%9E%E6%88%91%E4%BB%AC%E6%98%8E%E7%A1%AE%E7%9F%A5%E9%81%93%E5%AE%83%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8%E6%98%AF%E5%8F%AF%E6%8E%A5%E5%8F%97%E7%9A%84%EF%BC%8C%0A%E5%90%A6%E5%88%99%E5%BE%88%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%AF%BC%E8%87%B4%20%60writeStream%60%20%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%AE%8C%E6%95%B4%E3%80%82%0A%0A%23%23%23%20%60method%3A%20String%60%0A%0A%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%98%AF%20%60GET%60%E3%80%82%0A%E6%94%AF%E6%8C%81%20%60GET%E3%80%81POST%E3%80%81PUT%E3%80%81DELETE%E3%80%81PATCH%60%20%E7%AD%89%5B%E6%89%80%E6%9C%89%20HTTP%20%E6%96%B9%E6%B3%95%5D(https%3A%2F%2Fnodejs.org%2Fapi%2Fhttp.html%23http_http_methods)%E3%80%82%0A%0A%23%23%23%20%60contentType%3A%20String%60%0A%0A%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%98%AF%20%60undefined%60%EF%BC%8CHttpClient%20%E4%BC%9A%E8%87%AA%E5%8A%A8%E6%A0%B9%E6%8D%AE%20%60data%60%20%E5%92%8C%20%60content%60%20%E5%8F%82%E6%95%B0%E8%87%AA%E5%8A%A8%E8%AE%BE%E7%BD%AE%E3%80%82%0A%60data%60%20%E6%98%AF%20object%20%E7%9A%84%E6%97%B6%E5%80%99%E9%BB%98%E8%AE%A4%E8%AE%BE%E7%BD%AE%E7%9A%84%E6%98%AF%20%60form%60%E3%80%82%E6%94%AF%E6%8C%81%20%60json%60%20%E6%A0%BC%E5%BC%8F%E3%80%82%0A%0A%E5%A6%82%E9%9C%80%E8%A6%81%E4%BB%A5%20JSON%20%E6%A0%BC%E5%BC%8F%E5%8F%91%E9%80%81%20%60data%60%EF%BC%9A%0A%0A%60%60%60js%0Actx.curl(url%2C%20%7B%0A%20%20method%3A%20'POST'%2C%0A%20%20data%3A%20%7B%0A%20%20%20%20foo%3A%20'bar'%2C%0A%20%20%20%20now%3A%20Date.now()%2C%0A%20%20%7D%2C%0A%20%20contentType%3A%20'json'%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%20%60dataType%3A%20String%60%0A%0A%E8%AE%BE%E7%BD%AE%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%EF%BC%8C%E9%BB%98%E8%AE%A4%E4%B8%8D%E5%AF%B9%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E5%81%9A%E4%BB%BB%E4%BD%95%E5%A4%84%E7%90%86%EF%BC%8C%E7%9B%B4%E6%8E%A5%E8%BF%94%E5%9B%9E%E5%8E%9F%E5%A7%8B%E7%9A%84%20buffer%20%E6%A0%BC%E5%BC%8F%E6%95%B0%E6%8D%AE%E3%80%82%0A%E6%94%AF%E6%8C%81%20%60text%60%20%E5%92%8C%20%60json%60%20%E4%B8%A4%E7%A7%8D%E6%A0%BC%E5%BC%8F%E3%80%82%0A%0A**%E6%B3%A8%E6%84%8F%EF%BC%9A%E8%AE%BE%E7%BD%AE%E6%88%90%20%60json%60%20%E6%97%B6%EF%BC%8C%E5%A6%82%E6%9E%9C%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90%E5%A4%B1%E8%B4%A5%E4%BC%9A%E6%8A%9B%20%60JSONResponseFormatError%60%20%E5%BC%82%E5%B8%B8%E3%80%82**%0A%0A%60%60%60js%0Aconst%20jsonResult%20%3D%20await%20ctx.curl(url%2C%20%7B%0A%20%20dataType%3A%20'json'%2C%0A%7D)%3B%0Aconsole.log(jsonResult.data)%3B%0A%0Aconst%20htmlResult%20%3D%20await%20ctx.curl(url%2C%20%7B%0A%20%20dataType%3A%20'text'%2C%0A%7D)%3B%0Aconsole.log(htmlResult.data)%3B%0A%60%60%60%0A%0A%23%23%23%20%60fixJSONCtlChars%3A%20Boolean%60%0A%0A%E6%98%AF%E5%90%A6%E8%87%AA%E5%8A%A8%E8%BF%87%E6%BB%A4%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E4%B8%AD%E7%9A%84%E7%89%B9%E6%AE%8A%E6%8E%A7%E5%88%B6%E5%AD%97%E7%AC%A6%20(U%2B0000%20~%20U%2B001F)%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%98%AF%20%60false%60%E3%80%82%0A%E9%80%9A%E5%B8%B8%E4%B8%80%E4%BA%9B%20CGI%20%E7%B3%BB%E7%BB%9F%E8%BF%94%E5%9B%9E%E7%9A%84%20JSON%20%E6%95%B0%E6%8D%AE%E4%BC%9A%E5%8C%85%E5%90%AB%E8%BF%99%E4%BA%9B%E7%89%B9%E6%AE%8A%E6%8E%A7%E5%88%B6%E5%AD%97%E7%AC%A6%EF%BC%8C%E9%80%9A%E8%BF%87%E6%AD%A4%E5%8F%82%E6%95%B0%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%8A%A8%E8%BF%87%E6%BB%A4%E6%8E%89%E5%AE%83%E4%BB%AC%E3%80%82%0A%0A%60%60%60js%0Actx.curl(url%2C%20%7B%0A%20%20fixJSONCtlChars%3A%20true%2C%0A%20%20dataType%3A%20'json'%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%20%60headers%3A%20Object%60%0A%0A%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%B7%E6%B1%82%E5%A4%B4%E3%80%82%0A%0A%60%60%60js%0Actx.curl(url%2C%20%7B%0A%20%20headers%3A%20%7B%0A%20%20%20%20'x-foo'%3A%20'bar'%2C%0A%20%20%7D%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%20%60timeout%3A%20Number%7CArray%60%0A%0A%E8%AF%B7%E6%B1%82%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%98%AF%20%60%5B%205000%2C%205000%20%5D%60%EF%BC%8C%E5%8D%B3%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6%E6%98%AF%205%20%E7%A7%92%EF%BC%8C%E6%8E%A5%E6%94%B6%E5%93%8D%E5%BA%94%E8%B6%85%E6%97%B6%E6%98%AF%205%20%E7%A7%92%E3%80%82%0A%0A%60%60%60js%0Actx.curl(url%2C%20%7B%0A%20%20%2F%2F%20%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6%203%20%E7%A7%92%EF%BC%8C%E6%8E%A5%E6%94%B6%E5%93%8D%E5%BA%94%E8%B6%85%E6%97%B6%203%20%E7%A7%92%0A%20%20timeout%3A%203000%2C%0A%7D)%3B%0A%0Actx.curl(url%2C%20%7B%0A%20%20%2F%2F%20%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6%201%20%E7%A7%92%EF%BC%8C%E6%8E%A5%E6%94%B6%E5%93%8D%E5%BA%94%E8%B6%85%E6%97%B6%2030%20%E7%A7%92%EF%BC%8C%E7%94%A8%E4%BA%8E%E5%93%8D%E5%BA%94%E6%AF%94%E8%BE%83%E5%A4%A7%E7%9A%84%E5%9C%BA%E6%99%AF%0A%20%20timeout%3A%20%5B%201000%2C%2030000%20%5D%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%20%60agent%3A%20HttpAgent%60%0A%0A%E5%85%81%E8%AE%B8%E9%80%9A%E8%BF%87%E6%AD%A4%E5%8F%82%E6%95%B0%E8%A6%86%E7%9B%96%E9%BB%98%E8%AE%A4%E7%9A%84%20HttpAgent%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%BD%A0%E4%B8%8D%E6%83%B3%E5%BC%80%E5%90%AF%20KeepAlive%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%AE%BE%E7%BD%AE%E6%AD%A4%E5%8F%82%E6%95%B0%E4%B8%BA%20%60false%60%E3%80%82%0A%0A%60%60%60js%0Actx.curl(url%2C%20%7B%0A%20%20agent%3A%20false%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%20%60httpsAgent%3A%20HttpsAgent%60%0A%0A%E5%85%81%E8%AE%B8%E9%80%9A%E8%BF%87%E6%AD%A4%E5%8F%82%E6%95%B0%E8%A6%86%E7%9B%96%E9%BB%98%E8%AE%A4%E7%9A%84%20HttpsAgent%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%BD%A0%E4%B8%8D%E6%83%B3%E5%BC%80%E5%90%AF%20KeepAlive%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%AE%BE%E7%BD%AE%E6%AD%A4%E5%8F%82%E6%95%B0%E4%B8%BA%20%60false%60%E3%80%82%0A%0A%60%60%60js%0Actx.curl(url%2C%20%7B%0A%20%20httpsAgent%3A%20false%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%20%60auth%3A%20String%60%0A%0A%E7%AE%80%E5%8D%95%E7%99%BB%E5%BD%95%E6%8E%88%E6%9D%83%EF%BC%88Basic%20Authentication%EF%BC%89%E5%8F%82%E6%95%B0%EF%BC%8C%E5%B0%86%E4%BB%A5%E6%98%8E%E6%96%87%E6%96%B9%E5%BC%8F%E5%B0%86%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E4%BB%A5%20%60Authorization%60%20%E8%AF%B7%E6%B1%82%E5%A4%B4%E5%8F%91%E9%80%81%E5%87%BA%E5%8E%BB%E3%80%82%0A%0A%60%60%60js%0Actx.curl(url%2C%20%7B%0A%20%20%2F%2F%20%E5%8F%82%E6%95%B0%E5%BF%85%E9%A1%BB%E6%8C%89%E7%85%A7%20%60user%3Apassword%60%20%E6%A0%BC%E5%BC%8F%E8%AE%BE%E7%BD%AE%0A%20%20auth%3A%20'foo%3Abar'%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%20%60digestAuth%3A%20String%60%0A%0A%E6%91%98%E8%A6%81%E7%99%BB%E5%BD%95%E6%8E%88%E6%9D%83%EF%BC%88Digest%20Authentication%EF%BC%89%E5%8F%82%E6%95%B0%EF%BC%8C%E8%AE%BE%E7%BD%AE%E6%AD%A4%E5%8F%82%E6%95%B0%E4%BC%9A%E8%87%AA%E5%8A%A8%E5%AF%B9%20401%20%E5%93%8D%E5%BA%94%E5%B0%9D%E8%AF%95%E7%94%9F%E6%88%90%20%60Authorization%60%20%E8%AF%B7%E6%B1%82%E5%A4%B4%EF%BC%8C%0A%E5%B0%9D%E8%AF%95%E4%BB%A5%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F%E8%AF%B7%E6%B1%82%E4%B8%80%E6%AC%A1%E3%80%82%0A%0A%60%60%60js%0Actx.curl(url%2C%20%7B%0A%20%20%2F%2F%20%E5%8F%82%E6%95%B0%E5%BF%85%E9%A1%BB%E6%8C%89%E7%85%A7%20%60user%3Apassword%60%20%E6%A0%BC%E5%BC%8F%E8%AE%BE%E7%BD%AE%0A%20%20digestAuth%3A%20'foo%3Abar'%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%20%60followRedirect%3A%20Boolean%60%0A%0A%E6%98%AF%E5%90%A6%E8%87%AA%E5%8A%A8%E8%B7%9F%E8%BF%9B%203xx%20%E7%9A%84%E8%B7%B3%E8%BD%AC%E5%93%8D%E5%BA%94%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%98%AF%20%60false%60%E3%80%82%0A%0A%60%60%60js%0Actx.curl(url%2C%20%7B%0A%20%20followRedirect%3A%20true%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%20%60maxRedirects%3A%20Number%60%0A%0A%E8%AE%BE%E7%BD%AE%E6%9C%80%E5%A4%A7%E8%87%AA%E5%8A%A8%E8%B7%B3%E8%BD%AC%E6%AC%A1%E6%95%B0%EF%BC%8C%E9%81%BF%E5%85%8D%E5%BE%AA%E7%8E%AF%E8%B7%B3%E8%BD%AC%E6%97%A0%E6%B3%95%E7%BB%88%E6%AD%A2%EF%BC%8C%E9%BB%98%E8%AE%A4%E6%98%AF%2010%20%E6%AC%A1%E3%80%82%0A%E6%AD%A4%E5%8F%82%E6%95%B0%E4%B8%8D%E5%AE%9C%E8%AE%BE%E7%BD%AE%E8%BF%87%E5%A4%A7%EF%BC%8C%E5%AE%83%E5%8F%AA%E5%9C%A8%20%60followRedirect%3Dtrue%60%20%E6%83%85%E5%86%B5%E4%B8%8B%E6%89%8D%E4%BC%9A%E7%94%9F%E6%95%88%E3%80%82%0A%0A%60%60%60js%0Actx.curl(url%2C%20%7B%0A%20%20followRedirect%3A%20true%2C%0A%20%20%2F%2F%20%E6%9C%80%E5%A4%A7%E5%8F%AA%E5%85%81%E8%AE%B8%E8%87%AA%E5%8A%A8%E8%B7%B3%E8%BD%AC%205%20%E6%AC%A1%E3%80%82%0A%20%20maxRedirects%3A%205%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%20%60formatRedirectUrl%3A%20Function(from%2C%20to)%60%0A%0A%E5%85%81%E8%AE%B8%E6%88%91%E4%BB%AC%E9%80%9A%E8%BF%87%20%60formatRedirectUrl%60%20%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%9E%E7%8E%B0%20302%E3%80%81301%20%E7%AD%89%E8%B7%B3%E8%BD%AC%20url%20%E6%8B%BC%E6%8E%A5%EF%BC%8C%20%E9%BB%98%E8%AE%A4%E6%98%AF%20%60url.resolve(from%2C%20to)%60%E3%80%82%0A%0A%60%60%60js%0Actx.curl(url%2C%20%7B%0A%20%20formatRedirectUrl%3A%20(from%2C%20to)%20%3D%3E%20%7B%0A%20%20%20%20%2F%2F%20%E4%BE%8B%E5%A6%82%E5%8F%AF%E5%9C%A8%E8%BF%99%E9%87%8C%E4%BF%AE%E6%AD%A3%E8%B7%B3%E8%BD%AC%E4%B8%8D%E6%AD%A3%E7%A1%AE%E7%9A%84%20url%0A%20%20%20%20if%20(to%20%3D%3D%3D%20'%2F%2Ffoo%2F')%20%7B%0A%20%20%20%20%20%20to%20%3D%20'%2Ffoo'%3B%0A%20%20%20%20%7D%0A%20%20%20%20return%20url.resolve(from%2C%20to)%3B%0A%20%20%7D%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%20%60beforeRequest%3A%20Function(options)%60%0A%0AHttpClient%20%E5%9C%A8%E8%AF%B7%E6%B1%82%E6%AD%A3%E5%BC%8F%E5%8F%91%E9%80%81%E4%B9%8B%E5%89%8D%EF%BC%8C%E4%BC%9A%E5%B0%9D%E8%AF%95%E8%B0%83%E7%94%A8%20%60beforeRequest%60%20%E9%92%A9%E5%AD%90%EF%BC%8C%E5%85%81%E8%AE%B8%E6%88%91%E4%BB%AC%E5%9C%A8%E8%BF%99%E9%87%8C%E5%AF%B9%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E5%81%9A%E6%9C%80%E5%90%8E%E4%B8%80%E6%AC%A1%E4%BF%AE%E6%94%B9%E3%80%82%0A%0A%60%60%60js%0Actx.curl(url%2C%20%7B%0A%20%20beforeRequest%3A%20options%20%3D%3E%20%7B%0A%20%20%20%20%2F%2F%20%E4%BE%8B%E5%A6%82%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E8%AE%BE%E7%BD%AE%E5%85%A8%E5%B1%80%E8%AF%B7%E6%B1%82%20id%EF%BC%8C%E6%96%B9%E4%BE%BF%E6%97%A5%E5%BF%97%E8%B7%9F%E8%B8%AA%0A%20%20%20%20options.headers%5B'x-request-id'%5D%20%3D%20uuid.v1()%3B%0A%20%20%7D%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%20%60streaming%3A%20Boolean%60%0A%0A%E6%98%AF%E5%90%A6%E7%9B%B4%E6%8E%A5%E8%BF%94%E5%9B%9E%E5%93%8D%E5%BA%94%E6%B5%81%EF%BC%8C%E9%BB%98%E8%AE%A4%E4%B8%BA%20%60false%60%E3%80%82%0A%E5%BC%80%E5%90%AF%20streaming%20%E4%B9%8B%E5%90%8E%EF%BC%8CHttpClient%20%E4%BC%9A%E5%9C%A8%E6%8B%BF%E5%88%B0%E5%93%8D%E5%BA%94%E5%AF%B9%E8%B1%A1%20res%20%E4%B9%8B%E5%90%8E%E9%A9%AC%E4%B8%8A%E8%BF%94%E5%9B%9E%EF%BC%8C%0A%E6%AD%A4%E6%97%B6%20%60result.headers%60%20%E5%92%8C%20%60result.status%60%20%E5%B7%B2%E7%BB%8F%E5%8F%AF%E4%BB%A5%E8%AF%BB%E5%8F%96%E5%88%B0%EF%BC%8C%E5%8F%AA%E6%98%AF%E6%B2%A1%E6%9C%89%E8%AF%BB%E5%8F%96%20data%20%E6%95%B0%E6%8D%AE%E8%80%8C%E5%B7%B2%E3%80%82%0A%0A%60%60%60js%0Aconst%20result%20%3D%20await%20ctx.curl(url%2C%20%7B%0A%20%20streaming%3A%20true%2C%0A%7D)%3B%0A%0Aconsole.log(result.status%2C%20result.data)%3B%0A%2F%2F%20result.res%20%E6%98%AF%E4%B8%80%E4%B8%AA%20ReadStream%20%E5%AF%B9%E8%B1%A1%0Actx.body%20%3D%20result.res%3B%0A%60%60%60%0A%0A**%E6%B3%A8%E6%84%8F%EF%BC%9A%E5%A6%82%E6%9E%9C%20res%20%E4%B8%8D%E6%98%AF%E7%9B%B4%E6%8E%A5%E4%BC%A0%E9%80%92%E7%BB%99%20body%EF%BC%8C%E9%82%A3%E4%B9%88%E6%88%91%E4%BB%AC%E5%BF%85%E9%A1%BB%E6%B6%88%E8%B4%B9%E8%BF%99%E4%B8%AA%20stream%EF%BC%8C%E5%B9%B6%E4%B8%94%E8%A6%81%E5%81%9A%E5%A5%BD%20error%20%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E3%80%82**%0A%0A%23%23%23%20%60gzip%3A%20Boolean%60%0A%0A%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81%20gzip%20%E5%93%8D%E5%BA%94%E6%A0%BC%E5%BC%8F%EF%BC%8C%E9%BB%98%E8%AE%A4%E4%B8%BA%20%60false%60%E3%80%82%0A%E5%BC%80%E5%90%AF%20gzip%20%E4%B9%8B%E5%90%8E%EF%BC%8CHttpClient%20%E5%B0%86%E8%87%AA%E5%8A%A8%E8%AE%BE%E7%BD%AE%20%60Accept-Encoding%3A%20gzip%60%20%E8%AF%B7%E6%B1%82%E5%A4%B4%EF%BC%8C%0A%E5%B9%B6%E4%B8%94%E4%BC%9A%E8%87%AA%E5%8A%A8%E8%A7%A3%E5%8E%8B%E5%B8%A6%20%60Content-Encoding%3A%20gzip%60%20%E5%93%8D%E5%BA%94%E5%A4%B4%E7%9A%84%E6%95%B0%E6%8D%AE%E3%80%82%0A%0A%60%60%60js%0Actx.curl(url%2C%20%7B%0A%20%20gzip%3A%20true%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%20%60timing%3A%20Boolean%60%0A%0A%E6%98%AF%E5%90%A6%E5%BC%80%E5%90%AF%E8%AF%B7%E6%B1%82%E5%90%84%E9%98%B6%E6%AE%B5%E7%9A%84%E6%97%B6%E9%97%B4%E6%B5%8B%E9%87%8F%EF%BC%8C%E9%BB%98%E8%AE%A4%E4%B8%BA%20%60false%60%E3%80%82%0A%E5%BC%80%E5%90%AF%20timing%20%E4%B9%8B%E5%90%8E%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%20%60result.res.timing%60%20%E6%8B%BF%E5%88%B0%E8%BF%99%E6%AC%A1%20HTTP%20%E8%AF%B7%E6%B1%82%E5%90%84%E9%98%B6%E6%AE%B5%E7%9A%84%E6%97%B6%E9%97%B4%E6%B5%8B%E9%87%8F%E5%80%BC%EF%BC%88%E5%8D%95%E4%BD%8D%E6%98%AF%E6%AF%AB%E7%A7%92%EF%BC%89%EF%BC%8C%0A%E9%80%9A%E8%BF%87%E8%BF%99%E4%BA%9B%E6%B5%8B%E9%87%8F%E5%80%BC%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%9D%9E%E5%B8%B8%E6%96%B9%E4%BE%BF%E5%9C%B0%E5%AE%9A%E4%BD%8D%E5%88%B0%E8%BF%99%E6%AC%A1%E8%AF%B7%E6%B1%82%E6%9C%80%E6%85%A2%E7%9A%84%E7%8E%AF%E5%A2%83%E5%8F%91%E7%94%9F%E5%9C%A8%E9%82%A3%E4%B8%AA%E9%98%B6%E6%AE%B5%EF%BC%8C%E6%95%88%E6%9E%9C%E5%A6%82%E5%90%8C%20Chrome%20network%20timing%20%E7%9A%84%E4%BD%9C%E7%94%A8%E3%80%82%0A%0Atiming%20%E5%90%84%E9%98%B6%E6%AE%B5%E6%B5%8B%E9%87%8F%E5%80%BC%E8%A7%A3%E6%9E%90%EF%BC%9A%0A-%20queuing%EF%BC%9A%E5%88%86%E9%85%8D%20socket%20%E8%80%97%E6%97%B6%0A-%20dnslookup%EF%BC%9ADNS%20%E6%9F%A5%E8%AF%A2%E8%80%97%E6%97%B6%0A-%20connected%EF%BC%9Asocket%20%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E8%BF%9E%E6%8E%A5%E6%88%90%E5%8A%9F%E8%80%97%E6%97%B6%0A-%20requestSent%EF%BC%9A%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E5%8F%91%E9%80%81%E5%AE%8C%E6%AF%95%E8%80%97%E6%97%B6%0A-%20waiting%EF%BC%9A%E6%94%B6%E5%88%B0%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%AD%97%E8%8A%82%E7%9A%84%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E8%80%97%E6%97%B6%0A-%20contentDownload%EF%BC%9A%E5%85%A8%E9%83%A8%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E6%8E%A5%E6%94%B6%E5%AE%8C%E6%AF%95%E8%80%97%E6%97%B6%0A%0A%60%60%60js%0Aconst%20result%20%3D%20await%20ctx.curl(url%2C%20%7B%0A%20%20timing%3A%20true%2C%0A%7D)%3B%0Aconsole.log(result.res.timing)%3B%0A%2F%2F%20%7B%0A%2F%2F%20%20%20%22queuing%22%3A29%2C%0A%2F%2F%20%20%20%22dnslookup%22%3A37%2C%0A%2F%2F%20%20%20%22connected%22%3A370%2C%0A%2F%2F%20%20%20%22requestSent%22%3A1001%2C%0A%2F%2F%20%20%20%22waiting%22%3A1833%2C%0A%2F%2F%20%20%20%22contentDownload%22%3A3416%0A%2F%2F%20%7D%0A%60%60%60%0A%0A%23%23%23%20%60ca%EF%BC%8CrejectUnauthorized%EF%BC%8Cpfx%EF%BC%8Ckey%EF%BC%8Ccert%EF%BC%8Cpassphrase%EF%BC%8Cciphers%EF%BC%8CsecureProtocol%60%0A%0A%E8%BF%99%E5%87%A0%E4%B8%AA%E9%83%BD%E6%98%AF%E9%80%8F%E4%BC%A0%E7%BB%99%20%5BHTTPS%5D%20%E6%A8%A1%E5%9D%97%E7%9A%84%E5%8F%82%E6%95%B0%EF%BC%8C%E5%85%B7%E4%BD%93%E8%AF%B7%E6%9F%A5%E7%9C%8B%20%5B%60https.request(options%2C%20callback)%60%5D(https%3A%2F%2Fnodejs.org%2Fapi%2Fhttps.html%23https_https_request_options_callback)%E3%80%82%0A%0A%23%23%20%E8%B0%83%E8%AF%95%E8%BE%85%E5%8A%A9%0A%0A%E6%A1%86%E6%9E%B6%E8%BF%98%E6%8F%90%E4%BE%9B%E4%BA%86%20%5Begg-development-proxyagent%5D%20%E6%8F%92%E4%BB%B6%E6%9D%A5%E6%96%B9%E4%BE%BF%E5%BC%80%E5%8F%91%E8%80%85%E8%B0%83%E8%AF%95%E3%80%82%0A%0A%E5%85%88%E5%AE%89%E8%A3%85%E5%92%8C%E5%BC%80%E5%90%AF%E6%8F%92%E4%BB%B6%EF%BC%9A%0A%0A%60%60%60bash%0A%24%20npm%20i%20egg-development-proxyagent%20--save%0A%60%60%60%0A%0A%60%60%60js%0A%2F%2F%20config%2Fplugin.js%0Aexports.proxyagent%20%3D%20%7B%0A%20%20enable%3A%20true%2C%0A%20%20package%3A%20'egg-development-proxyagent'%2C%0A%7D%0A%60%60%60%0A%0A%E5%BC%80%E5%90%AF%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%94%A8%20%5Bcharles%5D%20%E6%88%96%20%5Bfiddler%5D%EF%BC%8C%E6%AD%A4%E5%A4%84%E6%88%91%E4%BB%AC%E7%94%A8%20%5Banyproxy%5D%20%E6%9D%A5%E6%BC%94%E7%A4%BA%E4%B8%8B%E3%80%82%0A%0A%60%60%60bash%0A%24%20npm%20install%20anyproxy%20-g%0A%24%20anyproxy%20--port%208888%0A%60%60%60%0A%0A%E4%BD%BF%E7%94%A8%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%90%AF%E5%8A%A8%E5%BA%94%E7%94%A8%EF%BC%9A%0A%0A%60%60%60bash%0A%24%20http_proxy%3Dhttp%3A%2F%2F127.0.0.1%3A8888%20npm%20run%20dev%0A%60%60%60%0A%0A%E7%84%B6%E5%90%8E%E5%B0%B1%E5%8F%AF%E4%BB%A5%E6%AD%A3%E5%B8%B8%E6%93%8D%E4%BD%9C%E4%BA%86%EF%BC%8C%E6%89%80%E6%9C%89%E7%BB%8F%E8%BF%87%20HttpClient%20%E7%9A%84%E8%AF%B7%E6%B1%82%EF%BC%8C%E9%83%BD%E5%8F%AF%E4%BB%A5%E5%9C%A8%20http%3A%2F%2Flocalhost%3A8002%20%E8%BF%99%E4%B8%AA%E6%8E%A7%E5%88%B6%E5%8F%B0%E4%B8%AD%E6%9F%A5%E7%9C%8B%E5%88%B0%E3%80%82%0A%0A!%5Banyproxy%5D(https%3A%2F%2Fcloud.githubusercontent.com%2Fassets%2F227713%2F21976937%2F06a63694-dc0f-11e6-98b5-e9e279c4867c.png)%0A%0A**%E6%B3%A8%E6%84%8F%EF%BC%9A%E8%AF%A5%E6%8F%92%E4%BB%B6%E9%BB%98%E8%AE%A4%E5%8F%AA%E5%9C%A8%20local%20%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%90%AF%E5%8A%A8%E3%80%82**%0A%0A%23%23%20%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%0A%0A%23%23%23%20%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6%0A%0A-%20%E5%BC%82%E5%B8%B8%E5%90%8D%E7%A7%B0%EF%BC%9A%60ConnectionTimeoutError%60%0A-%20%E5%87%BA%E7%8E%B0%E5%9C%BA%E6%99%AF%EF%BC%9A%E9%80%9A%E5%B8%B8%E6%98%AF%20DNS%20%E6%9F%A5%E8%AF%A2%E6%AF%94%E8%BE%83%E6%85%A2%EF%BC%8C%E6%88%96%E8%80%85%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8E%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%B9%8B%E9%97%B4%E7%9A%84%E7%BD%91%E7%BB%9C%E9%80%9F%E5%BA%A6%E6%AF%94%E8%BE%83%E6%85%A2%E5%AF%BC%E8%87%B4%E7%9A%84%E3%80%82%0A-%20%E6%8E%92%E6%9F%A5%E5%BB%BA%E8%AE%AE%EF%BC%9A%E8%AF%B7%E9%80%82%E5%BD%93%E5%A2%9E%E5%A4%A7%20%60timeout%60%20%E5%8F%82%E6%95%B0%E3%80%82%0A%0A%23%23%23%20%E6%9C%8D%E5%8A%A1%E5%93%8D%E5%BA%94%E8%B6%85%E6%97%B6%0A%0A-%20%E5%BC%82%E5%B8%B8%E5%90%8D%E7%A7%B0%EF%BC%9A%60ResponseTimeoutError%60%0A-%20%E5%87%BA%E7%8E%B0%E5%9C%BA%E6%99%AF%EF%BC%9A%E9%80%9A%E5%B8%B8%E6%98%AF%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8E%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%B9%8B%E9%97%B4%E7%BD%91%E7%BB%9C%E9%80%9F%E5%BA%A6%E6%AF%94%E8%BE%83%E6%85%A2%EF%BC%8C%E5%B9%B6%E4%B8%94%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E6%AF%94%E8%BE%83%E5%A4%A7%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E4%BC%9A%E5%8F%91%E7%94%9F%E3%80%82%0A-%20%E6%8E%92%E6%9F%A5%E5%BB%BA%E8%AE%AE%EF%BC%9A%E8%AF%B7%E9%80%82%E5%BD%93%E5%A2%9E%E5%A4%A7%20%60timeout%60%20%E5%8F%82%E6%95%B0%E3%80%82%0A%0A%23%23%23%20%E6%9C%8D%E5%8A%A1%E4%B8%BB%E5%8A%A8%E6%96%AD%E5%BC%80%E8%BF%9E%E6%8E%A5%0A%0A-%20%E5%BC%82%E5%B8%B8%E5%90%8D%E7%A7%B0%EF%BC%9A%60ResponseError%2C%20code%3A%20ECONNRESET%60%0A-%20%E5%87%BA%E7%8E%B0%E5%9C%BA%E6%99%AF%EF%BC%9A%E9%80%9A%E5%B8%B8%E6%98%AF%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%B8%BB%E5%8A%A8%E6%96%AD%E5%BC%80%20socket%20%E8%BF%9E%E6%8E%A5%EF%BC%8C%E5%AF%BC%E8%87%B4%20HTTP%20%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E5%BC%82%E5%B8%B8%E3%80%82%0A-%20%E6%8E%92%E6%9F%A5%E5%BB%BA%E8%AE%AE%EF%BC%9A%E8%AF%B7%E6%A3%80%E6%9F%A5%E5%BD%93%E6%97%B6%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%98%AF%E5%90%A6%E5%8F%91%E7%94%9F%E7%BD%91%E7%BB%9C%E5%BC%82%E5%B8%B8%E3%80%82%0A%0A%23%23%23%20%E6%9C%8D%E5%8A%A1%E4%B8%8D%E5%8F%AF%E8%BE%BE%0A%0A-%20%E5%BC%82%E5%B8%B8%E5%90%8D%E7%A7%B0%EF%BC%9A%60RequestError%2C%20code%3A%20ECONNREFUSED%2C%20status%3A%20-1%60%0A-%20%E5%87%BA%E7%8E%B0%E5%9C%BA%E6%99%AF%EF%BC%9A%E9%80%9A%E5%B8%B8%E6%98%AF%E5%9B%A0%E4%B8%BA%E8%AF%B7%E6%B1%82%E7%9A%84%20url%20%E6%89%80%E5%B1%9E%20IP%20%E6%88%96%E8%80%85%E7%AB%AF%E5%8F%A3%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5%E6%88%90%E5%8A%9F%E3%80%82%0A-%20%E6%8E%92%E6%9F%A5%E5%BB%BA%E8%AE%AE%EF%BC%9A%E8%AF%B7%E7%A1%AE%E4%BF%9D%20IP%20%E6%88%96%E8%80%85%E7%AB%AF%E5%8F%A3%E8%AE%BE%E7%BD%AE%E6%AD%A3%E7%A1%AE%E3%80%82%0A%0A%23%23%23%20%E5%9F%9F%E5%90%8D%E4%B8%8D%E5%AD%98%E5%9C%A8%0A%0A-%20%E5%BC%82%E5%B8%B8%E5%90%8D%E7%A7%B0%EF%BC%9A%60RequestError%2C%20code%3A%20ENOTFOUND%2C%20status%3A%20-1%60%0A-%20%E5%87%BA%E7%8E%B0%E5%9C%BA%E6%99%AF%EF%BC%9A%E9%80%9A%E5%B8%B8%E6%98%AF%E5%9B%A0%E4%B8%BA%E8%AF%B7%E6%B1%82%E7%9A%84%20url%20%E6%89%80%E5%9C%A8%E7%9A%84%E5%9F%9F%E5%90%8D%E6%97%A0%E6%B3%95%E9%80%9A%E8%BF%87%20DNS%20%E8%A7%A3%E6%9E%90%E6%88%90%E5%8A%9F%E3%80%82%0A-%20%E6%8E%92%E6%9F%A5%E5%BB%BA%E8%AE%AE%EF%BC%9A%E8%AF%B7%E7%A1%AE%E4%BF%9D%E5%9F%9F%E5%90%8D%E5%AD%98%E5%9C%A8%EF%BC%8C%E4%B9%9F%E9%9C%80%E8%A6%81%E6%8E%92%E6%9F%A5%E4%B8%80%E4%B8%8B%20DNS%20%E6%9C%8D%E5%8A%A1%E6%98%AF%E5%90%A6%E9%85%8D%E7%BD%AE%E6%AD%A3%E7%A1%AE%E3%80%82%0A%0A%23%23%23%20JSON%20%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E9%94%99%E8%AF%AF%0A%0A-%20%E5%BC%82%E5%B8%B8%E5%90%8D%E7%A7%B0%EF%BC%9A%60JSONResponseFormatError%60%0A-%20%E5%87%BA%E7%8E%B0%E5%9C%BA%E6%99%AF%EF%BC%9A%E8%AE%BE%E7%BD%AE%E4%BA%86%20%60dataType%3Djson%60%20%E5%B9%B6%E4%B8%94%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E4%B8%8D%E7%AC%A6%E5%90%88%20JSON%20%E6%A0%BC%E5%BC%8F%EF%BC%8C%E5%B0%B1%E4%BC%9A%E6%8A%9B%E5%87%BA%E6%AD%A4%E5%BC%82%E5%B8%B8%E3%80%82%0A-%20%E6%8E%92%E6%9F%A5%E5%BB%BA%E8%AE%AE%EF%BC%9A%E7%A1%AE%E4%BF%9D%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%97%A0%E8%AE%BA%E5%9C%A8%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E9%83%BD%E8%A6%81%E6%AD%A3%E7%A1%AE%E8%BF%94%E5%9B%9E%20JSON%20%E6%A0%BC%E5%BC%8F%E7%9A%84%E6%95%B0%E6%8D%AE%E3%80%82%0A%0A%23%23%20%E5%85%A8%E5%B1%80%20%60request%60%20%E5%92%8C%20%60response%60%20%E4%BA%8B%E4%BB%B6%0A%0A%E5%9C%A8%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%8C%E5%B8%B8%E5%B8%B8%E4%BC%9A%E6%9C%89%E7%BB%9F%E4%B8%80%20tracer%20%E6%97%A5%E5%BF%97%E7%9A%84%E9%9C%80%E6%B1%82%E3%80%82%0A%E4%B8%BA%E4%BA%86%E6%96%B9%E4%BE%BF%E5%9C%A8%20app%20%E5%B1%82%E9%9D%A2%E7%BB%9F%E4%B8%80%E7%9B%91%E5%90%AC%20HttpClient%20%E7%9A%84%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94%EF%BC%8C%E6%88%91%E4%BB%AC%E7%BA%A6%E5%AE%9A%E4%BA%86%E5%85%A8%E5%B1%80%20%60request%60%20%E5%92%8C%20%60response%60%20%E4%BA%8B%E4%BB%B6%E6%9D%A5%E6%9A%B4%E9%9C%B2%E8%BF%99%E4%B8%A4%E4%B8%AA%E6%97%B6%E6%9C%BA%E3%80%82%0A%0A%60%60%60bash%0A%20%20%20%20init%20options%0A%20%20%20%20%20%20%20%20%7C%0A%20%20%20%20%20%20%20%20V%0A%20%20%20%20emit%20%60request%60%20event%0A%20%20%20%20%20%20%20%20%7C%0A%20%20%20%20%20%20%20%20V%0A%20%20%20%20send%20request%20and%20receive%20response%0A%20%20%20%20%20%20%20%20%7C%0A%20%20%20%20%20%20%20%20V%0A%20%20%20%20emit%20%60response%60%20event%0A%20%20%20%20%20%20%20%20%7C%0A%20%20%20%20%20%20%20%20V%0A%20%20%20%20%20%20%20end%0A%60%60%60%0A%0A%23%23%23%20%60request%60%20%E4%BA%8B%E4%BB%B6%EF%BC%9A%E5%8F%91%E7%94%9F%E5%9C%A8%E7%BD%91%E7%BB%9C%E6%93%8D%E4%BD%9C%E5%8F%91%E7%94%9F%E4%B9%8B%E5%89%8D%0A%0A%E8%AF%B7%E6%B1%82%E5%8F%91%E9%80%81%E4%B9%8B%E5%89%8D%EF%BC%8C%E4%BC%9A%E8%A7%A6%E5%8F%91%E4%B8%80%E4%B8%AA%20%60request%60%20%E4%BA%8B%E4%BB%B6%EF%BC%8C%E5%85%81%E8%AE%B8%E5%AF%B9%E8%AF%B7%E6%B1%82%E5%81%9A%E6%8B%A6%E6%88%AA%E3%80%82%0A%0A%60%60%60js%0Aapp.httpclient.on('request'%2C%20req%20%3D%3E%20%7B%0A%20%20req.url%20%2F%2F%E8%AF%B7%E6%B1%82%20url%0A%20%20req.ctx%20%2F%2F%E6%98%AF%E5%8F%91%E8%B5%B7%E8%BF%99%E6%AC%A1%E8%AF%B7%E6%B1%82%E7%9A%84%E5%BD%93%E5%89%8D%E4%B8%8A%E4%B8%8B%E6%96%87%0A%0A%20%20%2F%2F%20%E5%8F%AF%E4%BB%A5%E5%9C%A8%E8%BF%99%E9%87%8C%E8%AE%BE%E7%BD%AE%E4%B8%80%E4%BA%9B%20trace%20headers%EF%BC%8C%E6%96%B9%E4%BE%BF%E5%85%A8%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%20%60response%60%20%E4%BA%8B%E4%BB%B6%EF%BC%9A%E5%8F%91%E7%94%9F%E5%9C%A8%E7%BD%91%E7%BB%9C%E6%93%8D%E4%BD%9C%E7%BB%93%E6%9D%9F%E4%B9%8B%E5%90%8E%0A%0A%E8%AF%B7%E6%B1%82%E7%BB%93%E6%9D%9F%E4%B9%8B%E5%90%8E%E4%BC%9A%E8%A7%A6%E5%8F%91%E4%B8%80%E4%B8%AA%20%60response%60%20%E4%BA%8B%E4%BB%B6%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%A4%96%E9%83%A8%E5%B0%B1%E5%8F%AF%E4%BB%A5%E8%AE%A2%E9%98%85%E8%BF%99%E4%B8%AA%E4%BA%8B%E4%BB%B6%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97%E3%80%82%0A%0A%60%60%60js%0Aapp.httpclient.on('response'%2C%20result%20%3D%3E%20%7B%0A%20%20result.res.status%0A%20%20result.ctx%20%2F%2F%E6%98%AF%E5%8F%91%E8%B5%B7%E8%BF%99%E6%AC%A1%E8%AF%B7%E6%B1%82%E7%9A%84%E5%BD%93%E5%89%8D%E4%B8%8A%E4%B8%8B%E6%96%87%0A%20%20result.req%20%2F%2F%E5%AF%B9%E5%BA%94%E7%9A%84%20req%20%E5%AF%B9%E8%B1%A1%EF%BC%8C%E5%8D%B3%20request%20%E4%BA%8B%E4%BB%B6%E9%87%8C%E9%9D%A2%E9%82%A3%E4%B8%AA%20req%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%20%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81%0A%0A%E5%AE%8C%E6%95%B4%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81%E5%8F%AF%E4%BB%A5%E5%9C%A8%20%5Beggjs%2Fexmaples%2Fhttpclient%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fexamples%2Fblob%2Fmaster%2Fhttpclient)%20%E6%89%BE%E5%88%B0%E3%80%82%0A%0A%5Burllib%5D%3A%20https%3A%2F%2Fgithub.com%2Fnode-modules%2Furllib%0A%5BHttpClient%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg%2Fblob%2Fmaster%2Flib%2Fcore%2Fhttpclient.js%0A%5Bformstream%5D%3A%20https%3A%2F%2Fgithub.com%2Fnode-modules%2Fformstream%0A%5BHTTP%5D%3A%20https%3A%2F%2Fnodejs.org%2Fapi%2Fhttp.html%0A%5BHTTPS%5D%3A%20https%3A%2F%2Fnodejs.org%2Fapi%2Fhttps.html%0A%5Begg-development-proxyagent%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-development-proxyagent%0A%5Bcharles%5D%3A%20https%3A%2F%2Fwww.charlesproxy.com%2F%0A%5Bfiddler%5D%3A%20http%3A%2F%2Fwww.telerik.com%2Ffiddler%0A%5Banyproxy%5D%3A%20https%3A%2F%2Fgithub.com%2Falibaba%2Fanyproxy%0A"}}</script><script type="text/javascript" src="/static/js/post.b9faab88.js"></script></body></html>