<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.png"><style class="_styletron_hydrate_"></style><title>Egg.js</title><meta name="description" content="Born to build better enterprise frameworks and apps"><link href="/static/css/post.d62265dc.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="ant-layout" data-reactroot=""><div class="header-module__header___3ADJ9 ant-layout-header"><div class="ant-row-flex"><div class="ant-col-xs-12 ant-col-md-20 ant-col-lg-2"><div class="header-module__logo___3yTXp"><a href="/"><img src="/logo.svg" alt="logo"/></a></div></div><div class="ant-col-xs-0 ant-col-md-0 ant-col-lg-20"><ul class="ant-menu header-module__menu___3yEtW ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-item" role="menuitem"><a href="/en/intro/">Guide</a></li><li class="ant-menu-item" role="menuitem"><a href="/api/">API</a></li><li class="ant-menu-item" role="menuitem"><a href="/en/tutorials/index.html">Tutorials</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/search?q=topic%3Aegg-plugin&amp;type=Repositories">Plugins</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/eggjs/egg/releases">Release</a></li></ul></div><div style="text-align:right" class="ant-col-xs-12 ant-col-md-4 ant-col-lg-2"><button type="button" class="ant-btn"><span>切换语言</span></button></div></div></div><div class="ant-layout-content"><div class="basic_layout-module__content___3flpY ant-layout"><div class="sider-module__side___1Cadj ant-layout-sider ant-layout-sider-light" style="flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"><ul class="ant-menu sider-module__menu___2GqPr ant-menu-light ant-menu-root ant-menu-inline" role="menu"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="0$Menu" aria-haspopup="true"><span>Guide</span><i class="ant-menu-submenu-arrow"></i></div><ul id="0$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/index.html">What is Egg?</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/egg-and-koa.html">Egg and Koa</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/quickstart.html">Quick Start</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/progressive.html">Progressive</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/migration.html">Migration to 2.x</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="1$Menu" aria-haspopup="true"><span>Basis Function</span><i class="ant-menu-submenu-arrow"></i></div><ul id="1$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/structure.html">Directory Structure</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/objects.html">Built-in Objects</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/env.html">Environment</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/config.html">Configuration</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/middleware.html">Middleware</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/router.html">Router</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/controller.html">Controller</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/service.html">Service</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/plugin.html">Plugin</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/schedule.html">Schedule</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/extend.html">Extend</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/app-start.html">Custom Init</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="2$Menu" aria-haspopup="true"><span>Core</span><i class="ant-menu-submenu-arrow"></i></div><ul id="2$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/development.html">Development</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/unittest.html">Unit Testing</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/deployment.html">Deployment</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/logger.html">Logger</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/httpclient.html">HttpClient</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/cookie-and-session.html">Cookie and Session</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/cluster-and-ipc.html">Cluster and IPC</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/view.html">View</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/error-handling.html">Error Handling</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/security.html">Security</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/i18n.html">i18n</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="3$Menu" aria-haspopup="true"><span>Tutorials</span><i class="ant-menu-submenu-arrow"></i></div><ul id="3$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/mysql.html">MySQL</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/restful.html">RESTful API</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/passport.html">Passport</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/socketio.html">Socket.IO</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/assets.html">Assets</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/typescript.html">TypeScript</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="4$Menu" aria-haspopup="true"><span>Advanced</span><i class="ant-menu-submenu-arrow"></i></div><ul id="4$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/loader.html">Loader</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/plugin.html">Plugin Development</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/framework.html">Framework</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/cluster-client.html">Cluster Enhancement</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/view-plugin.html">View Plugin</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/style-guide.html">Style Guide</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="5$Menu" aria-haspopup="true"><span>Community</span><i class="ant-menu-submenu-arrow"></i></div><ul id="5$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/plugins/">Plugin List</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/contributing.html">Contributing</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/resource.html">Resource</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/faq.html">FAQ</a></li></ul></li></ul></div></div><div class="basic_layout-module__post___2Z7KK ant-layout-content"><div class="ant-row" style="margin-left:-8px;margin-right:-8px"><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-24 ant-col-md-18"><div class="markdown-body" style="font-size:14px"><div><p>title: Progressive Development</p><p>Egg provides both <a href="../basics/plugin.md">Plugin</a> and <a href="../advanced/framework.md">Framework</a>, and the former has two loading modes which are <code>path</code> and <code>package</code>. Then how should we choose?</p><p>Step-by-step example will be provided to demonstrate how to start coding development progressively.</p><p>Find detail codes on <a href="https://github.com/eggjs/examples/tree/master/progressive">eggjs/examples/progressive</a>.</p><h2 id="getting-started">Getting Started</h2><p>Assume that we are writing a code to analyze UA to implement the function below:</p><ul><li><code>ctx.isAndroid</code></li><li><code>ctx.isIOS</code></li></ul><p>You can easily write it down after previous tutorials, let&#x27;s have a quick review:</p><p>Codes refer to <a href="https://github.com/eggjs/examples/tree/master/progressive/step1">step1</a>.</p><p>Directory structure:</p><pre><code class="language-bash">example-app
├── app
│   ├── extend
│   │   └── context.js
│   └── router.js
├── test
│   └── index.test.js
└── package.json</code></pre><p>Core code:</p><pre><code class="language-js">// app/extend/context.js
module.exports = {
  get isIOS() {
    const iosReg = /iphone|ipad|ipod/i;
    return iosReg.test(this.get(&#x27;user-agent&#x27;));
  },
};</code></pre><h2 id="prototype-of-plugin">Prototype of Plugin</h2><p>Obviously, the logic is universal that can be written as a plugin.</p><p>But since function might not be perfect at the beginning, it might be difficult to maintain if encapsulated into a plugin directly.</p><p>We can write the code as the format of plugin, but not separate out.</p><p>Codes refer to <a href="https://github.com/eggjs/examples/tree/master/progressive/step2">step2</a>.</p><p>New directory structure:</p><pre><code class="language-bash">example-app
├── app
│   └── router.js
├── config
│   └── plugin.js
├── lib
│   └── plugin
│       └── egg-ua
│           ├── app
│           │   └── extend
│           │       └── context.js
│           └── package.json
├── test
│   └── index.test.js
└── package.json</code></pre><p>Core code:</p><ul><li><p><code>app/extend/context.js</code> move to <code>lib/plugin/egg-ua/app/extend/context.js</code>.</p></li><li><code>lib/plugin/egg-ua/package.json</code> declares plugin.</li></ul><pre><code class="language-json">{
  &quot;eggPlugin&quot;: {
    &quot;name&quot;: &quot;ua&quot;
  }
}</code></pre><ul><li><code>config/plugin.js</code> uses <code>path</code> to mount the plugin.</li></ul><pre><code class="language-js">// config/plugin.js
const path = require(&#x27;path&#x27;);
exports.ua = {
  enable: true,
  path: path.join(__dirname, &#x27;../lib/plugin/egg-ua&#x27;),
};</code></pre><h2 id="extract-to-independent-plugin">Extract to Independent Plugin</h2><p>The functions of module become better after a period of developing so we could extract it out as an independent plugin.</p><p>We extract an egg-ua plugin and have a quick review as below. Details refer to <a href="../advanced/plugin.md">Plugin Development</a>.</p><p>Directory structure:</p><pre><code class="language-bash">egg-ua
├── app
│   └── extend
│       └── context.js
├── test
│   ├── fixtures
│   │   └── test-app
│   │       ├── app
│   │       │   └── router.js
│   │       └── package.json
│   └── ua.test.js
└── package.json</code></pre><p>Codes refer to  <a href="https://github.com/eggjs/examples/tree/master/progressive/step3/egg-ua">step3/egg-ua</a>.</p><p>Then modify the application, details refer to <a href="https://github.com/eggjs/examples/tree/master/progressive/step3/example-app">step3/example-app</a>.</p><ul><li>Remove directory <code>lib/plugin/egg-ua</code>.</li><li>declare dependencies <code>egg-ua</code>  in <code>package.json</code>.</li><li>change type to <code>package</code> in <code>config/plugin.js</code>.</li></ul><pre><code class="language-js">// config/plugin.js
exports.ua = {
  enable: true,
  package: &#x27;egg-ua&#x27;,
};</code></pre><p><strong>Note：We can use <code>npm link</code> for local test before releasing the plugin. Details refer to  <a href="https://docs.npmjs.com/cli/link">npm-link</a>.</strong></p><pre><code class="language-bash">$ cd example-app
$ npm link ../egg-ua
$ npm i
$ npm test</code></pre><h2 id="finally-a-framework">Finally: A Framework</h2><p>After repeating the process above, we accumulate a few plugins and configurations, and might find that most of our team projects are using them.</p><p>At that time, you can consider abstracting them as a framework which is suitable for business scenarios.</p><p>Firstly, abstract the example-framework as below. Let&#x27;s have a quick review, details refer to <a href="../advanced/framework.md">Framework</a>.</p><p>Directory structure:</p><pre><code class="language-bash">example-framework
├── config
│   ├── config.default.js
│   └── plugin.js
├── lib
│   ├── agent.js
│   └── application.js
├── test
│   ├── fixtures
│   │   └── test-app
│   └── framework.test.j.
├── README.md
├── index.js
└── package.json</code></pre><ul><li>Codes refer to <a href="https://github.com/eggjs/examples/tree/master/progressive/step4/example-framework">example-framework</a>.</li><li>Remove the dependencies of plugins such as <code>egg-ua</code> and remove it from example-app, then configure them into the <code>package.json</code> and <code>config/plugin.js</code> of the framework.</li></ul><p>Then modify the application, details refer to <a href="https://github.com/eggjs/examples/tree/master/progressive/step4/example-app">step4/example-app</a>.</p><ul><li>Remove <code>egg-ua</code> in <code>config/plugin.js</code>.</li><li>Remove <code>egg-ua</code> in <code>package.json</code>.</li><li>declare <code>example-framework</code>  in <code>package.json</code> and configure the <code>egg.framework</code>.</li></ul><pre><code class="language-json">{
  &quot;name&quot;: &quot;progressive&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;private&quot;: true,
  &quot;egg&quot;: {
    &quot;framework&quot;: &quot;example-framework&quot;
  },
  &quot;dependencies&quot;: {
    &quot;example-framework&quot;: &quot;*&quot;
  }
}</code></pre><p><strong>Note：We can use <code>npm link</code> for local test before releasing the framework <a href="https://docs.npmjs.com/cli/link">npm-link</a>.</strong></p><pre><code class="language-bash">$ cd example-app
$ npm link ../egg-framework
$ npm i
$ npm test</code></pre><h2 id="write-in-the-end">Write in the end</h2><p>In conclusion, we can see how to make the framework evolution step by step which benefits from Egg&#x27;s powerful plugin mechanism, code co-build, reusability and modularity.</p><ul><li>in general, put codes into <code>lib/plugin</code> if they can be reused in the application.</li><li>separate it into a <code>node module</code> when plugin becomes stable.</li><li>application with relatively reusable codes will work as a separate plugin.</li><li>abstract it as framework to release after application become certain solutions of specified business scenario.</li><li><p>it would be a great improvement in the efficiency of teamwork after plugins were extracted, modularized and finally became a framework, because other projects could reuse codes by just using <code>npm install</code>.</p></li><li><strong>Note：Whether it&#x27;s the application/plugin/framework, unittest is necessary and try to reach 100% coverage</strong></li></ul></div></div></div><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-0 ant-col-md-6"><div class="markdown-body" style="font-size:14px"><div><ul><li><a href="#getting-started">Getting Started</a></li><li><a href="#prototype-of-plugin">Prototype of Plugin</a></li><li><a href="#extract-to-independent-plugin">Extract to Independent Plugin</a></li><li><a href="#finally-a-framework">Finally: A Framework</a></li><li><a href="#write-in-the-end">Write in the end</a></li></ul></div></div></div></div></div></div></div></div></div><script type="text/javascript">window.__INIT_STATE__={"lang":"en","props":{"toc":"-%20%5BGetting%20Started%5D(%23getting-started)%0A-%20%5BPrototype%20of%20Plugin%5D(%23prototype-of-plugin)%0A-%20%5BExtract%20to%20Independent%20Plugin%5D(%23extract-to-independent-plugin)%0A-%20%5BFinally%3A%20A%20Framework%5D(%23finally-a-framework)%0A-%20%5BWrite%20in%20the%20end%5D(%23write-in-the-end)","meta":{"info":{"title":"Egg.js","subtitle":"Born to build better enterprise frameworks and apps","description":"Born to build better enterprise frameworks and apps"}},"content":"title%3A%20Progressive%20Development%0D%0A%0D%0A%0D%0AEgg%20provides%20both%20%5BPlugin%5D(..%2Fbasics%2Fplugin.md)%20and%20%5BFramework%5D(..%2Fadvanced%2Fframework.md)%2C%20and%20the%20former%20has%20two%20loading%20modes%20which%20are%20%60path%60%20and%20%60package%60.%20Then%20how%20should%20we%20choose%3F%0D%0A%0D%0AStep-by-step%20example%20will%20be%20provided%20to%20demonstrate%20how%20to%20start%20coding%20development%20progressively.%0D%0A%0D%0AFind%20detail%20codes%20on%20%5Beggjs%2Fexamples%2Fprogressive%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fexamples%2Ftree%2Fmaster%2Fprogressive).%0D%0A%0D%0A%23%23%20Getting%20Started%0D%0A%0D%0AAssume%20that%20we%20are%20writing%20a%20code%20to%20analyze%20UA%20to%20implement%20the%20function%20below%3A%0D%0A%0D%0A-%20%60ctx.isAndroid%60%0D%0A-%20%60ctx.isIOS%60%0D%0A%0D%0AYou%20can%20easily%20write%20it%20down%20after%20previous%20tutorials%2C%20let's%20have%20a%20quick%20review%3A%0D%0A%0D%0ACodes%20refer%20to%20%5Bstep1%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fexamples%2Ftree%2Fmaster%2Fprogressive%2Fstep1).%0D%0A%0D%0ADirectory%20structure%3A%0D%0A%0D%0A%60%60%60bash%0D%0Aexample-app%0D%0A%E2%94%9C%E2%94%80%E2%94%80%20app%0D%0A%E2%94%82%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20extend%0D%0A%E2%94%82%20%20%20%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20context.js%0D%0A%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20router.js%0D%0A%E2%94%9C%E2%94%80%E2%94%80%20test%0D%0A%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20index.test.js%0D%0A%E2%94%94%E2%94%80%E2%94%80%20package.json%0D%0A%60%60%60%0D%0A%0D%0ACore%20code%3A%0D%0A%0D%0A%60%60%60js%0D%0A%2F%2F%20app%2Fextend%2Fcontext.js%0D%0Amodule.exports%20%3D%20%7B%0D%0A%20%20get%20isIOS()%20%7B%0D%0A%20%20%20%20const%20iosReg%20%3D%20%2Fiphone%7Cipad%7Cipod%2Fi%3B%0D%0A%20%20%20%20return%20iosReg.test(this.get('user-agent'))%3B%0D%0A%20%20%7D%2C%0D%0A%7D%3B%0D%0A%60%60%60%0D%0A%0D%0A%23%23%20Prototype%20of%20Plugin%0D%0A%0D%0AObviously%2C%20the%20logic%20is%20universal%20that%20can%20be%20written%20as%20a%20plugin.%0D%0A%0D%0ABut%20since%20function%20might%20not%20be%20perfect%20at%20the%20beginning%2C%20it%20might%20be%20difficult%20to%20maintain%20if%20encapsulated%20into%20a%20plugin%20directly.%0D%0A%0D%0AWe%20can%20write%20the%20code%20as%20the%20format%20of%20plugin%2C%20but%20not%20separate%20out.%0D%0A%0D%0ACodes%20refer%20to%20%5Bstep2%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fexamples%2Ftree%2Fmaster%2Fprogressive%2Fstep2).%0D%0A%0D%0ANew%20directory%20structure%3A%0D%0A%0D%0A%60%60%60bash%0D%0Aexample-app%0D%0A%E2%94%9C%E2%94%80%E2%94%80%20app%0D%0A%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20router.js%0D%0A%E2%94%9C%E2%94%80%E2%94%80%20config%0D%0A%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20plugin.js%0D%0A%E2%94%9C%E2%94%80%E2%94%80%20lib%0D%0A%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20plugin%0D%0A%E2%94%82%20%20%20%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%20egg-ua%0D%0A%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20app%0D%0A%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20extend%0D%0A%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%E2%94%82%20%20%20%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%20context.js%0D%0A%E2%94%82%20%20%20%20%20%20%20%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%20package.json%0D%0A%E2%94%9C%E2%94%80%E2%94%80%20test%0D%0A%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20index.test.js%0D%0A%E2%94%94%E2%94%80%E2%94%80%20package.json%0D%0A%60%60%60%0D%0A%0D%0ACore%20code%3A%0D%0A%0D%0A-%20%60app%2Fextend%2Fcontext.js%60%20move%20to%20%60lib%2Fplugin%2Fegg-ua%2Fapp%2Fextend%2Fcontext.js%60.%0D%0A%0D%0A-%20%60lib%2Fplugin%2Fegg-ua%2Fpackage.json%60%20declares%20plugin.%0D%0A%0D%0A%60%60%60json%0D%0A%7B%0D%0A%20%20%22eggPlugin%22%3A%20%7B%0D%0A%20%20%20%20%22name%22%3A%20%22ua%22%0D%0A%20%20%7D%0D%0A%7D%0D%0A%60%60%60%0D%0A%0D%0A-%20%60config%2Fplugin.js%60%20uses%20%60path%60%20to%20mount%20the%20plugin.%0D%0A%0D%0A%60%60%60js%0D%0A%2F%2F%20config%2Fplugin.js%0D%0Aconst%20path%20%3D%20require('path')%3B%0D%0Aexports.ua%20%3D%20%7B%0D%0A%20%20enable%3A%20true%2C%0D%0A%20%20path%3A%20path.join(__dirname%2C%20'..%2Flib%2Fplugin%2Fegg-ua')%2C%0D%0A%7D%3B%0D%0A%60%60%60%0D%0A%0D%0A%23%23%20Extract%20to%20Independent%20Plugin%0D%0A%0D%0AThe%20functions%20of%20module%20become%20better%20after%20a%20period%20of%20developing%20so%20we%20could%20extract%20it%20out%20as%20an%20independent%20plugin.%0D%0A%0D%0AWe%20extract%20an%20egg-ua%20plugin%20and%20have%20a%20quick%20review%20as%20below.%20Details%20refer%20to%20%5BPlugin%20Development%5D(..%2Fadvanced%2Fplugin.md).%0D%0A%0D%0ADirectory%20structure%3A%0D%0A%0D%0A%60%60%60bash%0D%0Aegg-ua%0D%0A%E2%94%9C%E2%94%80%E2%94%80%20app%0D%0A%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20extend%0D%0A%E2%94%82%20%20%20%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%20context.js%0D%0A%E2%94%9C%E2%94%80%E2%94%80%20test%0D%0A%E2%94%82%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20fixtures%0D%0A%E2%94%82%20%20%20%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20test-app%0D%0A%E2%94%82%20%20%20%E2%94%82%20%20%20%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20app%0D%0A%E2%94%82%20%20%20%E2%94%82%20%20%20%20%20%20%20%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20router.js%0D%0A%E2%94%82%20%20%20%E2%94%82%20%20%20%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%20package.json%0D%0A%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20ua.test.js%0D%0A%E2%94%94%E2%94%80%E2%94%80%20package.json%0D%0A%60%60%60%0D%0A%0D%0ACodes%20refer%20to%20%20%5Bstep3%2Fegg-ua%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fexamples%2Ftree%2Fmaster%2Fprogressive%2Fstep3%2Fegg-ua).%0D%0A%0D%0AThen%20modify%20the%20application%2C%20details%20refer%20to%20%5Bstep3%2Fexample-app%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fexamples%2Ftree%2Fmaster%2Fprogressive%2Fstep3%2Fexample-app).%0D%0A%0D%0A-%20Remove%20directory%20%60lib%2Fplugin%2Fegg-ua%60.%0D%0A-%20declare%20dependencies%20%60egg-ua%60%20%20in%20%60package.json%60.%0D%0A-%20change%20type%20to%20%60package%60%20in%20%60config%2Fplugin.js%60.%0D%0A%0D%0A%60%60%60js%0D%0A%2F%2F%20config%2Fplugin.js%0D%0Aexports.ua%20%3D%20%7B%0D%0A%20%20enable%3A%20true%2C%0D%0A%20%20package%3A%20'egg-ua'%2C%0D%0A%7D%3B%0D%0A%60%60%60%0D%0A%0D%0A**Note%EF%BC%9AWe%20can%20use%20%60npm%20link%60%20for%20local%20test%20before%20releasing%20the%20plugin.%20Details%20refer%20to%20%20%5Bnpm-link%5D(https%3A%2F%2Fdocs.npmjs.com%2Fcli%2Flink).**%0D%0A%0D%0A%60%60%60bash%0D%0A%24%20cd%20example-app%0D%0A%24%20npm%20link%20..%2Fegg-ua%0D%0A%24%20npm%20i%0D%0A%24%20npm%20test%0D%0A%60%60%60%0D%0A%0D%0A%23%23%20Finally%3A%20A%20Framework%0D%0A%0D%0AAfter%20repeating%20the%20process%20above%2C%20we%20accumulate%20a%20few%20plugins%20and%20configurations%2C%20and%20might%20find%20that%20most%20of%20our%20team%20projects%20are%20using%20them.%0D%0A%0D%0AAt%20that%20time%2C%20you%20can%20consider%20abstracting%20them%20as%20a%20framework%20which%20is%20suitable%20for%20business%20scenarios.%0D%0A%0D%0AFirstly%2C%20abstract%20the%20example-framework%20as%20below.%20Let's%20have%20a%20quick%20review%2C%20details%20refer%20to%20%5BFramework%5D(..%2Fadvanced%2Fframework.md).%0D%0A%0D%0ADirectory%20structure%3A%0D%0A%0D%0A%60%60%60bash%0D%0Aexample-framework%0D%0A%E2%94%9C%E2%94%80%E2%94%80%20config%0D%0A%E2%94%82%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20config.default.js%0D%0A%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20plugin.js%0D%0A%E2%94%9C%E2%94%80%E2%94%80%20lib%0D%0A%E2%94%82%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20agent.js%0D%0A%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20application.js%0D%0A%E2%94%9C%E2%94%80%E2%94%80%20test%0D%0A%E2%94%82%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20fixtures%0D%0A%E2%94%82%20%20%20%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20test-app%0D%0A%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20framework.test.j.%0D%0A%E2%94%9C%E2%94%80%E2%94%80%20README.md%0D%0A%E2%94%9C%E2%94%80%E2%94%80%20index.js%0D%0A%E2%94%94%E2%94%80%E2%94%80%20package.json%0D%0A%60%60%60%0D%0A%0D%0A-%20Codes%20refer%20to%20%5Bexample-framework%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fexamples%2Ftree%2Fmaster%2Fprogressive%2Fstep4%2Fexample-framework).%0D%0A-%20Remove%20the%20dependencies%20of%20plugins%20such%20as%20%60egg-ua%60%20and%20remove%20it%20from%20example-app%2C%20then%20configure%20them%20into%20the%20%60package.json%60%20and%20%60config%2Fplugin.js%60%20of%20the%20framework.%0D%0A%0D%0AThen%20modify%20the%20application%2C%20details%20refer%20to%20%5Bstep4%2Fexample-app%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fexamples%2Ftree%2Fmaster%2Fprogressive%2Fstep4%2Fexample-app).%0D%0A%0D%0A-%20Remove%20%60egg-ua%60%20in%20%60config%2Fplugin.js%60.%0D%0A-%20Remove%20%60egg-ua%60%20in%20%60package.json%60.%0D%0A-%20declare%20%60example-framework%60%20%20in%20%60package.json%60%20and%20configure%20the%20%60egg.framework%60.%0D%0A%0D%0A%60%60%60json%0D%0A%7B%0D%0A%20%20%22name%22%3A%20%22progressive%22%2C%0D%0A%20%20%22version%22%3A%20%221.0.0%22%2C%0D%0A%20%20%22private%22%3A%20true%2C%0D%0A%20%20%22egg%22%3A%20%7B%0D%0A%20%20%20%20%22framework%22%3A%20%22example-framework%22%0D%0A%20%20%7D%2C%0D%0A%20%20%22dependencies%22%3A%20%7B%0D%0A%20%20%20%20%22example-framework%22%3A%20%22*%22%0D%0A%20%20%7D%0D%0A%7D%0D%0A%60%60%60%0D%0A%0D%0A**Note%EF%BC%9AWe%20can%20use%20%60npm%20link%60%20for%20local%20test%20before%20releasing%20the%20framework%20%5Bnpm-link%5D(https%3A%2F%2Fdocs.npmjs.com%2Fcli%2Flink).**%0D%0A%0D%0A%60%60%60bash%0D%0A%24%20cd%20example-app%0D%0A%24%20npm%20link%20..%2Fegg-framework%0D%0A%24%20npm%20i%0D%0A%24%20npm%20test%0D%0A%60%60%60%0D%0A%0D%0A%23%23%20Write%20in%20the%20end%0D%0A%0D%0AIn%20conclusion%2C%20we%20can%20see%20how%20to%20make%20the%20framework%20evolution%20step%20by%20step%20which%20benefits%20from%20Egg's%20powerful%20plugin%20mechanism%2C%20code%20co-build%2C%20reusability%20and%20modularity.%0D%0A%0D%0A%0D%0A-%20in%20general%2C%20put%20codes%20into%20%60lib%2Fplugin%60%20if%20they%20can%20be%20reused%20in%20the%20application.%0D%0A-%20separate%20it%20into%20a%20%60node%20module%60%20when%20plugin%20becomes%20stable.%0D%0A-%20application%20with%20relatively%20reusable%20codes%20will%20work%20as%20a%20separate%20plugin.%0D%0A-%20abstract%20it%20as%20framework%20to%20release%20after%20application%20become%20certain%20solutions%20of%20specified%20business%20scenario.%0D%0A-%20it%20would%20be%20a%20great%20improvement%20in%20the%20efficiency%20of%20teamwork%20after%20plugins%20were%20extracted%2C%20modularized%20and%20finally%20became%20a%20framework%2C%20because%20other%20projects%20could%20reuse%20codes%20by%20just%20using%20%60npm%20install%60.%0D%0A%0D%0A-%20**Note%EF%BC%9AWhether%20it's%20the%20application%2Fplugin%2Fframework%2C%20unittest%20is%20necessary%20and%20try%20to%20reach%20100%25%20coverage**%0D%0A"}}</script><script type="text/javascript" src="/static/js/post.b9faab88.js"></script></body></html>