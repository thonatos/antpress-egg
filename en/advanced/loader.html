<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.png"><style class="_styletron_hydrate_"></style><title>Loader</title><meta name="description" content="Born to build better enterprise frameworks and apps"><link href="/static/css/post.d62265dc.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="ant-layout" data-reactroot=""><div class="header-module__header___3ADJ9 ant-layout-header"><div class="ant-row-flex"><div class="ant-col-xs-12 ant-col-md-20 ant-col-lg-2"><div class="header-module__logo___3yTXp"><a href="/"><img src="/logo.svg" alt="logo"/></a></div></div><div class="ant-col-xs-0 ant-col-md-0 ant-col-lg-20"><ul class="ant-menu header-module__menu___3yEtW ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-item" role="menuitem"><a href="/en/intro/">Guide</a></li><li class="ant-menu-item" role="menuitem"><a href="/api/">API</a></li><li class="ant-menu-item" role="menuitem"><a href="/en/tutorials/index.html">Tutorials</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/search?q=topic%3Aegg-plugin&amp;type=Repositories">Plugins</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/eggjs/egg/releases">Release</a></li></ul></div><div style="text-align:right" class="ant-col-xs-12 ant-col-md-4 ant-col-lg-2"><button type="button" class="ant-btn"><span>切换语言</span></button></div></div></div><div class="ant-layout-content"><div class="basic_layout-module__content___3flpY ant-layout"><div class="sider-module__side___1Cadj ant-layout-sider ant-layout-sider-light" style="flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"><ul class="ant-menu sider-module__menu___2GqPr ant-menu-light ant-menu-root ant-menu-inline" role="menu"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="0$Menu" aria-haspopup="true"><span>Guide</span><i class="ant-menu-submenu-arrow"></i></div><ul id="0$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/index.html">What is Egg?</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/egg-and-koa.html">Egg and Koa</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/quickstart.html">Quick Start</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/progressive.html">Progressive</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/migration.html">Migration to 2.x</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="1$Menu" aria-haspopup="true"><span>Basis Function</span><i class="ant-menu-submenu-arrow"></i></div><ul id="1$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/structure.html">Directory Structure</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/objects.html">Built-in Objects</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/env.html">Environment</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/config.html">Configuration</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/middleware.html">Middleware</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/router.html">Router</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/controller.html">Controller</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/service.html">Service</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/plugin.html">Plugin</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/schedule.html">Schedule</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/extend.html">Extend</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/app-start.html">Custom Init</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="2$Menu" aria-haspopup="true"><span>Core</span><i class="ant-menu-submenu-arrow"></i></div><ul id="2$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/development.html">Development</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/unittest.html">Unit Testing</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/deployment.html">Deployment</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/logger.html">Logger</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/httpclient.html">HttpClient</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/cookie-and-session.html">Cookie and Session</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/cluster-and-ipc.html">Cluster and IPC</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/view.html">View</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/error-handling.html">Error Handling</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/security.html">Security</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/i18n.html">i18n</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="3$Menu" aria-haspopup="true"><span>Tutorials</span><i class="ant-menu-submenu-arrow"></i></div><ul id="3$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/mysql.html">MySQL</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/restful.html">RESTful API</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/passport.html">Passport</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/socketio.html">Socket.IO</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/assets.html">Assets</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/typescript.html">TypeScript</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="4$Menu" aria-haspopup="true"><span>Advanced</span><i class="ant-menu-submenu-arrow"></i></div><ul id="4$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/loader.html">Loader</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/plugin.html">Plugin Development</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/framework.html">Framework</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/cluster-client.html">Cluster Enhancement</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/view-plugin.html">View Plugin</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/style-guide.html">Style Guide</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="5$Menu" aria-haspopup="true"><span>Community</span><i class="ant-menu-submenu-arrow"></i></div><ul id="5$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/plugins/">Plugin List</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/contributing.html">Contributing</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/resource.html">Resource</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/faq.html">FAQ</a></li></ul></li></ul></div></div><div class="basic_layout-module__post___2Z7KK ant-layout-content"><div class="ant-row" style="margin-left:-8px;margin-right:-8px"><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-24 ant-col-md-18"><div class="markdown-body" style="font-size:14px"><div><p>The most important of Egg enhance Koa is Egg based on a certain agreement, code will be placed in different directories according to the functional differences, it significantly reduce development costs. Loader supports this set of conventions and abstracts that many low-level APIs could be extended.</p><h2 id="application-framework-and-plugin">Application, Framework and Plugin</h2><p>Egg is a low-level framework, applications could use it directly, but Egg only has a little default plugins, applications need to configure plugins to extend features, such as MySQL.</p><pre><code class="language-js">// application configuration
// package.json
{
  &quot;dependencies&quot;: {
    &quot;egg&quot;: &quot;^2.0.0&quot;,
    &quot;egg-mysql&quot;: &quot;^3.0.0&quot;
  }
}

// config/plugin.js
module.exports = {
  mysql: {
    enable: true,
    package: &#x27;egg-mysql&#x27;,
  },
}</code></pre><p>With the increase number of applications, we find most of them have similar configurations, then we could extend a new framework based on Egg, which make the application configuration simpler.</p><pre><code class="language-js">// framework configuration
// package.json
{
  &quot;name&quot;: &quot;framework1&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;dependencies&quot;: {
    &quot;egg-mysql&quot;: &quot;^3.0.0&quot;,
    &quot;egg-view-nunjucks&quot;: &quot;^2.0.0&quot;
  }
}

// config/plugin.js
module.exports = {
  mysql: {
    enable: false,
    package: &#x27;egg-mysql&#x27;,
  },
  view: {
    enable: false,
    package: &#x27;egg-view-nunjucks&#x27;,
  }
}

// application configuration
// package.json
{
  &quot;dependencies&quot;: {
    &quot;framework1&quot;: &quot;^1.0.0&quot;,
  }
}

// config/plugin.js
module.exports = {
  // enable plugins
  mysql: true,
  view: true,
}</code></pre><p>From the above scene we can see the relationship of application, plugin and framework.</p><ul><li>We implement business logics in application, we need to specify a framework to run, we could configure plugin to meet a special scene feature (such as MySQL).</li><li>Plugin only performs specific function, when two separate functions are interdependent, they still need to be separated into two plugins, and requires configuration.</li><li>Framework is a launcher (default is Egg), which is indispensable to run. Framework is also a wrapper, it aggregates plugins to provide functions unitedly, framework can also configure plugins.</li><li>We can extend a new framework based on framework, which means that <strong>framework can be inherited infinitely</strong>, like class inheritance.</li></ul><pre><code>+-----------------------------------+--------+
|      app1, app2, app3, app4       |        |
+-----+--------------+--------------+        |
|     |              |  framework3  |        |
+     |  framework1  +--------------+ plugin |
|     |              |  framework2  |        |
+     +--------------+--------------+        |
|                   Egg             |        |
+-----------------------------------+--------|
|                   Koa                      |
+-----------------------------------+--------+</code></pre><h2 id="loadunit">loadUnit</h2><p>Egg regard application, framework and plugin as loadUnit, because they are similar in code structure, here is the directory structure</p><pre><code>loadUnit
├── package.json
├── app.js
├── agent.js
├── app
│   ├── extend
│   |   ├── helper.js
│   |   ├── request.js
│   |   ├── response.js
│   |   ├── context.js
│   |   ├── application.js
│   |   └── agent.js
│   ├── service
│   ├── middleware
│   └── router.js
└── config
    ├── config.default.js
    ├── config.prod.js
    ├── config.test.js
    ├── config.local.js
    └── config.unittest.js</code></pre><p>However, there are still some differences</p><table><thead><tr><th>File</th><th>Application</th><th>Framework</th><th>Plugin</th></tr></thead><tbody><tr><td>app/router.js</td><td>✔︎</td><td></td></tr><tr><td>app/controller</td><td>✔︎</td><td></td></tr><tr><td>app/middleware</td><td>✔︎</td><td>✔︎</td><td>✔︎</td></tr><tr><td>app/service</td><td>✔︎</td><td>✔︎</td><td>✔︎</td></tr><tr><td>app/extend</td><td>✔︎</td><td>✔︎</td><td>✔︎</td></tr><tr><td>app.js</td><td>✔︎</td><td>✔︎</td><td>✔︎</td></tr><tr><td>agent.js</td><td>✔︎</td><td>✔︎</td><td>✔︎</td></tr><tr><td>config/config.{env}.js</td><td>✔︎</td><td>✔︎</td><td>✔︎</td></tr><tr><td>config/plugin.js</td><td>✔︎</td><td>✔︎</td></tr><tr><td>package.json</td><td>✔︎</td><td>✔︎</td><td>✔︎</td></tr></tbody></table><p>During the loading process, Egg will traverse all loadUnits to load the above files (application, framework and plugin are different), the loading process has priority.</p><ul><li>follow the order Plugin =&gt; Framework =&gt; Application to load</li><li>The order of loading plugins depends on the dependencies, depended plugins will be loaded first, no dependencies plugins are loaded by the object key configuration order, see <a href="./plugin.md">Plugin</a> for details.</li><li>Frameworks are loaded by the order of inheritance, the lower the more priority.</li></ul><p>For example, an application is configured with the following dependencies</p><pre><code>app
| ├── plugin2 (depends plugin3)
| └── plugin3
└── framework1
    | └── plugin1
    └── egg</code></pre><p>The final loading order is</p><pre><code>=&gt; plugin1
=&gt; plugin3
=&gt; plugin2
=&gt; egg
=&gt; framework1
=&gt; app</code></pre><p>The plugin1 is framework1 depended plugin, the object key order of plugin1 after configuration merger is prior to plugin2/plugin3. Because of the dependencies between plugin2 and plugin3, the order is swapped. The framework1 inherits the Egg, so the order it after the egg. The application is the last to be loaded.</p><p>See <a href="https://github.com/eggjs/egg-core/blob/65ea778a4f2156a9cebd3951dac12c4f9455e636/lib/loader/egg_loader.js#L233">Loader.getLoadUnits</a> method for details.</p><h3 id="file-order">File order</h3><p>The above lists default loading files, Egg will load files by the following order, each file or directory will be loaded according to loadUnit order (application, framework and plugin are different).</p><ul><li>Loading <a href="./plugin.md">plugin</a>, find application and framework, loading <code>config/plugin.js</code></li><li>Loading <a href="../basics/config.md">config</a>, traverse loadUnit to load <code>config/config.{env}.js</code></li><li>Loading <a href="../basics/extend.md">extend</a>, traverse loadUnit to load <code>app/extend/xx.js</code></li><li><a href="../basics/app-start.md">Application startup configuration</a>, traverse loadUnit to load <code>app.js</code> and <code>agent.js</code></li><li>Loading <a href="../basics/service.md">service</a>, traverse loadUnit to load <code>app/service</code> directory</li><li>Loading <a href="../basics/middleware.md">middleware</a>, traverse loadUnit to load <code>app/middleware</code> directory</li><li>Loading <a href="../basics/controller.md">controller</a>, loading application&#x27;s <code>app/controller</code> directory</li><li>Loading <a href="../basics/router.md">router</a>, loading application&#x27;s <code>app/router.js</code></li></ul><p>Note</p><ul><li>Same name will be override in loading, for example, if we want to override <code>ctx.ip</code> we could define ip in application&#x27;s <code>app/extend/context.js</code> directly.</li><li>See <a href="./framework.md">framework development</a> for detail application launch order.</li></ul><h3 id="loading-file-rules">Loading File rules</h3><p>The framework will convert file names when loading files, because there is a difference between the file naming style and the API style. We recommend that files use underscores, while APIs use lower camel case. For examplem <code>app/service/user_info.js</code> will be converted to <code>app.service.userInfo</code>.</p><p>The framework also supports hyphens and camel case.</p><ul><li><code>app/service/user-info.js</code> =&gt; <code>app.service.userInfo</code></li><li><code>app/service/userInfo.js</code> =&gt; <code>app.service.userInfo</code></li></ul><p>Loader also provides <a href="#caseStyle-string">caseStyle</a> to force the first letter case, such as make the first letter of the API upper case when loading the model, <code>app/model/user.js</code> =&gt; <code>app.model.User</code>, we can set <code>caseStyle: &#x27;upper&#x27;</code>.</p><h2 id="extend-loader">Extend Loader</h2><p><a href="https://github.com/eggjs/egg-core/blob/master/lib/loader/egg_loader.js">Loader</a> is a base class and provides some built-in methods based on the rules of the file loading, but itself does not call them in most cases, inherited classes call those methods.</p><ul><li>loadPlugin()</li><li>loadConfig()</li><li>loadAgentExtend()</li><li>loadApplicationExtend()</li><li>loadRequestExtend()</li><li>loadResponseExtend()</li><li>loadContextExtend()</li><li>loadHelperExtend()</li><li>loadCustomAgent()</li><li>loadCustomApp()</li><li>loadService()</li><li>loadMiddleware()</li><li>loadController()</li><li>loadRouter()</li></ul><p>Egg implements <a href="https://github.com/eggjs/egg/blob/master/lib/loader/app_worker_loader.js">AppWorkerLoader</a> and <a href="https://github.com/eggjs/egg/blob/master/lib/loader/agent_worker_loader.js">AgentWorkerLoader</a> based on the Loader, inherited frameworks could make extensions based on these two classes, and <strong>Extensions of the Loader can only be done in the framework</strong>.</p><pre><code class="language-js">// custom AppWorkerLoader
// lib/framework.js
const path = require(&#x27;path&#x27;);
const egg = require(&#x27;egg&#x27;);
const EGG_PATH = Symbol.for(&#x27;egg#eggPath&#x27;);

class YadanAppWorkerLoader extends egg.AppWorkerLoader {
  constructor(opt) {
    super(opt);
    // custom initialization
  }

  loadConfig() {
    super.loadConfig();
    // process config
  }

  load() {
    super.load();
    // custom loading other directories
    // or processing loaded files
  }
}

class Application extends egg.Application {
  get [EGG_PATH]() {
    return path.dirname(__dirname);
  }
  // override Egg&#x27;s Loader, use this Loader when launching
  get [EGG_LOADER]() {
    return YadanAppWorkerLoader;
  }
}

module.exports = Object.assign(egg, {
  Application,
  // custom Loader also need export, inherited framework make extensions based on it
  AppWorkerLoader: YadanAppWorkerLoader,
});</code></pre><p>It&#x27;s convenient for development team to customize loading via the Loader supported APIs. such as <code>this.model.xx</code>, <code>app/extend/filter.js</code> and so on.</p><p>The above is just a description of the Loader wording, see <a href="./framework.md">Framework Development</a> for details.</p><h2 id="loader-api">Loader API</h2><p>Loader also supports some low level APIs to simplify code when extending, <a href="https://github.com/eggjs/egg-core#eggloader">here</a> are all APIs.</p><h3 id="loadfile">loadFile</h3><p>Used to load a file, such as loading <code>app.js</code> is using this method.</p><pre><code class="language-js">// app/xx.js
module.exports = app =&gt; {
  console.log(app.config);
};

// app.js
// app/xx.js, as an example, we could load this file in app.js
const path = require(&#x27;path&#x27;);
module.exports = app =&gt; {
  app.loader.loadFile(path.join(app.config.baseDir, &#x27;app/xx.js&#x27;));
};</code></pre><p>If the file export a function, then the function will be called with app as a parameter, otherwise using this value directly.</p><h3 id="loadtoapp">loadToApp</h3><p>Used to load files from a directory into the app, such as <code>app/controller/home.js</code> to <code>app.controller.home</code>.</p><pre><code class="language-js">// app.js
// The following is just an example, using loadController to load controller in practice
module.exports = app =&gt; {
  const directory = path.join(app.config.baseDir, &#x27;app/controller&#x27;);
  app.loader.loadToApp(directory, &#x27;controller&#x27;);
};</code></pre><p>The method has three parameters <code>loadToApp(directory, property, LoaderOptions)</code></p><ol><li>directory could be String or Array, Loader will load files in those directories.</li><li>property is app&#x27;s property.</li><li><a href="#LoaderOptions">LoaderOptions</a> are some configurations.</li></ol><h3 id="loadtocontext">loadToContext</h3><p>The difference between loadToApp and loadToContext is that loadToContext loading files into ctx instead of app, and it is lazy loading. Putting files into a temp object when loading, and instantiate object when calling ctx API.</p><p>For example, service loading is this mode</p><pre><code class="language-js">// The following is just an example, using loadService in practice
// app/service/user.js
const Service = require(&#x27;egg&#x27;).Service;
class UserService extends Service {

}
module.exports = UserService;

// app.js
// get all loadUnit
const servicePaths = app.loader.getLoadUnits().map(unit =&gt; path.join(unit.path, &#x27;app/service&#x27;));

app.loader.loadToContext(servicePaths, &#x27;service&#x27;, {
  // service needs to inherit app.Service, so needs app as parameter
  // enable call will return UserService when loading
  call: true,
  // loading file into app.serviceClasses
  fieldClass: &#x27;serviceClasses&#x27;,
});</code></pre><p><code>app.serviceClasses.user</code> becomes UserService after file loading, instantiating UserService when calling <code>ctx.service.user</code>.
So this class will only be instantiated when first calling, and will be cached after instantiation, multiple calling same request will only instantiating once.</p><h3 id="loaderoptions">LoaderOptions</h3><h4 id="ignore-string">ignore <a href="">String</a></h4><p>ignore could ignore some files, supports glob, the default is empty</p><pre><code class="language-js">app.loader.loadToApp(directory, &#x27;controller&#x27;, {
  // ignore files in app/controller/util
  ignore: &#x27;util/**&#x27;,
});</code></pre><h4 id="initializer-function">initializer <a href="">Function</a></h4><p>Processing each file exported values, the default is empty. </p><pre><code class="language-js">// app/model/user.js
module.exports = class User {
  constructor(app, path) {}
}

// Loading from app/model, could do some initializations when loading.
const directory = path.join(app.config.baseDir, &#x27;app/model&#x27;);
app.loader.loadToApp(directory, &#x27;model&#x27;, {
  initializer(model, opt) {
    // The first parameter is export&#x27;s object
    // The second parameter is an object that only contains current file path.
    return new model(app, opt.path);
  },
});</code></pre><h4 id="casestyle-string">caseStyle <a href="">String</a></h4><p>File conversion rules, could be <code>camel</code>, <code>upper</code>, <code>lower</code>, the default is <code>camel</code>.</p><p>All three convert file name to camel case, but deal with the initials differently.</p><ul><li><code>camel</code>: initials unchanged.</li><li><code>upper</code>: initials upper case.</li><li><code>lower</code>: initials lower case.</li></ul><p>Loading different files using different configurations.</p><table><thead><tr><th>File</th><th>Configuration</th></tr></thead><tbody><tr><td>app/controller</td><td>lower</td></tr><tr><td>app/middleware</td><td>lower</td></tr><tr><td>app/service</td><td>lower</td></tr></tbody></table><h4 id="override-boolean">override <a href="">Boolean</a></h4><p>Overriding or throwing exception when encounter existing files, the default is false</p><p>For example, the <code>app/service/user.js</code> is both loaded by the application and the plugin, if the setting is true, the application will override the plugin, otherwise an error will be throwed when loading.</p><p>Loading different files using different configurations.</p><table><thead><tr><th>File</th><th>Configuration</th></tr></thead><tbody><tr><td>app/controller</td><td>true</td></tr><tr><td>app/middleware</td><td>false</td></tr><tr><td>app/service</td><td>false</td></tr></tbody></table><h4 id="call-boolean">call <a href="">Boolean</a></h4><p>Calling when export&#x27;s object is function, and get the return value, the default is true </p><p>Loading different files using different configurations.</p><table><thead><tr><th>File</th><th>Configuration</th></tr></thead><tbody><tr><td>app/controller</td><td>true</td></tr><tr><td>app/middleware</td><td>false</td></tr><tr><td>app/service</td><td>true</td></tr></tbody></table></div></div></div><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-0 ant-col-md-6"><div class="markdown-body" style="font-size:14px"><div><ul><li><a href="#application-framework-and-plugin">Application, Framework and Plugin</a></li><li><a href="#loadunit">loadUnit</a><ul><li><a href="#file-order">File order</a></li><li><a href="#loading-file-rules">Loading File rules</a></li></ul></li><li><a href="#extend-loader">Extend Loader</a></li><li><a href="#loader-api">Loader API</a><ul><li><a href="#loadfile">loadFile</a></li><li><a href="#loadtoapp">loadToApp</a></li><li><a href="#loadtocontext">loadToContext</a></li><li><a href="#loaderoptions">LoaderOptions</a><ul><li><a href="#ignore-string">ignore [String]</a></li><li><a href="#initializer-function">initializer [Function]</a></li><li><a href="#casestyle-string">caseStyle [String]</a></li><li><a href="#override-boolean">override [Boolean]</a></li><li><a href="#call-boolean">call [Boolean]</a></li></ul></li></ul></li></ul></div></div></div></div></div></div></div></div></div><script type="text/javascript">window.__INIT_STATE__={"lang":"en","props":{"toc":"-%20%5BApplication%2C%20Framework%20and%20Plugin%5D(%23application-framework-and-plugin)%0A-%20%5BloadUnit%5D(%23loadunit)%0A%20%20*%20%5BFile%20order%5D(%23file-order)%0A%20%20*%20%5BLoading%20File%20rules%5D(%23loading-file-rules)%0A-%20%5BExtend%20Loader%5D(%23extend-loader)%0A-%20%5BLoader%20API%5D(%23loader-api)%0A%20%20*%20%5BloadFile%5D(%23loadfile)%0A%20%20*%20%5BloadToApp%5D(%23loadtoapp)%0A%20%20*%20%5BloadToContext%5D(%23loadtocontext)%0A%20%20*%20%5BLoaderOptions%5D(%23loaderoptions)%0A%20%20%20%20%2B%20%5Bignore%20%5BString%5D%5D(%23ignore-string)%0A%20%20%20%20%2B%20%5Binitializer%20%5BFunction%5D%5D(%23initializer-function)%0A%20%20%20%20%2B%20%5BcaseStyle%20%5BString%5D%5D(%23casestyle-string)%0A%20%20%20%20%2B%20%5Boverride%20%5BBoolean%5D%5D(%23override-boolean)%0A%20%20%20%20%2B%20%5Bcall%20%5BBoolean%5D%5D(%23call-boolean)","meta":{"info":{"title":"Loader"}},"content":"%0A%0A%0AThe%20most%20important%20of%20Egg%20enhance%20Koa%20is%20Egg%20based%20on%20a%20certain%20agreement%2C%20code%20will%20be%20placed%20in%20different%20directories%20according%20to%20the%20functional%20differences%2C%20it%20significantly%20reduce%20development%20costs.%20Loader%20supports%20this%20set%20of%20conventions%20and%20abstracts%20that%20many%20low-level%20APIs%20could%20be%20extended.%0A%0A%23%23%20Application%2C%20Framework%20and%20Plugin%0A%0AEgg%20is%20a%20low-level%20framework%2C%20applications%20could%20use%20it%20directly%2C%20but%20Egg%20only%20has%20a%20little%20default%20plugins%2C%20applications%20need%20to%20configure%20plugins%20to%20extend%20features%2C%20such%20as%20MySQL.%0A%0A%60%60%60js%0A%2F%2F%20application%20configuration%0A%2F%2F%20package.json%0A%7B%0A%20%20%22dependencies%22%3A%20%7B%0A%20%20%20%20%22egg%22%3A%20%22%5E2.0.0%22%2C%0A%20%20%20%20%22egg-mysql%22%3A%20%22%5E3.0.0%22%0A%20%20%7D%0A%7D%0A%0A%2F%2F%20config%2Fplugin.js%0Amodule.exports%20%3D%20%7B%0A%20%20mysql%3A%20%7B%0A%20%20%20%20enable%3A%20true%2C%0A%20%20%20%20package%3A%20'egg-mysql'%2C%0A%20%20%7D%2C%0A%7D%0A%60%60%60%0A%0AWith%20the%20increase%20number%20of%20applications%2C%20we%20find%20most%20of%20them%20have%20similar%20configurations%2C%20then%20we%20could%20extend%20a%20new%20framework%20based%20on%20Egg%2C%20which%20make%20the%20application%20configuration%20simpler.%0A%0A%60%60%60js%0A%2F%2F%20framework%20configuration%0A%2F%2F%20package.json%0A%7B%0A%20%20%22name%22%3A%20%22framework1%22%2C%0A%20%20%22version%22%3A%20%221.0.0%22%2C%0A%20%20%22dependencies%22%3A%20%7B%0A%20%20%20%20%22egg-mysql%22%3A%20%22%5E3.0.0%22%2C%0A%20%20%20%20%22egg-view-nunjucks%22%3A%20%22%5E2.0.0%22%0A%20%20%7D%0A%7D%0A%0A%2F%2F%20config%2Fplugin.js%0Amodule.exports%20%3D%20%7B%0A%20%20mysql%3A%20%7B%0A%20%20%20%20enable%3A%20false%2C%0A%20%20%20%20package%3A%20'egg-mysql'%2C%0A%20%20%7D%2C%0A%20%20view%3A%20%7B%0A%20%20%20%20enable%3A%20false%2C%0A%20%20%20%20package%3A%20'egg-view-nunjucks'%2C%0A%20%20%7D%0A%7D%0A%0A%2F%2F%20application%20configuration%0A%2F%2F%20package.json%0A%7B%0A%20%20%22dependencies%22%3A%20%7B%0A%20%20%20%20%22framework1%22%3A%20%22%5E1.0.0%22%2C%0A%20%20%7D%0A%7D%0A%0A%2F%2F%20config%2Fplugin.js%0Amodule.exports%20%3D%20%7B%0A%20%20%2F%2F%20enable%20plugins%0A%20%20mysql%3A%20true%2C%0A%20%20view%3A%20true%2C%0A%7D%0A%60%60%60%0A%0AFrom%20the%20above%20scene%20we%20can%20see%20the%20relationship%20of%20application%2C%20plugin%20and%20framework.%0A%0A-%20We%20implement%20business%20logics%20in%20application%2C%20we%20need%20to%20specify%20a%20framework%20to%20run%2C%20we%20could%20configure%20plugin%20to%20meet%20a%20special%20scene%20feature%20(such%20as%20MySQL).%0A-%20Plugin%20only%20performs%20specific%20function%2C%20when%20two%20separate%20functions%20are%20interdependent%2C%20they%20still%20need%20to%20be%20separated%20into%20two%20plugins%2C%20and%20requires%20configuration.%0A-%20Framework%20is%20a%20launcher%20(default%20is%20Egg)%2C%20which%20is%20indispensable%20to%20run.%20Framework%20is%20also%20a%20wrapper%2C%20it%20aggregates%20plugins%20to%20provide%20functions%20unitedly%2C%20framework%20can%20also%20configure%20plugins.%0A-%20We%20can%20extend%20a%20new%20framework%20based%20on%20framework%2C%20which%20means%20that%20**framework%20can%20be%20inherited%20infinitely**%2C%20like%20class%20inheritance.%0A%0A%60%60%60%0A%2B-----------------------------------%2B--------%2B%0A%7C%20%20%20%20%20%20app1%2C%20app2%2C%20app3%2C%20app4%20%20%20%20%20%20%20%7C%20%20%20%20%20%20%20%20%7C%0A%2B-----%2B--------------%2B--------------%2B%20%20%20%20%20%20%20%20%7C%0A%7C%20%20%20%20%20%7C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20%20framework3%20%20%7C%20%20%20%20%20%20%20%20%7C%0A%2B%20%20%20%20%20%7C%20%20framework1%20%20%2B--------------%2B%20plugin%20%7C%0A%7C%20%20%20%20%20%7C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20%20framework2%20%20%7C%20%20%20%20%20%20%20%20%7C%0A%2B%20%20%20%20%20%2B--------------%2B--------------%2B%20%20%20%20%20%20%20%20%7C%0A%7C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Egg%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20%20%20%20%20%20%20%20%7C%0A%2B-----------------------------------%2B--------%7C%0A%7C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Koa%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%2B-----------------------------------%2B--------%2B%0A%60%60%60%0A%0A%23%23%20loadUnit%0A%0AEgg%20regard%20application%2C%20framework%20and%20plugin%20as%20loadUnit%2C%20because%20they%20are%20similar%20in%20code%20structure%2C%20here%20is%20the%20directory%20structure%0A%0A%60%60%60%0AloadUnit%0A%E2%94%9C%E2%94%80%E2%94%80%20package.json%0A%E2%94%9C%E2%94%80%E2%94%80%20app.js%0A%E2%94%9C%E2%94%80%E2%94%80%20agent.js%0A%E2%94%9C%E2%94%80%E2%94%80%20app%0A%E2%94%82%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20extend%0A%E2%94%82%20%20%20%7C%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20helper.js%0A%E2%94%82%20%20%20%7C%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20request.js%0A%E2%94%82%20%20%20%7C%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20response.js%0A%E2%94%82%20%20%20%7C%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20context.js%0A%E2%94%82%20%20%20%7C%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20application.js%0A%E2%94%82%20%20%20%7C%20%20%20%E2%94%94%E2%94%80%E2%94%80%20agent.js%0A%E2%94%82%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20service%0A%E2%94%82%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20middleware%0A%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20router.js%0A%E2%94%94%E2%94%80%E2%94%80%20config%0A%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20config.default.js%0A%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20config.prod.js%0A%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20config.test.js%0A%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20config.local.js%0A%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%20config.unittest.js%0A%60%60%60%0A%0AHowever%2C%20there%20are%20still%20some%20differences%0A%0AFile%20%7C%20Application%20%7C%20Framework%20%7C%20Plugin%0A---%20%7C%20---%20%7C%20---%20%7C%20---%0Aapp%2Frouter.js%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%7C%0Aapp%2Fcontroller%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%7C%0Aapp%2Fmiddleware%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%0Aapp%2Fservice%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%0Aapp%2Fextend%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%0Aapp.js%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%0Aagent.js%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%0Aconfig%2Fconfig.%7Benv%7D.js%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%0Aconfig%2Fplugin.js%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%0Apackage.json%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%20%7C%20%E2%9C%94%EF%B8%8E%0A%0ADuring%20the%20loading%20process%2C%20Egg%20will%20traverse%20all%20loadUnits%20to%20load%20the%20above%20files%20(application%2C%20framework%20and%20plugin%20are%20different)%2C%20the%20loading%20process%20has%20priority.%0A%0A-%20follow%20the%20order%20Plugin%20%3D%3E%20Framework%20%3D%3E%20Application%20to%20load%0A-%20The%20order%20of%20loading%20plugins%20depends%20on%20the%20dependencies%2C%20depended%20plugins%20will%20be%20loaded%20first%2C%20no%20dependencies%20plugins%20are%20loaded%20by%20the%20object%20key%20configuration%20order%2C%20see%20%5BPlugin%5D(.%2Fplugin.md)%20for%20details.%0A-%20Frameworks%20are%20loaded%20by%20the%20order%20of%20inheritance%2C%20the%20lower%20the%20more%20priority.%0A%0AFor%20example%2C%20an%20application%20is%20configured%20with%20the%20following%20dependencies%0A%0A%60%60%60%0Aapp%0A%7C%20%E2%94%9C%E2%94%80%E2%94%80%20plugin2%20(depends%20plugin3)%0A%7C%20%E2%94%94%E2%94%80%E2%94%80%20plugin3%0A%E2%94%94%E2%94%80%E2%94%80%20framework1%0A%20%20%20%20%7C%20%E2%94%94%E2%94%80%E2%94%80%20plugin1%0A%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%20egg%0A%60%60%60%0A%0AThe%20final%20loading%20order%20is%0A%0A%60%60%60%0A%3D%3E%20plugin1%0A%3D%3E%20plugin3%0A%3D%3E%20plugin2%0A%3D%3E%20egg%0A%3D%3E%20framework1%0A%3D%3E%20app%0A%60%60%60%0A%0AThe%20plugin1%20is%20framework1%20depended%20plugin%2C%20the%20object%20key%20order%20of%20plugin1%20after%20configuration%20merger%20is%20prior%20to%20plugin2%2Fplugin3.%20Because%20of%20the%20dependencies%20between%20plugin2%20and%20plugin3%2C%20the%20order%20is%20swapped.%20The%20framework1%20inherits%20the%20Egg%2C%20so%20the%20order%20it%20after%20the%20egg.%20The%20application%20is%20the%20last%20to%20be%20loaded.%0A%0ASee%20%5BLoader.getLoadUnits%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-core%2Fblob%2F65ea778a4f2156a9cebd3951dac12c4f9455e636%2Flib%2Floader%2Fegg_loader.js%23L233)%20method%20for%20details.%0A%0A%23%23%23%20File%20order%0A%0AThe%20above%20lists%20default%20loading%20files%2C%20Egg%20will%20load%20files%20by%20the%20following%20order%2C%20each%20file%20or%20directory%20will%20be%20loaded%20according%20to%20loadUnit%20order%20(application%2C%20framework%20and%20plugin%20are%20different).%0A%0A-%20Loading%20%5Bplugin%5D(.%2Fplugin.md)%2C%20find%20application%20and%20framework%2C%20loading%20%60config%2Fplugin.js%60%0A-%20Loading%20%5Bconfig%5D(..%2Fbasics%2Fconfig.md)%2C%20traverse%20loadUnit%20to%20load%20%60config%2Fconfig.%7Benv%7D.js%60%0A-%20Loading%20%5Bextend%5D(..%2Fbasics%2Fextend.md)%2C%20traverse%20loadUnit%20to%20load%20%60app%2Fextend%2Fxx.js%60%0A-%20%5BApplication%20startup%20configuration%5D(..%2Fbasics%2Fapp-start.md)%2C%20traverse%20loadUnit%20to%20load%20%60app.js%60%20and%20%60agent.js%60%0A-%20Loading%20%5Bservice%5D(..%2Fbasics%2Fservice.md)%2C%20traverse%20loadUnit%20to%20load%20%60app%2Fservice%60%20directory%0A-%20Loading%20%5Bmiddleware%5D(..%2Fbasics%2Fmiddleware.md)%2C%20traverse%20loadUnit%20to%20load%20%60app%2Fmiddleware%60%20directory%0A-%20Loading%20%5Bcontroller%5D(..%2Fbasics%2Fcontroller.md)%2C%20loading%20application's%20%60app%2Fcontroller%60%20directory%0A-%20Loading%20%5Brouter%5D(..%2Fbasics%2Frouter.md)%2C%20loading%20application's%20%60app%2Frouter.js%60%0A%0ANote%0A%0A-%20Same%20name%20will%20be%20override%20in%20loading%2C%20for%20example%2C%20if%20we%20want%20to%20override%20%60ctx.ip%60%20we%20could%20define%20ip%20in%20application's%20%60app%2Fextend%2Fcontext.js%60%20directly.%0A-%20See%20%5Bframework%20development%5D(.%2Fframework.md)%20for%20detail%20application%20launch%20order.%0A%0A%23%23%23%20Loading%20File%20rules%0A%0AThe%20framework%20will%20convert%20file%20names%20when%20loading%20files%2C%20because%20there%20is%20a%20difference%20between%20the%20file%20naming%20style%20and%20the%20API%20style.%20We%20recommend%20that%20files%20use%20underscores%2C%20while%20APIs%20use%20lower%20camel%20case.%20For%20examplem%20%60app%2Fservice%2Fuser_info.js%60%20will%20be%20converted%20to%20%60app.service.userInfo%60.%0A%0AThe%20framework%20also%20supports%20hyphens%20and%20camel%20case.%0A%0A-%20%60app%2Fservice%2Fuser-info.js%60%20%3D%3E%20%60app.service.userInfo%60%0A-%20%60app%2Fservice%2FuserInfo.js%60%20%3D%3E%20%60app.service.userInfo%60%0A%0ALoader%20also%20provides%20%5BcaseStyle%5D(%23caseStyle-string)%20to%20force%20the%20first%20letter%20case%2C%20such%20as%20make%20the%20first%20letter%20of%20the%20API%20upper%20case%20when%20loading%20the%20model%2C%20%60app%2Fmodel%2Fuser.js%60%20%3D%3E%20%60app.model.User%60%2C%20we%20can%20set%20%60caseStyle%3A%20'upper'%60.%0A%0A%23%23%20Extend%20Loader%0A%0A%5BLoader%5D%20is%20a%20base%20class%20and%20provides%20some%20built-in%20methods%20based%20on%20the%20rules%20of%20the%20file%20loading%2C%20but%20itself%20does%20not%20call%20them%20in%20most%20cases%2C%20inherited%20classes%20call%20those%20methods.%0A%0A-%20loadPlugin()%0A-%20loadConfig()%0A-%20loadAgentExtend()%0A-%20loadApplicationExtend()%0A-%20loadRequestExtend()%0A-%20loadResponseExtend()%0A-%20loadContextExtend()%0A-%20loadHelperExtend()%0A-%20loadCustomAgent()%0A-%20loadCustomApp()%0A-%20loadService()%0A-%20loadMiddleware()%0A-%20loadController()%0A-%20loadRouter()%0A%0AEgg%20implements%20%5BAppWorkerLoader%5D%20and%20%5BAgentWorkerLoader%5D%20based%20on%20the%20Loader%2C%20inherited%20frameworks%20could%20make%20extensions%20based%20on%20these%20two%20classes%2C%20and%20**Extensions%20of%20the%20Loader%20can%20only%20be%20done%20in%20the%20framework**.%0A%0A%60%60%60js%0A%2F%2F%20custom%20AppWorkerLoader%0A%2F%2F%20lib%2Fframework.js%0Aconst%20path%20%3D%20require('path')%3B%0Aconst%20egg%20%3D%20require('egg')%3B%0Aconst%20EGG_PATH%20%3D%20Symbol.for('egg%23eggPath')%3B%0A%0Aclass%20YadanAppWorkerLoader%20extends%20egg.AppWorkerLoader%20%7B%0A%20%20constructor(opt)%20%7B%0A%20%20%20%20super(opt)%3B%0A%20%20%20%20%2F%2F%20custom%20initialization%0A%20%20%7D%0A%0A%20%20loadConfig()%20%7B%0A%20%20%20%20super.loadConfig()%3B%0A%20%20%20%20%2F%2F%20process%20config%0A%20%20%7D%0A%0A%20%20load()%20%7B%0A%20%20%20%20super.load()%3B%0A%20%20%20%20%2F%2F%20custom%20loading%20other%20directories%0A%20%20%20%20%2F%2F%20or%20processing%20loaded%20files%0A%20%20%7D%0A%7D%0A%0Aclass%20Application%20extends%20egg.Application%20%7B%0A%20%20get%20%5BEGG_PATH%5D()%20%7B%0A%20%20%20%20return%20path.dirname(__dirname)%3B%0A%20%20%7D%0A%20%20%2F%2F%20override%20Egg's%20Loader%2C%20use%20this%20Loader%20when%20launching%0A%20%20get%20%5BEGG_LOADER%5D()%20%7B%0A%20%20%20%20return%20YadanAppWorkerLoader%3B%0A%20%20%7D%0A%7D%0A%0Amodule.exports%20%3D%20Object.assign(egg%2C%20%7B%0A%20%20Application%2C%0A%20%20%2F%2F%20custom%20Loader%20also%20need%20export%2C%20inherited%20framework%20make%20extensions%20based%20on%20it%0A%20%20AppWorkerLoader%3A%20YadanAppWorkerLoader%2C%0A%7D)%3B%0A%60%60%60%0A%0AIt's%20convenient%20for%20development%20team%20to%20customize%20loading%20via%20the%20Loader%20supported%20APIs.%20such%20as%20%60this.model.xx%60%2C%20%60app%2Fextend%2Ffilter.js%60%20and%20so%20on.%0A%0AThe%20above%20is%20just%20a%20description%20of%20the%20Loader%20wording%2C%20see%20%5BFramework%20Development%5D(.%2Fframework.md)%20for%20details.%0A%0A%23%23%20Loader%20API%0A%0ALoader%20also%20supports%20some%20low%20level%20APIs%20to%20simplify%20code%20when%20extending%2C%20%5Bhere%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-core%23eggloader)%20are%20all%20APIs.%0A%0A%23%23%23%20loadFile%0A%0AUsed%20to%20load%20a%20file%2C%20such%20as%20loading%20%60app.js%60%20is%20using%20this%20method.%0A%0A%60%60%60js%0A%2F%2F%20app%2Fxx.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20console.log(app.config)%3B%0A%7D%3B%0A%0A%2F%2F%20app.js%0A%2F%2F%20app%2Fxx.js%2C%20as%20an%20example%2C%20we%20could%20load%20this%20file%20in%20app.js%0Aconst%20path%20%3D%20require('path')%3B%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20app.loader.loadFile(path.join(app.config.baseDir%2C%20'app%2Fxx.js'))%3B%0A%7D%3B%0A%60%60%60%0A%0AIf%20the%20file%20export%20a%20function%2C%20then%20the%20function%20will%20be%20called%20with%20app%20as%20a%20parameter%2C%20otherwise%20using%20this%20value%20directly.%0A%0A%23%23%23%20loadToApp%0A%0AUsed%20to%20load%20files%20from%20a%20directory%20into%20the%20app%2C%20such%20as%20%60app%2Fcontroller%2Fhome.js%60%20to%20%60app.controller.home%60.%0A%0A%60%60%60js%0A%2F%2F%20app.js%0A%2F%2F%20The%20following%20is%20just%20an%20example%2C%20using%20loadController%20to%20load%20controller%20in%20practice%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20const%20directory%20%3D%20path.join(app.config.baseDir%2C%20'app%2Fcontroller')%3B%0A%20%20app.loader.loadToApp(directory%2C%20'controller')%3B%0A%7D%3B%0A%60%60%60%0A%0AThe%20method%20has%20three%20parameters%20%60loadToApp(directory%2C%20property%2C%20LoaderOptions)%60%0A%0A1.%20directory%20could%20be%20String%20or%20Array%2C%20Loader%20will%20load%20files%20in%20those%20directories.%0A1.%20property%20is%20app's%20property.%0A1.%20%5BLoaderOptions%5D(%23LoaderOptions)%20are%20some%20configurations.%0A%0A%23%23%23%20loadToContext%0A%0AThe%20difference%20between%20loadToApp%20and%20loadToContext%20is%20that%20loadToContext%20loading%20files%20into%20ctx%20instead%20of%20app%2C%20and%20it%20is%20lazy%20loading.%20Putting%20files%20into%20a%20temp%20object%20when%20loading%2C%20and%20instantiate%20object%20when%20calling%20ctx%20API.%0A%0AFor%20example%2C%20service%20loading%20is%20this%20mode%0A%0A%60%60%60js%0A%2F%2F%20The%20following%20is%20just%20an%20example%2C%20using%20loadService%20in%20practice%0A%2F%2F%20app%2Fservice%2Fuser.js%0Aconst%20Service%20%3D%20require('egg').Service%3B%0Aclass%20UserService%20extends%20Service%20%7B%0A%0A%7D%0Amodule.exports%20%3D%20UserService%3B%0A%0A%2F%2F%20app.js%0A%2F%2F%20get%20all%20loadUnit%0Aconst%20servicePaths%20%3D%20app.loader.getLoadUnits().map(unit%20%3D%3E%20path.join(unit.path%2C%20'app%2Fservice'))%3B%0A%0Aapp.loader.loadToContext(servicePaths%2C%20'service'%2C%20%7B%0A%20%20%2F%2F%20service%20needs%20to%20inherit%20app.Service%2C%20so%20needs%20app%20as%20parameter%0A%20%20%2F%2F%20enable%20call%20will%20return%20UserService%20when%20loading%0A%20%20call%3A%20true%2C%0A%20%20%2F%2F%20loading%20file%20into%20app.serviceClasses%0A%20%20fieldClass%3A%20'serviceClasses'%2C%0A%7D)%3B%0A%60%60%60%0A%0A%60app.serviceClasses.user%60%20becomes%20UserService%20after%20file%20loading%2C%20instantiating%20UserService%20when%20calling%20%60ctx.service.user%60.%0ASo%20this%20class%20will%20only%20be%20instantiated%20when%20first%20calling%2C%20and%20will%20be%20cached%20after%20instantiation%2C%20multiple%20calling%20same%20request%20will%20only%20instantiating%20once.%0A%0A%23%23%23%20LoaderOptions%0A%0A%23%23%23%23%20ignore%20%5BString%5D%0A%0Aignore%20could%20ignore%20some%20files%2C%20supports%20glob%2C%20the%20default%20is%20empty%0A%0A%60%60%60js%0Aapp.loader.loadToApp(directory%2C%20'controller'%2C%20%7B%0A%20%20%2F%2F%20ignore%20files%20in%20app%2Fcontroller%2Futil%0A%20%20ignore%3A%20'util%2F**'%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%23%20initializer%20%5BFunction%5D%0A%0AProcessing%20each%20file%20exported%20values%2C%20the%20default%20is%20empty.%20%0A%0A%60%60%60js%0A%2F%2F%20app%2Fmodel%2Fuser.js%0Amodule.exports%20%3D%20class%20User%20%7B%0A%20%20constructor(app%2C%20path)%20%7B%7D%0A%7D%0A%0A%2F%2F%20Loading%20from%20app%2Fmodel%2C%20could%20do%20some%20initializations%20when%20loading.%0Aconst%20directory%20%3D%20path.join(app.config.baseDir%2C%20'app%2Fmodel')%3B%0Aapp.loader.loadToApp(directory%2C%20'model'%2C%20%7B%0A%20%20initializer(model%2C%20opt)%20%7B%0A%20%20%20%20%2F%2F%20The%20first%20parameter%20is%20export's%20object%0A%20%20%20%20%2F%2F%20The%20second%20parameter%20is%20an%20object%20that%20only%20contains%20current%20file%20path.%0A%20%20%20%20return%20new%20model(app%2C%20opt.path)%3B%0A%20%20%7D%2C%0A%7D)%3B%0A%60%60%60%0A%0A%23%23%23%23%20caseStyle%20%5BString%5D%0A%0AFile%20conversion%20rules%2C%20could%20be%20%60camel%60%2C%20%60upper%60%2C%20%60lower%60%2C%20the%20default%20is%20%60camel%60.%0A%0AAll%20three%20convert%20file%20name%20to%20camel%20case%2C%20but%20deal%20with%20the%20initials%20differently.%0A%0A-%20%60camel%60%3A%20initials%20unchanged.%0A-%20%60upper%60%3A%20initials%20upper%20case.%0A-%20%60lower%60%3A%20initials%20lower%20case.%0A%0ALoading%20different%20files%20using%20different%20configurations.%0A%0AFile%20%7C%20Configuration%0A---%20%7C%20---%0Aapp%2Fcontroller%20%7C%20lower%0Aapp%2Fmiddleware%20%7C%20lower%0Aapp%2Fservice%20%7C%20lower%0A%0A%23%23%23%23%20override%20%5BBoolean%5D%0A%0AOverriding%20or%20throwing%20exception%20when%20encounter%20existing%20files%2C%20the%20default%20is%20false%0A%0AFor%20example%2C%20the%20%60app%2Fservice%2Fuser.js%60%20is%20both%20loaded%20by%20the%20application%20and%20the%20plugin%2C%20if%20the%20setting%20is%20true%2C%20the%20application%20will%20override%20the%20plugin%2C%20otherwise%20an%20error%20will%20be%20throwed%20when%20loading.%0A%0ALoading%20different%20files%20using%20different%20configurations.%0A%0AFile%20%7C%20Configuration%0A---%20%7C%20---%0Aapp%2Fcontroller%20%7C%20true%0Aapp%2Fmiddleware%20%7C%20false%0Aapp%2Fservice%20%7C%20false%0A%0A%23%23%23%23%20call%20%5BBoolean%5D%0A%0ACalling%20when%20export's%20object%20is%20function%2C%20and%20get%20the%20return%20value%2C%20the%20default%20is%20true%20%0A%0ALoading%20different%20files%20using%20different%20configurations.%0A%0AFile%20%7C%20Configuration%0A---%20%7C%20---%0Aapp%2Fcontroller%20%7C%20true%0Aapp%2Fmiddleware%20%7C%20false%0Aapp%2Fservice%20%7C%20true%0A%0A%5BLoader%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-core%2Fblob%2Fmaster%2Flib%2Floader%2Fegg_loader.js%0A%5BAppWorkerLoader%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg%2Fblob%2Fmaster%2Flib%2Floader%2Fapp_worker_loader.js%0A%5BAgentWorkerLoader%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg%2Fblob%2Fmaster%2Flib%2Floader%2Fagent_worker_loader.js%0A"}}</script><script type="text/javascript" src="/static/js/post.b9faab88.js"></script></body></html>