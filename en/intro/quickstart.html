<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.png"><style class="_styletron_hydrate_"></style><title>Quick Start</title><meta name="description" content="Born to build better enterprise frameworks and apps"><link href="/static/css/post.d62265dc.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="ant-layout" data-reactroot=""><div class="header-module__header___3ADJ9 ant-layout-header"><div class="ant-row-flex"><div class="ant-col-xs-12 ant-col-md-20 ant-col-lg-2"><div class="header-module__logo___3yTXp"><a href="/"><img src="/logo.svg" alt="logo"/></a></div></div><div class="ant-col-xs-0 ant-col-md-0 ant-col-lg-20"><ul class="ant-menu header-module__menu___3yEtW ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-item" role="menuitem"><a href="/en/intro/">Guide</a></li><li class="ant-menu-item" role="menuitem"><a href="/api/">API</a></li><li class="ant-menu-item" role="menuitem"><a href="/en/tutorials/index.html">Tutorials</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/search?q=topic%3Aegg-plugin&amp;type=Repositories">Plugins</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/eggjs/egg/releases">Release</a></li></ul></div><div style="text-align:right" class="ant-col-xs-12 ant-col-md-4 ant-col-lg-2"><button type="button" class="ant-btn"><span>切换语言</span></button></div></div></div><div class="ant-layout-content"><div class="basic_layout-module__content___3flpY ant-layout"><div class="sider-module__side___1Cadj ant-layout-sider ant-layout-sider-light" style="flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"><ul class="ant-menu sider-module__menu___2GqPr ant-menu-light ant-menu-root ant-menu-inline" role="menu"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="0$Menu" aria-haspopup="true"><span>Guide</span><i class="ant-menu-submenu-arrow"></i></div><ul id="0$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/index.html">What is Egg?</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/egg-and-koa.html">Egg and Koa</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/quickstart.html">Quick Start</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/progressive.html">Progressive</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/migration.html">Migration to 2.x</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="1$Menu" aria-haspopup="true"><span>Basis Function</span><i class="ant-menu-submenu-arrow"></i></div><ul id="1$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/structure.html">Directory Structure</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/objects.html">Built-in Objects</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/env.html">Environment</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/config.html">Configuration</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/middleware.html">Middleware</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/router.html">Router</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/controller.html">Controller</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/service.html">Service</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/plugin.html">Plugin</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/schedule.html">Schedule</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/extend.html">Extend</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/app-start.html">Custom Init</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="2$Menu" aria-haspopup="true"><span>Core</span><i class="ant-menu-submenu-arrow"></i></div><ul id="2$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/development.html">Development</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/unittest.html">Unit Testing</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/deployment.html">Deployment</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/logger.html">Logger</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/httpclient.html">HttpClient</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/cookie-and-session.html">Cookie and Session</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/cluster-and-ipc.html">Cluster and IPC</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/view.html">View</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/error-handling.html">Error Handling</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/security.html">Security</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/i18n.html">i18n</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="3$Menu" aria-haspopup="true"><span>Tutorials</span><i class="ant-menu-submenu-arrow"></i></div><ul id="3$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/mysql.html">MySQL</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/restful.html">RESTful API</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/passport.html">Passport</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/socketio.html">Socket.IO</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/assets.html">Assets</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/typescript.html">TypeScript</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="4$Menu" aria-haspopup="true"><span>Advanced</span><i class="ant-menu-submenu-arrow"></i></div><ul id="4$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/loader.html">Loader</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/plugin.html">Plugin Development</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/framework.html">Framework</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/cluster-client.html">Cluster Enhancement</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/view-plugin.html">View Plugin</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/style-guide.html">Style Guide</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="5$Menu" aria-haspopup="true"><span>Community</span><i class="ant-menu-submenu-arrow"></i></div><ul id="5$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/plugins/">Plugin List</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/contributing.html">Contributing</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/resource.html">Resource</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/faq.html">FAQ</a></li></ul></li></ul></div></div><div class="basic_layout-module__post___2Z7KK ant-layout-content"><div class="ant-row" style="margin-left:-8px;margin-right:-8px"><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-24 ant-col-md-18"><div class="markdown-body" style="font-size:14px"><div><p>This guide covers getting up and running a real example using Egg.
By following along with this guide step by step, you can quickly get started with Egg development.</p><h2 id="prerequisites">Prerequisites</h2><ul><li>Operating System: Linux, OS X or Windows.</li><li>Node.js Runtime: 8.x or newer; it is recommended that you use <a href="http://nodejs.org">LTS Releases</a>.</li></ul><h2 id="the-quick-way">the Quick Way</h2><p>To begin with, let&#x27;s quickly initialize the project by using a scaffold,
which will quickly generate some of the major pieces of the application.</p><pre><code class="language-bash">$ npm i egg-init -g
$ egg-init egg-example --type=simple
$ cd egg-example
$ npm i</code></pre><p>Then get up and run by using the following commands.</p><pre><code class="language-bash">$ npm run dev
$ open localhost:7001</code></pre><h2 id="step-by-step">Step by Step</h2><p>Usually you can just use <a href="https://github.com/eggjs/egg-init">egg-init</a> of the previous section,
choose a scaffold that best fits your business model and quickly generate a project,
then get started with the development.</p><p>However, in this section, instead of using scaffolds we will build a project called <a href="https://github.com/eggjs/examples/tree/master/hackernews">Egg HackerNews</a> step by step, for a better understanding of how it works.</p><p><img alt="Egg HackerNews Snapshoot" src="https://cloud.githubusercontent.com/assets/227713/22960991/812999bc-f37d-11e6-8bd5-a96ca37d0ff2.png"/></p><h3 id="initialization">Initialization</h3><p>First let&#x27;s create the project directory and initialize its structure.</p><pre><code class="language-bash">$ mkdir egg-example
$ cd egg-example
$ npm init
$ npm i egg --save
$ npm i egg-bin --save-dev</code></pre><p>Then add <code>npm scripts</code> to <code>package.json</code>.</p><pre><code class="language-json">{
  &quot;name&quot;: &quot;egg-example&quot;,
  &quot;scripts&quot;: {
    &quot;dev&quot;: &quot;egg-bin dev&quot;
  }
}</code></pre><h3 id="create-a-controller">Create a Controller</h3><p>If you are familiar with the MVC architecture,
you might have already guessed that the first thing to create
is a <a href="../basics/controller.md">controller</a> and <a href="../basics/router.md">router</a>.</p><pre><code class="language-js">// app/controller/home.js
const Controller = require(&#x27;egg&#x27;).Controller;

class HomeController extends Controller {
  async index() {
    this.ctx.body = &#x27;Hello world&#x27;;
  }
}

module.exports = HomeController;</code></pre><p>Then edit the router file and add a mapping.</p><pre><code class="language-js">// app/router.js
module.exports = app =&gt; {
  const { router, controller } = app;
  router.get(&#x27;/&#x27;, controller.home.index);
};</code></pre><p>Then add a <a href="../basics/config.md">configuration</a> file:</p><pre><code class="language-js">// config/config.default.js
exports.keys = &lt;YOUR_SECURITY_COOKE_KEYS&gt;;</code></pre><p>The project directory looks like this:</p><pre><code class="language-bash">egg-example
├── app
│   ├── controller
│   │   └── home.js
│   └── router.js
├── config
│   └── config.default.js
└── package.json</code></pre><p>For more information about directory structure, see <a href="../basics/structure.md">Directory Structure</a>.</p><p>Now you can start up the Web Server and see your application in action.</p><pre><code class="language-bash">$ npm run dev
$ open localhost:7001</code></pre><blockquote><p>Note：</p><ul><li>You could write <code>Controller</code> with <code>class</code> or <code>exports</code> style, see more detail at <a href="../basics/controller.md">Controller</a>.</li><li>And <code>Config</code> could write with <code>module.exports</code> or <code>exports</code> style, see more detail at <a href="https://nodejs.org/api/modules.html#modules_exports_shortcut">Node.js modules docs</a>.</li></ul></blockquote><h3 id="add-static-assets">Add Static Assets</h3><p>Egg has a built-in plugin called <a href="https://github.com/eggjs/egg-static">static</a>.
In production, it is recommended that you deploy static assets to CDN instead of using this plugin.</p><p><a href="https://github.com/eggjs/egg-static">static</a> maps <code>/public/*</code> to the directory <code>app/public/*</code> by default.</p><p>In this case, we just need to put our static assets into the directory <code>app/public</code>.</p><pre><code class="language-bash">app/public
├── css
│   └── news.css
└── js
    ├── lib.js
    └── news.js</code></pre><h3 id="add-templates-for-rendering">Add Templates for Rendering</h3><p>In most cases, data are usually read, processed and rendered by the templates before being presented to the user.
Thus we need to introduce corresponding template engines to handle it.</p><p>Egg does not force to use any particular template engines,
but specifies the <a href="../advanced/view-plugin.md">View Plug-ins Specification</a>
to allow the developers to use different plug-ins for their individual needs instead.</p><p>For more information, cf. <a href="../core/view.md">View</a>.</p><p>In this example, we will use <a href="https://mozilla.github.io/nunjucks/">Nunjucks</a>.</p><p>First install the corresponding plug-in <a href="https://github.com/eggjs/egg-view-nunjucks">egg-view-nunjucks</a>.</p><pre><code class="language-bash">$ npm i egg-view-nunjucks --save</code></pre><p>And enable it.</p><pre><code class="language-js">// config/plugin.js
exports.nunjucks = {
  enable: true,
  package: &#x27;egg-view-nunjucks&#x27;
};</code></pre><pre><code class="language-js">// config/config.default.js
exports.keys = &lt;YOUR_SECURITY_COOKE_KEYS&gt;;
// add view&#x27;s configurations
exports.view = {
  defaultViewEngine: &#x27;nunjucks&#x27;,
  mapping: {
    &#x27;.tpl&#x27;: &#x27;nunjucks&#x27;,
  },
};</code></pre><p><strong>Carefully! <code>config</code> dir, not <code>app/config</code>!</strong></p><p>Then create a template for the index page.
This usually goes to the app/view directory.</p><pre><code class="language-html">&lt;!-- app/view/news/list.tpl --&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Egg HackerNews Clone&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;/public/css/news.css&quot; /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;ul class=&quot;news-view view&quot;&gt;
      {% for item in list %}
        &lt;li class=&quot;item&quot;&gt;
          &lt;a href=&quot;{{ item.url }}&quot;&gt;{{ item.title }}&lt;/a&gt;
        &lt;/li&gt;
      {% endfor %}
    &lt;/ul&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre><p>Then add a controller and router.</p><pre><code class="language-js">// app/controller/news.js
const Controller = require(&#x27;egg&#x27;).Controller;

class NewsController extends Controller {
  async list() {
    const dataList = {
      list: [
        { id: 1, title: &#x27;this is news 1&#x27;, url: &#x27;/news/1&#x27; },
        { id: 2, title: &#x27;this is news 2&#x27;, url: &#x27;/news/2&#x27; }
      ]
    };
    await this.ctx.render(&#x27;news/list.tpl&#x27;, dataList);
  }
}

module.exports = NewsController;

// app/router.js
module.exports = app =&gt; {
  const { router, controller } = app;
  router.get(&#x27;/&#x27;, controller.home.index);
  router.get(&#x27;/news&#x27;, controller.news.list);
};</code></pre><p>Open a browser window and navigate to <a href="http://localhost:7001/news">http://localhost:7001/news</a>.
You should be able to see the rendered page.</p><p><strong>Tip：In development, Egg enables the <a href="https://github.com/eggjs/egg-development">development</a> plug-in by default, which reloads your worker process when changes are made to your back-end code.</strong></p><h3 id="create-a-service">Create a Service</h3><p>In practice, controllers usually won&#x27;t generate data on their own,
neither will they contain complicated business logic.
Complicated business logic should be abstracted as
a busineess logic layer instead, i.e., <a href="../basics/service.md">service</a>.</p><p>Let&#x27;s create a service to fetch data from the
<a href="https://github.com/HackerNews/API">HackerNews</a>.</p><pre><code class="language-js">// app/service/news.js
const Service = require(&#x27;egg&#x27;).Service;

class NewsService extends Service {
  async list(page = 1) {
    // read config
    const { serverUrl, pageSize } = this.config.news;

    // use build-in http client to GET hacker-news api
    const { data: idList } = await this.ctx.curl(`${serverUrl}/topstories.json`, {
      data: {
        orderBy: &#x27;&quot;$key&quot;&#x27;,
        startAt: `&quot;${pageSize * (page - 1)}&quot;`,
        endAt: `&quot;${pageSize * page - 1}&quot;`,
      },
      dataType: &#x27;json&#x27;,
    });

    // parallel GET detail
    const newsList = await Promise.all(
      Object.keys(idList).map(key =&gt; {
        const url = `${serverUrl}/item/${idList[key]}.json`;
        return this.ctx.curl(url, { dataType: &#x27;json&#x27; });
      })
    );
    return newsList.map(res =&gt; res.data);
  }
}

module.exports = NewsService;</code></pre><blockquote><p>Egg has <a href="../core/httpclient.md">HttpClient</a> built in in order to help you make HTTP requests.</p></blockquote><p>Then slightly modify our previous controller.</p><pre><code class="language-js">// app/controller/news.js
const Controller = require(&#x27;egg&#x27;).Controller;

class NewsController extends Controller {
  async list() {
    const ctx = this.ctx;
    const page = ctx.query.page || 1;
    const newsList = await ctx.service.news.list(page);
    await ctx.render(&#x27;news/list.tpl&#x27;, { list: newsList });
  }
}

module.exports = NewsController;</code></pre><p>And also add config.</p><pre><code class="language-js">// config/config.default.js
// add news&#x27; configurations
exports.news = {
  pageSize: 5,
  serverUrl: &#x27;https://hacker-news.firebaseio.com/v0&#x27;,
};</code></pre><h3 id="add-extensions">Add Extensions</h3><p>We might encounter a small problem here.
The time that we fetched are Unix Time format,
whereas we want to present them in a more friendly way to read.</p><p>Egg provides us with a quick way to extend its functionalities.
We just need to add extension scripts to the <code>app/extend</code> directory.
For more information, cf. <a href="../basics/extend.md">Extensions</a>.</p><p>In the case of view, we can just write a helper as an extension.</p><pre><code class="language-bash">$ npm i moment --save</code></pre><pre><code class="language-js">// app/extend/helper.js
const moment = require(&#x27;moment&#x27;);
exports.relativeTime = time =&gt; moment(new Date(time * 1000)).fromNow();</code></pre><p>Then use it in the templates.</p><pre><code class="language-html">&lt;!-- app/view/news/list.tpl --&gt;
{{ helper.relativeTime(item.time) }}</code></pre><h3 id="add-middlewares">Add Middlewares</h3><p>Suppose that we wanted to prohibit accesses from Baidu crawlers.</p><p>Smart developers might quickly guess that we can achieve it by adding a <a href="../basics/middleware.md">middleware</a>
that checks the User-Agent.</p><pre><code class="language-js">// app/middleware/robot.js
// options === app.config.robot
module.exports = (options, app) =&gt; {
  return async function robotMiddleware(ctx, next) {
    const source = ctx.get(&#x27;user-agent&#x27;) || &#x27;&#x27;;
    const match = options.ua.some(ua =&gt; ua.test(source));
    if (match) {
      ctx.status = 403;
      ctx.message = &#x27;Go away, robot.&#x27;;
    } else {
      await next();
    }
  }
};

// config/config.default.js
// add middleware robot
exports.middleware = [
  &#x27;robot&#x27;
];
// robot&#x27;s configurations
exports.robot = {
  ua: [
    /Baiduspider/i,
  ]
};</code></pre><p>Now try it using <code>curl localhost:7001/news -A &quot;Baiduspider&quot;</code>.</p><p>See <a href="../basics/middleware.md">Middleware</a> for more details.</p><h3 id="add-configurations">Add Configurations</h3><p>When writing business logic,
it is inevitable that we need to manage configurations.
Egg provides a powerful way to manage them in a merged configuration file.</p><ul><li>Environment-specific configuration files are well supported, e.g. config.local.js, config.prod.js, etc.</li><li>Configurations could be set wherever convenient, e.g. near Applications/Plug-ins/Framesworks, and Egg will be careful to merge and load them.</li><li>For more information on merging, see <a href="../basics/config.md">Configurations</a>.</li></ul><pre><code class="language-js">// config/config.default.js
exports.robot = {
  ua: [
    /curl/i,
    /Baiduspider/i,
  ],
};

// config/config.local.js
// only read at development mode, will override default
exports.robot = {
  ua: [
    /Baiduspider/i,
  ],
};

// app/service/some.js
const Service = require(&#x27;egg&#x27;).Service;

class SomeService extends Service {
  async list() {
    const rule = this.config.robot.ua;
  }
}

module.exports = SomeService;</code></pre><h3 id="add-unit-testing">Add Unit Testing</h3><p>Unit Testing is very important, and Egg also provides <a href="https://github.com/eggjs/egg-bin">egg-bin</a> to help you write tests painless.</p><p>All the test files should be placed at <code>{app_root}/test/**/*.test.js</code>.</p><pre><code class="language-js">// test/app/middleware/robot.test.js
const { app, mock, assert } = require(&#x27;egg-mock/bootstrap&#x27;);

describe(&#x27;test/app/middleware/robot.test.js&#x27;, () =&gt; {
  it(&#x27;should block robot&#x27;, () =&gt; {
    return app.httpRequest()
      .get(&#x27;/&#x27;)
      .set(&#x27;User-Agent&#x27;, &quot;Baiduspider&quot;)
      .expect(403);
  });
});</code></pre><p>Then add <code>npm scripts</code>.</p><pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;test&quot;: &quot;egg-bin test&quot;,
    &quot;cov&quot;: &quot;egg-bin cov&quot;
  }
}</code></pre><p>Also install dependencies.</p><pre><code class="language-bash">$ npm i egg-mock --save-dev</code></pre><p>Run it.</p><pre><code class="language-bash">$ npm test</code></pre><p>That is all of it, for more detail, see <a href="../core/unittest.md">Unit Testing</a>.</p><h2 id="conclusions">Conclusions</h2><p>We can only touch the tip of the iceberg of Egg with the above short sections.
Where to go from here? read our documentation to better understand the framework.</p><ul><li>About Egg boilerplate type, See <a href="../tutorials/index.md">Boilerplate Type Description</a>.</li><li>Egg provides a powerful mechanism for extending features. See <a href="../basics/plugin.md">Plugin</a>.</li><li>Egg framework allows small or large teams to work together as fast as possible under the well-documented conventions and coding best practices. In addition, the teams can build up logics on top of the framework to better suit their special needs. See more on <a href="">Frameworks</a>.(../advanced/framework.md).</li><li>Egg framework provides code reusabilities and modularities. See details at <a href="../tutorials/progressive.md">Progressive</a>.</li><li>Egg framework enables developers to write painless unit testing with many plugins and community-powered toolings. The team should give it a try by using Egg unit testing without worrying about setting up the testing tooling but writing the testing logics. See <a href="../core/unittest.md">Unit Testing</a>.</li></ul></div></div></div><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-0 ant-col-md-6"><div class="markdown-body" style="font-size:14px"><div><ul><li><a href="#prerequisites">Prerequisites</a></li><li><a href="#the-quick-way">the Quick Way</a></li><li><a href="#step-by-step">Step by Step</a><ul><li><a href="#initialization">Initialization</a></li><li><a href="#create-a-controller">Create a Controller</a></li><li><a href="#add-static-assets">Add Static Assets</a></li><li><a href="#add-templates-for-rendering">Add Templates for Rendering</a></li><li><a href="#create-a-service">Create a Service</a></li><li><a href="#add-extensions">Add Extensions</a></li><li><a href="#add-middlewares">Add Middlewares</a></li><li><a href="#add-configurations">Add Configurations</a></li><li><a href="#add-unit-testing">Add Unit Testing</a></li></ul></li><li><a href="#conclusions">Conclusions</a></li></ul></div></div></div></div></div></div></div></div></div><script type="text/javascript">window.__INIT_STATE__={"lang":"en","props":{"toc":"-%20%5BPrerequisites%5D(%23prerequisites)%0A-%20%5Bthe%20Quick%20Way%5D(%23the-quick-way)%0A-%20%5BStep%20by%20Step%5D(%23step-by-step)%0A%20%20*%20%5BInitialization%5D(%23initialization)%0A%20%20*%20%5BCreate%20a%20Controller%5D(%23create-a-controller)%0A%20%20*%20%5BAdd%20Static%20Assets%5D(%23add-static-assets)%0A%20%20*%20%5BAdd%20Templates%20for%20Rendering%5D(%23add-templates-for-rendering)%0A%20%20*%20%5BCreate%20a%20Service%5D(%23create-a-service)%0A%20%20*%20%5BAdd%20Extensions%5D(%23add-extensions)%0A%20%20*%20%5BAdd%20Middlewares%5D(%23add-middlewares)%0A%20%20*%20%5BAdd%20Configurations%5D(%23add-configurations)%0A%20%20*%20%5BAdd%20Unit%20Testing%5D(%23add-unit-testing)%0A-%20%5BConclusions%5D(%23conclusions)","meta":{"info":{"title":"Quick Start"}},"content":"%0A%0A%0AThis%20guide%20covers%20getting%20up%20and%20running%20a%20real%20example%20using%20Egg.%0ABy%20following%20along%20with%20this%20guide%20step%20by%20step%2C%20you%20can%20quickly%20get%20started%20with%20Egg%20development.%0A%0A%23%23%20Prerequisites%0A%0A-%20Operating%20System%3A%20Linux%2C%20OS%20X%20or%20Windows.%0A-%20Node.js%20Runtime%3A%208.x%20or%20newer%3B%20it%20is%20recommended%20that%20you%20use%20%5BLTS%20Releases%5D%5BNode.js%5D.%0A%0A%23%23%20the%20Quick%20Way%0A%0ATo%20begin%20with%2C%20let's%20quickly%20initialize%20the%20project%20by%20using%20a%20scaffold%2C%0Awhich%20will%20quickly%20generate%20some%20of%20the%20major%20pieces%20of%20the%20application.%0A%0A%60%60%60bash%0A%24%20npm%20i%20egg-init%20-g%0A%24%20egg-init%20egg-example%20--type%3Dsimple%0A%24%20cd%20egg-example%0A%24%20npm%20i%0A%60%60%60%0A%0AThen%20get%20up%20and%20run%20by%20using%20the%20following%20commands.%0A%0A%60%60%60bash%0A%24%20npm%20run%20dev%0A%24%20open%20localhost%3A7001%0A%60%60%60%0A%0A%23%23%20Step%20by%20Step%0A%0AUsually%20you%20can%20just%20use%20%5Begg-init%5D%20of%20the%20previous%20section%2C%0Achoose%20a%20scaffold%20that%20best%20fits%20your%20business%20model%20and%20quickly%20generate%20a%20project%2C%0Athen%20get%20started%20with%20the%20development.%0A%0AHowever%2C%20in%20this%20section%2C%20instead%20of%20using%20scaffolds%20we%20will%20build%20a%20project%20called%20%5BEgg%20HackerNews%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fexamples%2Ftree%2Fmaster%2Fhackernews)%20step%20by%20step%2C%20for%20a%20better%20understanding%20of%20how%20it%20works.%0A%0A!%5BEgg%20HackerNews%20Snapshoot%5D(https%3A%2F%2Fcloud.githubusercontent.com%2Fassets%2F227713%2F22960991%2F812999bc-f37d-11e6-8bd5-a96ca37d0ff2.png)%0A%0A%23%23%23%20Initialization%0A%0AFirst%20let's%20create%20the%20project%20directory%20and%20initialize%20its%20structure.%0A%0A%60%60%60bash%0A%24%20mkdir%20egg-example%0A%24%20cd%20egg-example%0A%24%20npm%20init%0A%24%20npm%20i%20egg%20--save%0A%24%20npm%20i%20egg-bin%20--save-dev%0A%60%60%60%0A%0AThen%20add%20%60npm%20scripts%60%20to%20%60package.json%60.%0A%0A%60%60%60json%0A%7B%0A%20%20%22name%22%3A%20%22egg-example%22%2C%0A%20%20%22scripts%22%3A%20%7B%0A%20%20%20%20%22dev%22%3A%20%22egg-bin%20dev%22%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A%23%23%23%20Create%20a%20Controller%0A%0AIf%20you%20are%20familiar%20with%20the%20MVC%20architecture%2C%0Ayou%20might%20have%20already%20guessed%20that%20the%20first%20thing%20to%20create%0Ais%20a%20%5Bcontroller%5D(..%2Fbasics%2Fcontroller.md)%20and%20%5Brouter%5D(..%2Fbasics%2Frouter.md).%0A%0A%60%60%60js%0A%2F%2F%20app%2Fcontroller%2Fhome.js%0Aconst%20Controller%20%3D%20require('egg').Controller%3B%0A%0Aclass%20HomeController%20extends%20Controller%20%7B%0A%20%20async%20index()%20%7B%0A%20%20%20%20this.ctx.body%20%3D%20'Hello%20world'%3B%0A%20%20%7D%0A%7D%0A%0Amodule.exports%20%3D%20HomeController%3B%0A%60%60%60%0A%0AThen%20edit%20the%20router%20file%20and%20add%20a%20mapping.%0A%0A%60%60%60js%0A%2F%2F%20app%2Frouter.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20const%20%7B%20router%2C%20controller%20%7D%20%3D%20app%3B%0A%20%20router.get('%2F'%2C%20controller.home.index)%3B%0A%7D%3B%0A%60%60%60%0A%0AThen%20add%20a%20%5Bconfiguration%5D(..%2Fbasics%2Fconfig.md)%20file%3A%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0Aexports.keys%20%3D%20%3CYOUR_SECURITY_COOKE_KEYS%3E%3B%0A%60%60%60%0A%0AThe%20project%20directory%20looks%20like%20this%3A%0A%0A%60%60%60bash%0Aegg-example%0A%E2%94%9C%E2%94%80%E2%94%80%20app%0A%E2%94%82%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20controller%0A%E2%94%82%20%20%20%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20home.js%0A%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20router.js%0A%E2%94%9C%E2%94%80%E2%94%80%20config%0A%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20config.default.js%0A%E2%94%94%E2%94%80%E2%94%80%20package.json%0A%60%60%60%0A%0AFor%20more%20information%20about%20directory%20structure%2C%20see%20%5BDirectory%20Structure%5D(..%2Fbasics%2Fstructure.md).%0A%0ANow%20you%20can%20start%20up%20the%20Web%20Server%20and%20see%20your%20application%20in%20action.%0A%0A%60%60%60bash%0A%24%20npm%20run%20dev%0A%24%20open%20localhost%3A7001%0A%60%60%60%0A%0A%3E%20Note%EF%BC%9A%0A%3E%0A%3E%20-%20You%20could%20write%20%60Controller%60%20with%20%60class%60%20or%20%60exports%60%20style%2C%20see%20more%20detail%20at%20%5BController%5D(..%2Fbasics%2Fcontroller.md).%0A%3E%20-%20And%20%60Config%60%20could%20write%20with%20%60module.exports%60%20or%20%60exports%60%20style%2C%20see%20more%20detail%20at%20%5BNode.js%20modules%20docs%5D(https%3A%2F%2Fnodejs.org%2Fapi%2Fmodules.html%23modules_exports_shortcut).%0A%0A%23%23%23%20Add%20Static%20Assets%0A%0AEgg%20has%20a%20built-in%20plugin%20called%20%5Bstatic%5D%5Begg-static%5D.%0AIn%20production%2C%20it%20is%20recommended%20that%20you%20deploy%20static%20assets%20to%20CDN%20instead%20of%20using%20this%20plugin.%0A%0A%5Bstatic%5D%5Begg-static%5D%20maps%20%60%2Fpublic%2F*%60%20to%20the%20directory%20%60app%2Fpublic%2F*%60%20by%20default.%0A%0AIn%20this%20case%2C%20we%20just%20need%20to%20put%20our%20static%20assets%20into%20the%20directory%20%60app%2Fpublic%60.%0A%0A%60%60%60bash%0Aapp%2Fpublic%0A%E2%94%9C%E2%94%80%E2%94%80%20css%0A%E2%94%82%20%20%20%E2%94%94%E2%94%80%E2%94%80%20news.css%0A%E2%94%94%E2%94%80%E2%94%80%20js%0A%20%20%20%20%E2%94%9C%E2%94%80%E2%94%80%20lib.js%0A%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%20news.js%0A%60%60%60%0A%0A%23%23%23%20Add%20Templates%20for%20Rendering%0A%0AIn%20most%20cases%2C%20data%20are%20usually%20read%2C%20processed%20and%20rendered%20by%20the%20templates%20before%20being%20presented%20to%20the%20user.%0AThus%20we%20need%20to%20introduce%20corresponding%20template%20engines%20to%20handle%20it.%0A%0AEgg%20does%20not%20force%20to%20use%20any%20particular%20template%20engines%2C%0Abut%20specifies%20the%20%5BView%20Plug-ins%20Specification%5D(..%2Fadvanced%2Fview-plugin.md)%0Ato%20allow%20the%20developers%20to%20use%20different%20plug-ins%20for%20their%20individual%20needs%20instead.%0A%0AFor%20more%20information%2C%20cf.%20%5BView%5D(..%2Fcore%2Fview.md).%0A%0AIn%20this%20example%2C%20we%20will%20use%20%5BNunjucks%5D.%0A%0AFirst%20install%20the%20corresponding%20plug-in%20%5Begg-view-nunjucks%5D.%0A%0A%60%60%60bash%0A%24%20npm%20i%20egg-view-nunjucks%20--save%0A%60%60%60%0A%0AAnd%20enable%20it.%0A%0A%60%60%60js%0A%2F%2F%20config%2Fplugin.js%0Aexports.nunjucks%20%3D%20%7B%0A%20%20enable%3A%20true%2C%0A%20%20package%3A%20'egg-view-nunjucks'%0A%7D%3B%0A%60%60%60%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0Aexports.keys%20%3D%20%3CYOUR_SECURITY_COOKE_KEYS%3E%3B%0A%2F%2F%20add%20view's%20configurations%0Aexports.view%20%3D%20%7B%0A%20%20defaultViewEngine%3A%20'nunjucks'%2C%0A%20%20mapping%3A%20%7B%0A%20%20%20%20'.tpl'%3A%20'nunjucks'%2C%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A**Carefully!%20%60config%60%20dir%2C%20not%20%60app%2Fconfig%60!**%0A%0AThen%20create%20a%20template%20for%20the%20index%20page.%0AThis%20usually%20goes%20to%20the%20app%2Fview%20directory.%0A%0A%0A%60%60%60html%0A%3C!--%20app%2Fview%2Fnews%2Flist.tpl%20--%3E%0A%3Chtml%3E%0A%20%20%3Chead%3E%0A%20%20%20%20%3Ctitle%3EEgg%20HackerNews%20Clone%3C%2Ftitle%3E%0A%20%20%20%20%3Clink%20rel%3D%22stylesheet%22%20href%3D%22%2Fpublic%2Fcss%2Fnews.css%22%20%2F%3E%0A%20%20%3C%2Fhead%3E%0A%20%20%3Cbody%3E%0A%20%20%20%20%3Cul%20class%3D%22news-view%20view%22%3E%0A%20%20%20%20%20%20%7B%25%20for%20item%20in%20list%20%25%7D%0A%20%20%20%20%20%20%20%20%3Cli%20class%3D%22item%22%3E%0A%20%20%20%20%20%20%20%20%20%20%3Ca%20href%3D%22%7B%7B%20item.url%20%7D%7D%22%3E%7B%7B%20item.title%20%7D%7D%3C%2Fa%3E%0A%20%20%20%20%20%20%20%20%3C%2Fli%3E%0A%20%20%20%20%20%20%7B%25%20endfor%20%25%7D%0A%20%20%20%20%3C%2Ful%3E%0A%20%20%3C%2Fbody%3E%0A%3C%2Fhtml%3E%0A%60%60%60%0A%0AThen%20add%20a%20controller%20and%20router.%0A%0A%60%60%60js%0A%2F%2F%20app%2Fcontroller%2Fnews.js%0Aconst%20Controller%20%3D%20require('egg').Controller%3B%0A%0Aclass%20NewsController%20extends%20Controller%20%7B%0A%20%20async%20list()%20%7B%0A%20%20%20%20const%20dataList%20%3D%20%7B%0A%20%20%20%20%20%20list%3A%20%5B%0A%20%20%20%20%20%20%20%20%7B%20id%3A%201%2C%20title%3A%20'this%20is%20news%201'%2C%20url%3A%20'%2Fnews%2F1'%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%20id%3A%202%2C%20title%3A%20'this%20is%20news%202'%2C%20url%3A%20'%2Fnews%2F2'%20%7D%0A%20%20%20%20%20%20%5D%0A%20%20%20%20%7D%3B%0A%20%20%20%20await%20this.ctx.render('news%2Flist.tpl'%2C%20dataList)%3B%0A%20%20%7D%0A%7D%0A%0Amodule.exports%20%3D%20NewsController%3B%0A%0A%2F%2F%20app%2Frouter.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20const%20%7B%20router%2C%20controller%20%7D%20%3D%20app%3B%0A%20%20router.get('%2F'%2C%20controller.home.index)%3B%0A%20%20router.get('%2Fnews'%2C%20controller.news.list)%3B%0A%7D%3B%0A%60%60%60%0A%0AOpen%20a%20browser%20window%20and%20navigate%20to%20http%3A%2F%2Flocalhost%3A7001%2Fnews.%0AYou%20should%20be%20able%20to%20see%20the%20rendered%20page.%0A%0A**Tip%EF%BC%9AIn%20development%2C%20Egg%20enables%20the%20%5Bdevelopment%5D%5Begg-development%5D%20plug-in%20by%20default%2C%20which%20reloads%20your%20worker%20process%20when%20changes%20are%20made%20to%20your%20back-end%20code.**%0A%0A%23%23%23%20Create%20a%20Service%0A%0AIn%20practice%2C%20controllers%20usually%20won't%20generate%20data%20on%20their%20own%2C%0Aneither%20will%20they%20contain%20complicated%20business%20logic.%0AComplicated%20business%20logic%20should%20be%20abstracted%20as%0Aa%20busineess%20logic%20layer%20instead%2C%20i.e.%2C%20%5Bservice%5D(..%2Fbasics%2Fservice.md).%0A%0ALet's%20create%20a%20service%20to%20fetch%20data%20from%20the%0A%5BHackerNews%5D(https%3A%2F%2Fgithub.com%2FHackerNews%2FAPI).%0A%0A%60%60%60js%0A%2F%2F%20app%2Fservice%2Fnews.js%0Aconst%20Service%20%3D%20require('egg').Service%3B%0A%0Aclass%20NewsService%20extends%20Service%20%7B%0A%20%20async%20list(page%20%3D%201)%20%7B%0A%20%20%20%20%2F%2F%20read%20config%0A%20%20%20%20const%20%7B%20serverUrl%2C%20pageSize%20%7D%20%3D%20this.config.news%3B%0A%0A%20%20%20%20%2F%2F%20use%20build-in%20http%20client%20to%20GET%20hacker-news%20api%0A%20%20%20%20const%20%7B%20data%3A%20idList%20%7D%20%3D%20await%20this.ctx.curl(%60%24%7BserverUrl%7D%2Ftopstories.json%60%2C%20%7B%0A%20%20%20%20%20%20data%3A%20%7B%0A%20%20%20%20%20%20%20%20orderBy%3A%20'%22%24key%22'%2C%0A%20%20%20%20%20%20%20%20startAt%3A%20%60%22%24%7BpageSize%20*%20(page%20-%201)%7D%22%60%2C%0A%20%20%20%20%20%20%20%20endAt%3A%20%60%22%24%7BpageSize%20*%20page%20-%201%7D%22%60%2C%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20dataType%3A%20'json'%2C%0A%20%20%20%20%7D)%3B%0A%0A%20%20%20%20%2F%2F%20parallel%20GET%20detail%0A%20%20%20%20const%20newsList%20%3D%20await%20Promise.all(%0A%20%20%20%20%20%20Object.keys(idList).map(key%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20const%20url%20%3D%20%60%24%7BserverUrl%7D%2Fitem%2F%24%7BidList%5Bkey%5D%7D.json%60%3B%0A%20%20%20%20%20%20%20%20return%20this.ctx.curl(url%2C%20%7B%20dataType%3A%20'json'%20%7D)%3B%0A%20%20%20%20%20%20%7D)%0A%20%20%20%20)%3B%0A%20%20%20%20return%20newsList.map(res%20%3D%3E%20res.data)%3B%0A%20%20%7D%0A%7D%0A%0Amodule.exports%20%3D%20NewsService%3B%0A%60%60%60%0A%0A%3E%20Egg%20has%20%5BHttpClient%5D(..%2Fcore%2Fhttpclient.md)%20built%20in%20in%20order%20to%20help%20you%20make%20HTTP%20requests.%0A%0AThen%20slightly%20modify%20our%20previous%20controller.%0A%0A%60%60%60js%0A%2F%2F%20app%2Fcontroller%2Fnews.js%0Aconst%20Controller%20%3D%20require('egg').Controller%3B%0A%0Aclass%20NewsController%20extends%20Controller%20%7B%0A%20%20async%20list()%20%7B%0A%20%20%20%20const%20ctx%20%3D%20this.ctx%3B%0A%20%20%20%20const%20page%20%3D%20ctx.query.page%20%7C%7C%201%3B%0A%20%20%20%20const%20newsList%20%3D%20await%20ctx.service.news.list(page)%3B%0A%20%20%20%20await%20ctx.render('news%2Flist.tpl'%2C%20%7B%20list%3A%20newsList%20%7D)%3B%0A%20%20%7D%0A%7D%0A%0Amodule.exports%20%3D%20NewsController%3B%0A%60%60%60%0A%0AAnd%20also%20add%20config.%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0A%2F%2F%20add%20news'%20configurations%0Aexports.news%20%3D%20%7B%0A%20%20pageSize%3A%205%2C%0A%20%20serverUrl%3A%20'https%3A%2F%2Fhacker-news.firebaseio.com%2Fv0'%2C%0A%7D%3B%0A%60%60%60%0A%0A%23%23%23%20Add%20Extensions%0A%0AWe%20might%20encounter%20a%20small%20problem%20here.%0AThe%20time%20that%20we%20fetched%20are%20Unix%20Time%20format%2C%0Awhereas%20we%20want%20to%20present%20them%20in%20a%20more%20friendly%20way%20to%20read.%0A%0AEgg%20provides%20us%20with%20a%20quick%20way%20to%20extend%20its%20functionalities.%0AWe%20just%20need%20to%20add%20extension%20scripts%20to%20the%20%60app%2Fextend%60%20directory.%0AFor%20more%20information%2C%20cf.%20%5BExtensions%5D(..%2Fbasics%2Fextend.md).%0A%0AIn%20the%20case%20of%20view%2C%20we%20can%20just%20write%20a%20helper%20as%20an%20extension.%0A%0A%60%60%60bash%0A%24%20npm%20i%20moment%20--save%0A%60%60%60%0A%0A%60%60%60js%0A%2F%2F%20app%2Fextend%2Fhelper.js%0Aconst%20moment%20%3D%20require('moment')%3B%0Aexports.relativeTime%20%3D%20time%20%3D%3E%20moment(new%20Date(time%20*%201000)).fromNow()%3B%0A%60%60%60%0A%0AThen%20use%20it%20in%20the%20templates.%0A%0A%60%60%60%20html%0A%3C!--%20app%2Fview%2Fnews%2Flist.tpl%20--%3E%0A%7B%7B%20helper.relativeTime(item.time)%20%7D%7D%0A%60%60%60%0A%0A%23%23%23%20Add%20Middlewares%0A%0ASuppose%20that%20we%20wanted%20to%20prohibit%20accesses%20from%20Baidu%20crawlers.%0A%0ASmart%20developers%20might%20quickly%20guess%20that%20we%20can%20achieve%20it%20by%20adding%20a%20%5Bmiddleware%5D(..%2Fbasics%2Fmiddleware.md)%0Athat%20checks%20the%20User-Agent.%0A%0A%60%60%60js%0A%2F%2F%20app%2Fmiddleware%2Frobot.js%0A%2F%2F%20options%20%3D%3D%3D%20app.config.robot%0Amodule.exports%20%3D%20(options%2C%20app)%20%3D%3E%20%7B%0A%20%20return%20async%20function%20robotMiddleware(ctx%2C%20next)%20%7B%0A%20%20%20%20const%20source%20%3D%20ctx.get('user-agent')%20%7C%7C%20''%3B%0A%20%20%20%20const%20match%20%3D%20options.ua.some(ua%20%3D%3E%20ua.test(source))%3B%0A%20%20%20%20if%20(match)%20%7B%0A%20%20%20%20%20%20ctx.status%20%3D%20403%3B%0A%20%20%20%20%20%20ctx.message%20%3D%20'Go%20away%2C%20robot.'%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20await%20next()%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%3B%0A%0A%2F%2F%20config%2Fconfig.default.js%0A%2F%2F%20add%20middleware%20robot%0Aexports.middleware%20%3D%20%5B%0A%20%20'robot'%0A%5D%3B%0A%2F%2F%20robot's%20configurations%0Aexports.robot%20%3D%20%7B%0A%20%20ua%3A%20%5B%0A%20%20%20%20%2FBaiduspider%2Fi%2C%0A%20%20%5D%0A%7D%3B%0A%60%60%60%0A%0ANow%20try%20it%20using%20%60curl%20localhost%3A7001%2Fnews%20-A%20%22Baiduspider%22%60.%0A%0ASee%20%5BMiddleware%5D(..%2Fbasics%2Fmiddleware.md)%20for%20more%20details.%0A%0A%0A%23%23%23%20Add%20Configurations%0A%0AWhen%20writing%20business%20logic%2C%0Ait%20is%20inevitable%20that%20we%20need%20to%20manage%20configurations.%0AEgg%20provides%20a%20powerful%20way%20to%20manage%20them%20in%20a%20merged%20configuration%20file.%0A%0A-%20Environment-specific%20configuration%20files%20are%20well%20supported%2C%20e.g.%20config.local.js%2C%20config.prod.js%2C%20etc.%0A-%20Configurations%20could%20be%20set%20wherever%20convenient%2C%20e.g.%20near%20Applications%2FPlug-ins%2FFramesworks%2C%20and%20Egg%20will%20be%20careful%20to%20merge%20and%20load%20them.%0A-%20For%20more%20information%20on%20merging%2C%20see%20%5BConfigurations%5D(..%2Fbasics%2Fconfig.md).%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0Aexports.robot%20%3D%20%7B%0A%20%20ua%3A%20%5B%0A%20%20%20%20%2Fcurl%2Fi%2C%0A%20%20%20%20%2FBaiduspider%2Fi%2C%0A%20%20%5D%2C%0A%7D%3B%0A%0A%2F%2F%20config%2Fconfig.local.js%0A%2F%2F%20only%20read%20at%20development%20mode%2C%20will%20override%20default%0Aexports.robot%20%3D%20%7B%0A%20%20ua%3A%20%5B%0A%20%20%20%20%2FBaiduspider%2Fi%2C%0A%20%20%5D%2C%0A%7D%3B%0A%0A%2F%2F%20app%2Fservice%2Fsome.js%0Aconst%20Service%20%3D%20require('egg').Service%3B%0A%0Aclass%20SomeService%20extends%20Service%20%7B%0A%20%20async%20list()%20%7B%0A%20%20%20%20const%20rule%20%3D%20this.config.robot.ua%3B%0A%20%20%7D%0A%7D%0A%0Amodule.exports%20%3D%20SomeService%3B%0A%60%60%60%0A%0A%23%23%23%20Add%20Unit%20Testing%0A%0AUnit%20Testing%20is%20very%20important%2C%20and%20Egg%20also%20provides%20%5Begg-bin%5D%20to%20help%20you%20write%20tests%20painless.%0A%0AAll%20the%20test%20files%20should%20be%20placed%20at%20%60%7Bapp_root%7D%2Ftest%2F**%2F*.test.js%60.%0A%0A%60%60%60js%0A%2F%2F%20test%2Fapp%2Fmiddleware%2Frobot.test.js%0Aconst%20%7B%20app%2C%20mock%2C%20assert%20%7D%20%3D%20require('egg-mock%2Fbootstrap')%3B%0A%0Adescribe('test%2Fapp%2Fmiddleware%2Frobot.test.js'%2C%20()%20%3D%3E%20%7B%0A%20%20it('should%20block%20robot'%2C%20()%20%3D%3E%20%7B%0A%20%20%20%20return%20app.httpRequest()%0A%20%20%20%20%20%20.get('%2F')%0A%20%20%20%20%20%20.set('User-Agent'%2C%20%22Baiduspider%22)%0A%20%20%20%20%20%20.expect(403)%3B%0A%20%20%7D)%3B%0A%7D)%3B%0A%60%60%60%0A%0AThen%20add%20%60npm%20scripts%60.%0A%0A%60%60%60json%0A%7B%0A%20%20%22scripts%22%3A%20%7B%0A%20%20%20%20%22test%22%3A%20%22egg-bin%20test%22%2C%0A%20%20%20%20%22cov%22%3A%20%22egg-bin%20cov%22%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0AAlso%20install%20dependencies.%0A%0A%60%60%60bash%0A%24%20npm%20i%20egg-mock%20--save-dev%0A%60%60%60%0A%0ARun%20it.%0A%0A%60%60%60bash%0A%24%20npm%20test%0A%60%60%60%0A%0AThat%20is%20all%20of%20it%2C%20for%20more%20detail%2C%20see%20%5BUnit%20Testing%5D(..%2Fcore%2Funittest.md).%0A%0A%23%23%20Conclusions%0A%0AWe%20can%20only%20touch%20the%20tip%20of%20the%20iceberg%20of%20Egg%20with%20the%20above%20short%20sections.%0AWhere%20to%20go%20from%20here%3F%20read%20our%20documentation%20to%20better%20understand%20the%20framework.%0A%0A-%20About%20Egg%20boilerplate%20type%2C%20See%20%5BBoilerplate%20Type%20Description%5D(..%2Ftutorials%2Findex.md).%0A-%20Egg%20provides%20a%20powerful%20mechanism%20for%20extending%20features.%20See%20%5BPlugin%5D(..%2Fbasics%2Fplugin.md).%0A-%20Egg%20framework%20allows%20small%20or%20large%20teams%20to%20work%20together%20as%20fast%20as%20possible%20under%20the%20well-documented%20conventions%20and%20coding%20best%20practices.%20In%20addition%2C%20the%20teams%20can%20build%20up%20logics%20on%20top%20of%20the%20framework%20to%20better%20suit%20their%20special%20needs.%20See%20more%20on%20%5BFrameworks%5D.(..%2Fadvanced%2Fframework.md).%0A-%20Egg%20framework%20provides%20code%20reusabilities%20and%20modularities.%20See%20details%20at%20%5BProgressive%5D(..%2Ftutorials%2Fprogressive.md).%0A-%20Egg%20framework%20enables%20developers%20to%20write%20painless%20unit%20testing%20with%20many%20plugins%20and%20community-powered%20toolings.%20The%20team%20should%20give%20it%20a%20try%20by%20using%20Egg%20unit%20testing%20without%20worrying%20about%20setting%20up%20the%20testing%20tooling%20but%20writing%20the%20testing%20logics.%20See%20%5BUnit%20Testing%5D(..%2Fcore%2Funittest.md).%0A%0A%5BNode.js%5D%3A%20http%3A%2F%2Fnodejs.org%0A%5Begg-init%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-init%0A%5Begg-bin%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-bin%0A%5Begg-static%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-static%0A%5Begg-development%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-development%0A%5Begg-view-nunjucks%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-view-nunjucks%0A%5Burllib%5D%3A%20https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Furllib%0A%5BNunjucks%5D%3A%20https%3A%2F%2Fmozilla.github.io%2Fnunjucks%2F%0A"}}</script><script type="text/javascript" src="/static/js/post.b9faab88.js"></script></body></html>