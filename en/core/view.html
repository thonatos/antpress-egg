<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.png"><style class="_styletron_hydrate_"></style><title>View Template Rendering</title><meta name="description" content="Born to build better enterprise frameworks and apps"><link href="/static/css/post.d62265dc.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="ant-layout" data-reactroot=""><div class="header-module__header___3ADJ9 ant-layout-header"><div class="ant-row-flex"><div class="ant-col-xs-12 ant-col-md-20 ant-col-lg-2"><div class="header-module__logo___3yTXp"><a href="/"><img src="/logo.svg" alt="logo"/></a></div></div><div class="ant-col-xs-0 ant-col-md-0 ant-col-lg-20"><ul class="ant-menu header-module__menu___3yEtW ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-item" role="menuitem"><a href="/en/intro/">Guide</a></li><li class="ant-menu-item" role="menuitem"><a href="/api/">API</a></li><li class="ant-menu-item" role="menuitem"><a href="/en/tutorials/index.html">Tutorials</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/search?q=topic%3Aegg-plugin&amp;type=Repositories">Plugins</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/eggjs/egg/releases">Release</a></li></ul></div><div style="text-align:right" class="ant-col-xs-12 ant-col-md-4 ant-col-lg-2"><button type="button" class="ant-btn"><span>切换语言</span></button></div></div></div><div class="ant-layout-content"><div class="basic_layout-module__content___3flpY ant-layout"><div class="sider-module__side___1Cadj ant-layout-sider ant-layout-sider-light" style="flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"><ul class="ant-menu sider-module__menu___2GqPr ant-menu-light ant-menu-root ant-menu-inline" role="menu"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="0$Menu" aria-haspopup="true"><span>Guide</span><i class="ant-menu-submenu-arrow"></i></div><ul id="0$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/index.html">What is Egg?</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/egg-and-koa.html">Egg and Koa</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/quickstart.html">Quick Start</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/progressive.html">Progressive</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/migration.html">Migration to 2.x</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="1$Menu" aria-haspopup="true"><span>Basis Function</span><i class="ant-menu-submenu-arrow"></i></div><ul id="1$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/structure.html">Directory Structure</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/objects.html">Built-in Objects</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/env.html">Environment</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/config.html">Configuration</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/middleware.html">Middleware</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/router.html">Router</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/controller.html">Controller</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/service.html">Service</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/plugin.html">Plugin</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/schedule.html">Schedule</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/extend.html">Extend</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/app-start.html">Custom Init</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="2$Menu" aria-haspopup="true"><span>Core</span><i class="ant-menu-submenu-arrow"></i></div><ul id="2$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/development.html">Development</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/unittest.html">Unit Testing</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/deployment.html">Deployment</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/logger.html">Logger</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/httpclient.html">HttpClient</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/cookie-and-session.html">Cookie and Session</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/cluster-and-ipc.html">Cluster and IPC</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/view.html">View</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/error-handling.html">Error Handling</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/security.html">Security</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/i18n.html">i18n</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="3$Menu" aria-haspopup="true"><span>Tutorials</span><i class="ant-menu-submenu-arrow"></i></div><ul id="3$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/mysql.html">MySQL</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/restful.html">RESTful API</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/passport.html">Passport</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/socketio.html">Socket.IO</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/assets.html">Assets</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/typescript.html">TypeScript</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="4$Menu" aria-haspopup="true"><span>Advanced</span><i class="ant-menu-submenu-arrow"></i></div><ul id="4$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/loader.html">Loader</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/plugin.html">Plugin Development</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/framework.html">Framework</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/cluster-client.html">Cluster Enhancement</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/view-plugin.html">View Plugin</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/style-guide.html">Style Guide</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="5$Menu" aria-haspopup="true"><span>Community</span><i class="ant-menu-submenu-arrow"></i></div><ul id="5$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/plugins/">Plugin List</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/contributing.html">Contributing</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/resource.html">Resource</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/faq.html">FAQ</a></li></ul></li></ul></div></div><div class="basic_layout-module__post___2Z7KK ant-layout-content"><div class="ant-row" style="margin-left:-8px;margin-right:-8px"><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-24 ant-col-md-18"><div class="markdown-body" style="font-size:14px"><div><p>In most cases, we need to fetch data and render with template files.
So we need to use corresponding view engines.</p><p><a href="https://github.com/eggjs/egg-view">egg-view</a> is a built-in plugin to support using multiple view engines in one application.
All view engines are imported as plugins.
With <a href="https://github.com/eggjs/egg-view">egg-view</a> developers can use the same API interface to work with different view engines.
See <a href="../advanced/view-plugin.md">View Plugin</a> for more details.</p><p>Take the officially supported View plugin <a href="https://github.com/eggjs/egg-view-nunjucks">egg-view-nunjucks</a> as an example:</p><h3 id="install-view-engine-plugin">Install view engine plugin</h3><pre><code class="language-bash">$ npm i egg-view-nunjucks --save</code></pre><h3 id="enable-view-engine-plugin">Enable view engine plugin</h3><pre><code class="language-js">// config/plugin.js
exports.nunjucks = {
  enable: true,
  package: &#x27;egg-view-nunjucks&#x27;,
};</code></pre><h2 id="configure-view-plugins">Configure view plugins</h2><p><a href="https://github.com/eggjs/egg-view">egg-view</a> defines the default configuration of <code>config.view</code></p><h3 id="root-string">root {String}</h3><p>Root directory for template files is absolute path, with default value <code>${baseDir}/app/view</code>.</p><p><a href="https://github.com/eggjs/egg-view">egg-view</a> supports having multiple directories, which are separated by <code>,</code>.
In this case, it looks for template files from all the directories.</p><p>The configuration below is an example of multiple view directories:</p><pre><code class="language-js">// config/config.default.js
const path = require(&#x27;path&#x27;);
module.exports = appInfo =&gt; {
  const config = {};
  config.view = {
    root: [
      path.join(appInfo.baseDir, &#x27;app/view&#x27;),
      path.join(appInfo.baseDir, &#x27;path/to/another&#x27;),
    ].join(&#x27;,&#x27;)
  };
  return config;
};</code></pre><h3 id="cache-boolean">cache {Boolean}</h3><p>Cache template file paths, default value is <code>true</code>.
<a href="https://github.com/eggjs/egg-view">egg-view</a> looks for template files from the directories that defined in <code>root</code>.
When a file matching given template path is found, the file&#x27;s full path will be cached
and reused afterward.
<a href="https://github.com/eggjs/egg-view">egg-view</a> won&#x27;t search all directories again for the same template path.</p><h3 id="mapping-and-defaultviewengine">mapping and defaultViewEngine</h3><p>Every view engine has a view engine name defined when the plugin is enabled.
In view configuration, <code>mapping</code> defines the mapping
from template file&#x27;s extension name to view engine name.
For example, use Nunjucks engine to render <code>.nj</code> files.</p><pre><code class="language-js">module.exports = {
  view: {
    mapping: {
      &#x27;.nj&#x27;: &#x27;nunjucks&#x27;,
    },
  },
};</code></pre><p><a href="https://github.com/eggjs/egg-view">egg-view</a> uses the corresponding view engine according to the configuration above.</p><pre><code class="language-js">await ctx.render(&#x27;home.nj&#x27;);</code></pre><p>The mapping from file extension name to view engine must be defined.
Otherwise <a href="https://github.com/eggjs/egg-view">egg-view</a> cannot find correct view engine.
Global configuration can be done with <code>defaultViewEngine</code>.</p><pre><code class="language-js">// config/config.default.js
module.exports = {
  view: {
    defaultViewEngine: &#x27;nunjucks&#x27;,
  },
};</code></pre><p>If a view engine cannot be found according to specified mapping,
the default view engine will be used.
For the applications that use only one view engine,
it&#x27;s recommended to set this option.</p><h3 id="defaultextension">defaultExtension</h3><p>When calling <code>render()</code>, the first argument should contain file extension name,
unless <code>defaultExtension</code> has been configured.</p><pre><code class="language-js">// config/config.default.js
module.exports = {
  view: {
    defaultExtension: &#x27;.nj&#x27;,
  },
};

// render app/view/home.nj
await ctx.render(&#x27;home&#x27;);</code></pre><h2 id="render-page">Render Page</h2><p><a href="https://github.com/eggjs/egg-view">egg-view</a> provides three interfaces in Context.
All three returns a Promise:</p><ul><li><code>render(name, locals)</code> renders template file, and set the value to <code>ctx.body</code>.</li><li><code>renderView(name, locals)</code> renders template file, returns the result and don&#x27;t set the value to any variable.</li><li><code>renderString(tpl, locals)</code> renders template string, returns the result and don&#x27;t set the value to any variable.</li></ul><pre><code class="language-js">// {app_root}/app/controller/home.js
class HomeController extends Controller {
  async index() {
    const data = { name: &#x27;egg&#x27; };

    // render a template, path relate to `app/view`
    await ctx.render(&#x27;home/index.tpl&#x27;, data);

    // or manually set render result to ctx.body
    ctx.body = await ctx.renderView(&#x27;path/to/file.tpl&#x27;, data);

    // or render string directly
    ctx.body = await ctx.renderString(&#x27;hi, {{ name }}&#x27;, data, {
      viewEngine: &#x27;nunjucks&#x27;,
    });
  }
}</code></pre><p>When calling <code>renderString</code>, view engine should be specified unless <code>defaultViewEngine</code> has been defined.</p><h2 id="locals">Locals</h2><p>In the process of rendering pages,
we usually need a variable to contain all information that is used in view template.
<a href="https://github.com/eggjs/egg-view">egg-view</a> provides <code>app.locals</code> and <code>ctx.locals</code>.</p><ul><li><code>app.locals</code> is global, usually configured in <code>app.js</code>.</li><li><code>ctx.locals</code> is per-request, and it merges <code>app.locals</code>.</li><li><code>ctx.locals</code> can be assigned by modifying key/value or assigned with a new object. <a href="https://github.com/eggjs/egg-view">egg-view</a> will merge the new object automatically in corresponding setter.</li></ul><pre><code class="language-js">// `app.locals` merged into `ctx.locals`
ctx.app.locals = { a: 1 };
ctx.locals.b = 2;
console.log(ctx.locals); // { a: 1, b: 2 }

// in the processing of a request, `app.locals` is merged into `ctx.locals` only at the first time `ctx.locals` being accessed
ctx.app.locals = { a: 2 };
console.log(ctx.locals); // already merged before, so output is still { a: 1, b: 2 }

// pass a new object to `locals`. New object will be merged into `locals`, instead of replacing it. It&#x27;s done by setter automatically.
ctx.locals.c = 3;
ctx.locals = { d: 4 };
console.log(ctx.locals); // { a: 1, b: 2, c: 3, d: 4 }</code></pre><p>In practical development, we usually don&#x27;t use these two objects in controller directly.
Instead, simply call <code>ctx.render(name, data)</code>:</p><ul><li><a href="https://github.com/eggjs/egg-view">egg-view</a> merges <code>data</code> into <code>ctx.locals</code> automatically.</li><li><a href="https://github.com/eggjs/egg-view">egg-view</a> injects <code>ctx</code>, <code>request</code>, <code>helper</code> into locals automatically.</li></ul><pre><code class="language-js">ctx.app.locals = { appName: &#x27;showcase&#x27; };
const data = { name: &#x27;egg&#x27; };

// will auto merge `data` to `ctx.locals`, output: egg - showcase
await ctx.renderString(&#x27;{{ name }} - {{ appName }}&#x27;, data);

// helper, ctx, request will auto inject
await ctx.renderString(&#x27;{{ name }} - {{ helper.lowercaseFirst(ctx.app.config.baseDir) }}&#x27;, data);</code></pre><p>Note:</p><ul><li><strong>ctx.locals is cached. app.locals is merged into it only at the first time that ctx.locals is accessed.</strong></li><li>due to the ambiguity of naming, the <code>ctx.state</code> that is used in Koa is replaced by <code>ctx.locals</code> in Egg.js, i.e. <code>ctx.state</code> and <code>ctx.locals</code> are equivalent. It&#x27;s recommended to use the latter.</li></ul><h2 id="helper">Helper</h2><p>All functions that defined in <code>helper</code> can be directly used in templates.
See <a href="../basics/extend.md">Extend</a> for more details.</p><pre><code class="language-js">// app/extend/helper.js
exports.lowercaseFirst = str =&gt; str[0].toLowerCase() + str.substring(1);

// app/controller/home.js
await ctx.renderString(&#x27;{{ helper.lowercaseFirst(name) }}&#x27;, data);</code></pre><h2 id="security">Security</h2><p>The built-in plugin <a href="https://github.com/eggjs/egg-security">egg-security</a> provides common security helper functions, including <code>helper.shtml / surl / sjs</code> and so on. It&#x27;s strongly recommended to read <a href="./security.md">Security</a>.</p></div></div></div><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-0 ant-col-md-6"><div class="markdown-body" style="font-size:14px"><div><ul><li><a href="#install-view-engine-plugin">Install view engine plugin</a></li><li><a href="#enable-view-engine-plugin">Enable view engine plugin</a></li></ul><ul><li><a href="#configure-view-plugins">Configure view plugins</a><ul><li><a href="#root-string">root {String}</a></li><li><a href="#cache-boolean">cache {Boolean}</a></li><li><a href="#mapping-and-defaultviewengine">mapping and defaultViewEngine</a></li><li><a href="#defaultextension">defaultExtension</a></li></ul></li><li><a href="#render-page">Render Page</a></li><li><a href="#locals">Locals</a></li><li><a href="#helper">Helper</a></li><li><a href="#security">Security</a></li></ul></div></div></div></div></div></div></div></div></div><script type="text/javascript">window.__INIT_STATE__={"lang":"en","props":{"toc":"%20%20*%20%5BInstall%20view%20engine%20plugin%5D(%23install-view-engine-plugin)%0A%20%20*%20%5BEnable%20view%20engine%20plugin%5D(%23enable-view-engine-plugin)%0A-%20%5BConfigure%20view%20plugins%5D(%23configure-view-plugins)%0A%20%20*%20%5Broot%20%7BString%7D%5D(%23root-string)%0A%20%20*%20%5Bcache%20%7BBoolean%7D%5D(%23cache-boolean)%0A%20%20*%20%5Bmapping%20and%20defaultViewEngine%5D(%23mapping-and-defaultviewengine)%0A%20%20*%20%5BdefaultExtension%5D(%23defaultextension)%0A-%20%5BRender%20Page%5D(%23render-page)%0A-%20%5BLocals%5D(%23locals)%0A-%20%5BHelper%5D(%23helper)%0A-%20%5BSecurity%5D(%23security)","meta":{"info":{"title":"View Template Rendering"}},"content":"%0A%0A%0AIn%20most%20cases%2C%20we%20need%20to%20fetch%20data%20and%20render%20with%20template%20files.%0ASo%20we%20need%20to%20use%20corresponding%20view%20engines.%0A%0A%5Begg-view%5D%20is%20a%20built-in%20plugin%20to%20support%20using%20multiple%20view%20engines%20in%20one%20application.%0AAll%20view%20engines%20are%20imported%20as%20plugins.%0AWith%20%5Begg-view%5D%20developers%20can%20use%20the%20same%20API%20interface%20to%20work%20with%20different%20view%20engines.%0ASee%20%5BView%20Plugin%5D(..%2Fadvanced%2Fview-plugin.md)%20for%20more%20details.%0A%0ATake%20the%20officially%20supported%20View%20plugin%20%5Begg-view-nunjucks%5D%20as%20an%20example%3A%0A%0A%23%23%23%20Install%20view%20engine%20plugin%0A%0A%60%60%60bash%0A%24%20npm%20i%20egg-view-nunjucks%20--save%0A%60%60%60%0A%0A%23%23%23%20Enable%20view%20engine%20plugin%0A%0A%60%60%60js%0A%2F%2F%20config%2Fplugin.js%0Aexports.nunjucks%20%3D%20%7B%0A%20%20enable%3A%20true%2C%0A%20%20package%3A%20'egg-view-nunjucks'%2C%0A%7D%3B%0A%60%60%60%0A%0A%23%23%20Configure%20view%20plugins%0A%0A%5Begg-view%5D%20defines%20the%20default%20configuration%20of%20%60config.view%60%0A%0A%23%23%23%20root%20%7BString%7D%0A%0ARoot%20directory%20for%20template%20files%20is%20absolute%20path%2C%20with%20default%20value%20%60%24%7BbaseDir%7D%2Fapp%2Fview%60.%0A%0A%5Begg-view%5D%20supports%20having%20multiple%20directories%2C%20which%20are%20separated%20by%20%60%2C%60.%0AIn%20this%20case%2C%20it%20looks%20for%20template%20files%20from%20all%20the%20directories.%0A%0AThe%20configuration%20below%20is%20an%20example%20of%20multiple%20view%20directories%3A%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0Aconst%20path%20%3D%20require('path')%3B%0Amodule.exports%20%3D%20appInfo%20%3D%3E%20%7B%0A%20%20const%20config%20%3D%20%7B%7D%3B%0A%20%20config.view%20%3D%20%7B%0A%20%20%20%20root%3A%20%5B%0A%20%20%20%20%20%20path.join(appInfo.baseDir%2C%20'app%2Fview')%2C%0A%20%20%20%20%20%20path.join(appInfo.baseDir%2C%20'path%2Fto%2Fanother')%2C%0A%20%20%20%20%5D.join('%2C')%0A%20%20%7D%3B%0A%20%20return%20config%3B%0A%7D%3B%0A%60%60%60%0A%0A%23%23%23%20cache%20%7BBoolean%7D%0A%0ACache%20template%20file%20paths%2C%20default%20value%20is%20%60true%60.%0A%5Begg-view%5D%20looks%20for%20template%20files%20from%20the%20directories%20that%20defined%20in%20%60root%60.%0AWhen%20a%20file%20matching%20given%20template%20path%20is%20found%2C%20the%20file's%20full%20path%20will%20be%20cached%0Aand%20reused%20afterward.%0A%5Begg-view%5D%20won't%20search%20all%20directories%20again%20for%20the%20same%20template%20path.%0A%0A%23%23%23%20mapping%20and%20defaultViewEngine%0A%0AEvery%20view%20engine%20has%20a%20view%20engine%20name%20defined%20when%20the%20plugin%20is%20enabled.%0AIn%20view%20configuration%2C%20%60mapping%60%20defines%20the%20mapping%0Afrom%20template%20file's%20extension%20name%20to%20view%20engine%20name.%0AFor%20example%2C%20use%20Nunjucks%20engine%20to%20render%20%60.nj%60%20files.%0A%0A%60%60%60js%0Amodule.exports%20%3D%20%7B%0A%20%20view%3A%20%7B%0A%20%20%20%20mapping%3A%20%7B%0A%20%20%20%20%20%20'.nj'%3A%20'nunjucks'%2C%0A%20%20%20%20%7D%2C%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%5Begg-view%5D%20uses%20the%20corresponding%20view%20engine%20according%20to%20the%20configuration%20above.%0A%0A%60%60%60js%0Aawait%20ctx.render('home.nj')%3B%0A%60%60%60%0A%0AThe%20mapping%20from%20file%20extension%20name%20to%20view%20engine%20must%20be%20defined.%0AOtherwise%20%5Begg-view%5D%20cannot%20find%20correct%20view%20engine.%0AGlobal%20configuration%20can%20be%20done%20with%20%60defaultViewEngine%60.%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0Amodule.exports%20%3D%20%7B%0A%20%20view%3A%20%7B%0A%20%20%20%20defaultViewEngine%3A%20'nunjucks'%2C%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0AIf%20a%20view%20engine%20cannot%20be%20found%20according%20to%20specified%20mapping%2C%0Athe%20default%20view%20engine%20will%20be%20used.%0AFor%20the%20applications%20that%20use%20only%20one%20view%20engine%2C%0Ait's%20recommended%20to%20set%20this%20option.%0A%0A%23%23%23%20defaultExtension%0A%0AWhen%20calling%20%60render()%60%2C%20the%20first%20argument%20should%20contain%20file%20extension%20name%2C%0Aunless%20%60defaultExtension%60%20has%20been%20configured.%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0Amodule.exports%20%3D%20%7B%0A%20%20view%3A%20%7B%0A%20%20%20%20defaultExtension%3A%20'.nj'%2C%0A%20%20%7D%2C%0A%7D%3B%0A%0A%2F%2F%20render%20app%2Fview%2Fhome.nj%0Aawait%20ctx.render('home')%3B%0A%60%60%60%0A%0A%23%23%20Render%20Page%0A%0A%5Begg-view%5D%20provides%20three%20interfaces%20in%20Context.%0AAll%20three%20returns%20a%20Promise%3A%0A%0A-%20%60render(name%2C%20locals)%60%20renders%20template%20file%2C%20and%20set%20the%20value%20to%20%60ctx.body%60.%0A-%20%60renderView(name%2C%20locals)%60%20renders%20template%20file%2C%20returns%20the%20result%20and%20don't%20set%20the%20value%20to%20any%20variable.%0A-%20%60renderString(tpl%2C%20locals)%60%20renders%20template%20string%2C%20returns%20the%20result%20and%20don't%20set%20the%20value%20to%20any%20variable.%0A%0A%60%60%60js%0A%2F%2F%20%7Bapp_root%7D%2Fapp%2Fcontroller%2Fhome.js%0Aclass%20HomeController%20extends%20Controller%20%7B%0A%20%20async%20index()%20%7B%0A%20%20%20%20const%20data%20%3D%20%7B%20name%3A%20'egg'%20%7D%3B%0A%0A%20%20%20%20%2F%2F%20render%20a%20template%2C%20path%20relate%20to%20%60app%2Fview%60%0A%20%20%20%20await%20ctx.render('home%2Findex.tpl'%2C%20data)%3B%0A%0A%20%20%20%20%2F%2F%20or%20manually%20set%20render%20result%20to%20ctx.body%0A%20%20%20%20ctx.body%20%3D%20await%20ctx.renderView('path%2Fto%2Ffile.tpl'%2C%20data)%3B%0A%0A%20%20%20%20%2F%2F%20or%20render%20string%20directly%0A%20%20%20%20ctx.body%20%3D%20await%20ctx.renderString('hi%2C%20%7B%7B%20name%20%7D%7D'%2C%20data%2C%20%7B%0A%20%20%20%20%20%20viewEngine%3A%20'nunjucks'%2C%0A%20%20%20%20%7D)%3B%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0AWhen%20calling%20%60renderString%60%2C%20view%20engine%20should%20be%20specified%20unless%20%60defaultViewEngine%60%20has%20been%20defined.%0A%0A%23%23%20Locals%0A%0AIn%20the%20process%20of%20rendering%20pages%2C%0Awe%20usually%20need%20a%20variable%20to%20contain%20all%20information%20that%20is%20used%20in%20view%20template.%0A%5Begg-view%5D%20provides%20%60app.locals%60%20and%20%60ctx.locals%60.%0A%0A-%20%60app.locals%60%20is%20global%2C%20usually%20configured%20in%20%60app.js%60.%0A-%20%60ctx.locals%60%20is%20per-request%2C%20and%20it%20merges%20%60app.locals%60.%0A-%20%60ctx.locals%60%20can%20be%20assigned%20by%20modifying%20key%2Fvalue%20or%20assigned%20with%20a%20new%20object.%20%5Begg-view%5D%20will%20merge%20the%20new%20object%20automatically%20in%20corresponding%20setter.%0A%0A%60%60%60js%0A%2F%2F%20%60app.locals%60%20merged%20into%20%60ctx.locals%60%0Actx.app.locals%20%3D%20%7B%20a%3A%201%20%7D%3B%0Actx.locals.b%20%3D%202%3B%0Aconsole.log(ctx.locals)%3B%20%2F%2F%20%7B%20a%3A%201%2C%20b%3A%202%20%7D%0A%0A%2F%2F%20in%20the%20processing%20of%20a%20request%2C%20%60app.locals%60%20is%20merged%20into%20%60ctx.locals%60%20only%20at%20the%20first%20time%20%60ctx.locals%60%20being%20accessed%0Actx.app.locals%20%3D%20%7B%20a%3A%202%20%7D%3B%0Aconsole.log(ctx.locals)%3B%20%2F%2F%20already%20merged%20before%2C%20so%20output%20is%20still%20%7B%20a%3A%201%2C%20b%3A%202%20%7D%0A%0A%2F%2F%20pass%20a%20new%20object%20to%20%60locals%60.%20New%20object%20will%20be%20merged%20into%20%60locals%60%2C%20instead%20of%20replacing%20it.%20It's%20done%20by%20setter%20automatically.%0Actx.locals.c%20%3D%203%3B%0Actx.locals%20%3D%20%7B%20d%3A%204%20%7D%3B%0Aconsole.log(ctx.locals)%3B%20%2F%2F%20%7B%20a%3A%201%2C%20b%3A%202%2C%20c%3A%203%2C%20d%3A%204%20%7D%0A%60%60%60%0A%0AIn%20practical%20development%2C%20we%20usually%20don't%20use%20these%20two%20objects%20in%20controller%20directly.%0AInstead%2C%20simply%20call%20%60ctx.render(name%2C%20data)%60%3A%0A-%20%5Begg-view%5D%20merges%20%60data%60%20into%20%60ctx.locals%60%20automatically.%0A-%20%5Begg-view%5D%20injects%20%60ctx%60%2C%20%60request%60%2C%20%60helper%60%20into%20locals%20automatically.%0A%0A%60%60%60js%0Actx.app.locals%20%3D%20%7B%20appName%3A%20'showcase'%20%7D%3B%0Aconst%20data%20%3D%20%7B%20name%3A%20'egg'%20%7D%3B%0A%0A%2F%2F%20will%20auto%20merge%20%60data%60%20to%20%60ctx.locals%60%2C%20output%3A%20egg%20-%20showcase%0Aawait%20ctx.renderString('%7B%7B%20name%20%7D%7D%20-%20%7B%7B%20appName%20%7D%7D'%2C%20data)%3B%0A%0A%2F%2F%20helper%2C%20ctx%2C%20request%20will%20auto%20inject%0Aawait%20ctx.renderString('%7B%7B%20name%20%7D%7D%20-%20%7B%7B%20helper.lowercaseFirst(ctx.app.config.baseDir)%20%7D%7D'%2C%20data)%3B%0A%60%60%60%0A%0ANote%3A%0A%0A-%20**ctx.locals%20is%20cached.%20app.locals%20is%20merged%20into%20it%20only%20at%20the%20first%20time%20that%20ctx.locals%20is%20accessed.**%0A-%20due%20to%20the%20ambiguity%20of%20naming%2C%20the%20%60ctx.state%60%20that%20is%20used%20in%20Koa%20is%20replaced%20by%20%60ctx.locals%60%20in%20Egg.js%2C%20i.e.%20%60ctx.state%60%20and%20%60ctx.locals%60%20are%20equivalent.%20It's%20recommended%20to%20use%20the%20latter.%0A%0A%23%23%20Helper%0A%0AAll%20functions%20that%20defined%20in%20%60helper%60%20can%20be%20directly%20used%20in%20templates.%0ASee%20%5BExtend%5D(..%2Fbasics%2Fextend.md)%20for%20more%20details.%0A%0A%60%60%60js%0A%2F%2F%20app%2Fextend%2Fhelper.js%0Aexports.lowercaseFirst%20%3D%20str%20%3D%3E%20str%5B0%5D.toLowerCase()%20%2B%20str.substring(1)%3B%0A%0A%2F%2F%20app%2Fcontroller%2Fhome.js%0Aawait%20ctx.renderString('%7B%7B%20helper.lowercaseFirst(name)%20%7D%7D'%2C%20data)%3B%0A%60%60%60%0A%0A%23%23%20Security%0A%0AThe%20built-in%20plugin%20%5Begg-security%5D%20provides%20common%20security%20helper%20functions%2C%20including%20%60helper.shtml%20%2F%20surl%20%2F%20sjs%60%20and%20so%20on.%20It's%20strongly%20recommended%20to%20read%20%5BSecurity%5D(.%2Fsecurity.md).%0A%0A%5Begg-security%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-security%0A%5Begg-view-nunjucks%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-view-nunjucks%0A%5Begg-view%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-view%0A"}}</script><script type="text/javascript" src="/static/js/post.b9faab88.js"></script></body></html>