<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.png"><style class="_styletron_hydrate_"></style><title>Deployment</title><meta name="description" content="Born to build better enterprise frameworks and apps"><link href="/static/css/post.d62265dc.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="ant-layout" data-reactroot=""><div class="header-module__header___3ADJ9 ant-layout-header"><div class="ant-row-flex"><div class="ant-col-xs-12 ant-col-md-20 ant-col-lg-2"><div class="header-module__logo___3yTXp"><a href="/"><img src="/logo.svg" alt="logo"/></a></div></div><div class="ant-col-xs-0 ant-col-md-0 ant-col-lg-20"><ul class="ant-menu header-module__menu___3yEtW ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-item" role="menuitem"><a href="/en/intro/">Guide</a></li><li class="ant-menu-item" role="menuitem"><a href="/api/">API</a></li><li class="ant-menu-item" role="menuitem"><a href="/en/tutorials/index.html">Tutorials</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/search?q=topic%3Aegg-plugin&amp;type=Repositories">Plugins</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/eggjs/egg/releases">Release</a></li></ul></div><div style="text-align:right" class="ant-col-xs-12 ant-col-md-4 ant-col-lg-2"><button type="button" class="ant-btn"><span>切换语言</span></button></div></div></div><div class="ant-layout-content"><div class="basic_layout-module__content___3flpY ant-layout"><div class="sider-module__side___1Cadj ant-layout-sider ant-layout-sider-light" style="flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"><ul class="ant-menu sider-module__menu___2GqPr ant-menu-light ant-menu-root ant-menu-inline" role="menu"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="0$Menu" aria-haspopup="true"><span>Guide</span><i class="ant-menu-submenu-arrow"></i></div><ul id="0$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/index.html">What is Egg?</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/egg-and-koa.html">Egg and Koa</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/quickstart.html">Quick Start</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/progressive.html">Progressive</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/migration.html">Migration to 2.x</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="1$Menu" aria-haspopup="true"><span>Basis Function</span><i class="ant-menu-submenu-arrow"></i></div><ul id="1$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/structure.html">Directory Structure</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/objects.html">Built-in Objects</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/env.html">Environment</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/config.html">Configuration</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/middleware.html">Middleware</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/router.html">Router</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/controller.html">Controller</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/service.html">Service</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/plugin.html">Plugin</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/schedule.html">Schedule</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/extend.html">Extend</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/app-start.html">Custom Init</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="2$Menu" aria-haspopup="true"><span>Core</span><i class="ant-menu-submenu-arrow"></i></div><ul id="2$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/development.html">Development</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/unittest.html">Unit Testing</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/deployment.html">Deployment</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/logger.html">Logger</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/httpclient.html">HttpClient</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/cookie-and-session.html">Cookie and Session</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/cluster-and-ipc.html">Cluster and IPC</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/view.html">View</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/error-handling.html">Error Handling</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/security.html">Security</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/i18n.html">i18n</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="3$Menu" aria-haspopup="true"><span>Tutorials</span><i class="ant-menu-submenu-arrow"></i></div><ul id="3$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/mysql.html">MySQL</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/restful.html">RESTful API</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/passport.html">Passport</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/socketio.html">Socket.IO</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/assets.html">Assets</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/typescript.html">TypeScript</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="4$Menu" aria-haspopup="true"><span>Advanced</span><i class="ant-menu-submenu-arrow"></i></div><ul id="4$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/loader.html">Loader</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/plugin.html">Plugin Development</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/framework.html">Framework</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/cluster-client.html">Cluster Enhancement</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/view-plugin.html">View Plugin</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/style-guide.html">Style Guide</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="5$Menu" aria-haspopup="true"><span>Community</span><i class="ant-menu-submenu-arrow"></i></div><ul id="5$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/plugins/">Plugin List</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/contributing.html">Contributing</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/resource.html">Resource</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/faq.html">FAQ</a></li></ul></li></ul></div></div><div class="basic_layout-module__post___2Z7KK ant-layout-content"><div class="ant-row" style="margin-left:-8px;margin-right:-8px"><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-24 ant-col-md-18"><div class="markdown-body" style="font-size:14px"><div><p>Launching application via <code>egg-bin dev</code> will bring something magical to help people to develop in high efficiency. However, actually, those features are not required in production or any other environment. Let&#x27;s walk through and learn how to deploy your application in Egg&#x27;s way.</p><p>There are two steps to achieve building once and deploying multiply from source code to runtime.</p><h2 id="build">Build</h2><p>In the stage, you don&#x27;t need to compile JavaScript files unless TypeScript or Babel(ES6 features) are involved in stack.</p><p>Generally, before deploying the application, dependencies will be installed with <code>NODE_ENV=production</code> or <code>--production</code>, which will exclude <code>devDependencies</code> because those used in development may increase the size of package released or even create pitfalls that you never expect.</p><pre><code class="language-bash">$ cd baseDir
$ npm install --production
$ tar -zcvf ../release.tgz .</code></pre><p>Both the application and dependencies will be packed into a tgz file, what you are going to do is unzipping and launching it.</p><p>Reusable package brings a few pros in:</p><ul><li>Environments in building and runtime are different, try to keep the later environment pure and stable.</li><li>Abbreviating publish progress and making rollback without hassle.</li></ul><h2 id="deploy">Deploy</h2><p>Node.js(<code>&gt;= 8.0.0</code>) is required so that you should make sure it is pre-installed in runtime environment.</p><p>Egg takes <code>egg-cluster</code> to create <a href="https://github.com/eggjs/egg/blob/master/docs/source/en/core/cluster-and-ipc.md#master">Master</a> process, which you can rely on to secure the application instead of daemon manager like <a href="https://github.com/Unitech/pm2">pm2</a>. The API is also really convenient for developers to achieve that, just <code>egg.startCluster</code>.</p><p>And framework also provide <a href="https://github.com/eggjs/egg-scripts">egg-scripts</a> for developers to start/stop application at prod mode.</p><p>Firstly, we need to import <code>egg-scripts</code> as <code>dependencies</code>:</p><pre><code class="language-bash">$ npm i egg-scripts --save</code></pre><p>Then add <code>npm scripts</code> to <code>package.json</code>:</p><pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;start&quot;: &quot;egg-scripts start --daemon&quot;,
    &quot;stop&quot;: &quot;egg-scripts stop&quot;
  }
}</code></pre><p>Then we are able to use <code>npm start</code> and <code>npm stop</code> to manage application.</p><blockquote><p>Note: <code>egg-scripts</code> has limited support for Windows, see <a href="https://github.com/eggjs/egg-scripts/pull/22">#22</a>.</p></blockquote><h3 id="start">Start</h3><pre><code class="language-bash">$ egg-scripts start --port=7001 --daemon --title=egg-server-showcase</code></pre><p>Options:</p><ul><li><code>--port=7001</code> http server port, will use <code>process.env.PORT</code>, default to <code>7001</code>.</li><li><code>--daemon</code> whether run at background, so you don&#x27;t need <code>nohup</code>. Ignore this when the application run in docker instance.</li><li><code>--env=prod</code> then framework env, will use <code>process.env.EGG_SERVER_ENV</code>, default to <code>prod</code>。</li><li><code>--workers=2</code> worker count, default to cpu cores, which can leverage the capability of the cpu.</li><li><code>--title=egg-server-showcase</code> convenient for <code>ps + grep</code>, default to <code>egg-server-${appname}</code>.</li><li><code>--framework=yadan</code> config <code>egg.framework</code> at <code>package.json</code> or pass this args, when you are using <a href="../advanced/framework.md">Custom Framework</a>.</li><li><code>--ignore-stderr</code> ignore the std err at start up。</li><li>support all options from <a href="https://github.com/eggjs/egg-cluster">egg-cluster</a>, such as <code>--https</code>.</li></ul><p>More about <a href="https://github.com/eggjs/egg-scripts">egg-scripts</a> and <a href="https://github.com/eggjs/egg-cluster">egg-cluster</a> documents.</p><h4 id="dispatch-with-arguments">Dispatch with arguments</h4><p>Arguments of dispatch can be configured in <code>config.{env}.js</code>.</p><pre><code class="language-js">// config/config.default.js

exports.cluster = {
  listen: {
    port: 7001,
    hostname: &#x27;127.0.0.1&#x27;,
    // path: &#x27;/var/run/egg.sock&#x27;,
  }
}</code></pre><p><a href="https://nodejs.org/api/http.html#http_server_listen_port_hostname_backlog_callback">server.listen</a> supports arguments including <code>path</code>, <code>port</code> and <code>hostname</code> to change dispatching behavior. One thing you should know is that the <code>port</code> in <code>egg.startCluster</code> will override the one in application config.</p><h3 id="stop">Stop</h3><pre><code class="language-bash">$ egg-scripts stop</code></pre><p>This command will kill master process which will handler and notice worker and agent to gracefull exit.</p><p>Also you can manually call <code>ps -eo &quot;pid,command&quot; | grep &quot;--type=egg-server&quot;</code> to find master process then <code>kill</code> without <code>-9</code>.</p></div></div></div><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-0 ant-col-md-6"><div class="markdown-body" style="font-size:14px"><div><ul><li><a href="#build">Build</a></li><li><a href="#deploy">Deploy</a><ul><li><a href="#start">Start</a><ul><li><a href="#dispatch-with-arguments">Dispatch with arguments</a></li></ul></li><li><a href="#stop">Stop</a></li></ul></li></ul></div></div></div></div></div></div></div></div></div><script type="text/javascript">window.__INIT_STATE__={"lang":"en","props":{"toc":"-%20%5BBuild%5D(%23build)%0A-%20%5BDeploy%5D(%23deploy)%0A%20%20*%20%5BStart%5D(%23start)%0A%20%20%20%20%2B%20%5BDispatch%20with%20arguments%5D(%23dispatch-with-arguments)%0A%20%20*%20%5BStop%5D(%23stop)","meta":{"info":{"title":"Deployment"}},"content":"%0A%0A%0ALaunching%20application%20via%20%60egg-bin%20dev%60%20will%20bring%20something%20magical%20to%20help%20people%20to%20develop%20in%20high%20efficiency.%20However%2C%20actually%2C%20those%20features%20are%20not%20required%20in%20production%20or%20any%20other%20environment.%20Let's%20walk%20through%20and%20learn%20how%20to%20deploy%20your%20application%20in%20Egg's%20way.%0A%0AThere%20are%20two%20steps%20to%20achieve%20building%20once%20and%20deploying%20multiply%20from%20source%20code%20to%20runtime.%0A%0A%23%23%20Build%0A%0AIn%20the%20stage%2C%20you%20don't%20need%20to%20compile%20JavaScript%20files%20unless%20TypeScript%20or%20Babel(ES6%20features)%20are%20involved%20in%20stack.%0A%0AGenerally%2C%20before%20deploying%20the%20application%2C%20dependencies%20will%20be%20installed%20with%20%60NODE_ENV%3Dproduction%60%20or%20%60--production%60%2C%20which%20will%20exclude%20%60devDependencies%60%20because%20those%20used%20in%20development%20may%20increase%20the%20size%20of%20package%20released%20or%20even%20create%20pitfalls%20that%20you%20never%20expect.%0A%0A%60%60%60bash%0A%24%20cd%20baseDir%0A%24%20npm%20install%20--production%0A%24%20tar%20-zcvf%20..%2Frelease.tgz%20.%0A%60%60%60%0A%0ABoth%20the%20application%20and%20dependencies%20will%20be%20packed%20into%20a%20tgz%20file%2C%20what%20you%20are%20going%20to%20do%20is%20unzipping%20and%20launching%20it.%0A%0AReusable%20package%20brings%20a%20few%20pros%20in%3A%0A-%20Environments%20in%20building%20and%20runtime%20are%20different%2C%20try%20to%20keep%20the%20later%20environment%20pure%20and%20stable.%0A-%20Abbreviating%20publish%20progress%20and%20making%20rollback%20without%20hassle.%0A%0A%23%23%20Deploy%0A%0ANode.js(%60%3E%3D%208.0.0%60)%20is%20required%20so%20that%20you%20should%20make%20sure%20it%20is%20pre-installed%20in%20runtime%20environment.%0A%0AEgg%20takes%20%60egg-cluster%60%20to%20create%20%5BMaster%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg%2Fblob%2Fmaster%2Fdocs%2Fsource%2Fen%2Fcore%2Fcluster-and-ipc.md%23master)%20process%2C%20which%20you%20can%20rely%20on%20to%20secure%20the%20application%20instead%20of%20daemon%20manager%20like%20%5Bpm2%5D.%20The%20API%20is%20also%20really%20convenient%20for%20developers%20to%20achieve%20that%2C%20just%20%60egg.startCluster%60.%0A%0AAnd%20framework%20also%20provide%20%5Begg-scripts%5D%20for%20developers%20to%20start%2Fstop%20application%20at%20prod%20mode.%0A%0AFirstly%2C%20we%20need%20to%20import%20%60egg-scripts%60%20as%20%60dependencies%60%3A%0A%0A%60%60%60bash%0A%24%20npm%20i%20egg-scripts%20--save%0A%60%60%60%0A%0AThen%20add%20%60npm%20scripts%60%20to%20%60package.json%60%3A%0A%0A%60%60%60json%0A%7B%0A%20%20%22scripts%22%3A%20%7B%0A%20%20%20%20%22start%22%3A%20%22egg-scripts%20start%20--daemon%22%2C%0A%20%20%20%20%22stop%22%3A%20%22egg-scripts%20stop%22%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0AThen%20we%20are%20able%20to%20use%20%60npm%20start%60%20and%20%60npm%20stop%60%20to%20manage%20application.%0A%0A%3E%20Note%3A%20%60egg-scripts%60%20has%20limited%20support%20for%20Windows%2C%20see%20%5B%2322%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-scripts%2Fpull%2F22).%0A%0A%23%23%23%20Start%0A%0A%60%60%60bash%0A%24%20egg-scripts%20start%20--port%3D7001%20--daemon%20--title%3Degg-server-showcase%0A%60%60%60%0A%0AOptions%3A%0A%0A-%20%60--port%3D7001%60%20http%20server%20port%2C%20will%20use%20%60process.env.PORT%60%2C%20default%20to%20%607001%60.%0A-%20%60--daemon%60%20whether%20run%20at%20background%2C%20so%20you%20don't%20need%20%60nohup%60.%20Ignore%20this%20when%20the%20application%20run%20in%20docker%20instance.%0A-%20%60--env%3Dprod%60%20then%20framework%20env%2C%20will%20use%20%60process.env.EGG_SERVER_ENV%60%2C%20default%20to%20%60prod%60%E3%80%82%0A-%20%60--workers%3D2%60%20worker%20count%2C%20default%20to%20cpu%20cores%2C%20which%20can%20leverage%20the%20capability%20of%20the%20cpu.%0A-%20%60--title%3Degg-server-showcase%60%20convenient%20for%20%60ps%20%2B%20grep%60%2C%20default%20to%20%60egg-server-%24%7Bappname%7D%60.%0A-%20%60--framework%3Dyadan%60%20config%20%60egg.framework%60%20at%20%60package.json%60%20or%20pass%20this%20args%2C%20when%20you%20are%20using%20%5BCustom%20Framework%5D(..%2Fadvanced%2Fframework.md).%0A-%20%60--ignore-stderr%60%20ignore%20the%20std%20err%20at%20start%20up%E3%80%82%0A-%20support%20all%20options%20from%20%5Begg-cluster%5D%2C%20such%20as%20%60--https%60.%0A%0AMore%20about%20%5Begg-scripts%5D%20and%20%5Begg-cluster%5D%20documents.%0A%0A%23%23%23%23%20Dispatch%20with%20arguments%0A%0AArguments%20of%20dispatch%20can%20be%20configured%20in%20%60config.%7Benv%7D.js%60.%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0A%0Aexports.cluster%20%3D%20%7B%0A%20%20listen%3A%20%7B%0A%20%20%20%20port%3A%207001%2C%0A%20%20%20%20hostname%3A%20'127.0.0.1'%2C%0A%20%20%20%20%2F%2F%20path%3A%20'%2Fvar%2Frun%2Fegg.sock'%2C%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0A%5Bserver.listen%5D(https%3A%2F%2Fnodejs.org%2Fapi%2Fhttp.html%23http_server_listen_port_hostname_backlog_callback)%20supports%20arguments%20including%20%60path%60%2C%20%60port%60%20and%20%60hostname%60%20to%20change%20dispatching%20behavior.%20One%20thing%20you%20should%20know%20is%20that%20the%20%60port%60%20in%20%60egg.startCluster%60%20will%20override%20the%20one%20in%20application%20config.%0A%0A%23%23%23%20Stop%0A%0A%60%60%60bash%0A%24%20egg-scripts%20stop%0A%60%60%60%0A%0AThis%20command%20will%20kill%20master%20process%20which%20will%20handler%20and%20notice%20worker%20and%20agent%20to%20gracefull%20exit.%0A%0AAlso%20you%20can%20manually%20call%20%60ps%20-eo%20%22pid%2Ccommand%22%20%7C%20grep%20%22--type%3Degg-server%22%60%20to%20find%20master%20process%20then%20%60kill%60%20without%20%60-9%60.%0A%0A%5Begg-cluster%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-cluster%0A%5Begg-scripts%5D%3A%20https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-scripts%0A%5Bpm2%5D%3A%20https%3A%2F%2Fgithub.com%2FUnitech%2Fpm2"}}</script><script type="text/javascript" src="/static/js/post.b9faab88.js"></script></body></html>