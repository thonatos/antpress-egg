<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.png"><style class="_styletron_hydrate_"></style><title>Exception Handling</title><meta name="description" content="Born to build better enterprise frameworks and apps"><link href="/static/css/post.d62265dc.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="ant-layout" data-reactroot=""><div class="header-module__header___3ADJ9 ant-layout-header"><div class="ant-row-flex"><div class="ant-col-xs-12 ant-col-md-20 ant-col-lg-2"><div class="header-module__logo___3yTXp"><a href="/"><img src="/logo.svg" alt="logo"/></a></div></div><div class="ant-col-xs-0 ant-col-md-0 ant-col-lg-20"><ul class="ant-menu header-module__menu___3yEtW ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-item" role="menuitem"><a href="/en/intro/">Guide</a></li><li class="ant-menu-item" role="menuitem"><a href="/api/">API</a></li><li class="ant-menu-item" role="menuitem"><a href="/en/tutorials/index.html">Tutorials</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/search?q=topic%3Aegg-plugin&amp;type=Repositories">Plugins</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/eggjs/egg/releases">Release</a></li></ul></div><div style="text-align:right" class="ant-col-xs-12 ant-col-md-4 ant-col-lg-2"><button type="button" class="ant-btn"><span>切换语言</span></button></div></div></div><div class="ant-layout-content"><div class="basic_layout-module__content___3flpY ant-layout"><div class="sider-module__side___1Cadj ant-layout-sider ant-layout-sider-light" style="flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"><ul class="ant-menu sider-module__menu___2GqPr ant-menu-light ant-menu-root ant-menu-inline" role="menu"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="0$Menu" aria-haspopup="true"><span>Guide</span><i class="ant-menu-submenu-arrow"></i></div><ul id="0$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/index.html">What is Egg?</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/egg-and-koa.html">Egg and Koa</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/quickstart.html">Quick Start</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/progressive.html">Progressive</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/migration.html">Migration to 2.x</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="1$Menu" aria-haspopup="true"><span>Basis Function</span><i class="ant-menu-submenu-arrow"></i></div><ul id="1$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/structure.html">Directory Structure</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/objects.html">Built-in Objects</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/env.html">Environment</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/config.html">Configuration</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/middleware.html">Middleware</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/router.html">Router</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/controller.html">Controller</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/service.html">Service</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/plugin.html">Plugin</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/schedule.html">Schedule</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/extend.html">Extend</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/app-start.html">Custom Init</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="2$Menu" aria-haspopup="true"><span>Core</span><i class="ant-menu-submenu-arrow"></i></div><ul id="2$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/development.html">Development</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/unittest.html">Unit Testing</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/deployment.html">Deployment</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/logger.html">Logger</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/httpclient.html">HttpClient</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/cookie-and-session.html">Cookie and Session</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/cluster-and-ipc.html">Cluster and IPC</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/view.html">View</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/error-handling.html">Error Handling</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/security.html">Security</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/i18n.html">i18n</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="3$Menu" aria-haspopup="true"><span>Tutorials</span><i class="ant-menu-submenu-arrow"></i></div><ul id="3$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/mysql.html">MySQL</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/restful.html">RESTful API</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/passport.html">Passport</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/socketio.html">Socket.IO</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/assets.html">Assets</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/typescript.html">TypeScript</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="4$Menu" aria-haspopup="true"><span>Advanced</span><i class="ant-menu-submenu-arrow"></i></div><ul id="4$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/loader.html">Loader</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/plugin.html">Plugin Development</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/framework.html">Framework</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/cluster-client.html">Cluster Enhancement</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/view-plugin.html">View Plugin</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/style-guide.html">Style Guide</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="5$Menu" aria-haspopup="true"><span>Community</span><i class="ant-menu-submenu-arrow"></i></div><ul id="5$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/plugins/">Plugin List</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/contributing.html">Contributing</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/resource.html">Resource</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/faq.html">FAQ</a></li></ul></li></ul></div></div><div class="basic_layout-module__post___2Z7KK ant-layout-content"><div class="ant-row" style="margin-left:-8px;margin-right:-8px"><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-24 ant-col-md-18"><div class="markdown-body" style="font-size:14px"><div><h2 id="exception-capture">Exception Capture</h2><p>Taking benefits from framework asynchronous support, all exceptions can be caught by <code>try catch</code>.</p><p>With those features, you can take following implementation as reference:</p><pre><code class="language-js">// app/service/test.js
try {
  const res = await this.ctx.curl(&#x27;http://eggjs.com/api/echo&#x27;, { dataType: &#x27;json&#x27; });
  if (res.status !== 200) throw new Error(&#x27;response status is not 200&#x27;);
  return res.data;
} catch (err) {
  this.logger.error(err);
  return {};
}</code></pre><p>Generally, you can use <code>try catch</code> to catch exceptions. However, some implementations may break this mechanism down. Imaging that <code>await</code> makes generators run in order just like a chain. What will happen if one of them jumpoff the chain? The following code can help you realize the imagination:</p><pre><code class="language-js">// app/controller/home.js
class HomeController extends Controller {
  async buy () {
    const request = {};
    const config = await ctx.service.trade.buy(request);
    // checking the deal and don&#x27;t block current request
    setImmediate(() =&gt; {
      ctx.service.trade.check(request).catch(err =&gt; ctx.logger.error(err));
    });
  }
}</code></pre><p>In this case, you may find that the exceptions in <code>setImmediate</code> will be swallowed because the scope breaks the chain, although egg already handled exceptions externally.</p><p>Above scene is also considered. To catch the exception inside the scope, You can invoke helper method <code>ctx.runInBackground(scope)</code> to wrap the chain back. Now, the exceptions will be detected and caught.</p><pre><code class="language-js">class HomeController extends Controller {
  async buy () {
    const request = {};
    const config = await ctx.service.trade.buy(request);
    // checking the deal and don&#x27;t block current request
    ctx.runInBackground(async () =&gt; {
      // Exceptions thrown here will be caught in background and printed into log.
      await ctx.service.trade.check(request);
    });
  }
}</code></pre><p>For convenience of locating problems, exceptions must be guaranteed to be Error object or object based on Error object, which offers a trace of which functions were called.</p><h2 id="egg-takes-charge-of-exceptions">Egg takes charge of exceptions</h2><p><a href="https://github.com/eggjs/egg-onerror">egg-onerror</a>, one of Egg&#x27;s plugin, handles all exceptions thrown in Middleware, Controller and Service, and returns the error as response based on &quot;Accept&quot; in request header field.</p><table><thead><tr><th>Accept</th><th>ENV</th><th>errorPageUrl</th><th>response</th></tr></thead><tbody><tr><td>HTML &amp; TEXT</td><td>local &amp; unittest</td><td>-</td><td>onerror built-in error page</td></tr><tr><td>HTML &amp; TEXT</td><td>others</td><td>YES</td><td>redirect to errorPageUrl</td></tr><tr><td>HTML &amp; TEXT</td><td>others</td><td>NO</td><td>onerror built-in error page(simple, not recommended)</td></tr><tr><td>JSON &amp; JSONP</td><td>local &amp; unittest</td><td>-</td><td>JSON Object or JSONP response body with details</td></tr><tr><td>JSON &amp; JSONP</td><td>others</td><td>-</td><td>JSON object  or JSONP response body without details</td></tr></tbody></table><h3 id="errorpageurl">errorPageUrl</h3><p>Redirecting to your customized error page by setting <code>errorPageUrl</code> in <code>onerror</code> plugin.</p><p><code>onerror</code> config in <code>config/config.default.js</code>:</p><pre><code class="language-js">module.exports = {
  onerror: {
    errorPageUrl: &#x27;/50x.html&#x27;,
  },
};</code></pre><h2 id="create-your-universal-exception-handler">Create your universal exception handler</h2><p>Once the default handler no longer meet your needs, you still can customize your owner error handler by onerror&#x27;s configurations.</p><pre><code class="language-js">// config/config.default.js
module.exports = {
  onerror: {
    all(err, ctx) {
      // Define an error handler for all type of Response.
      // Once config.all present, other type of error handers will be ignored.
      ctx.body = &#x27;error&#x27;;
      ctx.status = 500;
    },
    html(err, ctx) {
      // html hander
      ctx.body = &#x27;&lt;h3&gt;error&lt;/h3&gt;&#x27;;
      ctx.status = 500;
    },
    json(err, ctx) {
      // json hander
      ctx.body = { message: &#x27;error&#x27; };
      ctx.status = 500;
    },
    jsonp(err, ctx) {
      // Generally, we don&#x27;t need to customize jsonp error handler.
      // It will call json error handler and wrap to jsonp type response.
  },
};</code></pre><h2 id="404">404</h2><p>Egg won&#x27;t take <code>NOT FOUND</code> from back-end as exception. Instead, if <code>NOT FOUND</code> is emitted without a body, it will return the following JSON object as default response.</p><p>identified as JSON:</p><pre><code class="language-js">{
  &quot;message&quot;: &quot;Not Found&quot;
}</code></pre><p>identified as HTML:</p><pre><code class="language-html">&lt;h1&gt;404 Not Found&lt;/h1&gt;</code></pre><p>Overriding default 404 page to the one you want:</p><pre><code class="language-js">// config/config.default.js
module.exports = {
  notfound: {
    pageUrl: &#x27;/404.html&#x27;,
  },
};</code></pre><h3 id="customize-404-response">Customize 404 Response</h3><p>If you want a customized 404 response, you only need to create a middleware to handle it once, just like handling exceptions above.</p><pre><code class="language-js">// app/middleware/notfound_handler.js
module.exports = () =&gt; {
  return async function notFoundHandler(ctx, next) {
    await next();
    if (ctx.status === 404 &amp;&amp; !ctx.body) {
      if (ctx.acceptJSON) {
        ctx.body = { error: &#x27;Not Found&#x27; };
      } else {
        ctx.body = &#x27;&lt;h1&gt;Page Not Found&lt;/h1&gt;&#x27;;
      }
    }
  };
};</code></pre><p>Adding yours to <code>middleware</code> in config:</p><pre><code class="language-js">// config/config.default.js
module.exports = {
  middleware: [ &#x27;notfoundHandler&#x27; ],
};</code></pre></div></div></div><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-0 ant-col-md-6"><div class="markdown-body" style="font-size:14px"><div><ul><li><a href="#exception-capture">Exception Capture</a></li><li><a href="#egg-takes-charge-of-exceptions">Egg takes charge of exceptions</a><ul><li><a href="#errorpageurl">errorPageUrl</a></li></ul></li><li><a href="#create-your-universal-exception-handler">Create your universal exception handler</a></li><li><a href="#404">404</a><ul><li><a href="#customize-404-response">Customize 404 Response</a></li></ul></li></ul></div></div></div></div></div></div></div></div></div><script type="text/javascript">window.__INIT_STATE__={"lang":"en","props":{"toc":"-%20%5BException%20Capture%5D(%23exception-capture)%0A-%20%5BEgg%20takes%20charge%20of%20exceptions%5D(%23egg-takes-charge-of-exceptions)%0A%20%20*%20%5BerrorPageUrl%5D(%23errorpageurl)%0A-%20%5BCreate%20your%20universal%20exception%20handler%5D(%23create-your-universal-exception-handler)%0A-%20%5B404%5D(%23404)%0A%20%20*%20%5BCustomize%20404%20Response%5D(%23customize-404-response)","meta":{"info":{"title":"Exception Handling"}},"content":"%0A%0A%0A%23%23%20Exception%20Capture%0A%0ATaking%20benefits%20from%20framework%20asynchronous%20support%2C%20all%20exceptions%20can%20be%20caught%20by%20%60try%20catch%60.%0A%0AWith%20those%20features%2C%20you%20can%20take%20following%20implementation%20as%20reference%3A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fservice%2Ftest.js%0Atry%20%7B%0A%20%20const%20res%20%3D%20await%20this.ctx.curl('http%3A%2F%2Feggjs.com%2Fapi%2Fecho'%2C%20%7B%20dataType%3A%20'json'%20%7D)%3B%0A%20%20if%20(res.status%20!%3D%3D%20200)%20throw%20new%20Error('response%20status%20is%20not%20200')%3B%0A%20%20return%20res.data%3B%0A%7D%20catch%20(err)%20%7B%0A%20%20this.logger.error(err)%3B%0A%20%20return%20%7B%7D%3B%0A%7D%0A%60%60%60%0A%0AGenerally%2C%20you%20can%20use%20%60try%20catch%60%20to%20catch%20exceptions.%20However%2C%20some%20implementations%20may%20break%20this%20mechanism%20down.%20Imaging%20that%20%60await%60%20makes%20generators%20run%20in%20order%20just%20like%20a%20chain.%20What%20will%20happen%20if%20one%20of%20them%20jumpoff%20the%20chain%3F%20The%20following%20code%20can%20help%20you%20realize%20the%20imagination%3A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fcontroller%2Fhome.js%0Aclass%20HomeController%20extends%20Controller%20%7B%0A%20%20async%20buy%20()%20%7B%0A%20%20%20%20const%20request%20%3D%20%7B%7D%3B%0A%20%20%20%20const%20config%20%3D%20await%20ctx.service.trade.buy(request)%3B%0A%20%20%20%20%2F%2F%20checking%20the%20deal%20and%20don't%20block%20current%20request%0A%20%20%20%20setImmediate(()%20%3D%3E%20%7B%0A%20%20%20%20%20%20ctx.service.trade.check(request).catch(err%20%3D%3E%20ctx.logger.error(err))%3B%0A%20%20%20%20%7D)%3B%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0AIn%20this%20case%2C%20you%20may%20find%20that%20the%20exceptions%20in%20%60setImmediate%60%20will%20be%20swallowed%20because%20the%20scope%20breaks%20the%20chain%2C%20although%20egg%20already%20handled%20exceptions%20externally.%0A%0AAbove%20scene%20is%20also%20considered.%20To%20catch%20the%20exception%20inside%20the%20scope%2C%20You%20can%20invoke%20helper%20method%20%60ctx.runInBackground(scope)%60%20to%20wrap%20the%20chain%20back.%20Now%2C%20the%20exceptions%20will%20be%20detected%20and%20caught.%0A%0A%60%60%60js%0Aclass%20HomeController%20extends%20Controller%20%7B%0A%20%20async%20buy%20()%20%7B%0A%20%20%20%20const%20request%20%3D%20%7B%7D%3B%0A%20%20%20%20const%20config%20%3D%20await%20ctx.service.trade.buy(request)%3B%0A%20%20%20%20%2F%2F%20checking%20the%20deal%20and%20don't%20block%20current%20request%0A%20%20%20%20ctx.runInBackground(async%20()%20%3D%3E%20%7B%0A%20%20%20%20%20%20%2F%2F%20Exceptions%20thrown%20here%20will%20be%20caught%20in%20background%20and%20printed%20into%20log.%0A%20%20%20%20%20%20await%20ctx.service.trade.check(request)%3B%0A%20%20%20%20%7D)%3B%0A%20%20%7D%0A%7D%0A%60%60%60%0A%0AFor%20convenience%20of%20locating%20problems%2C%20exceptions%20must%20be%20guaranteed%20to%20be%20Error%20object%20or%20object%20based%20on%20Error%20object%2C%20which%20offers%20a%20trace%20of%20which%20functions%20were%20called.%0A%0A%23%23%20Egg%20takes%20charge%20of%20exceptions%0A%0A%5Begg-onerror%5D(https%3A%2F%2Fgithub.com%2Feggjs%2Fegg-onerror)%2C%20one%20of%20Egg's%20plugin%2C%20handles%20all%20exceptions%20thrown%20in%20Middleware%2C%20Controller%20and%20Service%2C%20and%20returns%20the%20error%20as%20response%20based%20on%20%22Accept%22%20in%20request%20header%20field.%0A%0A%7C%20Accept%20%7C%20ENV%20%7C%20errorPageUrl%20%7C%20response%20%7C%0A%7C-------------%7C------%7C----------------------%7C--------%7C%0A%7C%20HTML%20%26%20TEXT%20%7C%20local%20%26%20unittest%20%7C%20-%20%7C%20onerror%20built-in%20error%20page%20%7C%0A%7C%20HTML%20%26%20TEXT%20%7C%20others%20%7C%20YES%20%7C%20redirect%20to%20errorPageUrl%20%7C%0A%7C%20HTML%20%26%20TEXT%20%7C%20others%20%7C%20NO%20%7C%20onerror%20built-in%20error%20page(simple%2C%20not%20recommended)%20%7C%0A%7C%20JSON%20%26%20JSONP%20%7C%20local%20%26%20unittest%20%7C%20-%20%7C%20JSON%20Object%20or%20JSONP%20response%20body%20with%20details%20%7C%0A%7C%20JSON%20%26%20JSONP%7C%20others%20%7C%20-%20%7C%20JSON%20object%20%20or%20JSONP%20response%20body%20without%20details%20%7C%0A%0A%23%23%23%20errorPageUrl%0A%0ARedirecting%20to%20your%20customized%20error%20page%20by%20setting%20%60errorPageUrl%60%20in%20%60onerror%60%20plugin.%0A%0A%60onerror%60%20config%20in%20%60config%2Fconfig.default.js%60%3A%0A%0A%60%60%60js%0Amodule.exports%20%3D%20%7B%0A%20%20onerror%3A%20%7B%0A%20%20%20%20errorPageUrl%3A%20'%2F50x.html'%2C%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%23%23%20Create%20your%20universal%20exception%20handler%0A%0AOnce%20the%20default%20handler%20no%20longer%20meet%20your%20needs%2C%20you%20still%20can%20customize%20your%20owner%20error%20handler%20by%20onerror's%20configurations.%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0Amodule.exports%20%3D%20%7B%0A%20%20onerror%3A%20%7B%0A%20%20%20%20all(err%2C%20ctx)%20%7B%0A%20%20%20%20%20%20%2F%2F%20Define%20an%20error%20handler%20for%20all%20type%20of%20Response.%0A%20%20%20%20%20%20%2F%2F%20Once%20config.all%20present%2C%20other%20type%20of%20error%20handers%20will%20be%20ignored.%0A%20%20%20%20%20%20ctx.body%20%3D%20'error'%3B%0A%20%20%20%20%20%20ctx.status%20%3D%20500%3B%0A%20%20%20%20%7D%2C%0A%20%20%20%20html(err%2C%20ctx)%20%7B%0A%20%20%20%20%20%20%2F%2F%20html%20hander%0A%20%20%20%20%20%20ctx.body%20%3D%20'%3Ch3%3Eerror%3C%2Fh3%3E'%3B%0A%20%20%20%20%20%20ctx.status%20%3D%20500%3B%0A%20%20%20%20%7D%2C%0A%20%20%20%20json(err%2C%20ctx)%20%7B%0A%20%20%20%20%20%20%2F%2F%20json%20hander%0A%20%20%20%20%20%20ctx.body%20%3D%20%7B%20message%3A%20'error'%20%7D%3B%0A%20%20%20%20%20%20ctx.status%20%3D%20500%3B%0A%20%20%20%20%7D%2C%0A%20%20%20%20jsonp(err%2C%20ctx)%20%7B%0A%20%20%20%20%20%20%2F%2F%20Generally%2C%20we%20don't%20need%20to%20customize%20jsonp%20error%20handler.%0A%20%20%20%20%20%20%2F%2F%20It%20will%20call%20json%20error%20handler%20and%20wrap%20to%20jsonp%20type%20response.%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%23%23%20404%0A%0AEgg%20won't%20take%20%60NOT%20FOUND%60%20from%20back-end%20as%20exception.%20Instead%2C%20if%20%60NOT%20FOUND%60%20is%20emitted%20without%20a%20body%2C%20it%20will%20return%20the%20following%20JSON%20object%20as%20default%20response.%0A%0Aidentified%20as%20JSON%3A%0A%0A%60%60%60js%0A%7B%0A%20%20%22message%22%3A%20%22Not%20Found%22%0A%7D%0A%60%60%60%0A%0Aidentified%20as%20HTML%3A%0A%0A%60%60%60html%0A%3Ch1%3E404%20Not%20Found%3C%2Fh1%3E%0A%60%60%60%0A%0AOverriding%20default%20404%20page%20to%20the%20one%20you%20want%3A%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0Amodule.exports%20%3D%20%7B%0A%20%20notfound%3A%20%7B%0A%20%20%20%20pageUrl%3A%20'%2F404.html'%2C%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%23%23%23%20Customize%20404%20Response%0A%0AIf%20you%20want%20a%20customized%20404%20response%2C%20you%20only%20need%20to%20create%20a%20middleware%20to%20handle%20it%20once%2C%20just%20like%20handling%20exceptions%20above.%0A%0A%60%60%60js%0A%2F%2F%20app%2Fmiddleware%2Fnotfound_handler.js%0Amodule.exports%20%3D%20()%20%3D%3E%20%7B%0A%20%20return%20async%20function%20notFoundHandler(ctx%2C%20next)%20%7B%0A%20%20%20%20await%20next()%3B%0A%20%20%20%20if%20(ctx.status%20%3D%3D%3D%20404%20%26%26%20!ctx.body)%20%7B%0A%20%20%20%20%20%20if%20(ctx.acceptJSON)%20%7B%0A%20%20%20%20%20%20%20%20ctx.body%20%3D%20%7B%20error%3A%20'Not%20Found'%20%7D%3B%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20ctx.body%20%3D%20'%3Ch1%3EPage%20Not%20Found%3C%2Fh1%3E'%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%3B%0A%7D%3B%0A%60%60%60%0A%0AAdding%20yours%20to%20%60middleware%60%20in%20config%3A%0A%0A%60%60%60js%0A%2F%2F%20config%2Fconfig.default.js%0Amodule.exports%20%3D%20%7B%0A%20%20middleware%3A%20%5B%20'notfoundHandler'%20%5D%2C%0A%7D%3B%0A%60%60%60%0A"}}</script><script type="text/javascript" src="/static/js/post.b9faab88.js"></script></body></html>