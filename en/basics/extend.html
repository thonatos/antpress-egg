<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.png"><style class="_styletron_hydrate_"></style><title>Extend EGG</title><meta name="description" content="Born to build better enterprise frameworks and apps"><link href="/static/css/post.d62265dc.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="ant-layout" data-reactroot=""><div class="header-module__header___3ADJ9 ant-layout-header"><div class="ant-row-flex"><div class="ant-col-xs-12 ant-col-md-20 ant-col-lg-2"><div class="header-module__logo___3yTXp"><a href="/"><img src="/logo.svg" alt="logo"/></a></div></div><div class="ant-col-xs-0 ant-col-md-0 ant-col-lg-20"><ul class="ant-menu header-module__menu___3yEtW ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-item" role="menuitem"><a href="/en/intro/">Guide</a></li><li class="ant-menu-item" role="menuitem"><a href="/api/">API</a></li><li class="ant-menu-item" role="menuitem"><a href="/en/tutorials/index.html">Tutorials</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/search?q=topic%3Aegg-plugin&amp;type=Repositories">Plugins</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/eggjs/egg/releases">Release</a></li></ul></div><div style="text-align:right" class="ant-col-xs-12 ant-col-md-4 ant-col-lg-2"><button type="button" class="ant-btn"><span>切换语言</span></button></div></div></div><div class="ant-layout-content"><div class="basic_layout-module__content___3flpY ant-layout"><div class="sider-module__side___1Cadj ant-layout-sider ant-layout-sider-light" style="flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"><ul class="ant-menu sider-module__menu___2GqPr ant-menu-light ant-menu-root ant-menu-inline" role="menu"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="0$Menu" aria-haspopup="true"><span>Guide</span><i class="ant-menu-submenu-arrow"></i></div><ul id="0$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/index.html">What is Egg?</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/egg-and-koa.html">Egg and Koa</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/quickstart.html">Quick Start</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/progressive.html">Progressive</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/migration.html">Migration to 2.x</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="1$Menu" aria-haspopup="true"><span>Basis Function</span><i class="ant-menu-submenu-arrow"></i></div><ul id="1$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/structure.html">Directory Structure</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/objects.html">Built-in Objects</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/env.html">Environment</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/config.html">Configuration</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/middleware.html">Middleware</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/router.html">Router</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/controller.html">Controller</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/service.html">Service</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/plugin.html">Plugin</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/schedule.html">Schedule</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/extend.html">Extend</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/app-start.html">Custom Init</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="2$Menu" aria-haspopup="true"><span>Core</span><i class="ant-menu-submenu-arrow"></i></div><ul id="2$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/development.html">Development</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/unittest.html">Unit Testing</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/deployment.html">Deployment</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/logger.html">Logger</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/httpclient.html">HttpClient</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/cookie-and-session.html">Cookie and Session</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/cluster-and-ipc.html">Cluster and IPC</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/view.html">View</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/error-handling.html">Error Handling</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/security.html">Security</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/i18n.html">i18n</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="3$Menu" aria-haspopup="true"><span>Tutorials</span><i class="ant-menu-submenu-arrow"></i></div><ul id="3$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/mysql.html">MySQL</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/restful.html">RESTful API</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/passport.html">Passport</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/socketio.html">Socket.IO</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/assets.html">Assets</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/typescript.html">TypeScript</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="4$Menu" aria-haspopup="true"><span>Advanced</span><i class="ant-menu-submenu-arrow"></i></div><ul id="4$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/loader.html">Loader</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/plugin.html">Plugin Development</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/framework.html">Framework</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/cluster-client.html">Cluster Enhancement</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/view-plugin.html">View Plugin</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/style-guide.html">Style Guide</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="5$Menu" aria-haspopup="true"><span>Community</span><i class="ant-menu-submenu-arrow"></i></div><ul id="5$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/plugins/">Plugin List</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/contributing.html">Contributing</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/resource.html">Resource</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/faq.html">FAQ</a></li></ul></li></ul></div></div><div class="basic_layout-module__post___2Z7KK ant-layout-content"><div class="ant-row" style="margin-left:-8px;margin-right:-8px"><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-24 ant-col-md-18"><div class="markdown-body" style="font-size:14px"><div><p>Egg.js is extensible and it provides multiple extension points to enhance the functionality of itself:</p><ul><li>Application</li><li>Context</li><li>Request</li><li>Response</li><li>Helper</li></ul><p>We could use the extension APIs to help us to develop, or extend the objects given above to enhance the functionality of egg as well while programming.</p><h2 id="application">Application</h2><p>The object <code>app</code> is just the same aspect as the global application object in Koa. There should be only one <code>app</code> in your application, and it will be created by egg when the application is started.</p><h3 id="access-method">Access Method</h3><ul><li><code>ctx.app</code></li><li>You can access the Application object by using <code>this.app</code> in Controller, Middleware, Helper, Service. For instance, <code>this.app.config</code> will help you access the Config object.</li><li><p>The <code>app</code> object would be injected into the entry function as the first argument in <code>app.js</code>, like this: </p><pre><code class="language-js">// app.js
module.exports = app =&gt; {
  // here you can use the app object
};</code></pre></li></ul><h3 id="how-to-extend">How to extend</h3><p>Egg will merge the object defined in <code>app/extend/application.js</code> with the prototype of Application object in Koa, then generate object <code>app</code> which is based on the extended prototype when application is started.</p><h4 id="extend-methods">Extend Methods</h4><p>If we want to create a method <code>app.foo()</code>, we can do it like this: ：</p><pre><code class="language-js">// app/extend/application.js
module.exports = {
  foo(param) {
    // `this` points to the object app, you can access other methods or property of app with this
  },
};</code></pre><h4 id="extend-properties">Extend Properties</h4><p>Generally speaking, the calculation of properties only need to be done once, therefore we have to do some cache, otherwise it will degrade performance of the app as too much calculation would be going to do when accessing those properties several times.</p><p>So, it&#x27;s recommended to use Symbol + Getter.</p><p>For example, if we would like to add a Getter property <code>app.bar</code>:</p><pre><code class="language-js">// app/extend/application.js
const BAR = Symbol(&#x27;Application#bar&#x27;);

module.exports = {
  get bar() {
    // `this` points to the app object, you can access other methods or property of app with this
    if (!this[BAR]) {
      // It should be more complex in real situation
      this[BAR] = this.config.xx + this.config.yy;
    }
    return this[BAR];
  },
};</code></pre><h2 id="context">Context</h2><p>Context means the context in Koa, which is a  <strong>Request Level</strong> object. That is to say, every request from client will generate an Context instance. We usually write Context as <code>ctx</code> in short. In all the doc, both Context and <code>ctx</code> means the context object in Koa.</p><h3 id="access-method">Access Method</h3><ul><li><code>this</code> in middleware is ctx, such as <code>this.cookies.get(&#x27;foo&#x27;)</code>。</li><li>There are two different ways to write controller. If you use class to describe controller, you can use <code>this.ctx</code> to access Context. Or if you write as method, you can access Context with <code>ctx</code> directly.</li><li><code>this</code> in helper, service points to the helper object and service object themselves. Simply use <code>this.ctx</code> to access Context object, such as <code>this.ctx.cookies.get(&#x27;foo&#x27;)</code>.</li></ul><h3 id="how-to-extend">How to extend</h3><p>Egg will merge the object defined in <code>app/extend/context.js</code> with the prototype of Context object in Koa. And it will generate a <code>ctx</code> object which is based on the extended prototype when deal with request.</p><h4 id="extend-methods">Extend Methods</h4><p>For instance, we could add a method <code>ctx.foo()</code> in the following way:</p><pre><code class="language-js">// app/extend/context.js
module.exports = {
  foo(param) {
    // `this` points to the ctx object, you can access other methods or property of ctx 
  },
};</code></pre><h4 id="extend-properties">Extend Properties</h4><p>Generally speaking, the calculation of properties only need to do once, therefore we have to do some cache, otherwise it will degrade performance of the app as too much calculation would be going to do when access those properties several times.</p><p>So, it&#x27;s recommended to use Symbol + Getter.</p><p>For example, if we would like to add a Getter property <code>ctx.bar</code>:</p><pre><code class="language-js">// app/extend/context.js
const BAR = Symbol(&#x27;Context#bar&#x27;);

module.exports = {
  get bar() {
    // `this` points to the ctx object, you can access other methods or property of ctx
    if (!this[BAR]) {
      // For example, we can get from header, but it should be more complex in real situation.
      this[BAR] = this.get(&#x27;x-bar&#x27;);
    }
    return this[BAR];
  },
};</code></pre><h2 id="request">Request</h2><p>Request object is the same as that in Koa, which is a <strong>Request Level</strong> object. It provides a great number of methods to help to access the properties and methods you need.</p><h3 id="access-method">Access Method</h3><pre><code class="language-js">ctx.request</code></pre><p>So many properties and methods in <code>ctx</code> can also be accessed in <code>request</code> object. For those properties and methods, it is just the same to access them by using either <code>ctx</code> or <code>request</code>, such as <code>ctx.url === ctx.request.url</code>.</p><p>Here are the properties and methods in <code>ctx</code> which can also be accessed by Request aliases: <a href="http://koajs.com/#request-aliases">Koa - Request aliases</a></p><h3 id="how-to-extend">How to extend</h3><p>Egg will merge the object defined in <code>app/extend/request.js</code> and the prototype of <code>request</code> object built in egg. And it will generate a <code>request</code> object which is based on the extended prototype when deal with request.</p><p>For instance, we could add a property <code>request.foo</code> in the following way:</p><pre><code class="language-js">// app/extend/request.js
module.exports = {
  get foo() {
    return this.get(&#x27;x-request-foo&#x27;);
  },
};</code></pre><h2 id="response">Response</h2><p>Response object is the same as that in Koa, which is a <strong>Request Level</strong> object. It provides a great number of methods to help to access the properties and methods you need.</p><h3 id="access-method">Access Method</h3><pre><code class="language-js">ctx.response</code></pre><p>So many properties and methods in <code>ctx</code> can also be accessed in <code>response</code> object. For those properties and methods, it is just the same to access them by using either <code>ctx</code> or <code>response</code>. For example <code>ctx.status = 404</code> is the same as <code>ctx.response.status = 404</code>.</p><p>Here are the properties and methods in <code>ctx</code> which can also be accessed by Response aliases: <a href="http://koajs.com/#response-aliases">Koa Response aliases</a></p><h3 id="how-to-extend">How to extend</h3><p>Egg will merge the object defined in <code>app/extend/response.js</code> and the prototype of <code>response</code> object build in egg. And it will generate a <code>response</code> object which is based on the extended prototype after dealt with request.</p><p>For instance, we could add a setter <code>request.foo</code> in the following way:</p><pre><code class="language-js">// app/extend/response.js
module.exports = {
  set foo(value) {
    this.set(&#x27;x-response-foo&#x27;, value);
  },
};</code></pre><p>Then we can use the setter like this: <code>this.response.foo = &#x27;bar&#x27;;</code></p><h2 id="helper">Helper</h2><p>Function Helper can provides some useful utility functions.</p><p>We can put some utility functions we use ofter into helper.js as an individual function. Then we can write the complex codes in JavaScript, avoiding to write them everywhere. Besides, such a simple function like Helper allows to write test case much easier.</p><p>Egg has had some build-in Helper functions. We can write our own Helper as well.</p><h3 id="access-method">Access Method</h3><p>Access helper object with <code>ctx.helper</code>, for example:</p><pre><code class="language-js">// Assume that home router has already defined in app/router.js
app.get(&#x27;home&#x27;, &#x27;/&#x27;, &#x27;home.index&#x27;);

// Use helper to calculate the specific url path
ctx.helper.pathFor(&#x27;home&#x27;, { by: &#x27;recent&#x27;, limit: 20 })
// =&gt; /?by=recent&amp;limit=20</code></pre><h3 id="how-to-extend">How to extend</h3><p>Egg will merge the object defined in <code>app/extend/helper.js</code> and the prototype of <code>helper</code> object build in egg. And it will generate a <code>helper</code> object which is based on the extended prototype after dealt with request.</p><p>For instance, we could add a method <code>helper.foo()</code> in the following way:</p><pre><code class="language-js">// app/extend/helper.js
module.exports = {
  foo(param) {
    // // `this` points to the helper object, you can access other methods or property of helper 
    // this.ctx =&gt; context object
    // this.app =&gt; application object
  },
};</code></pre><h2 id="extend-according-to-environment">Extend according to environment</h2><p>Besides, we can extend the framework in an optional way according to the environment. For example, if you want <code>mockXX()</code> only be able to accessed when doing unittest:</p><pre><code class="language-js">// app/extend/application.unittest.js
module.exports = {
  mockXX(k, v) {
  }
};</code></pre><p>This file will only be required under unittest environment.</p><p>Similarly, we could extend egg in this way for other object,such as Application, Context, Request, Response and Helper. See more on <a href="./env.md">environment</a></p></div></div></div><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-0 ant-col-md-6"><div class="markdown-body" style="font-size:14px"><div><ul><li><a href="#application">Application</a><ul><li><a href="#access-method">Access Method</a></li><li><a href="#how-to-extend">How to extend</a><ul><li><a href="#extend-methods">Extend Methods</a></li><li><a href="#extend-properties">Extend Properties</a></li></ul></li></ul></li><li><a href="#context">Context</a><ul><li><a href="#access-method">Access Method</a></li><li><a href="#how-to-extend">How to extend</a><ul><li><a href="#extend-methods">Extend Methods</a></li><li><a href="#extend-properties">Extend Properties</a></li></ul></li></ul></li><li><a href="#request">Request</a><ul><li><a href="#access-method">Access Method</a></li><li><a href="#how-to-extend">How to extend</a></li></ul></li><li><a href="#response">Response</a><ul><li><a href="#access-method">Access Method</a></li><li><a href="#how-to-extend">How to extend</a></li></ul></li><li><a href="#helper">Helper</a><ul><li><a href="#access-method">Access Method</a></li><li><a href="#how-to-extend">How to extend</a></li></ul></li><li><a href="#extend-according-to-environment">Extend according to environment</a></li></ul></div></div></div></div></div></div></div></div></div><script type="text/javascript">window.__INIT_STATE__={"lang":"en","props":{"toc":"-%20%5BApplication%5D(%23application)%0A%20%20*%20%5BAccess%20Method%5D(%23access-method)%0A%20%20*%20%5BHow%20to%20extend%5D(%23how-to-extend)%0A%20%20%20%20%2B%20%5BExtend%20Methods%5D(%23extend-methods)%0A%20%20%20%20%2B%20%5BExtend%20Properties%5D(%23extend-properties)%0A-%20%5BContext%5D(%23context)%0A%20%20*%20%5BAccess%20Method%5D(%23access-method)%0A%20%20*%20%5BHow%20to%20extend%5D(%23how-to-extend)%0A%20%20%20%20%2B%20%5BExtend%20Methods%5D(%23extend-methods)%0A%20%20%20%20%2B%20%5BExtend%20Properties%5D(%23extend-properties)%0A-%20%5BRequest%5D(%23request)%0A%20%20*%20%5BAccess%20Method%5D(%23access-method)%0A%20%20*%20%5BHow%20to%20extend%5D(%23how-to-extend)%0A-%20%5BResponse%5D(%23response)%0A%20%20*%20%5BAccess%20Method%5D(%23access-method)%0A%20%20*%20%5BHow%20to%20extend%5D(%23how-to-extend)%0A-%20%5BHelper%5D(%23helper)%0A%20%20*%20%5BAccess%20Method%5D(%23access-method)%0A%20%20*%20%5BHow%20to%20extend%5D(%23how-to-extend)%0A-%20%5BExtend%20according%20to%20environment%5D(%23extend-according-to-environment)","meta":{"info":{"title":"Extend EGG"}},"content":"%0A%0A%0AEgg.js%20is%20extensible%20and%20it%20provides%20multiple%20extension%20points%20to%20enhance%20the%20functionality%20of%20itself%3A%0A%0A-%20Application%0A-%20Context%0A-%20Request%0A-%20Response%0A-%20Helper%0A%0AWe%20could%20use%20the%20extension%20APIs%20to%20help%20us%20to%20develop%2C%20or%20extend%20the%20objects%20given%20above%20to%20enhance%20the%20functionality%20of%20egg%20as%20well%20while%20programming.%0A%0A%23%23%20Application%0A%0AThe%20object%20%60app%60%20is%20just%20the%20same%20aspect%20as%20the%20global%20application%20object%20in%20Koa.%20There%20should%20be%20only%20one%20%60app%60%20in%20your%20application%2C%20and%20it%20will%20be%20created%20by%20egg%20when%20the%20application%20is%20started.%0A%0A%23%23%23%20Access%20Method%0A%0A-%20%60ctx.app%60%0A-%20You%20can%20access%20the%20Application%20object%20by%20using%20%60this.app%60%20in%20Controller%2C%20Middleware%2C%20Helper%2C%20Service.%20For%20instance%2C%20%60this.app.config%60%20will%20help%20you%20access%20the%20Config%20object.%0A-%20The%20%60app%60%20object%20would%20be%20injected%20into%20the%20entry%20function%20as%20the%20first%20argument%20in%20%60app.js%60%2C%20like%20this%3A%20%0A%0A%20%20%20%60%60%60js%0A%20%20%20%2F%2F%20app.js%0A%20%20%20module.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20%20%20%20%2F%2F%20here%20you%20can%20use%20the%20app%20object%0A%20%20%20%7D%3B%0A%20%20%20%60%60%60%0A%0A%23%23%23%20How%20to%20extend%20%0A%0AEgg%20will%20merge%20the%20object%20defined%20in%20%60app%2Fextend%2Fapplication.js%60%20with%20the%20prototype%20of%20Application%20object%20in%20Koa%2C%20then%20generate%20object%20%60app%60%20which%20is%20based%20on%20the%20extended%20prototype%20when%20application%20is%20started.%0A%0A%23%23%23%23%20Extend%20Methods%0A%0AIf%20we%20want%20to%20create%20a%20method%20%60app.foo()%60%2C%20we%20can%20do%20it%20like%20this%3A%20%EF%BC%9A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fextend%2Fapplication.js%0Amodule.exports%20%3D%20%7B%0A%20%20foo(param)%20%7B%0A%20%20%20%20%2F%2F%20%60this%60%20points%20to%20the%20object%20app%2C%20you%20can%20access%20other%20methods%20or%20property%20of%20app%20with%20this%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%23%23%23%23%20Extend%20Properties%0A%0AGenerally%20speaking%2C%20the%20calculation%20of%20properties%20only%20need%20to%20be%20done%20once%2C%20therefore%20we%20have%20to%20do%20some%20cache%2C%20otherwise%20it%20will%20degrade%20performance%20of%20the%20app%20as%20too%20much%20calculation%20would%20be%20going%20to%20do%20when%20accessing%20those%20properties%20several%20times.%0A%0ASo%2C%20it's%20recommended%20to%20use%20Symbol%20%2B%20Getter.%0A%0AFor%20example%2C%20if%20we%20would%20like%20to%20add%20a%20Getter%20property%20%60app.bar%60%3A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fextend%2Fapplication.js%0Aconst%20BAR%20%3D%20Symbol('Application%23bar')%3B%0A%0Amodule.exports%20%3D%20%7B%0A%20%20get%20bar()%20%7B%0A%20%20%20%20%2F%2F%20%60this%60%20points%20to%20the%20app%20object%2C%20you%20can%20access%20other%20methods%20or%20property%20of%20app%20with%20this%0A%20%20%20%20if%20(!this%5BBAR%5D)%20%7B%0A%20%20%20%20%20%20%2F%2F%20It%20should%20be%20more%20complex%20in%20real%20situation%0A%20%20%20%20%20%20this%5BBAR%5D%20%3D%20this.config.xx%20%2B%20this.config.yy%3B%0A%20%20%20%20%7D%0A%20%20%20%20return%20this%5BBAR%5D%3B%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%23%23%20Context%0A%0AContext%20means%20the%20context%20in%20Koa%2C%20which%20is%20a%20%20**Request%20Level**%20object.%20That%20is%20to%20say%2C%20every%20request%20from%20client%20will%20generate%20an%20Context%20instance.%20We%20usually%20write%20Context%20as%20%60ctx%60%20in%20short.%20In%20all%20the%20doc%2C%20both%20Context%20and%20%60ctx%60%20means%20the%20context%20object%20in%20Koa.%0A%0A%23%23%23%20Access%20Method%0A%0A-%20%60this%60%20in%20middleware%20is%20ctx%2C%20such%20as%20%60this.cookies.get('foo')%60%E3%80%82%0A-%20There%20are%20two%20different%20ways%20to%20write%20controller.%20If%20you%20use%20class%20to%20describe%20controller%2C%20you%20can%20use%20%60this.ctx%60%20to%20access%20Context.%20Or%20if%20you%20write%20as%20method%2C%20you%20can%20access%20Context%20with%20%60ctx%60%20directly.%0A-%20%60this%60%20in%20helper%2C%20service%20points%20to%20the%20helper%20object%20and%20service%20object%20themselves.%20Simply%20use%20%60this.ctx%60%20to%20access%20Context%20object%2C%20such%20as%20%60this.ctx.cookies.get('foo')%60.%0A%0A%23%23%23%20How%20to%20extend%0A%0AEgg%20will%20merge%20the%20object%20defined%20in%20%60app%2Fextend%2Fcontext.js%60%20with%20the%20prototype%20of%20Context%20object%20in%20Koa.%20And%20it%20will%20generate%20a%20%60ctx%60%20object%20which%20is%20based%20on%20the%20extended%20prototype%20when%20deal%20with%20request.%0A%0A%23%23%23%23%20Extend%20Methods%0A%0AFor%20instance%2C%20we%20could%20add%20a%20method%20%60ctx.foo()%60%20in%20the%20following%20way%3A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fextend%2Fcontext.js%0Amodule.exports%20%3D%20%7B%0A%20%20foo(param)%20%7B%0A%20%20%20%20%2F%2F%20%60this%60%20points%20to%20the%20ctx%20object%2C%20you%20can%20access%20other%20methods%20or%20property%20of%20ctx%20%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%23%23%23%23%20Extend%20Properties%0A%0AGenerally%20speaking%2C%20the%20calculation%20of%20properties%20only%20need%20to%20do%20once%2C%20therefore%20we%20have%20to%20do%20some%20cache%2C%20otherwise%20it%20will%20degrade%20performance%20of%20the%20app%20as%20too%20much%20calculation%20would%20be%20going%20to%20do%20when%20access%20those%20properties%20several%20times.%0A%0ASo%2C%20it's%20recommended%20to%20use%20Symbol%20%2B%20Getter.%0A%0AFor%20example%2C%20if%20we%20would%20like%20to%20add%20a%20Getter%20property%20%60ctx.bar%60%3A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fextend%2Fcontext.js%0Aconst%20BAR%20%3D%20Symbol('Context%23bar')%3B%0A%0Amodule.exports%20%3D%20%7B%0A%20%20get%20bar()%20%7B%0A%20%20%20%20%2F%2F%20%60this%60%20points%20to%20the%20ctx%20object%2C%20you%20can%20access%20other%20methods%20or%20property%20of%20ctx%0A%20%20%20%20if%20(!this%5BBAR%5D)%20%7B%0A%20%20%20%20%20%20%2F%2F%20For%20example%2C%20we%20can%20get%20from%20header%2C%20but%20it%20should%20be%20more%20complex%20in%20real%20situation.%0A%20%20%20%20%20%20this%5BBAR%5D%20%3D%20this.get('x-bar')%3B%0A%20%20%20%20%7D%0A%20%20%20%20return%20this%5BBAR%5D%3B%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%23%23%20Request%0A%0ARequest%20object%20is%20the%20same%20as%20that%20in%20Koa%2C%20which%20is%20a%20**Request%20Level**%20object.%20It%20provides%20a%20great%20number%20of%20methods%20to%20help%20to%20access%20the%20properties%20and%20methods%20you%20need.%0A%0A%23%23%23%20Access%20Method%0A%0A%60%60%60js%0Actx.request%0A%60%60%60%0A%0ASo%20many%20properties%20and%20methods%20in%20%60ctx%60%20can%20also%20be%20accessed%20in%20%60request%60%20object.%20For%20those%20properties%20and%20methods%2C%20it%20is%20just%20the%20same%20to%20access%20them%20by%20using%20either%20%60ctx%60%20or%20%60request%60%2C%20such%20as%20%60ctx.url%20%3D%3D%3D%20ctx.request.url%60.%0A%0AHere%20are%20the%20properties%20and%20methods%20in%20%60ctx%60%20which%20can%20also%20be%20accessed%20by%20Request%20aliases%3A%20%5BKoa%20-%20Request%20aliases%5D(http%3A%2F%2Fkoajs.com%2F%23request-aliases)%0A%0A%23%23%23%20How%20to%20extend%0A%0AEgg%20will%20merge%20the%20object%20defined%20in%20%60app%2Fextend%2Frequest.js%60%20and%20the%20prototype%20of%20%60request%60%20object%20built%20in%20egg.%20And%20it%20will%20generate%20a%20%60request%60%20object%20which%20is%20based%20on%20the%20extended%20prototype%20when%20deal%20with%20request.%0A%0AFor%20instance%2C%20we%20could%20add%20a%20property%20%60request.foo%60%20in%20the%20following%20way%3A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fextend%2Frequest.js%0Amodule.exports%20%3D%20%7B%0A%20%20get%20foo()%20%7B%0A%20%20%20%20return%20this.get('x-request-foo')%3B%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%23%23%20Response%0A%0AResponse%20object%20is%20the%20same%20as%20that%20in%20Koa%2C%20which%20is%20a%20**Request%20Level**%20object.%20It%20provides%20a%20great%20number%20of%20methods%20to%20help%20to%20access%20the%20properties%20and%20methods%20you%20need.%0A%0A%23%23%23%20Access%20Method%0A%0A%60%60%60js%0Actx.response%0A%60%60%60%0A%0ASo%20many%20properties%20and%20methods%20in%20%60ctx%60%20can%20also%20be%20accessed%20in%20%60response%60%20object.%20For%20those%20properties%20and%20methods%2C%20it%20is%20just%20the%20same%20to%20access%20them%20by%20using%20either%20%60ctx%60%20or%20%60response%60.%20For%20example%20%60ctx.status%20%3D%20404%60%20is%20the%20same%20as%20%60ctx.response.status%20%3D%20404%60.%0A%0AHere%20are%20the%20properties%20and%20methods%20in%20%60ctx%60%20which%20can%20also%20be%20accessed%20by%20Response%20aliases%3A%20%5BKoa%20Response%20aliases%5D(http%3A%2F%2Fkoajs.com%2F%23response-aliases)%0A%0A%23%23%23%20How%20to%20extend%0A%0AEgg%20will%20merge%20the%20object%20defined%20in%20%60app%2Fextend%2Fresponse.js%60%20and%20the%20prototype%20of%20%60response%60%20object%20build%20in%20egg.%20And%20it%20will%20generate%20a%20%60response%60%20object%20which%20is%20based%20on%20the%20extended%20prototype%20after%20dealt%20with%20request.%0A%0AFor%20instance%2C%20we%20could%20add%20a%20setter%20%60request.foo%60%20in%20the%20following%20way%3A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fextend%2Fresponse.js%0Amodule.exports%20%3D%20%7B%0A%20%20set%20foo(value)%20%7B%0A%20%20%20%20this.set('x-response-foo'%2C%20value)%3B%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0AThen%20we%20can%20use%20the%20setter%20like%20this%3A%20%60this.response.foo%20%3D%20'bar'%3B%60%0A%0A%23%23%20Helper%0A%0AFunction%20Helper%20can%20provides%20some%20useful%20utility%20functions.%0A%0AWe%20can%20put%20some%20utility%20functions%20we%20use%20ofter%20into%20helper.js%20as%20an%20individual%20function.%20Then%20we%20can%20write%20the%20complex%20codes%20in%20JavaScript%2C%20avoiding%20to%20write%20them%20everywhere.%20Besides%2C%20such%20a%20simple%20function%20like%20Helper%20allows%20to%20write%20test%20case%20much%20easier.%0A%0AEgg%20has%20had%20some%20build-in%20Helper%20functions.%20We%20can%20write%20our%20own%20Helper%20as%20well.%0A%0A%23%23%23%20Access%20Method%0A%0AAccess%20helper%20object%20with%20%60ctx.helper%60%2C%20for%20example%3A%0A%0A%60%60%60js%0A%2F%2F%20Assume%20that%20home%20router%20has%20already%20defined%20in%20app%2Frouter.js%0Aapp.get('home'%2C%20'%2F'%2C%20'home.index')%3B%0A%0A%2F%2F%20Use%20helper%20to%20calculate%20the%20specific%20url%20path%0Actx.helper.pathFor('home'%2C%20%7B%20by%3A%20'recent'%2C%20limit%3A%2020%20%7D)%0A%2F%2F%20%3D%3E%20%2F%3Fby%3Drecent%26limit%3D20%0A%60%60%60%0A%0A%23%23%23%20How%20to%20extend%0A%0AEgg%20will%20merge%20the%20object%20defined%20in%20%60app%2Fextend%2Fhelper.js%60%20and%20the%20prototype%20of%20%60helper%60%20object%20build%20in%20egg.%20And%20it%20will%20generate%20a%20%60helper%60%20object%20which%20is%20based%20on%20the%20extended%20prototype%20after%20dealt%20with%20request.%0A%0AFor%20instance%2C%20we%20could%20add%20a%20method%20%60helper.foo()%60%20in%20the%20following%20way%3A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fextend%2Fhelper.js%0Amodule.exports%20%3D%20%7B%0A%20%20foo(param)%20%7B%0A%20%20%20%20%2F%2F%20%2F%2F%20%60this%60%20points%20to%20the%20helper%20object%2C%20you%20can%20access%20other%20methods%20or%20property%20of%20helper%20%0A%20%20%20%20%2F%2F%20this.ctx%20%3D%3E%20context%20object%0A%20%20%20%20%2F%2F%20this.app%20%3D%3E%20application%20object%0A%20%20%7D%2C%0A%7D%3B%0A%60%60%60%0A%0A%0A%23%23%20Extend%20according%20to%20environment%0A%0ABesides%2C%20we%20can%20extend%20the%20framework%20in%20an%20optional%20way%20according%20to%20the%20environment.%20For%20example%2C%20if%20you%20want%20%60mockXX()%60%20only%20be%20able%20to%20accessed%20when%20doing%20unittest%3A%0A%0A%60%60%60js%0A%2F%2F%20app%2Fextend%2Fapplication.unittest.js%0Amodule.exports%20%3D%20%7B%0A%20%20mockXX(k%2C%20v)%20%7B%0A%20%20%7D%0A%7D%3B%0A%60%60%60%0A%0AThis%20file%20will%20only%20be%20required%20under%20unittest%20environment.%0A%0ASimilarly%2C%20we%20could%20extend%20egg%20in%20this%20way%20for%20other%20object%2Csuch%20as%20Application%2C%20Context%2C%20Request%2C%20Response%20and%20Helper.%20See%20more%20on%20%5Benvironment%5D(.%2Fenv.md)%0A"}}</script><script type="text/javascript" src="/static/js/post.b9faab88.js"></script></body></html>