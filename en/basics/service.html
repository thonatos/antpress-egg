<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.png"><style class="_styletron_hydrate_"></style><title>Service</title><meta name="description" content="Born to build better enterprise frameworks and apps"><link href="/static/css/post.d62265dc.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="ant-layout" data-reactroot=""><div class="header-module__header___3ADJ9 ant-layout-header"><div class="ant-row-flex"><div class="ant-col-xs-12 ant-col-md-20 ant-col-lg-2"><div class="header-module__logo___3yTXp"><a href="/"><img src="/logo.svg" alt="logo"/></a></div></div><div class="ant-col-xs-0 ant-col-md-0 ant-col-lg-20"><ul class="ant-menu header-module__menu___3yEtW ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-item" role="menuitem"><a href="/en/intro/">Guide</a></li><li class="ant-menu-item" role="menuitem"><a href="/api/">API</a></li><li class="ant-menu-item" role="menuitem"><a href="/en/tutorials/index.html">Tutorials</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/search?q=topic%3Aegg-plugin&amp;type=Repositories">Plugins</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/eggjs/egg/releases">Release</a></li></ul></div><div style="text-align:right" class="ant-col-xs-12 ant-col-md-4 ant-col-lg-2"><button type="button" class="ant-btn"><span>切换语言</span></button></div></div></div><div class="ant-layout-content"><div class="basic_layout-module__content___3flpY ant-layout"><div class="sider-module__side___1Cadj ant-layout-sider ant-layout-sider-light" style="flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"><ul class="ant-menu sider-module__menu___2GqPr ant-menu-light ant-menu-root ant-menu-inline" role="menu"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="0$Menu" aria-haspopup="true"><span>Guide</span><i class="ant-menu-submenu-arrow"></i></div><ul id="0$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/index.html">What is Egg?</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/egg-and-koa.html">Egg and Koa</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/quickstart.html">Quick Start</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/progressive.html">Progressive</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/migration.html">Migration to 2.x</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="1$Menu" aria-haspopup="true"><span>Basis Function</span><i class="ant-menu-submenu-arrow"></i></div><ul id="1$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/structure.html">Directory Structure</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/objects.html">Built-in Objects</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/env.html">Environment</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/config.html">Configuration</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/middleware.html">Middleware</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/router.html">Router</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/controller.html">Controller</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/service.html">Service</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/plugin.html">Plugin</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/schedule.html">Schedule</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/extend.html">Extend</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/app-start.html">Custom Init</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="2$Menu" aria-haspopup="true"><span>Core</span><i class="ant-menu-submenu-arrow"></i></div><ul id="2$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/development.html">Development</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/unittest.html">Unit Testing</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/deployment.html">Deployment</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/logger.html">Logger</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/httpclient.html">HttpClient</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/cookie-and-session.html">Cookie and Session</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/cluster-and-ipc.html">Cluster and IPC</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/view.html">View</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/error-handling.html">Error Handling</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/security.html">Security</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/i18n.html">i18n</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="3$Menu" aria-haspopup="true"><span>Tutorials</span><i class="ant-menu-submenu-arrow"></i></div><ul id="3$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/mysql.html">MySQL</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/restful.html">RESTful API</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/passport.html">Passport</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/socketio.html">Socket.IO</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/assets.html">Assets</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/typescript.html">TypeScript</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="4$Menu" aria-haspopup="true"><span>Advanced</span><i class="ant-menu-submenu-arrow"></i></div><ul id="4$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/loader.html">Loader</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/plugin.html">Plugin Development</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/framework.html">Framework</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/cluster-client.html">Cluster Enhancement</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/view-plugin.html">View Plugin</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/style-guide.html">Style Guide</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="5$Menu" aria-haspopup="true"><span>Community</span><i class="ant-menu-submenu-arrow"></i></div><ul id="5$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/plugins/">Plugin List</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/contributing.html">Contributing</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/resource.html">Resource</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/faq.html">FAQ</a></li></ul></li></ul></div></div><div class="basic_layout-module__post___2Z7KK ant-layout-content"><div class="ant-row" style="margin-left:-8px;margin-right:-8px"><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-24 ant-col-md-18"><div class="markdown-body" style="font-size:14px"><div><p>Simply speaking, Service is an abstract layer which is used to encapsulate business logics in complex business circumstances, and this abstraction offers advantages as below:</p><ul><li>keep logics in Controller cleaner.</li><li>keep business logics independent, since the abstracted Service can be called by many Controllers repeatedly.</li><li>separate logics and representations, and make it easier to write test cases. Write test cases in detail referring to <a href="../core/unittest.md">here</a>.</li></ul><h2 id="usage-scenario">Usage Scenario</h2><ul><li>Processing complex data, e.g. information to be shown need to be got from databases, and should be processed in specific rules before it can be sent and seen by the user. Or when the process is done, the database should be updated.</li><li>Calling third party services, e.g. getting Github information etc.</li></ul><h2 id="defining-service">Defining Service</h2><pre><code class="language-js">// app/service/user.js
const Service = require(&#x27;egg&#x27;).Service;

class UserService extends Service {
  async find(uid) {
    const user = await this.ctx.db.query(&#x27;select * from user where uid = ?&#x27;, uid);
    return user;
  }
}

module.exports = UserService;</code></pre><h3 id="properties">Properties</h3><p>Framework will initialize a new Service instance for every request accessing the server, and, for the example above, several attributes are attached to <code>this</code> since the Service class inherits <code>egg.Service</code>.</p><ul><li><code>this.ctx</code>: the instance of <a href="./extend.md#context">Context</a> for current request, through which we can access many attributes and methods, encapsulated by the framework, of current request conveniently.</li><li><code>this.app</code>: the instance of <a href="./extend.md#application">Application</a> for current request, through which we can access global objects and methods provided by the framework.</li><li><code>this.service</code>: <a href="./service.md">Service</a> defined by the application, through which we can access the abstract business layer, equivalent to <code>this.ctx.service</code>.</li><li><code>this.config</code>: the application&#x27;s run-time <a href="./config.md">config</a>.</li><li><code>this.logger</code>：logger with <code>debug</code>，<code>info</code>，<code>warn</code>，<code>error</code>, use to print different level logs, almost the same as <a href="../core/logger.md#context-logger">context logger</a>, but it will append Service file path for quickly track.</li></ul><h3 id="service-ctx-in-detail">Service ctx in Detail</h3><p>To get the path chain of user request, the request context is injected by us during the Service initialization, so you are able to get the related information of context directly by <code>this.ctx</code> in methods. For detailed information about context, please refer to <a href="./extend.md#context">Context</a>.
With <code>ctx</code>, we can get various convenient attributes and methods encapsulated by the framework. For example we can use:</p><ul><li><code>this.ctx.curl</code> to make network calls.</li><li><code>this.ctx.service.otherService</code> to call other Services.</li><li><code>this.ctx.db</code> to make database calls etc, where db may be a module mounted by other plugins in advance.</li></ul><h3 id="notes">Notes</h3><ul><li>Service files must be put under the <code>app/service</code> directory, and multi-level directory is supported, which can be accessed by cascading directory names.</li></ul><pre><code class="language-js">app/service/biz/user.js =&gt; ctx.service.biz.user
app/service/sync_user.js =&gt; ctx.service.syncUser
app/service/HackerNews.js =&gt; ctx.service.hackerNews</code></pre><ul><li>one Service file can only define one Class, which should be returned by <code>module.exports</code>.</li><li>Service should be defined in the Class way, and the parent class must be <code>egg.Service</code>.</li><li>Service is not a singleton but a <strong>request level</strong> object, the framework lazy-initializes it when the request <code>ctx.service.xx</code> for the first time, so the context of current request can be got from this.ctx in Service.</li></ul><h2 id="using-service">Using Service</h2><p>We begin to see how to use Service from a complete example below.</p><pre><code class="language-js">// app/router.js
module.exports = app =&gt; {
  app.router.get(&#x27;/user/:id&#x27;, app.controller.user.info);
};

// app/controller/user.js
const Controller = require(&#x27;egg&#x27;).Controller;
class UserController extends Controller {
  async info() {
    const userId = ctx.params.id;
    const userInfo = await ctx.service.user.find(userId);
    ctx.body = userInfo;
  }
}
module.exports = UserController;

// app/service/user.js
const Service = require(&#x27;egg&#x27;).Service;
class UserService extends Service {
  // the constructor is not a must by default
  // constructor(ctx) {
  //   super(ctx); if some processes should be made in the constructor, this statement is a must in order to use `this.ctx` later
  //   // get ctx through this.ctx directly
  //   // get app through this.app directly too
  // }
  async find(uid) {
    // suppose we&#x27;ve got user&#x27;s id and are going to get detailed user information from databases
    const user = await this.ctx.db.query(&#x27;select * from user where uid = ?&#x27;, uid);

    // suppose some complex processes should be made here, and demanded informations are returned then.
    const picture = await this.getPicture(uid);

    return {
      name: user.user_name,
      age: user.age,
      picture,
    };
  }

  async getPicture(uid) {
    const result = await this.ctx.curl(`http://photoserver/uid=${uid}`, { dataType: &#x27;json&#x27; });
    return result.data;
  }
}
module.exports = UserService;

// curl http://127.0.0.1:7001/user/1234</code></pre></div></div></div><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-0 ant-col-md-6"><div class="markdown-body" style="font-size:14px"><div><ul><li><a href="#usage-scenario">Usage Scenario</a></li><li><a href="#defining-service">Defining Service</a><ul><li><a href="#properties">Properties</a></li><li><a href="#service-ctx-in-detail">Service ctx in Detail</a></li><li><a href="#notes">Notes</a></li></ul></li><li><a href="#using-service">Using Service</a></li></ul></div></div></div></div></div></div></div></div></div><script type="text/javascript">window.__INIT_STATE__={"lang":"en","props":{"toc":"-%20%5BUsage%20Scenario%5D(%23usage-scenario)%0A-%20%5BDefining%20Service%5D(%23defining-service)%0A%20%20*%20%5BProperties%5D(%23properties)%0A%20%20*%20%5BService%20ctx%20in%20Detail%5D(%23service-ctx-in-detail)%0A%20%20*%20%5BNotes%5D(%23notes)%0A-%20%5BUsing%20Service%5D(%23using-service)","meta":{"info":{"title":"Service"}},"content":"%0A%0A%0ASimply%20speaking%2C%20Service%20is%20an%20abstract%20layer%20which%20is%20used%20to%20encapsulate%20business%20logics%20in%20complex%20business%20circumstances%2C%20and%20this%20abstraction%20offers%20advantages%20as%20below%3A%0A%0A-%20keep%20logics%20in%20Controller%20cleaner.%0A-%20keep%20business%20logics%20independent%2C%20since%20the%20abstracted%20Service%20can%20be%20called%20by%20many%20Controllers%20repeatedly.%0A-%20separate%20logics%20and%20representations%2C%20and%20make%20it%20easier%20to%20write%20test%20cases.%20Write%20test%20cases%20in%20detail%20referring%20to%20%5Bhere%5D(..%2Fcore%2Funittest.md).%0A%0A%23%23%20Usage%20Scenario%0A%0A-%20Processing%20complex%20data%2C%20e.g.%20information%20to%20be%20shown%20need%20to%20be%20got%20from%20databases%2C%20and%20should%20be%20processed%20in%20specific%20rules%20before%20it%20can%20be%20sent%20and%20seen%20by%20the%20user.%20Or%20when%20the%20process%20is%20done%2C%20the%20database%20should%20be%20updated.%0A-%20Calling%20third%20party%20services%2C%20e.g.%20getting%20Github%20information%20etc.%0A%0A%23%23%20Defining%20Service%0A%0A%60%60%60js%0A%2F%2F%20app%2Fservice%2Fuser.js%0Aconst%20Service%20%3D%20require('egg').Service%3B%0A%0Aclass%20UserService%20extends%20Service%20%7B%0A%20%20async%20find(uid)%20%7B%0A%20%20%20%20const%20user%20%3D%20await%20this.ctx.db.query('select%20*%20from%20user%20where%20uid%20%3D%20%3F'%2C%20uid)%3B%0A%20%20%20%20return%20user%3B%0A%20%20%7D%0A%7D%0A%0Amodule.exports%20%3D%20UserService%3B%0A%60%60%60%0A%0A%23%23%23%20Properties%0A%0AFramework%20will%20initialize%20a%20new%20Service%20instance%20for%20every%20request%20accessing%20the%20server%2C%20and%2C%20for%20the%20example%20above%2C%20several%20attributes%20are%20attached%20to%20%60this%60%20since%20the%20Service%20class%20inherits%20%60egg.Service%60.%0A%0A-%20%60this.ctx%60%3A%20the%20instance%20of%20%5BContext%5D(.%2Fextend.md%23context)%20for%20current%20request%2C%20through%20which%20we%20can%20access%20many%20attributes%20and%20methods%2C%20encapsulated%20by%20the%20framework%2C%20of%20current%20request%20conveniently.%0A-%20%60this.app%60%3A%20the%20instance%20of%20%5BApplication%5D(.%2Fextend.md%23application)%20for%20current%20request%2C%20through%20which%20we%20can%20access%20global%20objects%20and%20methods%20provided%20by%20the%20framework.%0A-%20%60this.service%60%3A%20%5BService%5D(.%2Fservice.md)%20defined%20by%20the%20application%2C%20through%20which%20we%20can%20access%20the%20abstract%20business%20layer%2C%20equivalent%20to%20%60this.ctx.service%60.%0A-%20%60this.config%60%3A%20the%20application's%20run-time%20%5Bconfig%5D(.%2Fconfig.md).%0A-%20%60this.logger%60%EF%BC%9Alogger%20with%20%60debug%60%EF%BC%8C%60info%60%EF%BC%8C%60warn%60%EF%BC%8C%60error%60%2C%20use%20to%20print%20different%20level%20logs%2C%20almost%20the%20same%20as%20%5Bcontext%20logger%5D(..%2Fcore%2Flogger.md%23context-logger)%2C%20but%20it%20will%20append%20Service%20file%20path%20for%20quickly%20track.%0A%0A%23%23%23%20Service%20ctx%20in%20Detail%0A%0ATo%20get%20the%20path%20chain%20of%20user%20request%2C%20the%20request%20context%20is%20injected%20by%20us%20during%20the%20Service%20initialization%2C%20so%20you%20are%20able%20to%20get%20the%20related%20information%20of%20context%20directly%20by%20%60this.ctx%60%20in%20methods.%20For%20detailed%20information%20about%20context%2C%20please%20refer%20to%20%5BContext%5D(.%2Fextend.md%23context).%0AWith%20%60ctx%60%2C%20we%20can%20get%20various%20convenient%20attributes%20and%20methods%20encapsulated%20by%20the%20framework.%20For%20example%20we%20can%20use%3A%0A%0A-%20%60this.ctx.curl%60%20to%20make%20network%20calls.%0A-%20%60this.ctx.service.otherService%60%20to%20call%20other%20Services.%0A-%20%60this.ctx.db%60%20to%20make%20database%20calls%20etc%2C%20where%20db%20may%20be%20a%20module%20mounted%20by%20other%20plugins%20in%20advance.%0A%0A%23%23%23%20Notes%0A%0A-%20Service%20files%20must%20be%20put%20under%20the%20%60app%2Fservice%60%20directory%2C%20and%20multi-level%20directory%20is%20supported%2C%20which%20can%20be%20accessed%20by%20cascading%20directory%20names.%0A%0A%60%60%60js%0Aapp%2Fservice%2Fbiz%2Fuser.js%20%3D%3E%20ctx.service.biz.user%0Aapp%2Fservice%2Fsync_user.js%20%3D%3E%20ctx.service.syncUser%0Aapp%2Fservice%2FHackerNews.js%20%3D%3E%20ctx.service.hackerNews%0A%60%60%60%0A%0A-%20one%20Service%20file%20can%20only%20define%20one%20Class%2C%20which%20should%20be%20returned%20by%20%60module.exports%60.%0A-%20Service%20should%20be%20defined%20in%20the%20Class%20way%2C%20and%20the%20parent%20class%20must%20be%20%60egg.Service%60.%0A-%20Service%20is%20not%20a%20singleton%20but%20a%20**request%20level**%20object%2C%20the%20framework%20lazy-initializes%20it%20when%20the%20request%20%60ctx.service.xx%60%20for%20the%20first%20time%2C%20so%20the%20context%20of%20current%20request%20can%20be%20got%20from%20this.ctx%20in%20Service.%0A%0A%23%23%20Using%20Service%0A%0AWe%20begin%20to%20see%20how%20to%20use%20Service%20from%20a%20complete%20example%20below.%0A%0A%60%60%60js%0A%2F%2F%20app%2Frouter.js%0Amodule.exports%20%3D%20app%20%3D%3E%20%7B%0A%20%20app.router.get('%2Fuser%2F%3Aid'%2C%20app.controller.user.info)%3B%0A%7D%3B%0A%0A%2F%2F%20app%2Fcontroller%2Fuser.js%0Aconst%20Controller%20%3D%20require('egg').Controller%3B%0Aclass%20UserController%20extends%20Controller%20%7B%0A%20%20async%20info()%20%7B%0A%20%20%20%20const%20userId%20%3D%20ctx.params.id%3B%0A%20%20%20%20const%20userInfo%20%3D%20await%20ctx.service.user.find(userId)%3B%0A%20%20%20%20ctx.body%20%3D%20userInfo%3B%0A%20%20%7D%0A%7D%0Amodule.exports%20%3D%20UserController%3B%0A%0A%2F%2F%20app%2Fservice%2Fuser.js%0Aconst%20Service%20%3D%20require('egg').Service%3B%0Aclass%20UserService%20extends%20Service%20%7B%0A%20%20%2F%2F%20the%20constructor%20is%20not%20a%20must%20by%20default%0A%20%20%2F%2F%20constructor(ctx)%20%7B%0A%20%20%2F%2F%20%20%20super(ctx)%3B%20if%20some%20processes%20should%20be%20made%20in%20the%20constructor%2C%20this%20statement%20is%20a%20must%20in%20order%20to%20use%20%60this.ctx%60%20later%0A%20%20%2F%2F%20%20%20%2F%2F%20get%20ctx%20through%20this.ctx%20directly%0A%20%20%2F%2F%20%20%20%2F%2F%20get%20app%20through%20this.app%20directly%20too%0A%20%20%2F%2F%20%7D%0A%20%20async%20find(uid)%20%7B%0A%20%20%20%20%2F%2F%20suppose%20we've%20got%20user's%20id%20and%20are%20going%20to%20get%20detailed%20user%20information%20from%20databases%0A%20%20%20%20const%20user%20%3D%20await%20this.ctx.db.query('select%20*%20from%20user%20where%20uid%20%3D%20%3F'%2C%20uid)%3B%0A%0A%20%20%20%20%2F%2F%20suppose%20some%20complex%20processes%20should%20be%20made%20here%2C%20and%20demanded%20informations%20are%20returned%20then.%0A%20%20%20%20const%20picture%20%3D%20await%20this.getPicture(uid)%3B%0A%0A%20%20%20%20return%20%7B%0A%20%20%20%20%20%20name%3A%20user.user_name%2C%0A%20%20%20%20%20%20age%3A%20user.age%2C%0A%20%20%20%20%20%20picture%2C%0A%20%20%20%20%7D%3B%0A%20%20%7D%0A%0A%20%20async%20getPicture(uid)%20%7B%0A%20%20%20%20const%20result%20%3D%20await%20this.ctx.curl(%60http%3A%2F%2Fphotoserver%2Fuid%3D%24%7Buid%7D%60%2C%20%7B%20dataType%3A%20'json'%20%7D)%3B%0A%20%20%20%20return%20result.data%3B%0A%20%20%7D%0A%7D%0Amodule.exports%20%3D%20UserService%3B%0A%0A%2F%2F%20curl%20http%3A%2F%2F127.0.0.1%3A7001%2Fuser%2F1234%0A%60%60%60%0A"}}</script><script type="text/javascript" src="/static/js/post.b9faab88.js"></script></body></html>