<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/manifest.json"><link rel="shortcut icon" href="/favicon.png"><style class="_styletron_hydrate_"></style><title>Runtime Environment</title><meta name="description" content="Born to build better enterprise frameworks and apps"><link href="/static/css/post.d62265dc.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="ant-layout" data-reactroot=""><div class="header-module__header___3ADJ9 ant-layout-header"><div class="ant-row-flex"><div class="ant-col-xs-12 ant-col-md-20 ant-col-lg-2"><div class="header-module__logo___3yTXp"><a href="/"><img src="/logo.svg" alt="logo"/></a></div></div><div class="ant-col-xs-0 ant-col-md-0 ant-col-lg-20"><ul class="ant-menu header-module__menu___3yEtW ant-menu-light ant-menu-root ant-menu-horizontal" role="menu"><li class="ant-menu-item" role="menuitem"><a href="/en/intro/">Guide</a></li><li class="ant-menu-item" role="menuitem"><a href="/api/">API</a></li><li class="ant-menu-item" role="menuitem"><a href="/en/tutorials/index.html">Tutorials</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/search?q=topic%3Aegg-plugin&amp;type=Repositories">Plugins</a></li><li class="ant-menu-item" role="menuitem"><a href="https://github.com/eggjs/egg/releases">Release</a></li></ul></div><div style="text-align:right" class="ant-col-xs-12 ant-col-md-4 ant-col-lg-2"><button type="button" class="ant-btn"><span>切换语言</span></button></div></div></div><div class="ant-layout-content"><div class="basic_layout-module__content___3flpY ant-layout"><div class="sider-module__side___1Cadj ant-layout-sider ant-layout-sider-light" style="flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"><ul class="ant-menu sider-module__menu___2GqPr ant-menu-light ant-menu-root ant-menu-inline" role="menu"><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="0$Menu" aria-haspopup="true"><span>Guide</span><i class="ant-menu-submenu-arrow"></i></div><ul id="0$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/index.html">What is Egg?</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/egg-and-koa.html">Egg and Koa</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/intro/quickstart.html">Quick Start</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/progressive.html">Progressive</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/migration.html">Migration to 2.x</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="1$Menu" aria-haspopup="true"><span>Basis Function</span><i class="ant-menu-submenu-arrow"></i></div><ul id="1$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/structure.html">Directory Structure</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/objects.html">Built-in Objects</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/env.html">Environment</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/config.html">Configuration</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/middleware.html">Middleware</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/router.html">Router</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/controller.html">Controller</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/service.html">Service</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/plugin.html">Plugin</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/schedule.html">Schedule</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/extend.html">Extend</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/basics/app-start.html">Custom Init</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="2$Menu" aria-haspopup="true"><span>Core</span><i class="ant-menu-submenu-arrow"></i></div><ul id="2$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/development.html">Development</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/unittest.html">Unit Testing</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/deployment.html">Deployment</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/logger.html">Logger</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/httpclient.html">HttpClient</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/cookie-and-session.html">Cookie and Session</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/cluster-and-ipc.html">Cluster and IPC</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/view.html">View</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/error-handling.html">Error Handling</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/security.html">Security</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/core/i18n.html">i18n</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="3$Menu" aria-haspopup="true"><span>Tutorials</span><i class="ant-menu-submenu-arrow"></i></div><ul id="3$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/mysql.html">MySQL</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/restful.html">RESTful API</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/passport.html">Passport</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/socketio.html">Socket.IO</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/assets.html">Assets</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/tutorials/typescript.html">TypeScript</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="4$Menu" aria-haspopup="true"><span>Advanced</span><i class="ant-menu-submenu-arrow"></i></div><ul id="4$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/loader.html">Loader</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/plugin.html">Plugin Development</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/framework.html">Framework</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/cluster-client.html">Cluster Enhancement</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/advanced/view-plugin.html">View Plugin</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/style-guide.html">Style Guide</a></li></ul></li><li class="ant-menu-submenu ant-menu-submenu-inline ant-menu-submenu-open" role="menuitem"><div style="padding-left:24px" class="ant-menu-submenu-title" aria-expanded="true" aria-owns="5$Menu" aria-haspopup="true"><span>Community</span><i class="ant-menu-submenu-arrow"></i></div><ul id="5$Menu" class="ant-menu  ant-menu-sub ant-menu-inline" role="menu"><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/plugins/">Plugin List</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/contributing.html">Contributing</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/resource.html">Resource</a></li><li class="ant-menu-item" role="menuitem" style="padding-left:48px"><a href="/en/faq.html">FAQ</a></li></ul></li></ul></div></div><div class="basic_layout-module__post___2Z7KK ant-layout-content"><div class="ant-row" style="margin-left:-8px;margin-right:-8px"><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-24 ant-col-md-18"><div class="markdown-body" style="font-size:14px"><div><p>An web application itself should be stateless and has the ability to set its own according to the runtime environment.</p><h2 id="configure-runtime-environment">Configure Runtime Environment</h2><p>Egg has two ways to configure runtime environment:</p><ol><li>Use <code>config/env</code> file, usually we use the build tools to generate this file, the content of this file is just the env value, such as <code>prod</code>.</li><li><p>use <code>EGG_SERVER_ENV</code> environment variable to configure.</p><p>The second way will be more commonly used, defining the runtime environment via <code>EGG_SERVER_ENV</code> when you start the application is more convenient, for example, use the code below to start the application in the production environment.</p></li></ol><pre><code class="language-shell">EGG_SERVER_ENV=prod npm start</code></pre><h2 id="access-to-the-runtime-environment-in-application">Access to the runtime environment in Application</h2><p>Egg provides a variable <code>app.config.env</code> to represent the current runtime environment of application.</p><h2 id="configurations-of-runtime-environment">Configurations of runtime environment</h2><p>Different running environment corresponds to different configurations, read <a href="./config.md">Configuration of Config</a> in detail.</p><h2 id="difference-from-node_env">Difference from NODE_ENV</h2><p>Lots of Node.js applications use <code>NODE_ENV</code> to distinguish the runtime environment, but <code>EGG_SERVER_ENV</code>  distinguishes the environments much more specific. Generally speaking, there are local environment, test environment, production environment during the application development. In addition to the local development environment and the test environment, other environments are collectively referred to as the <strong>Server Environment</strong> and their <code>NODE_ENV</code> should be set to <code>production</code>. What&#x27;s more, npm will use this variable and will not install the devDependencies when you deploy applications, so <code>production</code> should also be applied. </p><p>Default mapping of <code>EGG_SERVER_ENV</code> and <code>NODE_ENV</code> (will generate <code>EGG_SERVER_ENV</code> from <code>NODE_ENV</code> setting if <code>EGG_SERVER_ENV</code> is not specified)</p><table><thead><tr><th>NODE_ENV</th><th>EGG_SERVER_ENV</th><th>remarks</th></tr></thead><tbody><tr><td></td><td>local</td><td>local development environment</td></tr><tr><td>test</td><td>unittest</td><td>unit test environment</td></tr><tr><td>production</td><td>prod</td><td>production environment</td></tr></tbody></table><p>For example, <code>EGG_SERVER_ENV</code> will be set to prod when <code>NODE_ENV</code> is set as <code>production</code> and <code>EGG_SERVER_ENV</code> is not specified.</p><h2 id="customize-environment">Customize environment</h2><p>In normal development process, it&#x27;s not limit to these environments mentioned above. So you can customize environment for your development process.</p><p>For example, if you want to add SIT (System integration testing) to development process, you can set <code>EGG_SERVER_ENV</code> to <code>sit</code> (also recommend to set <code>NODE_ENV = production</code>), the framework will load <code>config/config.sit.js</code> when launching, and the runtime environment <code>app.config.env</code> will be <code>sit</code>.</p><h2 id="difference-from-koa">Difference from Koa</h2><p>We are using <code>app.env</code> to distinguish the environments in Koa, and the default value for <code>app.env</code> is <code>process.env.NODE_ENV</code>. But in Egg (and frameworks base on Egg), we put all the configurations in <code>app.config</code>, so we should use <code>app.config.env</code> to distinguish the environments, <code>app.env</code> is no longer used.</p></div></div></div><div style="padding-left:8px;padding-right:8px" class="ant-col-xs-0 ant-col-md-6"><div class="markdown-body" style="font-size:14px"><div><ul><li><a href="#configure-runtime-environment">Configure Runtime Environment</a></li><li><a href="#access-to-the-runtime-environment-in-application">Access to the runtime environment in Application</a></li><li><a href="#configurations-of-runtime-environment">Configurations of runtime environment</a></li><li><a href="#difference-from-node_env">Difference from NODE_ENV</a></li><li><a href="#customize-environment">Customize environment</a></li><li><a href="#difference-from-koa">Difference from Koa</a></li></ul></div></div></div></div></div></div></div></div></div><script type="text/javascript">window.__INIT_STATE__={"lang":"en","props":{"toc":"-%20%5BConfigure%20Runtime%20Environment%5D(%23configure-runtime-environment)%0A-%20%5BAccess%20to%20the%20runtime%20environment%20in%20Application%5D(%23access-to-the-runtime-environment-in-application)%0A-%20%5BConfigurations%20of%20runtime%20environment%5D(%23configurations-of-runtime-environment)%0A-%20%5BDifference%20from%20NODE_ENV%5D(%23difference-from-node_env)%0A-%20%5BCustomize%20environment%5D(%23customize-environment)%0A-%20%5BDifference%20from%20Koa%5D(%23difference-from-koa)","meta":{"info":{"title":"Runtime Environment"}},"content":"%0A%0A%0AAn%20web%20application%20itself%20should%20be%20stateless%20and%20has%20the%20ability%20to%20set%20its%20own%20according%20to%20the%20runtime%20environment.%0A%0A%0A%23%23%20Configure%20Runtime%20Environment%0A%0AEgg%20has%20two%20ways%20to%20configure%20runtime%20environment%3A%0A%0A1.%20Use%20%60config%2Fenv%60%20file%2C%20usually%20we%20use%20the%20build%20tools%20to%20generate%20this%20file%2C%20the%20content%20of%20this%20file%20is%20just%20the%20env%20value%2C%20such%20as%20%60prod%60.%0A2.%20use%20%60EGG_SERVER_ENV%60%20environment%20variable%20to%20configure.%0A%0A%20The%20second%20way%20will%20be%20more%20commonly%20used%2C%20defining%20the%20runtime%20environment%20via%20%60EGG_SERVER_ENV%60%20when%20you%20start%20the%20application%20is%20more%20convenient%2C%20for%20example%2C%20use%20the%20code%20below%20to%20start%20the%20application%20in%20the%20production%20environment.%0A%0A%60%60%60shell%0AEGG_SERVER_ENV%3Dprod%20npm%20start%0A%60%60%60%0A%0A%23%23%20Access%20to%20the%20runtime%20environment%20in%20Application%0A%0AEgg%20provides%20a%20variable%20%60app.config.env%60%20to%20represent%20the%20current%20runtime%20environment%20of%20application.%0A%0A%23%23%20Configurations%20of%20runtime%20environment%0A%0ADifferent%20running%20environment%20corresponds%20to%20different%20configurations%2C%20read%20%5BConfiguration%20of%20Config%5D(.%2Fconfig.md)%20in%20detail.%0A%0A%23%23%20Difference%20from%20NODE_ENV%0A%0ALots%20of%20Node.js%20applications%20use%20%60NODE_ENV%60%20to%20distinguish%20the%20runtime%20environment%2C%20but%20%60EGG_SERVER_ENV%60%20%20distinguishes%20the%20environments%20much%20more%20specific.%20Generally%20speaking%2C%20there%20are%20local%20environment%2C%20test%20environment%2C%20production%20environment%20during%20the%20application%20development.%20In%20addition%20to%20the%20local%20development%20environment%20and%20the%20test%20environment%2C%20other%20environments%20are%20collectively%20referred%20to%20as%20the%20**Server%20Environment**%20and%20their%20%60NODE_ENV%60%20should%20be%20set%20to%20%60production%60.%20What's%20more%2C%20npm%20will%20use%20this%20variable%20and%20will%20not%20install%20the%20devDependencies%20when%20you%20deploy%20applications%2C%20so%20%60production%60%20should%20also%20be%20applied.%20%0A%0ADefault%20mapping%20of%20%60EGG_SERVER_ENV%60%20and%20%60NODE_ENV%60%20(will%20generate%20%60EGG_SERVER_ENV%60%20from%20%60NODE_ENV%60%20setting%20if%20%60EGG_SERVER_ENV%60%20is%20not%20specified)%0A%0A%7C%20NODE_ENV%20%20%20%7C%20EGG_SERVER_ENV%20%7C%20remarks%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%0A%7C%20----------%20%7C%20--------------%20%7C%20-----------------------------%20%7C%0A%7C%20%20%20%20%20%20%20%20%20%20%20%20%7C%20local%20%20%20%20%20%20%20%20%20%20%7C%20local%20development%20environment%20%7C%0A%7C%20test%20%20%20%20%20%20%20%7C%20unittest%20%20%20%20%20%20%20%7C%20unit%20test%20environment%20%20%20%20%20%20%20%20%20%7C%0A%7C%20production%20%7C%20prod%20%20%20%20%20%20%20%20%20%20%20%7C%20production%20environment%20%20%20%20%20%20%20%20%7C%0A%0AFor%20example%2C%20%60EGG_SERVER_ENV%60%20will%20be%20set%20to%20prod%20when%20%60NODE_ENV%60%20is%20set%20as%20%60production%60%20and%20%60EGG_SERVER_ENV%60%20is%20not%20specified.%0A%0A%23%23%20Customize%20environment%0A%0AIn%20normal%20development%20process%2C%20it's%20not%20limit%20to%20these%20environments%20mentioned%20above.%20So%20you%20can%20customize%20environment%20for%20your%20development%20process.%0A%0AFor%20example%2C%20if%20you%20want%20to%20add%20SIT%20(System%20integration%20testing)%20to%20development%20process%2C%20you%20can%20set%20%60EGG_SERVER_ENV%60%20to%20%60sit%60%20(also%20recommend%20to%20set%20%60NODE_ENV%20%3D%20production%60)%2C%20the%20framework%20will%20load%20%60config%2Fconfig.sit.js%60%20when%20launching%2C%20and%20the%20runtime%20environment%20%60app.config.env%60%20will%20be%20%60sit%60.%0A%0A%23%23%20Difference%20from%20Koa%0A%0AWe%20are%20using%20%60app.env%60%20to%20distinguish%20the%20environments%20in%20Koa%2C%20and%20the%20default%20value%20for%20%60app.env%60%20is%20%60process.env.NODE_ENV%60.%20But%20in%20Egg%20(and%20frameworks%20base%20on%20Egg)%2C%20we%20put%20all%20the%20configurations%20in%20%60app.config%60%2C%20so%20we%20should%20use%20%60app.config.env%60%20to%20distinguish%20the%20environments%2C%20%60app.env%60%20is%20no%20longer%20used.%0A"}}</script><script type="text/javascript" src="/static/js/post.b9faab88.js"></script></body></html>